<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta property="og:url" content="https://newzone.top/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html"><meta property="og:site_name" content="æŒ¨è¸¢ç‰›é©¬"><meta property="og:title" content="MySQL"><meta property="og:description" content="MySQL ç®€ä»‹ æ•°æ®åº“ æ•°æ®åº“ï¼šDataBaseï¼Œç®€ç§° DBï¼Œå­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ä»“åº“ æ•°æ®åº“çš„ä¼˜åŠ¿ï¼š å¯ä»¥æŒä¹…åŒ–å­˜å‚¨æ•°æ® æ–¹ä¾¿å­˜å‚¨å’Œç®¡ç†æ•°æ® ä½¿ç”¨äº†ç»Ÿä¸€çš„æ–¹å¼æ“ä½œæ•°æ®åº“ SQL æ•°æ®åº“ã€æ•°æ®è¡¨ã€æ•°æ®çš„å…³ç³»ä»‹ç»ï¼š æ•°æ®åº“ ç”¨äºå­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ä»“åº“ ä¸€ä¸ªåº“ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ•°æ®è¡¨ æ•°æ®è¡¨ æ•°æ®åº“æœ€é‡è¦çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ ç”±çºµå‘çš„åˆ—å’Œæ¨ªå‘çš„è¡Œç»„æˆï¼ˆç±»ä¼¼ excel è¡¨æ ¼ï¼‰ å¯ä»¥æŒ‡å®šåˆ—åã€æ•°æ®ç±»å‹ã€çº¦æŸç­‰ ä¸€ä¸ªè¡¨ä¸­å¯ä»¥å­˜å‚¨å¤šæ¡æ•°æ® æ•°æ®ï¼šæƒ³è¦æ°¸ä¹…åŒ–å­˜å‚¨çš„æ•°æ®"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-08-16T07:46:55.000Z"><meta property="article:author" content="æŒ¨è¸¢ç‰›é©¬"><meta property="article:modified_time" content="2023-08-16T07:46:55.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"MySQL","image":[""],"dateModified":"2023-08-16T07:46:55.000Z","author":[{"@type":"Person","name":"æŒ¨è¸¢ç‰›é©¬","url":"https://newzone.top"}]}</script><link rel="alternate" type="application/rss+xml" href="https://newzone.top/rss.xml" title="æŒ¨è¸¢ç‰›é©¬ RSS Feed"><title>MySQL | æŒ¨è¸¢ç‰›é©¬</title><meta name="description" content="MySQL ç®€ä»‹ æ•°æ®åº“ æ•°æ®åº“ï¼šDataBaseï¼Œç®€ç§° DBï¼Œå­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ä»“åº“ æ•°æ®åº“çš„ä¼˜åŠ¿ï¼š å¯ä»¥æŒä¹…åŒ–å­˜å‚¨æ•°æ® æ–¹ä¾¿å­˜å‚¨å’Œç®¡ç†æ•°æ® ä½¿ç”¨äº†ç»Ÿä¸€çš„æ–¹å¼æ“ä½œæ•°æ®åº“ SQL æ•°æ®åº“ã€æ•°æ®è¡¨ã€æ•°æ®çš„å…³ç³»ä»‹ç»ï¼š æ•°æ®åº“ ç”¨äºå­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ä»“åº“ ä¸€ä¸ªåº“ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ•°æ®è¡¨ æ•°æ®è¡¨ æ•°æ®åº“æœ€é‡è¦çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€ ç”±çºµå‘çš„åˆ—å’Œæ¨ªå‘çš„è¡Œç»„æˆï¼ˆç±»ä¼¼ excel è¡¨æ ¼ï¼‰ å¯ä»¥æŒ‡å®šåˆ—åã€æ•°æ®ç±»å‹ã€çº¦æŸç­‰ ä¸€ä¸ªè¡¨ä¸­å¯ä»¥å­˜å‚¨å¤šæ¡æ•°æ® æ•°æ®ï¼šæƒ³è¦æ°¸ä¹…åŒ–å­˜å‚¨çš„æ•°æ®">
    <meta name="keywords" content="è‡ªæˆ‘æå‡,æ•ˆç‡æå‡,å¼€æºå·¥å…·,å­¦ä¹ ç¬”è®°" />
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #252232;
      }

      html,
      body {
        background: var(--bg-color);
      }
      .wwads-cn * {
        color: var(--text-color) !important;
      }
      @media screen and (max-width: 1300px) {
        .wwads-cn {
          display: none;
        }
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-962fc479.css" as="style"><link rel="stylesheet" href="/assets/style-962fc479.css">
    <link rel="modulepreload" href="/assets/app-3aac6385.js"><link rel="modulepreload" href="/assets/MySQL.html-032d438e.js"><link rel="modulepreload" href="/assets/MySQL.html-92d4238f.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/index.html-3ff342bf.js" as="script"><link rel="prefetch" href="/assets/blog.html-5b492070.js" as="script"><link rel="prefetch" href="/assets/intro.html-3e827329.js" as="script"><link rel="prefetch" href="/assets/JVM.html-38517126.js" as="script"><link rel="prefetch" href="/assets/JavaSE.html-253fd3a5.js" as="script"><link rel="prefetch" href="/assets/ç®—æ³•.html-2706b582.js" as="script"><link rel="prefetch" href="/assets/AJAX.html-cba67190.js" as="script"><link rel="prefetch" href="/assets/CSS.html-ab50b6dd.js" as="script"><link rel="prefetch" href="/assets/HTML.html-9118e91a.js" as="script"><link rel="prefetch" href="/assets/HTTP.html-a472e287.js" as="script"><link rel="prefetch" href="/assets/JS.html-655a3924.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-112d02b1.js" as="script"><link rel="prefetch" href="/assets/Servlet.html-c5fd170b.js" as="script"><link rel="prefetch" href="/assets/VUE.html-17a52af9.js" as="script"><link rel="prefetch" href="/assets/MyBatis.html-cb25e492.js" as="script"><link rel="prefetch" href="/assets/Spring.html-f53fa6cf.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-ab37d22b.js" as="script"><link rel="prefetch" href="/assets/SpringCloud.html-873fd3d2.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-13a7790a.js" as="script"><link rel="prefetch" href="/assets/AutoHotkey.html-93f77451.js" as="script"><link rel="prefetch" href="/assets/Electron.html-031583fb.js" as="script"><link rel="prefetch" href="/assets/HTML.html-262d2f4d.js" as="script"><link rel="prefetch" href="/assets/Javascript.html-1b3b627b.js" as="script"><link rel="prefetch" href="/assets/Markdown.html-756ae24c.js" as="script"><link rel="prefetch" href="/assets/Python.html-7189afc3.js" as="script"><link rel="prefetch" href="/assets/index.html-1bea80e3.js" as="script"><link rel="prefetch" href="/assets/Regex.html-e40c3d88.js" as="script"><link rel="prefetch" href="/assets/Vue.html-ddbcc429.js" as="script"><link rel="prefetch" href="/assets/Cloudflare.html-cc44ecff.js" as="script"><link rel="prefetch" href="/assets/DNS.html-15883a35.js" as="script"><link rel="prefetch" href="/assets/GitHub.html-2d104d0f.js" as="script"><link rel="prefetch" href="/assets/Static.html-9ecb0930.js" as="script"><link rel="prefetch" href="/assets/VPS.html-00f13f78.js" as="script"><link rel="prefetch" href="/assets/Comments.html-ca88c317.js" as="script"><link rel="prefetch" href="/assets/VuePress.html-f23b8ae5.js" as="script"><link rel="prefetch" href="/assets/docsify.html-d1c77532.js" as="script"><link rel="prefetch" href="/assets/Maven.html-dfae2894.js" as="script"><link rel="prefetch" href="/assets/Netty.html-af5debfd.js" as="script"><link rel="prefetch" href="/assets/RocketMQ.html-3e238d84.js" as="script"><link rel="prefetch" href="/assets/Zookeeper.html-8b4f9abb.js" as="script"><link rel="prefetch" href="/assets/Docker.html-33b7e6ff.js" as="script"><link rel="prefetch" href="/assets/Git.html-61c1908c.js" as="script"><link rel="prefetch" href="/assets/Linux.html-cc52cc1e.js" as="script"><link rel="prefetch" href="/assets/JUC.html-0ad57c4e.js" as="script"><link rel="prefetch" href="/assets/NET.html-06a07968.js" as="script"><link rel="prefetch" href="/assets/Javaæ•°æ®åº“API.html-fc1956d1.js" as="script"><link rel="prefetch" href="/assets/Redis.html-37f941e2.js" as="script"><link rel="prefetch" href="/assets/404.html-d452e021.js" as="script"><link rel="prefetch" href="/assets/index.html-4edb39e6.js" as="script"><link rel="prefetch" href="/assets/index.html-b9799b66.js" as="script"><link rel="prefetch" href="/assets/index.html-86025758.js" as="script"><link rel="prefetch" href="/assets/index.html-85cb61ed.js" as="script"><link rel="prefetch" href="/assets/index.html-6ea8950c.js" as="script"><link rel="prefetch" href="/assets/index.html-49598c38.js" as="script"><link rel="prefetch" href="/assets/index.html-28299f5a.js" as="script"><link rel="prefetch" href="/assets/index.html-4c521a15.js" as="script"><link rel="prefetch" href="/assets/index.html-22803f63.js" as="script"><link rel="prefetch" href="/assets/index.html-b9fff7fd.js" as="script"><link rel="prefetch" href="/assets/index.html-1e5e2781.js" as="script"><link rel="prefetch" href="/assets/index.html-202cc2d9.js" as="script"><link rel="prefetch" href="/assets/index.html-0904d946.js" as="script"><link rel="prefetch" href="/assets/index.html-a063af4b.js" as="script"><link rel="prefetch" href="/assets/index.html-b975f392.js" as="script"><link rel="prefetch" href="/assets/blog.html-bdf0a60b.js" as="script"><link rel="prefetch" href="/assets/intro.html-dbdff8b7.js" as="script"><link rel="prefetch" href="/assets/JVM.html-c170717b.js" as="script"><link rel="prefetch" href="/assets/JavaSE.html-1c00b98c.js" as="script"><link rel="prefetch" href="/assets/ç®—æ³•.html-f97b1b03.js" as="script"><link rel="prefetch" href="/assets/AJAX.html-b97ca552.js" as="script"><link rel="prefetch" href="/assets/CSS.html-c31987b3.js" as="script"><link rel="prefetch" href="/assets/HTML.html-b4b1d9ea.js" as="script"><link rel="prefetch" href="/assets/HTTP.html-2d8336c3.js" as="script"><link rel="prefetch" href="/assets/JS.html-d1aed2e6.js" as="script"><link rel="prefetch" href="/assets/Nginx.html-f688b163.js" as="script"><link rel="prefetch" href="/assets/Servlet.html-b7a4bf62.js" as="script"><link rel="prefetch" href="/assets/VUE.html-5b50a546.js" as="script"><link rel="prefetch" href="/assets/MyBatis.html-d33d8057.js" as="script"><link rel="prefetch" href="/assets/Spring.html-c6ade521.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-10d86294.js" as="script"><link rel="prefetch" href="/assets/SpringCloud.html-650c49a8.js" as="script"><link rel="prefetch" href="/assets/SpringMVC.html-813d7cfd.js" as="script"><link rel="prefetch" href="/assets/AutoHotkey.html-355f669e.js" as="script"><link rel="prefetch" href="/assets/Electron.html-61c02c3c.js" as="script"><link rel="prefetch" href="/assets/HTML.html-2c19d067.js" as="script"><link rel="prefetch" href="/assets/Javascript.html-ff9ab74c.js" as="script"><link rel="prefetch" href="/assets/Markdown.html-94c7bbcb.js" as="script"><link rel="prefetch" href="/assets/Python.html-76d6bcc6.js" as="script"><link rel="prefetch" href="/assets/index.html-2202ac76.js" as="script"><link rel="prefetch" href="/assets/Regex.html-8106b7bb.js" as="script"><link rel="prefetch" href="/assets/Vue.html-c022ab82.js" as="script"><link rel="prefetch" href="/assets/Cloudflare.html-5e38f011.js" as="script"><link rel="prefetch" href="/assets/DNS.html-a9288eff.js" as="script"><link rel="prefetch" href="/assets/GitHub.html-bc398c34.js" as="script"><link rel="prefetch" href="/assets/Static.html-8cbb84e6.js" as="script"><link rel="prefetch" href="/assets/VPS.html-a06913f6.js" as="script"><link rel="prefetch" href="/assets/Comments.html-31738cb9.js" as="script"><link rel="prefetch" href="/assets/VuePress.html-ec8deccd.js" as="script"><link rel="prefetch" href="/assets/docsify.html-0160f724.js" as="script"><link rel="prefetch" href="/assets/Maven.html-fdbac5c9.js" as="script"><link rel="prefetch" href="/assets/Netty.html-328d95cd.js" as="script"><link rel="prefetch" href="/assets/RocketMQ.html-cec36ebe.js" as="script"><link rel="prefetch" href="/assets/Zookeeper.html-e9b55c4d.js" as="script"><link rel="prefetch" href="/assets/Docker.html-e54107fd.js" as="script"><link rel="prefetch" href="/assets/Git.html-8adb41f1.js" as="script"><link rel="prefetch" href="/assets/Linux.html-4b846e04.js" as="script"><link rel="prefetch" href="/assets/JUC.html-428f7eb8.js" as="script"><link rel="prefetch" href="/assets/NET.html-06499db9.js" as="script"><link rel="prefetch" href="/assets/Javaæ•°æ®åº“API.html-dd84fd1d.js" as="script"><link rel="prefetch" href="/assets/Redis.html-d4995828.js" as="script"><link rel="prefetch" href="/assets/404.html-9c56c223.js" as="script"><link rel="prefetch" href="/assets/index.html-3d541f18.js" as="script"><link rel="prefetch" href="/assets/index.html-98600397.js" as="script"><link rel="prefetch" href="/assets/index.html-a6d2e783.js" as="script"><link rel="prefetch" href="/assets/index.html-4084d10a.js" as="script"><link rel="prefetch" href="/assets/index.html-df25c848.js" as="script"><link rel="prefetch" href="/assets/index.html-ea07f84a.js" as="script"><link rel="prefetch" href="/assets/index.html-91176658.js" as="script"><link rel="prefetch" href="/assets/index.html-efb1a73d.js" as="script"><link rel="prefetch" href="/assets/index.html-a2371e27.js" as="script"><link rel="prefetch" href="/assets/index.html-1cbbbd09.js" as="script"><link rel="prefetch" href="/assets/index.html-76b3d711.js" as="script"><link rel="prefetch" href="/assets/index.html-992507f9.js" as="script"><link rel="prefetch" href="/assets/index.html-c376f763.js" as="script"><link rel="prefetch" href="/assets/index.html-47a07d9c.js" as="script"><link rel="prefetch" href="/assets/plyr.min-d2156373.js" as="script"><link rel="prefetch" href="/assets/waline-meta-56fbc549.js" as="script"><link rel="prefetch" href="/assets/component-9b7941d1.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-5794cde2.js" as="script"><link rel="prefetch" href="/assets/pageview-d8f78d7a.js" as="script"><link rel="prefetch" href="/assets/SearchResult-172f634a.js" as="script">
    <!-- <script type="text/javascript" charset="UTF-8" src="https://cdn.wwads.cn/js/makemoney.js" async></script> -->
	  <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7585955822109216"
     crossorigin="anonymous"></script> -->
    <!-- Matomo æ­¤åŒºå—ä¸ºç»Ÿè®¡ä»£ç ï¼Œè¯·åˆ é™¤-->
    <script>
      var _paq = window._paq = window._paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="https://piwik.seoipo.com/";
        _paq.push(['setTrackerUrl', u+'matomo.php']);
        _paq.push(['setSiteId', '7']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code æ­¤åŒºå—ä¸ºç»Ÿè®¡ä»£ç ï¼Œè¯·åˆ é™¤-->
  </head>
  <body>
    <!-- <div class="wwads-cn wwads-vertical wwads-sticky" data-id="255" data-sticky-position="left" style="max-width:180px; background-color:var(--bg-color);"></div> -->
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/"><img class="vp-nav-logo" src="/æ©˜çŒ«.jpeg" alt="æŒ¨è¸¢ç‰›é©¬"><!----><span class="vp-site-name hide-in-pad">æŒ¨è¸¢ç‰›é©¬</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Contact"><span class="title"><span class="font-icon icon iconfont icon-advance" style=""></span>Contact</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="https://img.newzone.top/wechat.svg" rel="noopener noreferrer" target="_blank" aria-label="å¾®ä¿¡" class="nav-link"><span class="font-icon icon iconfont icon-wechat" style=""></span>å¾®ä¿¡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li><li class="dropdown-item"><a href="mailto:learndata@newzone.top" aria-label="Email" class="nav-link"><span class="font-icon icon iconfont icon-alias" style=""></span>Email<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ğŸ§° Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">ğŸŒ æ•°æ®åº“</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/Java%E6%95%B0%E6%8D%AE%E5%BA%93API.html"><!---->Javaæ•°æ®åº“API<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html"><!---->MySQL<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç®€ä»‹"><!---->ç®€ä»‹<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#æ•°æ®åº“"><!---->æ•°æ®åº“<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#mysql-1"><!---->MySQL<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ä½“ç³»æ¶æ„"><!---->ä½“ç³»æ¶æ„<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#æ•´ä½“æ¶æ„"><!---->æ•´ä½“æ¶æ„<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å»ºç«‹è¿æ¥"><!---->å»ºç«‹è¿æ¥<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#æ‰§è¡Œæµç¨‹"><!---->æ‰§è¡Œæµç¨‹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç»ˆæ­¢æµç¨‹"><!---->ç»ˆæ­¢æµç¨‹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å¸¸ç”¨å·¥å…·"><!---->å¸¸ç”¨å·¥å…·<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å•è¡¨æ“ä½œ"><!---->å•è¡¨æ“ä½œ<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#sql"><!---->SQL<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ddl"><!---->DDL<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#dml"><!---->DML<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#dql"><!---->DQL<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å¤šè¡¨æ“ä½œ"><!---->å¤šè¡¨æ“ä½œ<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#çº¦æŸåˆ†ç±»"><!---->çº¦æŸåˆ†ç±»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å¤šè¡¨è®¾è®¡"><!---->å¤šè¡¨è®¾è®¡<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#è¿æ¥æŸ¥è¯¢"><!---->è¿æ¥æŸ¥è¯¢<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#åµŒå¥—æŸ¥è¯¢"><!---->åµŒå¥—æŸ¥è¯¢<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#æŸ¥è¯¢ç»ƒä¹ "><!---->æŸ¥è¯¢ç»ƒä¹ <!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#é«˜çº§ç»“æ„"><!---->é«˜çº§ç»“æ„<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#è§†å›¾"><!---->è§†å›¾<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å­˜å‚¨è¿‡ç¨‹"><!---->å­˜å‚¨è¿‡ç¨‹<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#è§¦å‘å™¨"><!---->è§¦å‘å™¨<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å­˜å‚¨å¼•æ“"><!---->å­˜å‚¨å¼•æ“<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#åŸºæœ¬ä»‹ç»-3"><!---->åŸºæœ¬ä»‹ç»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å¼•æ“å¯¹æ¯”"><!---->å¼•æ“å¯¹æ¯”<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å¼•æ“æ“ä½œ"><!---->å¼•æ“æ“ä½œ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç´¢å¼•æœºåˆ¶"><!---->ç´¢å¼•æœºåˆ¶<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç´¢å¼•ä»‹ç»"><!---->ç´¢å¼•ä»‹ç»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç´¢å¼•æ“ä½œ"><!---->ç´¢å¼•æ“ä½œ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#èšç°‡ç´¢å¼•"><!---->èšç°‡ç´¢å¼•<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç´¢å¼•ç»“æ„"><!---->ç´¢å¼•ç»“æ„<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#è®¾è®¡åŸåˆ™"><!---->è®¾è®¡åŸåˆ™<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç´¢å¼•ä¼˜åŒ–"><!---->ç´¢å¼•ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç³»ç»Ÿä¼˜åŒ–"><!---->ç³»ç»Ÿä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#è¡¨ä¼˜åŒ–"><!---->è¡¨ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ä¼˜åŒ–æ­¥éª¤"><!---->ä¼˜åŒ–æ­¥éª¤<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç´¢å¼•ä¼˜åŒ–-1"><!---->ç´¢å¼•ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#sql-ä¼˜åŒ–"><!---->SQL ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç¼“å†²ä¼˜åŒ–"><!---->ç¼“å†²ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å†…å­˜ä¼˜åŒ–"><!---->å†…å­˜ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å­˜å‚¨ä¼˜åŒ–"><!---->å­˜å‚¨ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å¹¶å‘ä¼˜åŒ–"><!---->å¹¶å‘ä¼˜åŒ–<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#äº‹åŠ¡æœºåˆ¶"><!---->äº‹åŠ¡æœºåˆ¶<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#åŸºæœ¬ä»‹ç»-7"><!---->åŸºæœ¬ä»‹ç»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#äº‹åŠ¡ç®¡ç†"><!---->äº‹åŠ¡ç®¡ç†<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#éš”ç¦»çº§åˆ«"><!---->éš”ç¦»çº§åˆ«<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#åŸå­ç‰¹æ€§"><!---->åŸå­ç‰¹æ€§<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#éš”ç¦»ç‰¹æ€§"><!---->éš”ç¦»ç‰¹æ€§<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#æŒä¹…ç‰¹æ€§"><!---->æŒä¹…ç‰¹æ€§<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ä¸€è‡´ç‰¹æ€§"><!---->ä¸€è‡´ç‰¹æ€§<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#é”æœºåˆ¶"><!---->é”æœºåˆ¶<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#åŸºæœ¬ä»‹ç»-8"><!---->åŸºæœ¬ä»‹ç»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å†…å­˜ç»“æ„"><!---->å†…å­˜ç»“æ„<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#server"><!---->Server<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#myisam-1"><!---->MyISAM<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#innodb-1"><!---->InnoDB<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ä¹è§‚é”"><!---->ä¹è§‚é”<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ä¸»ä»"><!---->ä¸»ä»<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#åŸºæœ¬ä»‹ç»-9"><!---->åŸºæœ¬ä»‹ç»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ä¸»ä»å¤åˆ¶"><!---->ä¸»ä»å¤åˆ¶<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ä¸»ä»å»¶è¿Ÿ"><!---->ä¸»ä»å»¶è¿Ÿ<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#è¯»å†™åˆ†ç¦»"><!---->è¯»å†™åˆ†ç¦»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ä¸»ä»æ­å»º"><!---->ä¸»ä»æ­å»º<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ä¸»ä»åˆ‡æ¢"><!---->ä¸»ä»åˆ‡æ¢<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#æ—¥å¿—"><!---->æ—¥å¿—<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#æ—¥å¿—åˆ†ç±»"><!---->æ—¥å¿—åˆ†ç±»<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#é”™è¯¯æ—¥å¿—"><!---->é”™è¯¯æ—¥å¿—<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#å½’æ¡£æ—¥å¿—"><!---->å½’æ¡£æ—¥å¿—<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#æŸ¥è¯¢æ—¥å¿—"><!---->æŸ¥è¯¢æ—¥å¿—<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#æ…¢æ—¥å¿—"><!---->æ…¢æ—¥å¿—<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#èŒƒå¼"><!---->èŒƒå¼<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç¬¬ä¸€èŒƒå¼"><!---->ç¬¬ä¸€èŒƒå¼<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç¬¬äºŒèŒƒå¼"><!---->ç¬¬äºŒèŒƒå¼<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#ç¬¬ä¸‰èŒƒå¼"><!---->ç¬¬ä¸‰èŒƒå¼<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html#æ€»ç»“"><!---->æ€»ç»“<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html"><!---->Redis<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ğŸ—ï¸ ä¸­é—´ä»¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ğŸ‹ Springå…¨å®¶æ¡¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ğŸ‹ å¹¶å‘åŒ…</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ğŸ‹ å·¥å…·</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">ğŸ‹ JavaWeb</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->MySQL</h1><div class="page-info"><!----><!----><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 73160 å­—</span><meta property="wordCount" content="73160"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 244 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT244M"></span><span class="page-pageview-info" aria-label="è®¿é—®é‡ğŸ”¢" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="waline-pageview-count" data-path="/%E6%95%B0%E6%8D%AE%E5%BA%93/MySQL.html">...</span></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ç®€ä»‹">ç®€ä»‹</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•°æ®åº“">æ•°æ®åº“</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#mysql-1">MySQL</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ä½“ç³»æ¶æ„">ä½“ç³»æ¶æ„</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•´ä½“æ¶æ„">æ•´ä½“æ¶æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å»ºç«‹è¿æ¥">å»ºç«‹è¿æ¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ‰§è¡Œæµç¨‹">æ‰§è¡Œæµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç»ˆæ­¢æµç¨‹">ç»ˆæ­¢æµç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¸¸ç”¨å·¥å…·">å¸¸ç”¨å·¥å…·</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å•è¡¨æ“ä½œ">å•è¡¨æ“ä½œ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#sql">SQL</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ddl">DDL</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#dml">DML</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#dql">DQL</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å¤šè¡¨æ“ä½œ">å¤šè¡¨æ“ä½œ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#çº¦æŸåˆ†ç±»">çº¦æŸåˆ†ç±»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¤šè¡¨è®¾è®¡">å¤šè¡¨è®¾è®¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è¿æ¥æŸ¥è¯¢">è¿æ¥æŸ¥è¯¢</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åµŒå¥—æŸ¥è¯¢">åµŒå¥—æŸ¥è¯¢</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æŸ¥è¯¢ç»ƒä¹ ">æŸ¥è¯¢ç»ƒä¹ </a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#é«˜çº§ç»“æ„">é«˜çº§ç»“æ„</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è§†å›¾">è§†å›¾</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å­˜å‚¨è¿‡ç¨‹">å­˜å‚¨è¿‡ç¨‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è§¦å‘å™¨">è§¦å‘å™¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å­˜å‚¨å¼•æ“">å­˜å‚¨å¼•æ“</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åŸºæœ¬ä»‹ç»-3">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¼•æ“å¯¹æ¯”">å¼•æ“å¯¹æ¯”</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¼•æ“æ“ä½œ">å¼•æ“æ“ä½œ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ç´¢å¼•æœºåˆ¶">ç´¢å¼•æœºåˆ¶</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç´¢å¼•ä»‹ç»">ç´¢å¼•ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç´¢å¼•æ“ä½œ">ç´¢å¼•æ“ä½œ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#èšç°‡ç´¢å¼•">èšç°‡ç´¢å¼•</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç´¢å¼•ç»“æ„">ç´¢å¼•ç»“æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è®¾è®¡åŸåˆ™">è®¾è®¡åŸåˆ™</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç´¢å¼•ä¼˜åŒ–">ç´¢å¼•ä¼˜åŒ–</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ç³»ç»Ÿä¼˜åŒ–">ç³»ç»Ÿä¼˜åŒ–</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è¡¨ä¼˜åŒ–">è¡¨ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¼˜åŒ–æ­¥éª¤">ä¼˜åŒ–æ­¥éª¤</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç´¢å¼•ä¼˜åŒ–-1">ç´¢å¼•ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#sql-ä¼˜åŒ–">SQL ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¼“å†²ä¼˜åŒ–">ç¼“å†²ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å†…å­˜ä¼˜åŒ–">å†…å­˜ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å­˜å‚¨ä¼˜åŒ–">å­˜å‚¨ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¹¶å‘ä¼˜åŒ–">å¹¶å‘ä¼˜åŒ–</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#äº‹åŠ¡æœºåˆ¶">äº‹åŠ¡æœºåˆ¶</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åŸºæœ¬ä»‹ç»-7">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#äº‹åŠ¡ç®¡ç†">äº‹åŠ¡ç®¡ç†</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#éš”ç¦»çº§åˆ«">éš”ç¦»çº§åˆ«</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åŸå­ç‰¹æ€§">åŸå­ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#éš”ç¦»ç‰¹æ€§">éš”ç¦»ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æŒä¹…ç‰¹æ€§">æŒä¹…ç‰¹æ€§</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¸€è‡´ç‰¹æ€§">ä¸€è‡´ç‰¹æ€§</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#é”æœºåˆ¶">é”æœºåˆ¶</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åŸºæœ¬ä»‹ç»-8">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å†…å­˜ç»“æ„">å†…å­˜ç»“æ„</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#server">Server</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#myisam-1">MyISAM</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#innodb-1">InnoDB</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¹è§‚é”">ä¹è§‚é”</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ä¸»ä»">ä¸»ä»</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åŸºæœ¬ä»‹ç»-9">åŸºæœ¬ä»‹ç»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¸»ä»å¤åˆ¶">ä¸»ä»å¤åˆ¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¸»ä»å»¶è¿Ÿ">ä¸»ä»å»¶è¿Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è¯»å†™åˆ†ç¦»">è¯»å†™åˆ†ç¦»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¸»ä»æ­å»º">ä¸»ä»æ­å»º</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¸»ä»åˆ‡æ¢">ä¸»ä»åˆ‡æ¢</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#æ—¥å¿—">æ—¥å¿—</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ—¥å¿—åˆ†ç±»">æ—¥å¿—åˆ†ç±»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#é”™è¯¯æ—¥å¿—">é”™è¯¯æ—¥å¿—</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å½’æ¡£æ—¥å¿—">å½’æ¡£æ—¥å¿—</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æŸ¥è¯¢æ—¥å¿—">æŸ¥è¯¢æ—¥å¿—</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ…¢æ—¥å¿—">æ…¢æ—¥å¿—</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#èŒƒå¼">èŒƒå¼</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬ä¸€èŒƒå¼">ç¬¬ä¸€èŒƒå¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬äºŒèŒƒå¼">ç¬¬äºŒèŒƒå¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç¬¬ä¸‰èŒƒå¼">ç¬¬ä¸‰èŒƒå¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ€»ç»“">æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="mysql" tabindex="-1"><a class="header-anchor" href="#mysql" aria-hidden="true">#</a> MySQL</h1><h2 id="ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#ç®€ä»‹" aria-hidden="true">#</a> ç®€ä»‹</h2><h3 id="æ•°æ®åº“" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“" aria-hidden="true">#</a> æ•°æ®åº“</h3><p>æ•°æ®åº“ï¼šDataBaseï¼Œç®€ç§° DBï¼Œå­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ä»“åº“</p><p>æ•°æ®åº“çš„ä¼˜åŠ¿ï¼š</p><ul><li>å¯ä»¥æŒä¹…åŒ–å­˜å‚¨æ•°æ®</li><li>æ–¹ä¾¿å­˜å‚¨å’Œç®¡ç†æ•°æ®</li><li>ä½¿ç”¨äº†ç»Ÿä¸€çš„æ–¹å¼æ“ä½œæ•°æ®åº“ SQL</li></ul><p>æ•°æ®åº“ã€æ•°æ®è¡¨ã€æ•°æ®çš„å…³ç³»ä»‹ç»ï¼š</p><ul><li><p>æ•°æ®åº“</p><ul><li>ç”¨äºå­˜å‚¨å’Œç®¡ç†æ•°æ®çš„ä»“åº“</li><li>ä¸€ä¸ªåº“ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ•°æ®è¡¨</li></ul></li><li><p>æ•°æ®è¡¨</p><ul><li>æ•°æ®åº“æœ€é‡è¦çš„ç»„æˆéƒ¨åˆ†ä¹‹ä¸€</li><li>ç”±çºµå‘çš„åˆ—å’Œæ¨ªå‘çš„è¡Œç»„æˆï¼ˆç±»ä¼¼ excel è¡¨æ ¼ï¼‰</li><li>å¯ä»¥æŒ‡å®šåˆ—åã€æ•°æ®ç±»å‹ã€çº¦æŸç­‰</li><li>ä¸€ä¸ªè¡¨ä¸­å¯ä»¥å­˜å‚¨å¤šæ¡æ•°æ®</li></ul></li><li><p>æ•°æ®ï¼šæƒ³è¦æ°¸ä¹…åŒ–å­˜å‚¨çš„æ•°æ®</p></li></ul><p>å‚è€ƒè§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1zJ411M7TB" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1zJ411M7TB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å‚è€ƒä¸“æ ï¼š<a href="https://time.geekbang.org/column/intro/139" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/intro/139<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å‚è€ƒä¹¦ç±ï¼š<a href="https://book.douban.com/subject/35231266/" target="_blank" rel="noopener noreferrer">https://book.douban.com/subject/35231266/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h3 id="mysql-1" tabindex="-1"><a class="header-anchor" href="#mysql-1" aria-hidden="true">#</a> MySQL</h3><p>MySQL æ•°æ®åº“æ˜¯ä¸€ä¸ªæœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿä¹‹ä¸€ï¼Œå…³ç³»å‹æ•°æ®åº“æ˜¯å°†æ•°æ®ä¿å­˜åœ¨ä¸åŒçš„æ•°æ®è¡¨ä¸­ï¼Œè€Œä¸”è¡¨ä¸è¡¨ä¹‹é—´å¯ä»¥æœ‰å…³è”å…³ç³»ï¼Œæé«˜äº†çµæ´»æ€§</p><p>ç¼ºç‚¹ï¼šæ•°æ®å­˜å‚¨åœ¨ç£ç›˜ä¸­ï¼Œå¯¼è‡´è¯»å†™æ€§èƒ½å·®ï¼Œè€Œä¸”æ•°æ®å…³ç³»å¤æ‚ï¼Œæ‰©å±•æ€§å·®</p><p>MySQL æ‰€ä½¿ç”¨çš„ SQL è¯­å¥æ˜¯ç”¨äºè®¿é—®æ•°æ®åº“æœ€å¸¸ç”¨çš„æ ‡å‡†åŒ–è¯­è¨€</p><p>MySQL é…ç½®ï¼š</p><ul><li><p>MySQL å®‰è£…ï¼š<a href="https://www.jianshu.com/p/ba48f1e386f0" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/ba48f1e386f0<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>MySQL é…ç½®ï¼š</p><ul><li><p>ä¿®æ”¹ MySQL é»˜è®¤å­—ç¬¦é›†ï¼šå®‰è£… MySQL ä¹‹åç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä¿®æ”¹å­—ç¬¦é›†ç¼–ç </p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>vim /etc/mysql/my.cnf

æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š
[mysqld]
character-set-server=utf8
collation-server=utf8_general_ci

[client]
default-character-set=utf8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å¯åŠ¨ MySQL æœåŠ¡ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl start/restart mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ç™»å½• MySQLï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>  æ•²å›è½¦ï¼Œè¾“å…¥å¯†ç 
åˆå§‹å¯†ç æŸ¥çœ‹ï¼šcat /var/log/mysqld.log
åœ¨root@localhost:   åé¢çš„å°±æ˜¯åˆå§‹å¯†ç 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹é»˜è®¤å­—ç¬¦é›†å‘½ä»¤ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW VARIABLES LIKE &#39;char%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹MySQLç™»å½•å¯†ç ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>set global validate_password_policy=0;
set global validate_password_length=1;
  
set password=password(&#39;å¯†ç &#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æˆäºˆè¿œç¨‹è¿æ¥æƒé™ï¼ˆMySQL å†…è¾“å…¥ï¼‰ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- æˆæƒ
grant all privileges on *.* to &#39;root&#39; @&#39;%&#39; identified by &#39;å¯†ç &#39;;
-- åˆ·æ–°
flush privileges;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>ä¿®æ”¹ MySQL ç»‘å®š IPï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /etc/mysql/mysql.conf.d
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">666</span> mysqld.cnf 
<span class="token function">vim</span> mysqld.cnf 
<span class="token comment"># bind-address = 127.0.0.1æ³¨é‡Šè¯¥è¡Œ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å…³é—­ Linux é˜²ç«å¢™</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl stop firewalld.service
<span class="token comment"># æ”¾è¡Œ3306ç«¯å£</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h2 id="ä½“ç³»æ¶æ„" tabindex="-1"><a class="header-anchor" href="#ä½“ç³»æ¶æ„" aria-hidden="true">#</a> ä½“ç³»æ¶æ„</h2><h3 id="æ•´ä½“æ¶æ„" tabindex="-1"><a class="header-anchor" href="#æ•´ä½“æ¶æ„" aria-hidden="true">#</a> æ•´ä½“æ¶æ„</h3><p>ä½“ç³»ç»“æ„è¯¦è§£ï¼š</p><ul><li>ç¬¬ä¸€å±‚ï¼šç½‘ç»œè¿æ¥å±‚ <ul><li>ä¸€äº›å®¢æˆ·ç«¯å’Œé“¾æ¥æœåŠ¡ï¼ŒåŒ…å«æœ¬åœ° Socket é€šä¿¡å’Œå¤§å¤šæ•°åŸºäºå®¢æˆ·ç«¯/æœåŠ¡ç«¯å·¥å…·å®ç°çš„ TCP/IP é€šä¿¡ï¼Œä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆ</li><li>åœ¨è¯¥å±‚ä¸Šå¼•å…¥äº†<strong>è¿æ¥æ± </strong> Connection Pool çš„æ¦‚å¿µï¼Œç®¡ç†ç¼“å†²ç”¨æˆ·è¿æ¥ï¼Œçº¿ç¨‹å¤„ç†ç­‰éœ€è¦ç¼“å­˜çš„éœ€æ±‚</li><li>åœ¨è¯¥å±‚ä¸Šå®ç°åŸºäº SSL çš„å®‰å…¨é“¾æ¥ï¼ŒæœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™</li></ul></li></ul><ul><li>ç¬¬äºŒå±‚ï¼šæ ¸å¿ƒæœåŠ¡å±‚ <ul><li>æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ¶µç›– MySQL çš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆæ—¥æœŸã€æ•°å­¦ã€åŠ å¯†å‡½æ•°ç­‰ï¼‰ <ul><li>Management Serveices &amp; Utilitiesï¼šç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…·ï¼Œå¤‡ä»½ã€å®‰å…¨ã€å¤åˆ¶ã€é›†ç¾¤ç­‰</li><li>SQL Interfaceï¼šæ¥å—ç”¨æˆ·çš„ SQL å‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„ç»“æœ</li><li>Parserï¼šSQL è¯­å¥åˆ†æå™¨</li><li>Optimizerï¼šæŸ¥è¯¢ä¼˜åŒ–å™¨</li><li>Caches &amp; Buffersï¼šæŸ¥è¯¢ç¼“å­˜ï¼ŒæœåŠ¡å™¨ä¼šæŸ¥è¯¢å†…éƒ¨çš„ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ç©ºé—´è¶³å¤Ÿå¤§ï¼Œå¯ä»¥åœ¨å¤§é‡è¯»æ“ä½œçš„ç¯å¢ƒä¸­æå‡ç³»ç»Ÿæ€§èƒ½</li></ul></li><li>æ‰€æœ‰<strong>è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½</strong>åœ¨è¿™ä¸€å±‚å®ç°ï¼Œå¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰</li><li>åœ¨è¯¥å±‚æœåŠ¡å™¨ä¼šè§£ææŸ¥è¯¢å¹¶åˆ›å»ºç›¸åº”çš„å†…éƒ¨è§£ææ ‘ï¼Œå¹¶å¯¹å…¶å®Œæˆç›¸åº”çš„ä¼˜åŒ–å¦‚ç¡®å®šè¡¨çš„æŸ¥è¯¢é¡ºåºï¼Œæ˜¯å¦åˆ©ç”¨ç´¢å¼•ç­‰ï¼Œ æœ€åç”Ÿæˆç›¸åº”çš„æ‰§è¡Œæ“ä½œ</li><li>MySQL ä¸­æœåŠ¡å™¨å±‚ä¸ç®¡ç†äº‹åŠ¡ï¼Œ<strong>äº‹åŠ¡æ˜¯ç”±å­˜å‚¨å¼•æ“å®ç°çš„</strong></li></ul></li><li>ç¬¬ä¸‰å±‚ï¼šå­˜å‚¨å¼•æ“å±‚ <ul><li>Pluggable Storage Enginesï¼šå­˜å‚¨å¼•æ“æ¥å£ï¼ŒMySQL åŒºåˆ«äºå…¶ä»–æ•°æ®åº“çš„é‡è¦ç‰¹ç‚¹å°±æ˜¯å…¶å­˜å‚¨å¼•æ“çš„æ¶æ„æ¨¡å¼æ˜¯æ’ä»¶å¼çš„ï¼ˆå­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯æ•°æ®åº“ï¼‰</li><li>å­˜å‚¨å¼•æ“<strong>çœŸæ­£çš„è´Ÿè´£äº† MySQL ä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–</strong>ï¼ŒæœåŠ¡å™¨é€šè¿‡ API å’Œå­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡</li><li>ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œå…±ç”¨ä¸€ä¸ª Server å±‚ï¼Œå¯ä»¥æ ¹æ®å¼€å‘çš„éœ€è¦ï¼Œæ¥é€‰å–åˆé€‚çš„å­˜å‚¨å¼•æ“</li></ul></li><li>ç¬¬å››å±‚ï¼šç³»ç»Ÿæ–‡ä»¶å±‚ <ul><li>æ•°æ®å­˜å‚¨å±‚ï¼Œä¸»è¦æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’</li><li>File Systemï¼šæ–‡ä»¶ç³»ç»Ÿï¼Œä¿å­˜é…ç½®æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶ã€é”™è¯¯æ–‡ä»¶ã€äºŒè¿›åˆ¶æ–‡ä»¶ç­‰</li></ul></li></ul><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä½“ç³»ç»“æ„.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h3 id="å»ºç«‹è¿æ¥" tabindex="-1"><a class="header-anchor" href="#å»ºç«‹è¿æ¥" aria-hidden="true">#</a> å»ºç«‹è¿æ¥</h3><h4 id="è¿æ¥å™¨" tabindex="-1"><a class="header-anchor" href="#è¿æ¥å™¨" aria-hidden="true">#</a> è¿æ¥å™¨</h4><p>æ± åŒ–æŠ€æœ¯ï¼šå¯¹äºè®¿é—®æ•°æ®åº“æ¥è¯´ï¼Œå»ºç«‹è¿æ¥çš„ä»£ä»·æ˜¯æ¯”è¾ƒæ˜‚è´µçš„ï¼Œå› ä¸ºæ¯ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªç”¨æ¥äº¤äº’çš„çº¿ç¨‹ï¼Œé¢‘ç¹çš„åˆ›å»ºå…³é—­è¿æ¥æ¯”è¾ƒè€—è´¹èµ„æºï¼Œæœ‰å¿…è¦å»ºç«‹æ•°æ®åº“è¿æ¥æ± ï¼Œä»¥æé«˜è®¿é—®çš„æ€§èƒ½</p><p>è¿æ¥å»ºç«‹ TCP ä»¥åéœ€è¦åš<strong>æƒé™éªŒè¯</strong>ï¼ŒéªŒè¯æˆåŠŸåå¯ä»¥è¿›è¡Œæ‰§è¡Œ SQLã€‚å¦‚æœè¿™æ—¶ç®¡ç†å‘˜è´¦å·å¯¹è¿™ä¸ªç”¨æˆ·çš„æƒé™åšäº†ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šå½±å“å·²ç»å­˜åœ¨è¿æ¥çš„æƒé™ï¼Œåªæœ‰å†æ–°å»ºçš„è¿æ¥æ‰ä¼šä½¿ç”¨æ–°çš„æƒé™è®¾ç½®</p><p>MySQL æœåŠ¡å™¨å¯ä»¥åŒæ—¶å’Œå¤šä¸ªå®¢æˆ·ç«¯è¿›è¡Œäº¤äº’ï¼Œæ‰€ä»¥è¦ä¿è¯æ¯ä¸ªè¿æ¥ä¼šè¯çš„éš”ç¦»æ€§ï¼ˆäº‹åŠ¡æœºåˆ¶éƒ¨åˆ†è¯¦è§£ï¼‰</p><p>æ•´ä½“çš„æ‰§è¡Œæµç¨‹ï¼š</p><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-SQLçš„æ‰§è¡Œæµç¨‹.png" style="zoom:33%;"><hr><h4 id="æƒé™ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#æƒé™ä¿¡æ¯" aria-hidden="true">#</a> æƒé™ä¿¡æ¯</h4><p>grant è¯­å¥ä¼šåŒæ—¶ä¿®æ”¹æ•°æ®è¡¨å’Œå†…å­˜ï¼Œåˆ¤æ–­æƒé™çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯å†…å­˜æ•°æ®</p><p>flush privileges è¯­å¥æœ¬èº«ä¼šç”¨æ•°æ®è¡¨ï¼ˆç£ç›˜ï¼‰çš„æ•°æ®é‡å»ºä¸€ä»½å†…å­˜æƒé™æ•°æ®ï¼Œæ‰€ä»¥åœ¨æƒé™æ•°æ®å¯èƒ½å­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œè¿™ç§ä¸ä¸€è‡´å¾€å¾€æ˜¯ç”±äºç›´æ¥ç”¨ DML è¯­å¥æ“ä½œç³»ç»Ÿæƒé™è¡¨å¯¼è‡´çš„ï¼Œæ‰€ä»¥å°½é‡ä¸è¦ä½¿ç”¨è¿™ç±»è¯­å¥</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æƒé™èŒƒå›´.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h4 id="è¿æ¥çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#è¿æ¥çŠ¶æ€" aria-hidden="true">#</a> è¿æ¥çŠ¶æ€</h4><p>å®¢æˆ·ç«¯å¦‚æœé•¿æ—¶é—´æ²¡æœ‰æ“ä½œï¼Œè¿æ¥å™¨å°±ä¼šè‡ªåŠ¨æ–­å¼€ï¼Œæ—¶é—´æ˜¯ç”±å‚æ•° wait_timeout æ§åˆ¶çš„ï¼Œé»˜è®¤å€¼æ˜¯ 8 å°æ—¶ã€‚å¦‚æœåœ¨è¿æ¥è¢«æ–­å¼€ä¹‹åï¼Œå®¢æˆ·ç«¯<strong>å†æ¬¡å‘é€è¯·æ±‚</strong>çš„è¯ï¼Œå°±ä¼šæ”¶åˆ°ä¸€ä¸ªé”™è¯¯æé†’ï¼š<code>Lost connection to MySQL server during query</code></p><p>æ•°æ®åº“é‡Œé¢ï¼Œé•¿è¿æ¥æ˜¯æŒ‡è¿æ¥æˆåŠŸåï¼Œå¦‚æœå®¢æˆ·ç«¯æŒç»­æœ‰è¯·æ±‚ï¼Œåˆ™ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ï¼›çŸ­è¿æ¥åˆ™æ˜¯æŒ‡æ¯æ¬¡æ‰§è¡Œå®Œå¾ˆå°‘çš„å‡ æ¬¡æŸ¥è¯¢å°±æ–­å¼€è¿æ¥ï¼Œä¸‹æ¬¡æŸ¥è¯¢å†é‡æ–°å»ºç«‹ä¸€ä¸ª</p><p>ä¸ºäº†å‡å°‘è¿æ¥çš„åˆ›å»ºï¼Œæ¨èä½¿ç”¨é•¿è¿æ¥ï¼Œä½†æ˜¯<strong>è¿‡å¤šçš„é•¿è¿æ¥ä¼šé€ æˆ OOM</strong>ï¼Œè§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>å®šæœŸæ–­å¼€é•¿è¿æ¥ï¼Œä½¿ç”¨ä¸€æ®µæ—¶é—´ï¼Œæˆ–è€…ç¨‹åºé‡Œé¢åˆ¤æ–­æ‰§è¡Œè¿‡ä¸€ä¸ªå ç”¨å†…å­˜çš„å¤§æŸ¥è¯¢åï¼Œæ–­å¼€è¿æ¥ï¼Œä¹‹åè¦æŸ¥è¯¢å†é‡è¿</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>KILL CONNECTION id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>MySQL 5.7 ç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ“ä½œåï¼Œé€šè¿‡æ‰§è¡Œ mysql_reset_connection æ¥é‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æºï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦é‡è¿å’Œé‡æ–°åšæƒé™éªŒè¯ï¼Œä½†æ˜¯ä¼šå°†è¿æ¥æ¢å¤åˆ°åˆšåˆšåˆ›å»ºå®Œæ—¶çš„çŠ¶æ€</p></li></ul><p>SHOW PROCESSLISTï¼šæŸ¥çœ‹å½“å‰ MySQL åœ¨è¿›è¡Œçš„çº¿ç¨‹ï¼Œå¯ä»¥å®æ—¶åœ°æŸ¥çœ‹ SQL çš„æ‰§è¡Œæƒ…å†µï¼Œå…¶ä¸­çš„ Command åˆ—æ˜¾ç¤ºä¸º Sleep çš„è¿™ä¸€è¡Œï¼Œå°±è¡¨ç¤ºç°åœ¨ç³»ç»Ÿé‡Œé¢æœ‰ä¸€ä¸ªç©ºé—²è¿æ¥</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-SHOW_PROCESSLISTå‘½ä»¤.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ID</td><td>ç”¨æˆ·ç™»å½• mysql æ—¶ç³»ç»Ÿåˆ†é…çš„ connection_idï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•° connection_id() æŸ¥çœ‹</td></tr><tr><td>User</td><td>æ˜¾ç¤ºå½“å‰ç”¨æˆ·ï¼Œå¦‚æœä¸æ˜¯ rootï¼Œè¿™ä¸ªå‘½ä»¤å°±åªæ˜¾ç¤ºç”¨æˆ·æƒé™èŒƒå›´çš„ sql è¯­å¥</td></tr><tr><td>Host</td><td>æ˜¾ç¤ºè¿™ä¸ªè¯­å¥æ˜¯ä»å“ªä¸ª ip çš„å“ªä¸ªç«¯å£ä¸Šå‘çš„ï¼Œå¯ä»¥ç”¨æ¥è·Ÿè¸ªå‡ºç°é—®é¢˜è¯­å¥çš„ç”¨æˆ·</td></tr><tr><td>db</td><td>æ˜¾ç¤ºè¿™ä¸ªè¿›ç¨‹ç›®å‰è¿æ¥çš„æ˜¯å“ªä¸ªæ•°æ®åº“</td></tr><tr><td>Command</td><td>æ˜¾ç¤ºå½“å‰è¿æ¥çš„æ‰§è¡Œçš„å‘½ä»¤ï¼Œä¸€èˆ¬å–å€¼ä¸ºä¼‘çœ  Sleepã€æŸ¥è¯¢ Queryã€è¿æ¥ Connect ç­‰</td></tr><tr><td>Time</td><td>æ˜¾ç¤ºè¿™ä¸ªçŠ¶æ€æŒç»­çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’</td></tr><tr><td>State</td><td>æ˜¾ç¤ºä½¿ç”¨å½“å‰è¿æ¥çš„ sql è¯­å¥çš„çŠ¶æ€ï¼Œä»¥æŸ¥è¯¢ä¸ºä¾‹ï¼Œéœ€è¦ç»è¿‡ copying to tmp tableã€sorting resultã€sending dataç­‰çŠ¶æ€æ‰å¯ä»¥å®Œæˆ</td></tr><tr><td>Info</td><td>æ˜¾ç¤ºæ‰§è¡Œçš„ sql è¯­å¥ï¼Œæ˜¯åˆ¤æ–­é—®é¢˜è¯­å¥çš„ä¸€ä¸ªé‡è¦ä¾æ®</td></tr></tbody></table><p><strong>Sending data çŠ¶æ€</strong>è¡¨ç¤º MySQL çº¿ç¨‹å¼€å§‹è®¿é—®æ•°æ®è¡Œå¹¶æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸ä»…ä»…åªæ˜¯è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ˜¯å¤„äºæ‰§è¡Œå™¨è¿‡ç¨‹ä¸­çš„ä»»æ„é˜¶æ®µã€‚ç”±äºåœ¨ Sending data çŠ¶æ€ä¸‹ï¼ŒMySQL çº¿ç¨‹éœ€è¦åšå¤§é‡ç£ç›˜è¯»å–æ“ä½œï¼Œæ‰€ä»¥æ˜¯æ•´ä¸ªæŸ¥è¯¢ä¸­è€—æ—¶æœ€é•¿çš„çŠ¶æ€</p><hr><h3 id="æ‰§è¡Œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#æ‰§è¡Œæµç¨‹" aria-hidden="true">#</a> æ‰§è¡Œæµç¨‹</h3><h4 id="æŸ¥è¯¢ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢ç¼“å­˜" aria-hidden="true">#</a> æŸ¥è¯¢ç¼“å­˜</h4><h5 id="å·¥ä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œæµç¨‹" aria-hidden="true">#</a> å·¥ä½œæµç¨‹</h5><p>å½“æ‰§è¡Œå®Œå…¨ç›¸åŒçš„ SQL è¯­å¥çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å°±ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è¯»å–ç»“æœï¼Œå½“æ•°æ®è¢«ä¿®æ”¹ï¼Œä¹‹å‰çš„ç¼“å­˜ä¼šå¤±æ•ˆï¼Œä¿®æ”¹æ¯”è¾ƒé¢‘ç¹çš„è¡¨ä¸é€‚åˆåšæŸ¥è¯¢ç¼“å­˜</p><p>æŸ¥è¯¢è¿‡ç¨‹ï¼š</p><ol><li>å®¢æˆ·ç«¯å‘é€ä¸€æ¡æŸ¥è¯¢ç»™æœåŠ¡å™¨</li><li>æœåŠ¡å™¨å…ˆä¼šæ£€æŸ¥æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœå‘½ä¸­äº†ç¼“å­˜ï¼Œåˆ™ç«‹å³è¿”å›å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„ç»“æœï¼ˆä¸€èˆ¬æ˜¯ K-V é”®å€¼å¯¹ï¼‰ï¼Œå¦åˆ™è¿›å…¥ä¸‹ä¸€é˜¶æ®µ</li><li>åˆ†æå™¨è¿›è¡Œ SQL åˆ†æï¼Œå†ç”±ä¼˜åŒ–å™¨ç”Ÿæˆå¯¹åº”çš„æ‰§è¡Œè®¡åˆ’</li><li>æ‰§è¡Œå™¨æ ¹æ®ä¼˜åŒ–å™¨ç”Ÿæˆçš„æ‰§è¡Œè®¡åˆ’ï¼Œè°ƒç”¨å­˜å‚¨å¼•æ“çš„ API æ¥æ‰§è¡ŒæŸ¥è¯¢</li><li>å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</li></ol><p>å¤§å¤šæ•°æƒ…å†µä¸‹ä¸å»ºè®®ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œå› ä¸ºæŸ¥è¯¢ç¼“å­˜å¾€å¾€å¼Šå¤§äºåˆ©</p><ul><li>æŸ¥è¯¢ç¼“å­˜çš„<strong>å¤±æ•ˆéå¸¸é¢‘ç¹</strong>ï¼Œåªè¦æœ‰å¯¹ä¸€ä¸ªè¡¨çš„æ›´æ–°ï¼Œè¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚å› æ­¤å¾ˆå¯èƒ½è´¹åŠ›åœ°æŠŠç»“æœå­˜èµ·æ¥ï¼Œè¿˜æ²¡ä½¿ç”¨å°±è¢«ä¸€ä¸ªæ›´æ–°å…¨æ¸…ç©ºäº†ï¼Œå¯¹äºæ›´æ–°å‹åŠ›å¤§çš„æ•°æ®åº“æ¥è¯´ï¼ŒæŸ¥è¯¢ç¼“å­˜çš„å‘½ä¸­ç‡ä¼šéå¸¸ä½</li><li>é™¤éä¸šåŠ¡å°±æ˜¯æœ‰ä¸€å¼ é™æ€è¡¨ï¼Œå¾ˆé•¿æ—¶é—´æ‰ä¼šæ›´æ–°ä¸€æ¬¡ï¼Œæ¯”å¦‚ä¸€ä¸ªç³»ç»Ÿé…ç½®è¡¨ï¼Œé‚£è¿™å¼ è¡¨ä¸Šçš„æŸ¥è¯¢æ‰é€‚åˆä½¿ç”¨æŸ¥è¯¢ç¼“å­˜</li></ul><hr><h5 id="ç¼“å­˜é…ç½®" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜é…ç½®" aria-hidden="true">#</a> ç¼“å­˜é…ç½®</h5><ol><li><p>æŸ¥çœ‹å½“å‰ MySQL æ•°æ®åº“æ˜¯å¦æ”¯æŒæŸ¥è¯¢ç¼“å­˜ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW VARIABLES LIKE &#39;have_query_cache&#39;;	-- YES
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹å½“å‰ MySQL æ˜¯å¦å¼€å¯äº†æŸ¥è¯¢ç¼“å­˜ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW VARIABLES LIKE &#39;query_cache_type&#39;;	-- OFF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><p>OFF æˆ– 0ï¼šæŸ¥è¯¢ç¼“å­˜åŠŸèƒ½å…³é—­</p></li><li><p>ON æˆ– 1ï¼šæŸ¥è¯¢ç¼“å­˜åŠŸèƒ½æ‰“å¼€ï¼ŒæŸ¥è¯¢ç»“æœç¬¦åˆç¼“å­˜æ¡ä»¶å³ä¼šç¼“å­˜ï¼Œå¦åˆ™ä¸äºˆç¼“å­˜ï¼›å¯ä»¥æ˜¾å¼æŒ‡å®š SQL_NO_CACHE ä¸äºˆç¼“å­˜</p></li><li><p>DEMAND æˆ– 2ï¼šæŸ¥è¯¢ç¼“å­˜åŠŸèƒ½æŒ‰éœ€è¿›è¡Œï¼Œæ˜¾å¼æŒ‡å®š SQL_CACHE çš„ SELECT è¯­å¥æ‰ç¼“å­˜ï¼Œå…¶å®ƒä¸äºˆç¼“å­˜</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT SQL_CACHE id, name FROM customer; -- SQL_CACHE:æŸ¥è¯¢ç»“æœå¯ç¼“å­˜
SELECT SQL_NO_CACHE id, name FROM customer;-- SQL_NO_CACHE:ä¸ä½¿ç”¨æŸ¥è¯¢ç¼“å­˜
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„å ç”¨å¤§å°ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW VARIABLES LIKE &#39;query_cache_size&#39;;-- å•ä½æ˜¯å­—èŠ‚ 1048576 / 1024 = 1024 = 1KB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„çŠ¶æ€å˜é‡ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW STATUS LIKE &#39;Qcache%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æŸ¥è¯¢ç¼“å­˜çš„çŠ¶æ€å˜é‡.png" style="zoom:67%;"><table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>Qcache_free_blocks</td><td>æŸ¥è¯¢ç¼“å­˜ä¸­çš„å¯ç”¨å†…å­˜å—æ•°</td></tr><tr><td>Qcache_free_memory</td><td>æŸ¥è¯¢ç¼“å­˜çš„å¯ç”¨å†…å­˜é‡</td></tr><tr><td>Qcache_hits</td><td>æŸ¥è¯¢ç¼“å­˜å‘½ä¸­æ•°</td></tr><tr><td>Qcache_inserts</td><td>æ·»åŠ åˆ°æŸ¥è¯¢ç¼“å­˜çš„æŸ¥è¯¢æ•°</td></tr><tr><td>Qcache_lowmen_prunes</td><td>ç”±äºå†…å­˜ä¸è¶³è€Œä»æŸ¥è¯¢ç¼“å­˜ä¸­åˆ é™¤çš„æŸ¥è¯¢æ•°</td></tr><tr><td>Qcache_not_cached</td><td>éç¼“å­˜æŸ¥è¯¢çš„æ•°é‡ï¼ˆç”±äº query_cache_type è®¾ç½®è€Œæ— æ³•ç¼“å­˜æˆ–æœªç¼“å­˜ï¼‰</td></tr><tr><td>Qcache_queries_in_cache</td><td>æŸ¥è¯¢ç¼“å­˜ä¸­æ³¨å†Œçš„æŸ¥è¯¢æ•°</td></tr><tr><td>Qcache_total_blocks</td><td>æŸ¥è¯¢ç¼“å­˜ä¸­çš„å—æ€»æ•°</td></tr></tbody></table></li><li><p>é…ç½® my.cnfï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">666</span> /etc/mysql/my.cnf
<span class="token function">vim</span> my.cnf
<span class="token comment"># mysqldä¸­é…ç½®ç¼“å­˜</span>
<span class="token assign-left variable">query_cache_type</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡å¯æœåŠ¡æ—¢å¯ç”Ÿæ•ˆï¼Œæ‰§è¡Œ SQL è¯­å¥è¿›è¡ŒéªŒè¯ ï¼Œæ‰§è¡Œä¸€æ¡æ¯”è¾ƒè€—æ—¶çš„ SQL è¯­å¥ï¼Œç„¶åå†å¤šæ‰§è¡Œå‡ æ¬¡ï¼ŒæŸ¥çœ‹åé¢å‡ æ¬¡çš„æ‰§è¡Œæ—¶é—´ï¼›è·å–é€šè¿‡æŸ¥çœ‹æŸ¥è¯¢ç¼“å­˜çš„ç¼“å­˜å‘½ä¸­æ•°ï¼Œæ¥åˆ¤å®šæ˜¯å¦èµ°æŸ¥è¯¢ç¼“å­˜</p></li></ol><hr><h5 id="ç¼“å­˜å¤±æ•ˆ" tabindex="-1"><a class="header-anchor" href="#ç¼“å­˜å¤±æ•ˆ" aria-hidden="true">#</a> ç¼“å­˜å¤±æ•ˆ</h5><p>æŸ¥è¯¢ç¼“å­˜å¤±æ•ˆçš„æƒ…å†µï¼š</p><ul><li><p>SQL è¯­å¥ä¸ä¸€è‡´ï¼Œè¦æƒ³å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼ŒæŸ¥è¯¢çš„ SQL è¯­å¥å¿…é¡»ä¸€è‡´ï¼Œå› ä¸º<strong>ç¼“å­˜ä¸­ key æ˜¯æŸ¥è¯¢çš„è¯­å¥</strong>ï¼Œvalue æ˜¯æŸ¥è¯¢ç»“æ„</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select count(*) from tb_item;
Select count(*) from tb_item;	-- ä¸èµ°ç¼“å­˜ï¼Œé¦–å­—æ¯ä¸ä¸€è‡´
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å½“æŸ¥è¯¢è¯­å¥ä¸­æœ‰ä¸€äº›ä¸ç¡®å®šæŸ¥è¯¢æ—¶ï¼Œåˆ™ä¸ä¼šç¼“å­˜ï¼Œæ¯”å¦‚ï¼šnow()ã€current_date()ã€curdate()ã€curtime()ã€rand()ã€uuid()ã€user()ã€database()</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM tb_item WHERE updatetime &lt; NOW() LIMIT 1;
SELECT USER();
SELECT DATABASE();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¸ä½¿ç”¨ä»»ä½•è¡¨æŸ¥è¯¢è¯­å¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT &#39;A&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢ mysqlã€information_schemaã€performance_schema ç­‰ç³»ç»Ÿè¡¨æ—¶ï¼Œä¸èµ°æŸ¥è¯¢ç¼“å­˜ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM information_schema.engines;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>åœ¨<strong>è·¨å­˜å‚¨å¼•æ“</strong>çš„å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨æˆ–å­˜å‚¨å‡½æ•°çš„ä¸»ä½“å†…æ‰§è¡Œçš„æŸ¥è¯¢ï¼Œç¼“å­˜å¤±æ•ˆ</p></li><li><p>å¦‚æœè¡¨æ›´æ”¹ï¼Œåˆ™ä½¿ç”¨è¯¥è¡¨çš„<strong>æ‰€æœ‰é«˜é€Ÿç¼“å­˜æŸ¥è¯¢éƒ½å°†å˜ä¸ºæ— æ•ˆ</strong>å¹¶ä»é«˜é€Ÿç¼“å­˜ä¸­åˆ é™¤ï¼ŒåŒ…æ‹¬ä½¿ç”¨ MERGE æ˜ å°„åˆ°å·²æ›´æ”¹è¡¨çš„è¡¨çš„æŸ¥è¯¢ï¼Œæ¯”å¦‚ï¼šINSERTã€UPDATEã€DELETEã€ALTER TABLEã€DROP TABLEã€DROP DATABASE</p></li></ul><hr><h4 id="åˆ†æå™¨" tabindex="-1"><a class="header-anchor" href="#åˆ†æå™¨" aria-hidden="true">#</a> åˆ†æå™¨</h4><p>æ²¡æœ‰å‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œå°±å¼€å§‹äº† SQL çš„çœŸæ­£æ‰§è¡Œï¼Œåˆ†æå™¨ä¼šå¯¹ SQL è¯­å¥åšè§£æ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> t <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è§£æå™¨ï¼šå¤„ç†è¯­æ³•å’Œè§£ææŸ¥è¯¢ï¼Œç”Ÿæˆä¸€è¯¾å¯¹åº”çš„è§£ææ ‘</p><ul><li>å…ˆåš<strong>è¯æ³•åˆ†æ</strong>ï¼Œè¾“å…¥çš„æ˜¯ç”±å¤šä¸ªå­—ç¬¦ä¸²å’Œç©ºæ ¼ç»„æˆçš„ä¸€æ¡ SQL è¯­å¥ï¼ŒMySQL éœ€è¦è¯†åˆ«å‡ºé‡Œé¢çš„å­—ç¬¦ä¸²åˆ†åˆ«æ˜¯ä»€ä¹ˆä»£è¡¨ä»€ä¹ˆã€‚ä»è¾“å…¥çš„ select è¿™ä¸ªå…³é”®å­—è¯†åˆ«å‡ºæ¥è¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼›æŠŠå­—ç¬¦ä¸² t è¯†åˆ«æˆ è¡¨å tï¼ŒæŠŠå­—ç¬¦ä¸² id è¯†åˆ«æˆåˆ— id</li><li>ç„¶ååš<strong>è¯­æ³•åˆ†æ</strong>ï¼Œæ ¹æ®è¯æ³•åˆ†æçš„ç»“æœï¼Œè¯­æ³•åˆ†æå™¨ä¼šæ ¹æ®è¯­æ³•è§„åˆ™ï¼Œåˆ¤æ–­ä½ è¾“å…¥çš„è¿™ä¸ª SQL è¯­å¥æ˜¯å¦æ»¡è¶³ MySQL è¯­æ³•ã€‚å¦‚æœè¯­å¥ä¸å¯¹ï¼Œå°±ä¼šæ”¶åˆ° <code>You have an error in your SQL syntax</code> çš„é”™è¯¯æé†’</li></ul><p>é¢„å¤„ç†å™¨ï¼šè¿›ä¸€æ­¥æ£€æŸ¥è§£ææ ‘çš„åˆæ³•æ€§ï¼Œæ¯”å¦‚æ•°æ®è¡¨å’Œæ•°æ®åˆ—æ˜¯å¦å­˜åœ¨ã€åˆ«åæ˜¯å¦æœ‰æ­§ä¹‰ç­‰</p><hr><h4 id="ä¼˜åŒ–å™¨" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–å™¨" aria-hidden="true">#</a> ä¼˜åŒ–å™¨</h4><h5 id="æˆæœ¬åˆ†æ" tabindex="-1"><a class="header-anchor" href="#æˆæœ¬åˆ†æ" aria-hidden="true">#</a> æˆæœ¬åˆ†æ</h5><p>ä¼˜åŒ–å™¨æ˜¯åœ¨è¡¨é‡Œé¢æœ‰å¤šä¸ªç´¢å¼•çš„æ—¶å€™ï¼Œå†³å®šä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼›æˆ–è€…åœ¨ä¸€ä¸ªè¯­å¥æœ‰å¤šè¡¨å…³è”ï¼ˆjoinï¼‰çš„æ—¶å€™ï¼Œå†³å®šå„ä¸ªè¡¨çš„è¿æ¥é¡ºåº</p><ul><li>æ ¹æ®æœç´¢æ¡ä»¶æ‰¾å‡ºæ‰€æœ‰å¯èƒ½çš„ä½¿ç”¨çš„ç´¢å¼•</li><li>æˆæœ¬åˆ†æï¼Œæ‰§è¡Œæˆæœ¬ç”± I/O æˆæœ¬å’Œ CPU æˆæœ¬ç»„æˆï¼Œè®¡ç®—å…¨è¡¨æ‰«æå’Œä½¿ç”¨ä¸åŒç´¢å¼•æ‰§è¡Œ SQL çš„ä»£ä»·</li><li>æ‰¾åˆ°ä¸€ä¸ªæœ€ä¼˜çš„æ‰§è¡Œæ–¹æ¡ˆï¼Œç”¨æœ€å°çš„ä»£ä»·å»æ‰§è¡Œè¯­å¥</li></ul><p>åœ¨æ•°æ®åº“é‡Œé¢ï¼Œæ‰«æè¡Œæ•°æ˜¯å½±å“æ‰§è¡Œä»£ä»·çš„å› ç´ ä¹‹ä¸€ï¼Œæ‰«æçš„è¡Œæ•°è¶Šå°‘æ„å‘³ç€è®¿é—®ç£ç›˜çš„æ¬¡æ•°è¶Šå°‘ï¼Œæ¶ˆè€—çš„ CPU èµ„æºè¶Šå°‘ï¼Œä¼˜åŒ–å™¨è¿˜ä¼šç»“åˆæ˜¯å¦ä½¿ç”¨ä¸´æ—¶è¡¨ã€æ˜¯å¦æ’åºç­‰å› ç´ è¿›è¡Œç»¼åˆåˆ¤æ–­</p><hr><h5 id="ç»Ÿè®¡æ•°æ®" tabindex="-1"><a class="header-anchor" href="#ç»Ÿè®¡æ•°æ®" aria-hidden="true">#</a> ç»Ÿè®¡æ•°æ®</h5><p>MySQL ä¸­ä¿å­˜ç€ä¸¤ç§ç»Ÿè®¡æ•°æ®ï¼š</p><ul><li>innodb_table_stats å­˜å‚¨äº†è¡¨çš„ç»Ÿè®¡æ•°æ®ï¼Œæ¯ä¸€æ¡è®°å½•å¯¹åº”ç€ä¸€ä¸ªè¡¨çš„ç»Ÿè®¡æ•°æ®</li><li>innodb_index_stats å­˜å‚¨äº†ç´¢å¼•çš„ç»Ÿè®¡æ•°æ®ï¼Œæ¯ä¸€æ¡è®°å½•å¯¹åº”ç€ä¸€ä¸ªç´¢å¼•çš„ä¸€ä¸ªç»Ÿè®¡é¡¹çš„æ•°æ®</li></ul><p>MySQL åœ¨çœŸæ­£æ‰§è¡Œè¯­å¥ä¹‹å‰ï¼Œå¹¶ä¸èƒ½ç²¾ç¡®åœ°çŸ¥é“æ»¡è¶³æ¡ä»¶çš„è®°å½•æœ‰å¤šå°‘æ¡ï¼Œåªèƒ½æ ¹æ®ç»Ÿè®¡ä¿¡æ¯æ¥ä¼°ç®—è®°å½•ï¼Œç»Ÿè®¡ä¿¡æ¯å°±æ˜¯ç´¢å¼•çš„åŒºåˆ†åº¦ï¼Œä¸€ä¸ªç´¢å¼•ä¸Šä¸åŒçš„å€¼çš„ä¸ªæ•°ï¼ˆæ¯”å¦‚æ€§åˆ«åªèƒ½æ˜¯ç”·å¥³ï¼Œå°±æ˜¯ 2 ï¼‰ï¼Œç§°ä¹‹ä¸ºåŸºæ•°ï¼ˆcardinalityï¼‰ï¼Œ<strong>åŸºæ•°è¶Šå¤§è¯´æ˜åŒºåˆ†åº¦è¶Šå¥½</strong></p><p>é€šè¿‡<strong>é‡‡æ ·ç»Ÿè®¡</strong>æ¥è·å–åŸºæ•°ï¼ŒInnoDB é»˜è®¤ä¼šé€‰æ‹© N ä¸ªæ•°æ®é¡µï¼Œç»Ÿè®¡è¿™äº›é¡µé¢ä¸Šçš„ä¸åŒå€¼å¾—åˆ°ä¸€ä¸ªå¹³å‡å€¼ï¼Œç„¶åä¹˜ä»¥è¿™ä¸ªç´¢å¼•çš„é¡µé¢æ•°ï¼Œå°±å¾—åˆ°äº†è¿™ä¸ªç´¢å¼•çš„åŸºæ•°</p><p>åœ¨ MySQL ä¸­ï¼Œæœ‰ä¸¤ç§å­˜å‚¨ç»Ÿè®¡æ•°æ®çš„æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å‚æ•° <code>innodb_stats_persistent</code> çš„å€¼æ¥é€‰æ‹©ï¼š</p><ul><li>ONï¼šè¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯ä¼šæŒä¹…åŒ–å­˜å‚¨ï¼ˆé»˜è®¤ï¼‰ï¼Œé‡‡æ ·é¡µæ•° N é»˜è®¤ä¸º 20ï¼Œå¯ä»¥é€šè¿‡ <code>innodb_stats_persistent_sample_pages</code> æŒ‡å®šï¼Œé¡µæ•°è¶Šå¤šç»Ÿè®¡çš„æ•°æ®è¶Šå‡†ç¡®ï¼Œä½†æ¶ˆè€—çš„èµ„æºæ›´å¤§</li><li>OFFï¼šè¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯åªå­˜å‚¨åœ¨å†…å­˜ï¼Œé‡‡æ ·é¡µæ•° N é»˜è®¤ä¸º 8ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç³»ç»Ÿå˜é‡è®¾ç½®ï¼ˆä¸æ¨èï¼Œæ¯æ¬¡é‡æ–°è®¡ç®—æµªè´¹èµ„æºï¼‰</li></ul><p>æ•°æ®è¡¨æ˜¯ä¼šæŒç»­æ›´æ–°çš„ï¼Œä¸¤ç§ç»Ÿè®¡ä¿¡æ¯çš„æ›´æ–°æ–¹å¼ï¼š</p><ul><li>è®¾ç½® <code>innodb_stats_auto_recalc</code> ä¸º 1ï¼Œå½“å‘ç”Ÿå˜åŠ¨çš„è®°å½•æ•°é‡è¶…è¿‡è¡¨å¤§å°çš„ 10% æ—¶ï¼Œè‡ªåŠ¨è§¦å‘é‡æ–°è®¡ç®—ï¼Œä¸è¿‡æ˜¯<strong>å¼‚æ­¥è¿›è¡Œ</strong></li><li>è°ƒç”¨ <code>ANALYZE TABLE t</code> æ‰‹åŠ¨æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œåªå¯¹ä¿¡æ¯åš<strong>é‡æ–°ç»Ÿè®¡</strong>ï¼ˆä¸æ˜¯é‡å»ºè¡¨ï¼‰ï¼Œæ²¡æœ‰ä¿®æ”¹æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­åŠ äº† MDL è¯»é”å¹¶ä¸”æ˜¯åŒæ­¥è¿›è¡Œï¼Œæ‰€ä»¥ä¼šæš‚æ—¶é˜»å¡ç³»ç»Ÿ</li></ul><p><strong>EXPLAIN æ‰§è¡Œè®¡åˆ’åœ¨ä¼˜åŒ–å™¨é˜¶æ®µç”Ÿæˆ</strong>ï¼Œå¦‚æœ explain çš„ç»“æœé¢„ä¼°çš„ rows å€¼è·Ÿå®é™…æƒ…å†µå·®è·æ¯”è¾ƒå¤§ï¼Œå¯ä»¥æ‰§è¡Œ analyze å‘½ä»¤é‡æ–°ä¿®æ­£ä¿¡æ¯</p><hr><h5 id="é”™é€‰ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#é”™é€‰ç´¢å¼•" aria-hidden="true">#</a> é”™é€‰ç´¢å¼•</h5><p>é‡‡æ ·ç»Ÿè®¡æœ¬èº«æ˜¯ä¼°ç®—æ•°æ®ï¼Œæˆ–è€… SQL è¯­å¥ä¸­çš„å­—æ®µé€‰æ‹©æœ‰é—®é¢˜æ—¶ï¼Œå¯èƒ½å¯¼è‡´ MySQL æ²¡æœ‰é€‰æ‹©æ­£ç¡®çš„æ‰§è¡Œç´¢å¼•</p><p>è§£å†³æ–¹æ³•ï¼š</p><ul><li><p>é‡‡ç”¨ force index å¼ºè¡Œé€‰æ‹©ä¸€ä¸ªç´¢å¼•</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">FORCE</span> <span class="token keyword">INDEX</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token keyword">WHERE</span> NAME<span class="token operator">=</span><span class="token string">&#39;seazean&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å¯ä»¥è€ƒè™‘ä¿®æ”¹ SQL è¯­å¥ï¼Œå¼•å¯¼ MySQL ä½¿ç”¨æœŸæœ›çš„ç´¢å¼•</p></li><li><p>æ–°å»ºä¸€ä¸ªæ›´åˆé€‚çš„ç´¢å¼•ï¼Œæ¥æä¾›ç»™ä¼˜åŒ–å™¨åšé€‰æ‹©ï¼Œæˆ–åˆ æ‰è¯¯ç”¨çš„ç´¢å¼•</p></li></ul><hr><h4 id="æ‰§è¡Œå™¨" tabindex="-1"><a class="header-anchor" href="#æ‰§è¡Œå™¨" aria-hidden="true">#</a> æ‰§è¡Œå™¨</h4><p>å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦å…ˆåˆ¤æ–­ä¸€ä¸‹å½“å‰è¿æ¥å¯¹è¡¨æœ‰æ²¡æœ‰<strong>æ‰§è¡ŒæŸ¥è¯¢çš„æƒé™</strong>ï¼Œå¦‚æœæ²¡æœ‰å°±ä¼šè¿”å›æ²¡æœ‰æƒé™çš„é”™è¯¯ï¼Œåœ¨å·¥ç¨‹å®ç°ä¸Šï¼Œå¦‚æœå‘½ä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œä¼šåœ¨æŸ¥è¯¢ç¼“å­˜è¿”å›ç»“æœçš„æ—¶å€™ï¼Œåšæƒé™éªŒè¯ã€‚å¦‚æœæœ‰æƒé™ï¼Œå°±æ‰“å¼€è¡¨ç»§ç»­æ‰§è¡Œï¼Œæ‰§è¡Œå™¨å°±ä¼šæ ¹æ®è¡¨çš„å¼•æ“å®šä¹‰ï¼Œå»ä½¿ç”¨è¿™ä¸ªå¼•æ“æä¾›çš„æ¥å£</p><hr><h4 id="å¼•æ“å±‚" tabindex="-1"><a class="header-anchor" href="#å¼•æ“å±‚" aria-hidden="true">#</a> å¼•æ“å±‚</h4><p>Server å±‚å’Œå­˜å‚¨å¼•æ“å±‚çš„äº¤äº’æ˜¯<strong>ä»¥è®°å½•ä¸ºå•ä½çš„</strong>ï¼Œå­˜å‚¨å¼•æ“ä¼šå°†å•æ¡è®°å½•è¿”å›ç»™ Server å±‚åšè¿›ä¸€æ­¥å¤„ç†ï¼Œå¹¶ä¸æ˜¯ç›´æ¥è¿”å›æ‰€æœ‰çš„è®°å½•</p><p>å·¥ä½œæµç¨‹ï¼š</p><ul><li>é¦–å…ˆæ ¹æ®äºŒçº§ç´¢å¼•é€‰æ‹©æ‰«æèŒƒå›´ï¼Œè·å–ç¬¬ä¸€æ¡ç¬¦åˆäºŒçº§ç´¢å¼•æ¡ä»¶çš„è®°å½•ï¼Œè¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œå°†èšç°‡ç´¢å¼•çš„è®°å½•è¿”å› Server å±‚ï¼Œç”± Server åˆ¤æ–­è®°å½•æ˜¯å¦ç¬¦åˆè¦æ±‚</li><li>ç„¶ååœ¨äºŒçº§ç´¢å¼•ä¸Šç»§ç»­æ‰«æä¸‹ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„è®°å½•</li></ul><p>æ¨èé˜…è¯»ï¼š<a href="https://mp.weixin.qq.com/s/YZ-LckObephrP1f15mzHpA" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/YZ-LckObephrP1f15mzHpA<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h3 id="ç»ˆæ­¢æµç¨‹" tabindex="-1"><a class="header-anchor" href="#ç»ˆæ­¢æµç¨‹" aria-hidden="true">#</a> ç»ˆæ­¢æµç¨‹</h3><h4 id="ç»ˆæ­¢è¯­å¥" tabindex="-1"><a class="header-anchor" href="#ç»ˆæ­¢è¯­å¥" aria-hidden="true">#</a> ç»ˆæ­¢è¯­å¥</h4><p>ç»ˆæ­¢çº¿ç¨‹ä¸­æ­£åœ¨æ‰§è¡Œçš„è¯­å¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>KILL QUERY thread_id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>KILL ä¸æ˜¯é©¬ä¸Šç»ˆæ­¢çš„æ„æ€ï¼Œè€Œæ˜¯å‘Šè¯‰æ‰§è¡Œçº¿ç¨‹è¿™æ¡è¯­å¥å·²ç»ä¸éœ€è¦ç»§ç»­æ‰§è¡Œï¼Œå¯ä»¥å¼€å§‹æ‰§è¡Œåœæ­¢çš„é€»è¾‘ï¼ˆç±»ä¼¼äºæ‰“æ–­ï¼‰ã€‚å› ä¸ºå¯¹è¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œï¼Œä¼šåœ¨è¡¨ä¸ŠåŠ  MDL è¯»é”ï¼Œå¦‚æœçº¿ç¨‹è¢« KILL æ—¶å°±ç›´æ¥ç»ˆæ­¢ï¼Œé‚£è¿™ä¸ª MDL è¯»é”å°±æ²¡æœºä¼šè¢«é‡Šæ”¾äº†</p><p>å‘½ä»¤ <code>KILL QUERYthread_id_A</code> çš„æ‰§è¡Œæµç¨‹ï¼š</p><ul><li>æŠŠ session A çš„è¿è¡ŒçŠ¶æ€æ”¹æˆ THD::KILL_QUERYï¼ˆå°†å˜é‡ killed èµ‹å€¼ä¸º THD::KILL_QUERYï¼‰</li><li>ç»™ session A çš„æ‰§è¡Œçº¿ç¨‹å‘ä¸€ä¸ªä¿¡å·ï¼Œè®© session A æ¥å¤„ç†è¿™ä¸ª THD::KILL_QUERY çŠ¶æ€</li></ul><p>ä¼šè¯å¤„äºç­‰å¾…çŠ¶æ€ï¼ˆé”é˜»å¡ï¼‰ï¼Œå¿…é¡»æ»¡è¶³æ˜¯ä¸€ä¸ªå¯ä»¥è¢«å”¤é†’çš„ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœºä¼šå»<strong>åˆ¤æ–­çº¿ç¨‹çš„çŠ¶æ€</strong>ï¼Œå¦‚æœä¸æ»¡è¶³å°±ä¼šé€ æˆ KILL å¤±è´¥</p><p>å…¸å‹åœºæ™¯ï¼šinnodb_thread_concurrency ä¸º 2ï¼Œä»£è¡¨å¹¶å‘çº¿ç¨‹ä¸Šé™æ•°è®¾ç½®ä¸º 2</p><ul><li>session A æ‰§è¡Œäº‹åŠ¡ï¼Œsession B æ‰§è¡Œäº‹åŠ¡ï¼Œè¾¾åˆ°çº¿ç¨‹ä¸Šé™ï¼›æ­¤æ—¶ session C æ‰§è¡Œäº‹åŠ¡ä¼šé˜»å¡ç­‰å¾…ï¼Œsession D æ‰§è¡Œ kill query C æ— æ•ˆ</li><li>C çš„é€»è¾‘æ˜¯æ¯ 10 æ¯«ç§’åˆ¤æ–­æ˜¯å¦å¯ä»¥è¿›å…¥ InnoDB æ‰§è¡Œï¼Œå¦‚æœä¸è¡Œå°±è°ƒç”¨ nanosleep å‡½æ•°è¿›å…¥ sleep çŠ¶æ€ï¼Œæ²¡æœ‰å»åˆ¤æ–­çº¿ç¨‹çŠ¶æ€</li></ul><p>è¡¥å……ï¼šæ‰§è¡Œ Ctrl+C çš„æ—¶å€™ï¼Œæ˜¯ MySQL å®¢æˆ·ç«¯å¦å¤–å¯åŠ¨ä¸€ä¸ªè¿æ¥ï¼Œç„¶åå‘é€ä¸€ä¸ª KILL QUERY å‘½ä»¤</p><hr><h4 id="ç»ˆæ­¢è¿æ¥" tabindex="-1"><a class="header-anchor" href="#ç»ˆæ­¢è¿æ¥" aria-hidden="true">#</a> ç»ˆæ­¢è¿æ¥</h4><p>æ–­å¼€çº¿ç¨‹çš„è¿æ¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>KILL CONNECTION id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ–­å¼€è¿æ¥åæ‰§è¡Œ SHOW PROCESSLIST å‘½ä»¤ï¼Œå¦‚æœè¿™æ¡è¯­å¥çš„ Command åˆ—æ˜¾ç¤º Killedï¼Œä»£è¡¨çº¿ç¨‹çš„çŠ¶æ€æ˜¯ KILL_CONNECTIONï¼Œè¯´æ˜è¿™ä¸ªçº¿ç¨‹æœ‰è¯­å¥æ­£åœ¨æ‰§è¡Œï¼Œå½“å‰çŠ¶æ€æ˜¯åœæ­¢è¯­å¥æ‰§è¡Œä¸­ï¼Œç»ˆæ­¢é€»è¾‘è€—æ—¶è¾ƒé•¿</p><ul><li>è¶…å¤§äº‹åŠ¡æ‰§è¡ŒæœŸé—´è¢« KILLï¼Œè¿™æ—¶å›æ»šæ“ä½œéœ€è¦å¯¹äº‹åŠ¡æ‰§è¡ŒæœŸé—´ç”Ÿæˆçš„æ‰€æœ‰æ–°æ•°æ®ç‰ˆæœ¬åšå›æ”¶æ“ä½œï¼Œè€—æ—¶å¾ˆé•¿</li><li>å¤§æŸ¥è¯¢å›æ»šï¼Œå¦‚æœæŸ¥è¯¢è¿‡ç¨‹ä¸­ç”Ÿæˆäº†æ¯”è¾ƒå¤§çš„ä¸´æ—¶æ–‡ä»¶ï¼Œåˆ é™¤ä¸´æ—¶æ–‡ä»¶å¯èƒ½éœ€è¦ç­‰å¾… IO èµ„æºï¼Œå¯¼è‡´è€—æ—¶è¾ƒé•¿</li><li>DDL å‘½ä»¤æ‰§è¡Œåˆ°æœ€åé˜¶æ®µè¢« KILLï¼Œéœ€è¦åˆ é™¤ä¸­é—´è¿‡ç¨‹çš„ä¸´æ—¶æ–‡ä»¶ï¼Œä¹Ÿå¯èƒ½å— IO èµ„æºå½±å“è€—æ—¶è¾ƒä¹…</li></ul><p>æ€»ç»“ï¼šKILL CONNECTION æœ¬è´¨ä¸Šåªæ˜¯æŠŠå®¢æˆ·ç«¯çš„ SQL è¿æ¥æ–­å¼€ï¼Œåé¢çš„ç»ˆæ­¢æµç¨‹è¿˜æ˜¯è¦èµ° KILL QUERY</p><p>ä¸€ä¸ªäº‹åŠ¡è¢« KILL ä¹‹åï¼ŒæŒç»­å¤„äºå›æ»šçŠ¶æ€ï¼Œä¸åº”è¯¥å¼ºè¡Œé‡å¯æ•´ä¸ª MySQL è¿›ç¨‹ï¼Œåº”è¯¥ç­‰å¾…äº‹åŠ¡è‡ªå·±æ‰§è¡Œå®Œæˆï¼Œå› ä¸ºé‡å¯åä¾ç„¶ç»§ç»­åšå›æ»šæ“ä½œçš„é€»è¾‘</p><hr><h3 id="å¸¸ç”¨å·¥å…·" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨å·¥å…·" aria-hidden="true">#</a> å¸¸ç”¨å·¥å…·</h3><h4 id="mysql-2" tabindex="-1"><a class="header-anchor" href="#mysql-2" aria-hidden="true">#</a> mysql</h4><p>mysql ä¸æ˜¯æŒ‡ mysql æœåŠ¡ï¼Œè€Œæ˜¯æŒ‡ mysql çš„å®¢æˆ·ç«¯å·¥å…·</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>database<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>-u --user=nameï¼šæŒ‡å®šç”¨æˆ·å</li><li>-p --password[=name]ï¼šæŒ‡å®šå¯†ç </li><li>-h --host=nameï¼šæŒ‡å®šæœåŠ¡å™¨IPæˆ–åŸŸå</li><li>-P --port=#ï¼šæŒ‡å®šè¿æ¥ç«¯å£</li><li>-e --execute=nameï¼šæ‰§è¡ŒSQLè¯­å¥å¹¶é€€å‡ºï¼Œåœ¨æ§åˆ¶å°æ‰§è¡ŒSQLè¯­å¥ï¼Œè€Œä¸ç”¨è¿æ¥åˆ°æ•°æ®åº“æ‰§è¡Œ</li></ul><p>ç¤ºä¾‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-h</span> <span class="token number">127.0</span>.0.1 <span class="token parameter variable">-P</span> <span class="token number">3306</span> <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>
mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p2143</span> db01 <span class="token parameter variable">-e</span> <span class="token string">&quot;select * from tb_book&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="admin" tabindex="-1"><a class="header-anchor" href="#admin" aria-hidden="true">#</a> admin</h4><p>mysqladmin æ˜¯ä¸€ä¸ªæ‰§è¡Œç®¡ç†æ“ä½œçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œç”¨æ¥æ£€æŸ¥æœåŠ¡å™¨çš„é…ç½®å’Œå½“å‰çŠ¶æ€ã€åˆ›å»ºå¹¶åˆ é™¤æ•°æ®åº“ç­‰</p><p>é€šè¿‡ <code>mysqladmin --help</code> æŒ‡ä»¤æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqladmin <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p2143</span> create <span class="token string">&#39;test01&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h4 id="binlog" tabindex="-1"><a class="header-anchor" href="#binlog" aria-hidden="true">#</a> binlog</h4><p>æœåŠ¡å™¨ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ä»¥äºŒè¿›åˆ¶æ ¼å¼ä¿å­˜ï¼Œå¦‚æœéœ€è¦æ£€æŸ¥è¿™äº›æ–‡æœ¬ï¼Œå°±è¦ä½¿ç”¨ mysqlbinlog æ—¥å¿—ç®¡ç†å·¥å…·</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlbinlog <span class="token punctuation">[</span>options<span class="token punctuation">]</span>  log-files1 log-files2 <span class="token punctuation">..</span>.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>-d --database=nameï¼šæŒ‡å®šæ•°æ®åº“åç§°ï¼Œåªåˆ—å‡ºæŒ‡å®šçš„æ•°æ®åº“ç›¸å…³æ“ä½œ</p></li><li><p>-o --offset=#ï¼šå¿½ç•¥æ‰æ—¥å¿—ä¸­çš„å‰ n è¡Œå‘½ä»¤ã€‚</p></li><li><p>-r --result-file=nameï¼šå°†è¾“å‡ºçš„æ–‡æœ¬æ ¼å¼æ—¥å¿—è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ã€‚</p></li><li><p>-s --short-formï¼šæ˜¾ç¤ºç®€å•æ ¼å¼ï¼Œçœç•¥æ‰ä¸€äº›ä¿¡æ¯ã€‚</p></li><li><p>--start-datatime=date1 --stop-datetime=date2ï¼šæŒ‡å®šæ—¥æœŸé—´éš”å†…çš„æ‰€æœ‰æ—¥å¿—</p></li><li><p>--start-position=pos1 --stop-position=pos2ï¼šæŒ‡å®šä½ç½®é—´éš”å†…çš„æ‰€æœ‰æ—¥å¿—</p></li></ul><hr><h4 id="dump" tabindex="-1"><a class="header-anchor" href="#dump" aria-hidden="true">#</a> dump</h4><h5 id="å‘½ä»¤ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#å‘½ä»¤ä»‹ç»" aria-hidden="true">#</a> å‘½ä»¤ä»‹ç»</h5><p>mysqldump å®¢æˆ·ç«¯å·¥å…·ç”¨æ¥å¤‡ä»½æ•°æ®åº“æˆ–åœ¨ä¸åŒæ•°æ®åº“ä¹‹é—´è¿›è¡Œæ•°æ®è¿ç§»ï¼Œå¤‡ä»½å†…å®¹åŒ…å«åˆ›å»ºè¡¨ï¼ŒåŠæ’å…¥è¡¨çš„ SQL è¯­å¥</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token punctuation">[</span>options<span class="token punctuation">]</span> db_name <span class="token punctuation">[</span>tables<span class="token punctuation">]</span>
mysqldump <span class="token punctuation">[</span>options<span class="token punctuation">]</span> --database/-B db1 <span class="token punctuation">[</span>db2 db3<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
mysqldump <span class="token punctuation">[</span>options<span class="token punctuation">]</span> --all-databases/-A
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿æ¥é€‰é¡¹ï¼š</p><ul><li>-u --user=nameï¼šæŒ‡å®šç”¨æˆ·å</li><li>-p --password[=name]ï¼šæŒ‡å®šå¯†ç </li><li>-h --host=nameï¼šæŒ‡å®šæœåŠ¡å™¨ IP æˆ–åŸŸå</li><li>-P --port=#ï¼šæŒ‡å®šè¿æ¥ç«¯å£</li></ul><p>è¾“å‡ºå†…å®¹é€‰é¡¹ï¼š</p><ul><li>--add-drop-databaseï¼šåœ¨æ¯ä¸ªæ•°æ®åº“åˆ›å»ºè¯­å¥å‰åŠ ä¸Š Drop database è¯­å¥</li><li>--add-drop-tableï¼šåœ¨æ¯ä¸ªè¡¨åˆ›å»ºè¯­å¥å‰åŠ ä¸Š Drop table è¯­å¥ , é»˜è®¤å¼€å¯ï¼Œä¸å¼€å¯ (--skip-add-drop-table)</li><li>-n --no-create-dbï¼šä¸åŒ…å«æ•°æ®åº“çš„åˆ›å»ºè¯­å¥</li><li>-t --no-create-infoï¼šä¸åŒ…å«æ•°æ®è¡¨çš„åˆ›å»ºè¯­å¥</li><li>-d --no-dataï¼šä¸åŒ…å«æ•°æ®</li><li>-T, --tab=nameï¼šè‡ªåŠ¨ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼šä¸€ä¸ª .sql æ–‡ä»¶ï¼Œåˆ›å»ºè¡¨ç»“æ„çš„è¯­å¥ï¼›ä¸€ä¸ª .txt æ–‡ä»¶ï¼Œæ•°æ®æ–‡ä»¶ï¼Œç›¸å½“äº select into outfile</li></ul><p>ç¤ºä¾‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p2143</span> db01 tb_book --add-drop-database --add-drop-table <span class="token operator">&gt;</span> a
mysqldump <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p2143</span> <span class="token parameter variable">-T</span> /tmp <span class="token builtin class-name">test</span> city
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h5 id="æ•°æ®å¤‡ä»½" tabindex="-1"><a class="header-anchor" href="#æ•°æ®å¤‡ä»½" aria-hidden="true">#</a> æ•°æ®å¤‡ä»½</h5><p>å‘½ä»¤è¡Œæ–¹å¼ï¼š</p><ul><li>å¤‡ä»½å‘½ä»¤ï¼šmysqldump -u root -p æ•°æ®åº“åç§° &gt; æ–‡ä»¶ä¿å­˜è·¯å¾„</li><li>æ¢å¤ <ol><li>ç™»å½•MySQLæ•°æ®åº“ï¼š<code>mysql -u root p</code></li><li>åˆ é™¤å·²ç»å¤‡ä»½çš„æ•°æ®åº“</li><li>é‡æ–°åˆ›å»ºä¸å¤‡ä»½æ•°æ®åº“åç§°ç›¸åŒçš„æ•°æ®åº“</li><li>ä½¿ç”¨è¯¥æ•°æ®åº“</li><li>å¯¼å…¥æ–‡ä»¶æ‰§è¡Œï¼š<code>source å¤‡ä»½æ–‡ä»¶å…¨è·¯å¾„</code></li></ol></li></ul><p>æ›´å¤šæ–¹å¼å‚è€ƒï¼š<a href="https://time.geekbang.org/column/article/81925" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/81925<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å›¾å½¢åŒ–ç•Œé¢ï¼š</p><ul><li><p>å¤‡ä»½</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/å›¾å½¢åŒ–ç•Œé¢å¤‡ä»½.png" alt="å›¾å½¢åŒ–ç•Œé¢å¤‡ä»½" tabindex="0" loading="lazy"><figcaption>å›¾å½¢åŒ–ç•Œé¢å¤‡ä»½</figcaption></figure></li><li><p>æ¢å¤</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/å›¾å½¢åŒ–ç•Œé¢æ¢å¤.png" alt="å›¾å½¢åŒ–ç•Œé¢æ¢å¤" tabindex="0" loading="lazy"><figcaption>å›¾å½¢åŒ–ç•Œé¢æ¢å¤</figcaption></figure></li></ul><hr><h4 id="import" tabindex="-1"><a class="header-anchor" href="#import" aria-hidden="true">#</a> import</h4><p>mysqlimport æ˜¯å®¢æˆ·ç«¯æ•°æ®å¯¼å…¥å·¥å…·ï¼Œç”¨æ¥å¯¼å…¥mysqldump åŠ  -T å‚æ•°åå¯¼å‡ºçš„æ–‡æœ¬æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlimport <span class="token punctuation">[</span>options<span class="token punctuation">]</span>  db_name  textfile1  <span class="token punctuation">[</span>textfile2<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç¤ºä¾‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlimport <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p2143</span> <span class="token builtin class-name">test</span> /tmp/city.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¯¼å…¥ sql æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ MySQL ä¸­çš„ source æŒ‡ä»¤ :</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>source æ–‡ä»¶å…¨è·¯å¾„
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h4 id="show" tabindex="-1"><a class="header-anchor" href="#show" aria-hidden="true">#</a> show</h4><p>mysqlshow å®¢æˆ·ç«¯å¯¹è±¡æŸ¥æ‰¾å·¥å…·ï¼Œç”¨æ¥å¾ˆå¿«åœ°æŸ¥æ‰¾å­˜åœ¨å“ªäº›æ•°æ®åº“ã€æ•°æ®åº“ä¸­çš„è¡¨ã€è¡¨ä¸­çš„åˆ—æˆ–è€…ç´¢å¼•</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlshow <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span>db_name <span class="token punctuation">[</span>table_name <span class="token punctuation">[</span>col_name<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>--countï¼šæ˜¾ç¤ºæ•°æ®åº“åŠè¡¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ•°æ®åº“ï¼Œè¡¨ å‡å¯ä»¥ä¸æŒ‡å®šï¼‰</p></li><li><p>-iï¼šæ˜¾ç¤ºæŒ‡å®šæ•°æ®åº“æˆ–è€…æŒ‡å®šè¡¨çš„çŠ¶æ€ä¿¡æ¯</p></li></ul><p>ç¤ºä¾‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#æŸ¥è¯¢æ¯ä¸ªæ•°æ®åº“çš„è¡¨çš„æ•°é‡åŠè¡¨ä¸­è®°å½•çš„æ•°é‡</span>
mysqlshow <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p1234</span> <span class="token parameter variable">--count</span>
<span class="token comment">#æŸ¥è¯¢teståº“ä¸­æ¯ä¸ªè¡¨ä¸­çš„å­—æ®µä¹¦ï¼ŒåŠè¡Œæ•°</span>
mysqlshow <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p1234</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--count</span>
<span class="token comment">#æŸ¥è¯¢teståº“ä¸­bookè¡¨çš„è¯¦ç»†æƒ…å†µ</span>
mysqlshow <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p1234</span> <span class="token builtin class-name">test</span> book <span class="token parameter variable">--count</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="å•è¡¨æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å•è¡¨æ“ä½œ" aria-hidden="true">#</a> å•è¡¨æ“ä½œ</h2><h3 id="sql" tabindex="-1"><a class="header-anchor" href="#sql" aria-hidden="true">#</a> SQL</h3><ul><li><p>SQL</p><ul><li>Structured Query Languageï¼šç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€</li><li>å®šä¹‰äº†æ“ä½œæ‰€æœ‰å…³ç³»å‹æ•°æ®åº“çš„è§„åˆ™ï¼Œæ¯ç§æ•°æ®åº“æ“ä½œçš„æ–¹å¼å¯èƒ½ä¼šå­˜åœ¨ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œç§°ä¸ºâ€œæ–¹è¨€â€</li></ul></li><li><p>SQL é€šç”¨è¯­æ³•</p><ul><li>SQL è¯­å¥å¯ä»¥å•è¡Œæˆ–å¤šè¡Œä¹¦å†™ï¼Œä»¥<strong>åˆ†å·ç»“å°¾</strong>ã€‚</li><li>å¯ä½¿ç”¨ç©ºæ ¼å’Œç¼©è¿›æ¥å¢å¼ºè¯­å¥çš„å¯è¯»æ€§ã€‚</li><li>MySQL æ•°æ®åº“çš„ SQL è¯­å¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œ<strong>å…³é”®å­—å»ºè®®ä½¿ç”¨å¤§å†™</strong>ã€‚</li><li>æ•°æ®åº“çš„æ³¨é‡Šï¼š <ul><li>å•è¡Œæ³¨é‡Šï¼š-- æ³¨é‡Šå†…å®¹ #æ³¨é‡Šå†…å®¹ï¼ˆMySQL ç‰¹æœ‰ï¼‰</li><li>å¤šè¡Œæ³¨é‡Šï¼š/* æ³¨é‡Šå†…å®¹ */</li></ul></li></ul></li><li><p>SQL åˆ†ç±»</p><ul><li><p>DDLï¼ˆData Definition Languageï¼‰æ•°æ®å®šä¹‰è¯­è¨€</p><ul><li>ç”¨æ¥å®šä¹‰æ•°æ®åº“å¯¹è±¡ï¼šæ•°æ®åº“ï¼Œè¡¨ï¼Œåˆ—ç­‰ã€‚å…³é”®å­—ï¼šcreateã€drop,ã€alter ç­‰</li></ul></li><li><p>DMLï¼ˆData Manipulation Languageï¼‰æ•°æ®æ“ä½œè¯­è¨€</p><ul><li>ç”¨æ¥å¯¹æ•°æ®åº“ä¸­è¡¨çš„æ•°æ®è¿›è¡Œå¢åˆ æ”¹ã€‚å…³é”®å­—ï¼šinsertã€deleteã€update ç­‰</li></ul></li><li><p>DQLï¼ˆData Query Languageï¼‰æ•°æ®æŸ¥è¯¢è¯­è¨€</p><ul><li>ç”¨æ¥æŸ¥è¯¢æ•°æ®åº“ä¸­è¡¨çš„è®°å½•(æ•°æ®)ã€‚å…³é”®å­—ï¼šselectã€where ç­‰</li></ul></li><li><p>DCLï¼ˆData Control Languageï¼‰æ•°æ®æ§åˆ¶è¯­è¨€</p><ul><li>ç”¨æ¥å®šä¹‰æ•°æ®åº“çš„è®¿é—®æƒé™å’Œå®‰å…¨çº§åˆ«ï¼ŒåŠåˆ›å»ºç”¨æˆ·ã€‚å…³é”®å­—ï¼šgrantï¼Œ revokeç­‰</li></ul><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-SQLåˆ†ç±».png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul></li></ul><hr><h3 id="ddl" tabindex="-1"><a class="header-anchor" href="#ddl" aria-hidden="true">#</a> DDL</h3><h4 id="æ•°æ®åº“-1" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“-1" aria-hidden="true">#</a> æ•°æ®åº“</h4><ul><li><p>R(Retrieve)ï¼šæŸ¥è¯¢</p><ul><li><p>æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW DATABASES;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢æŸä¸ªæ•°æ®åº“çš„åˆ›å»ºè¯­å¥</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> æ•°æ®åº“åç§°<span class="token punctuation">;</span>  <span class="token comment">-- æ ‡å‡†è¯­æ³•</span>

<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> mysql<span class="token punctuation">;</span>     <span class="token comment">-- æŸ¥çœ‹mysqlæ•°æ®åº“çš„åˆ›å»ºæ ¼å¼</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>C(Create)ï¼šåˆ›å»º</p><ul><li><p>åˆ›å»ºæ•°æ®åº“</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE DATABASE æ•°æ®åº“åç§°;-- æ ‡å‡†è¯­æ³•

CREATE DATABASE db1;     -- åˆ›å»ºdb1æ•°æ®åº“
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ›å»ºæ•°æ®åº“ï¼ˆåˆ¤æ–­ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE DATABASE IF NOT EXISTS æ•°æ®åº“åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>åˆ›å»ºæ•°æ®åº“ï¼Œå¹¶æŒ‡å®šå­—ç¬¦é›†</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE DATABASE æ•°æ®åº“åç§° CHARACTER SET å­—ç¬¦é›†åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¾‹å¦‚ï¼šåˆ›å»ºdb4æ•°æ®åº“ã€å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼ŒæŒ‡å®šå­—ç¬¦é›†ä¸ºgbk</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºdb4æ•°æ®åº“ã€å¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼ŒæŒ‡å®šå­—ç¬¦é›†ä¸ºgbk
CREATE DATABASE IF NOT EXISTS db4 CHARACTER SET gbk;

-- æŸ¥çœ‹db4æ•°æ®åº“çš„å­—ç¬¦é›†
SHOW CREATE DATABASE db4;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>U(Update)ï¼šä¿®æ”¹</p><ul><li><p>ä¿®æ”¹æ•°æ®åº“çš„å­—ç¬¦é›†</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER DATABASE æ•°æ®åº“åç§° CHARACTER SET å­—ç¬¦é›†åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å¸¸ç”¨å­—ç¬¦é›†ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>--æŸ¥è¯¢æ‰€æœ‰æ”¯æŒçš„å­—ç¬¦é›†
SHOW CHARSET;
--æŸ¥çœ‹æ‰€æœ‰æ”¯æŒçš„æ ¡å¯¹è§„åˆ™
SHOW COLLATION;

-- å­—ç¬¦é›†: utf8,latinI,GBK,,GBKæ˜¯utf8çš„å­é›†
-- æ ¡å¯¹è§„åˆ™: ci å¤§å°å®šä¸æ•æ„Ÿï¼Œcsæˆ–binå¤§å°å†™æ•æ„Ÿ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>D(Delete)ï¼šåˆ é™¤</p><ul><li><p>åˆ é™¤æ•°æ®åº“ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP DATABASE æ•°æ®åº“åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>åˆ é™¤æ•°æ®åº“(åˆ¤æ–­ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ é™¤)ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP DATABASE IF EXISTS æ•°æ®åº“åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li><li><p>ä½¿ç”¨æ•°æ®åº“ï¼š</p><ul><li><p>æŸ¥è¯¢å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“åç§°</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT DATABASE();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä½¿ç”¨æ•°æ®åº“</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>USE æ•°æ®åº“åç§°ï¼› -- æ ‡å‡†è¯­æ³•
USE db4;	   -- ä½¿ç”¨db4æ•°æ®åº“
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul><hr><h4 id="æ•°æ®è¡¨" tabindex="-1"><a class="header-anchor" href="#æ•°æ®è¡¨" aria-hidden="true">#</a> æ•°æ®è¡¨</h4><ul><li><p>R(Retrieve)ï¼šæŸ¥è¯¢</p><ul><li><p>æŸ¥è¯¢æ•°æ®åº“ä¸­æ‰€æœ‰çš„æ•°æ®è¡¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>USE mysql;-- ä½¿ç”¨mysqlæ•°æ®åº“

SHOW TABLES;-- æŸ¥è¯¢åº“ä¸­æ‰€æœ‰çš„è¡¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢è¡¨ç»“æ„</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DESC è¡¨å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢è¡¨å­—ç¬¦é›†</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW TABLE STATUS FROM åº“å LIKE &#39;è¡¨å&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li><li><p>C(Create)ï¼šåˆ›å»º</p><ul><li><p>åˆ›å»ºæ•°æ®è¡¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE è¡¨å(
    åˆ—å1 æ•°æ®ç±»å‹1,
    åˆ—å2 æ•°æ®ç±»å‹2,
    ....
    åˆ—ån æ•°æ®ç±»å‹n
);
-- æ³¨æ„ï¼šæœ€åä¸€åˆ—ï¼Œä¸éœ€è¦åŠ é€—å·
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å¤åˆ¶è¡¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE è¡¨å LIKE è¢«å¤åˆ¶çš„è¡¨å;  -- æ ‡å‡†è¯­æ³•

CREATE TABLE product2 LIKE product; -- å¤åˆ¶productè¡¨åˆ°product2è¡¨
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ•°æ®ç±»å‹</p><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>INT</td><td>æ•´æ•°ç±»å‹</td></tr><tr><td>DOUBLE</td><td>å°æ•°ç±»å‹</td></tr><tr><td>DATE</td><td>æ—¥æœŸï¼ŒåªåŒ…å«å¹´æœˆæ—¥ï¼šyyyy-MM-dd</td></tr><tr><td>DATETIME</td><td>æ—¥æœŸï¼ŒåŒ…å«å¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼šyyyy-MM-dd HH:mm:ss</td></tr><tr><td>TIMESTAMP</td><td>æ—¶é—´æˆ³ç±»å‹ï¼ŒåŒ…å«å¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼šyyyy-MM-dd HH:mm:ss<br>å¦‚æœä¸ç»™è¿™ä¸ªå­—æ®µèµ‹å€¼æˆ–èµ‹å€¼ä¸º NULLï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰çš„ç³»ç»Ÿæ—¶é—´</td></tr><tr><td>CHAR</td><td>å­—ç¬¦ä¸²ï¼Œå®šé•¿ç±»å‹</td></tr><tr><td>VARCHAR</td><td>å­—ç¬¦ä¸²ï¼Œ<strong>å˜é•¿ç±»å‹</strong><br>name varchar(20) ä»£è¡¨å§“åæœ€å¤§ 20 ä¸ªå­—ç¬¦ï¼šzhangsan 8 ä¸ªå­—ç¬¦ï¼Œå¼ ä¸‰ 2 ä¸ªå­—ç¬¦</td></tr></tbody></table><p><code>INT(n)</code>ï¼šn ä»£è¡¨ä½æ•°</p><ul><li>3ï¼šintï¼ˆ9ï¼‰æ˜¾ç¤ºç»“æœä¸º 000000010</li><li>3ï¼šintï¼ˆ3ï¼‰æ˜¾ç¤ºç»“æœä¸º 010</li></ul><p><code>varchar(n)</code>ï¼šn è¡¨ç¤ºçš„æ˜¯å­—ç¬¦æ•°</p></li><li><p>ä¾‹å¦‚ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- ä½¿ç”¨db3æ•°æ®åº“
USE db3;

-- åˆ›å»ºä¸€ä¸ªproductå•†å“è¡¨
CREATE TABLE product(
	id INT,				-- å•†å“ç¼–å·
	NAME VARCHAR(30),	-- å•†å“åç§°
	price DOUBLE,		-- å•†å“ä»·æ ¼
	stock INT,			-- å•†å“åº“å­˜
	insert_time DATE    -- ä¸Šæ¶æ—¶é—´
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul><p>â€‹</p><ul><li><p>U(Update)ï¼šä¿®æ”¹</p><ul><li><p>ä¿®æ”¹è¡¨å</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å RENAME TO æ–°çš„è¡¨å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å CHARACTER SET å­—ç¬¦é›†åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ·»åŠ ä¸€åˆ—</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å ADD åˆ—å æ•°æ®ç±»å‹;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹åˆ—æ•°æ®ç±»å‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å MODIFY åˆ—å æ–°æ•°æ®ç±»å‹;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹åˆ—åç§°å’Œæ•°æ®ç±»å‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å CHANGE åˆ—å æ–°åˆ—å æ–°æ•°æ®ç±»å‹;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>åˆ é™¤åˆ—</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å DROP åˆ—å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li><li><p>D(Delete)ï¼šåˆ é™¤</p><ul><li><p>åˆ é™¤æ•°æ®è¡¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP TABLE è¡¨å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>åˆ é™¤æ•°æ®è¡¨(åˆ¤æ–­ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ é™¤)</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP TABLE IF EXISTS è¡¨å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul></li></ul><hr><h3 id="dml" tabindex="-1"><a class="header-anchor" href="#dml" aria-hidden="true">#</a> DML</h3><h4 id="insert" tabindex="-1"><a class="header-anchor" href="#insert" aria-hidden="true">#</a> INSERT</h4><ul><li><p>æ–°å¢è¡¨æ•°æ®</p><ul><li><p>æ–°å¢æ ¼å¼ 1ï¼šç»™æŒ‡å®šåˆ—æ·»åŠ æ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>INSERT INTO è¡¨å(åˆ—å1,åˆ—å2...) VALUES (å€¼1,å€¼2...);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ–°å¢æ ¼å¼ 2ï¼šé»˜è®¤ç»™å…¨éƒ¨åˆ—æ·»åŠ æ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>INSERT INTO è¡¨å VALUES (å€¼1,å€¼2,å€¼3,...);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ–°å¢æ ¼å¼ 3ï¼šæ‰¹é‡æ·»åŠ æ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- ç»™æŒ‡å®šåˆ—æ‰¹é‡æ·»åŠ æ•°æ®
INSERT INTO è¡¨å(åˆ—å1,åˆ—å2,...) VALUES (å€¼1,å€¼2,...),(å€¼1,å€¼2,...)...;

-- é»˜è®¤ç»™æ‰€æœ‰åˆ—æ‰¹é‡æ·»åŠ æ•°æ® 
INSERT INTO è¡¨å VALUES (å€¼1,å€¼2,å€¼3,...),(å€¼1,å€¼2,å€¼3,...)...;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>å­—ç¬¦ä¸²æ‹¼æ¥</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CONCAT(string1,string2,&#39;&#39;,...)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ³¨æ„äº‹é¡¹</p><ul><li>åˆ—åå’Œå€¼çš„æ•°é‡ä»¥åŠæ•°æ®ç±»å‹è¦å¯¹åº”</li><li>é™¤äº†æ•°å­—ç±»å‹ï¼Œå…¶ä»–æ•°æ®ç±»å‹çš„æ•°æ®éƒ½éœ€è¦åŠ å¼•å·(å•å¼•åŒå¼•éƒ½å¯ä»¥ï¼Œæ¨èå•å¼•)</li></ul></li></ul><hr><h4 id="update" tabindex="-1"><a class="header-anchor" href="#update" aria-hidden="true">#</a> UPDATE</h4><ul><li><p>ä¿®æ”¹è¡¨æ•°æ®è¯­æ³•</p><ul><li><p>æ ‡å‡†è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>UPDATE è¡¨å SET åˆ—å1 = å€¼1,åˆ—å2 = å€¼2,... [where æ¡ä»¶];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹ç”µè§†çš„ä»·æ ¼ä¸º1800ã€åº“å­˜ä¸º36</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>UPDATE product SET price=1800,stock=36 WHERE NAME=&#39;ç”µè§†&#39;;
SELECT * FROM product;-- æŸ¥çœ‹æ‰€æœ‰å•†å“ä¿¡æ¯
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>æ³¨æ„äº‹é¡¹</p><ul><li>ä¿®æ”¹è¯­å¥ä¸­å¿…é¡»åŠ æ¡ä»¶</li><li>å¦‚æœä¸åŠ æ¡ä»¶ï¼Œåˆ™å°†æ‰€æœ‰æ•°æ®éƒ½ä¿®æ”¹</li></ul></li></ul><hr><h4 id="delete" tabindex="-1"><a class="header-anchor" href="#delete" aria-hidden="true">#</a> DELETE</h4><ul><li><p>åˆ é™¤è¡¨æ•°æ®è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELETE FROM è¡¨å [WHERE æ¡ä»¶];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ³¨æ„äº‹é¡¹</p><ul><li>åˆ é™¤è¯­å¥ä¸­å¿…é¡»åŠ æ¡ä»¶</li><li>å¦‚æœä¸åŠ æ¡ä»¶ï¼Œåˆ™å°†æ‰€æœ‰æ•°æ®åˆ é™¤</li></ul></li></ul><p>â€‹</p><hr><h3 id="dql" tabindex="-1"><a class="header-anchor" href="#dql" aria-hidden="true">#</a> DQL</h3><h4 id="æŸ¥è¯¢è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢è¯­æ³•" aria-hidden="true">#</a> æŸ¥è¯¢è¯­æ³•</h4><p>æ•°æ®åº“æŸ¥è¯¢éµå¾ªæ¡ä»¶åœ¨å‰çš„åŸåˆ™</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT DISTINCT
	&lt;select list&gt;
FROM
	&lt;left_table&gt; &lt;join_type&gt;
JOIN
	&lt;right_table&gt; ON &lt;join_condition&gt;	-- è¿æ¥æŸ¥è¯¢åœ¨å¤šè¡¨æŸ¥è¯¢éƒ¨åˆ†è¯¦è§£
WHERE
	&lt;where_condition&gt;
GROUP BY
	&lt;group_by_list&gt;
HAVING
	&lt;having_condition&gt;
ORDER BY
	&lt;order_by_condition&gt;
LIMIT
	&lt;limit_params&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œé¡ºåºï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>FROM	&lt;left_table&gt;

ON 		&lt;join_condition&gt;

&lt;join_type&gt;		JOIN	&lt;right_table&gt;

WHERE		&lt;where_condition&gt;

GROUP BY 	&lt;group_by_list&gt;

HAVING		&lt;having_condition&gt;

SELECT DISTINCT		&lt;select list&gt;

ORDER BY	&lt;order_by_condition&gt;

LIMIT		&lt;limit_params&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="æŸ¥è¯¢å…¨éƒ¨" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢å…¨éƒ¨" aria-hidden="true">#</a> æŸ¥è¯¢å…¨éƒ¨</h4><ul><li><p>æŸ¥è¯¢å…¨éƒ¨çš„è¡¨æ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- æ ‡å‡†è¯­æ³•
SELECT * FROM è¡¨å;

-- æŸ¥è¯¢productè¡¨æ‰€æœ‰æ•°æ®(å¸¸ç”¨)
SELECT * FROM product;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢æŒ‡å®šå­—æ®µçš„è¡¨æ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å1,åˆ—å2,... FROM è¡¨å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p><strong>å»é™¤é‡å¤æŸ¥è¯¢</strong>ï¼šåªæœ‰å€¼å…¨éƒ¨é‡å¤çš„æ‰å¯ä»¥å»é™¤ï¼Œéœ€è¦åˆ›å»ºä¸´æ—¶è¡¨è¾…åŠ©æŸ¥è¯¢</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT DISTINCT åˆ—å1,åˆ—å2,... FROM è¡¨å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>è®¡ç®—åˆ—çš„å€¼ï¼ˆå››åˆ™è¿ç®—ï¼‰</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å1 è¿ç®—ç¬¦(+ - * /) åˆ—å2 FROM è¡¨å;

/*å¦‚æœæŸä¸€åˆ—å€¼ä¸ºnullï¼Œå¯ä»¥è¿›è¡Œæ›¿æ¢
	ifnull(è¡¨è¾¾å¼1,è¡¨è¾¾å¼2)
	è¡¨è¾¾å¼1ï¼šæƒ³æ›¿æ¢çš„åˆ—
	è¡¨è¾¾å¼2ï¼šæƒ³æ›¿æ¢çš„å€¼*/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¾‹å¦‚ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- æŸ¥è¯¢å•†å“åç§°å’Œåº“å­˜ï¼Œåº“å­˜æ•°é‡åœ¨åŸæœ‰åŸºç¡€ä¸ŠåŠ 10
SELECT NAME,stock+10 FROM product;

-- æŸ¥è¯¢å•†å“åç§°å’Œåº“å­˜ï¼Œåº“å­˜æ•°é‡åœ¨åŸæœ‰åŸºç¡€ä¸ŠåŠ 10ã€‚è¿›è¡Œnullå€¼åˆ¤æ–­
SELECT NAME,IFNULL(stock,0)+10 FROM product;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>èµ·åˆ«å</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å1,åˆ—å2,... AS åˆ«å FROM è¡¨å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¾‹å¦‚ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- æŸ¥è¯¢å•†å“åç§°å’Œåº“å­˜ï¼Œåº“å­˜æ•°é‡åœ¨åŸæœ‰åŸºç¡€ä¸ŠåŠ 10ã€‚è¿›è¡Œnullå€¼åˆ¤æ–­ï¼Œèµ·åˆ«åä¸ºgetSum,ASå¯ä»¥çœç•¥ã€‚
SELECT NAME,IFNULL(stock,0)+10 AS getsum FROM product;
SELECT NAME,IFNULL(stock,0)+10 getsum FROM product;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="æ¡ä»¶æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#æ¡ä»¶æŸ¥è¯¢" aria-hidden="true">#</a> æ¡ä»¶æŸ¥è¯¢</h4><ul><li><p>æ¡ä»¶æŸ¥è¯¢è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å WHERE æ¡ä»¶;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ¡ä»¶åˆ†ç±»</p><table><thead><tr><th>ç¬¦å·</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>&gt;</td><td>å¤§äº</td></tr><tr><td>&lt;</td><td>å°äº</td></tr><tr><td>&gt;=</td><td>å¤§äºç­‰äº</td></tr><tr><td>&lt;=</td><td>å°äºç­‰äº</td></tr><tr><td>=</td><td>ç­‰äº</td></tr><tr><td>&lt;&gt; æˆ– !=</td><td>ä¸ç­‰äº</td></tr><tr><td>BETWEEN ... AND ...</td><td>åœ¨æŸä¸ªèŒƒå›´ä¹‹å†…(éƒ½åŒ…å«)</td></tr><tr><td>IN(...)</td><td>å¤šé€‰ä¸€</td></tr><tr><td>LIKE</td><td><strong>æ¨¡ç³ŠæŸ¥è¯¢</strong>ï¼š_å•ä¸ªä»»æ„å­—ç¬¦ã€%ä»»æ„ä¸ªå­—ç¬¦ã€[] åŒ¹é…é›†åˆå†…çš„å­—ç¬¦<br><code>LIKE &#39;[^AB]%&#39; </code>ï¼šä¸ä»¥ A å’Œ B å¼€å¤´çš„ä»»æ„æ–‡æœ¬</td></tr><tr><td>IS NULL</td><td>æ˜¯NULL</td></tr><tr><td>IS NOT NULL</td><td>ä¸æ˜¯NULL</td></tr><tr><td>AND æˆ– &amp;&amp;</td><td>å¹¶ä¸”</td></tr><tr><td>OR æˆ– ||</td><td>æˆ–è€…</td></tr><tr><td>NOT æˆ– !</td><td>éï¼Œä¸æ˜¯</td></tr><tr><td>UNION</td><td>å¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œ<strong>å¹¶é›†æ“ä½œå¹¶è¿›è¡Œå»é‡ï¼ŒåŒæ—¶è¿›è¡Œé»˜è®¤è§„åˆ™çš„æ’åº</strong></td></tr><tr><td>UNION ALL</td><td>å¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå¹¶é›†æ“ä½œä¸è¿›è¡Œå»é‡ï¼Œä¸è¿›è¡Œæ’åº</td></tr></tbody></table></li><li><p>ä¾‹å¦‚ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- æŸ¥è¯¢åº“å­˜å¤§äº20çš„å•†å“ä¿¡æ¯
SELECT * FROM product WHERE stock &gt; 20;

-- æŸ¥è¯¢å“ç‰Œä¸ºåä¸ºçš„å•†å“ä¿¡æ¯
SELECT * FROM product WHERE brand=&#39;åä¸º&#39;;

-- æŸ¥è¯¢é‡‘é¢åœ¨4000 ~ 6000ä¹‹é—´çš„å•†å“ä¿¡æ¯
SELECT * FROM product WHERE price &gt;= 4000 AND price &lt;= 6000;
SELECT * FROM product WHERE price BETWEEN 4000 AND 6000;

-- æŸ¥è¯¢åº“å­˜ä¸º14ã€30ã€23çš„å•†å“ä¿¡æ¯
SELECT * FROM product WHERE stock=14 OR stock=30 OR stock=23;
SELECT * FROM product WHERE stock IN(14,30,23);

-- æŸ¥è¯¢åº“å­˜ä¸ºnullçš„å•†å“ä¿¡æ¯
SELECT * FROM product WHERE stock IS NULL;
-- æŸ¥è¯¢åº“å­˜ä¸ä¸ºnullçš„å•†å“ä¿¡æ¯
SELECT * FROM product WHERE stock IS NOT NULL;

-- æŸ¥è¯¢åç§°ä»¥&#39;å°ç±³&#39;ä¸ºå¼€å¤´çš„å•†å“ä¿¡æ¯
SELECT * FROM product WHERE NAME LIKE &#39;å°ç±³%&#39;;

-- æŸ¥è¯¢åç§°ç¬¬äºŒä¸ªå­—æ˜¯&#39;ä¸º&#39;çš„å•†å“ä¿¡æ¯
SELECT * FROM product WHERE NAME LIKE &#39;_ä¸º%&#39;;

-- æŸ¥è¯¢åç§°ä¸ºå››ä¸ªå­—ç¬¦çš„å•†å“ä¿¡æ¯ 4ä¸ªä¸‹åˆ’çº¿
SELECT * FROM product WHERE NAME LIKE &#39;____&#39;;

-- æŸ¥è¯¢åç§°ä¸­åŒ…å«ç”µè„‘çš„å•†å“ä¿¡æ¯
SELECT * FROM product WHERE NAME LIKE &#39;%ç”µè„‘%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-DQLæ•°æ®å‡†å¤‡.png" style="zoom:80%;"></li></ul><hr><h4 id="å‡½æ•°æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°æŸ¥è¯¢" aria-hidden="true">#</a> å‡½æ•°æŸ¥è¯¢</h4><h5 id="èšåˆå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#èšåˆå‡½æ•°" aria-hidden="true">#</a> èšåˆå‡½æ•°</h5><p>èšåˆå‡½æ•°ï¼šå°†ä¸€åˆ—æ•°æ®ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œè¿›è¡Œçºµå‘çš„è®¡ç®—</p><ul><li><p>èšåˆå‡½æ•°è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT å‡½æ•°å(åˆ—å) FROM è¡¨å [WHERE æ¡ä»¶]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>èšåˆå‡½æ•°åˆ†ç±»</p><table><thead><tr><th>å‡½æ•°å</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>COUNT(åˆ—å)</td><td>ç»Ÿè®¡æ•°é‡ï¼ˆä¸€èˆ¬é€‰ç”¨ä¸ä¸º null çš„åˆ—ï¼‰</td></tr><tr><td>MAX(åˆ—å)</td><td>æœ€å¤§å€¼</td></tr><tr><td>MIN(åˆ—å)</td><td>æœ€å°å€¼</td></tr><tr><td>SUM(åˆ—å)</td><td>æ±‚å’Œ</td></tr><tr><td>AVG(åˆ—å)</td><td>å¹³å‡å€¼ï¼ˆä¼šå¿½ç•¥ null è¡Œï¼‰</td></tr></tbody></table></li><li><p>ä¾‹å¦‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- è®¡ç®—productè¡¨ä¸­æ€»è®°å½•æ¡æ•° 7
SELECT COUNT(*) FROM product;

-- è·å–æœ€é«˜ä»·æ ¼
SELECT MAX(price) FROM product;
-- è·å–æœ€é«˜ä»·æ ¼çš„å•†å“åç§°
SELECT NAME,price FROM product WHERE price = (SELECT MAX(price) FROM product);

-- è·å–æœ€ä½åº“å­˜
SELECT MIN(stock) FROM product;
-- è·å–æœ€ä½åº“å­˜çš„å•†å“åç§°
SELECT NAME,stock FROM product WHERE stock = (SELECT MIN(stock) FROM product);

-- è·å–æ€»åº“å­˜æ•°é‡
SELECT SUM(stock) FROM product;
-- è·å–å“ç‰Œä¸ºå°ç±³çš„å¹³å‡å•†å“ä»·æ ¼
SELECT AVG(price) FROM product WHERE brand=&#39;å°ç±³&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h5 id="æ–‡æœ¬å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#æ–‡æœ¬å‡½æ•°" aria-hidden="true">#</a> æ–‡æœ¬å‡½æ•°</h5><p>CONCAT()ï¼šç”¨äºè¿æ¥ä¸¤ä¸ªå­—æ®µ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>TRIM<span class="token punctuation">(</span>col1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;(&#39;</span><span class="token punctuation">,</span> TRIM<span class="token punctuation">(</span>col2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;)&#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> concat_col <span class="token keyword">FROM</span> mytable
<span class="token comment">-- è®¸å¤šæ•°æ®åº“ä¼šä½¿ç”¨ç©ºæ ¼æŠŠä¸€ä¸ªå€¼å¡«å……ä¸ºåˆ—å®½ï¼Œè¿æ¥çš„ç»“æœå‡ºç°ä¸€äº›ä¸å¿…è¦çš„ç©ºæ ¼ï¼Œä½¿ç”¨TRIM()å¯ä»¥å»é™¤é¦–å°¾ç©ºæ ¼</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>å‡½æ•°åç§°</th><th>ä½œ ç”¨</th></tr></thead><tbody><tr><td>LENGTH</td><td>è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦å‡½æ•°ï¼Œè¿”å›å­—ç¬¦ä¸²çš„å­—èŠ‚é•¿åº¦</td></tr><tr><td>CONCAT</td><td>åˆå¹¶å­—ç¬¦ä¸²å‡½æ•°ï¼Œè¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ï¼Œå‚æ•°å¯ä»¥ä½¿ä¸€ä¸ªæˆ–å¤šä¸ª</td></tr><tr><td>INSERT</td><td>æ›¿æ¢å­—ç¬¦ä¸²å‡½æ•°</td></tr><tr><td>LOWER</td><td>å°†å­—ç¬¦ä¸²ä¸­çš„å­—æ¯è½¬æ¢ä¸ºå°å†™</td></tr><tr><td>UPPER</td><td>å°†å­—ç¬¦ä¸²ä¸­çš„å­—æ¯è½¬æ¢ä¸ºå¤§å†™</td></tr><tr><td>LEFT</td><td>ä»å·¦ä¾§å­—æˆªå–ç¬¦ä¸²ï¼Œè¿”å›å­—ç¬¦ä¸²å·¦è¾¹çš„è‹¥å¹²ä¸ªå­—ç¬¦</td></tr><tr><td>RIGHT</td><td>ä»å³ä¾§å­—æˆªå–ç¬¦ä¸²ï¼Œè¿”å›å­—ç¬¦ä¸²å³è¾¹çš„è‹¥å¹²ä¸ªå­—ç¬¦</td></tr><tr><td>TRIM</td><td>åˆ é™¤å­—ç¬¦ä¸²å·¦å³ä¸¤ä¾§çš„ç©ºæ ¼</td></tr><tr><td>REPLACE</td><td>å­—ç¬¦ä¸²æ›¿æ¢å‡½æ•°ï¼Œè¿”å›æ›¿æ¢åçš„æ–°å­—ç¬¦ä¸²</td></tr><tr><td>SUBSTRING</td><td>æˆªå–å­—ç¬¦ä¸²ï¼Œè¿”å›ä»æŒ‡å®šä½ç½®å¼€å§‹çš„æŒ‡å®šé•¿åº¦çš„å­—ç¬¦æ¢</td></tr><tr><td>REVERSE</td><td>å­—ç¬¦ä¸²åè½¬ï¼ˆé€†åºï¼‰å‡½æ•°ï¼Œè¿”å›ä¸åŸå§‹å­—ç¬¦ä¸²é¡ºåºç›¸åçš„å­—ç¬¦ä¸²</td></tr></tbody></table><hr><h5 id="æ•°å­—å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#æ•°å­—å‡½æ•°" aria-hidden="true">#</a> æ•°å­—å‡½æ•°</h5><table><thead><tr><th>å‡½æ•°åç§°</th><th>ä½œ ç”¨</th></tr></thead><tbody><tr><td>ABS</td><td>æ±‚ç»å¯¹å€¼</td></tr><tr><td>SQRT</td><td>æ±‚äºŒæ¬¡æ–¹æ ¹</td></tr><tr><td>MOD</td><td>æ±‚ä½™æ•°</td></tr><tr><td>CEIL å’Œ CEILING</td><td>ä¸¤ä¸ªå‡½æ•°åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯è¿”å›ä¸å°äºå‚æ•°çš„æœ€å°æ•´æ•°ï¼Œå³å‘ä¸Šå–æ•´</td></tr><tr><td>FLOOR</td><td>å‘ä¸‹å–æ•´ï¼Œè¿”å›å€¼è½¬åŒ–ä¸ºä¸€ä¸ªBIGINT</td></tr><tr><td>RAND</td><td>ç”Ÿæˆä¸€ä¸ª0~1ä¹‹é—´çš„éšæœºæ•°ï¼Œä¼ å…¥æ•´æ•°å‚æ•°æ˜¯ï¼Œç”¨æ¥äº§ç”Ÿé‡å¤åºåˆ—</td></tr><tr><td>ROUND</td><td>å¯¹æ‰€ä¼ å‚æ•°è¿›è¡Œå››èˆäº”å…¥</td></tr><tr><td>SIGN</td><td>è¿”å›å‚æ•°çš„ç¬¦å·</td></tr><tr><td>POW å’Œ POWER</td><td>ä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯æ‰€ä¼ å‚æ•°çš„æ¬¡æ–¹çš„ç»“æœå€¼</td></tr><tr><td>SIN</td><td>æ±‚æ­£å¼¦å€¼</td></tr><tr><td>ASIN</td><td>æ±‚åæ­£å¼¦å€¼ï¼Œä¸å‡½æ•° SIN äº’ä¸ºåå‡½æ•°</td></tr><tr><td>COS</td><td>æ±‚ä½™å¼¦å€¼</td></tr><tr><td>ACOS</td><td>æ±‚åä½™å¼¦å€¼ï¼Œä¸å‡½æ•° COS äº’ä¸ºåå‡½æ•°</td></tr><tr><td>TAN</td><td>æ±‚æ­£åˆ‡å€¼</td></tr><tr><td>ATAN</td><td>æ±‚åæ­£åˆ‡å€¼ï¼Œä¸å‡½æ•° TAN äº’ä¸ºåå‡½æ•°</td></tr><tr><td>COT</td><td>æ±‚ä½™åˆ‡å€¼</td></tr></tbody></table><hr><h5 id="æ—¥æœŸå‡½æ•°" tabindex="-1"><a class="header-anchor" href="#æ—¥æœŸå‡½æ•°" aria-hidden="true">#</a> æ—¥æœŸå‡½æ•°</h5><table><thead><tr><th>å‡½æ•°åç§°</th><th>ä½œ ç”¨</th></tr></thead><tbody><tr><td>CURDATE å’Œ CURRENT_DATE</td><td>ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¥æœŸå€¼</td></tr><tr><td>CURTIME å’Œ CURRENT_TIME</td><td>ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¶é—´å€¼</td></tr><tr><td>NOW å’Œ SYSDATE</td><td>ä¸¤ä¸ªå‡½æ•°ä½œç”¨ç›¸åŒï¼Œè¿”å›å½“å‰ç³»ç»Ÿçš„æ—¥æœŸå’Œæ—¶é—´å€¼</td></tr><tr><td>MONTH</td><td>è·å–æŒ‡å®šæ—¥æœŸä¸­çš„æœˆä»½</td></tr><tr><td>MONTHNAME</td><td>è·å–æŒ‡å®šæ—¥æœŸä¸­çš„æœˆä»½è‹±æ–‡åç§°</td></tr><tr><td>DAYNAME</td><td>è·å–æŒ‡å®šæ›°æœŸå¯¹åº”çš„æ˜ŸæœŸå‡ çš„è‹±æ–‡åç§°</td></tr><tr><td>DAYOFWEEK</td><td>è·å–æŒ‡å®šæ—¥æœŸå¯¹åº”çš„ä¸€å‘¨çš„ç´¢å¼•ä½ç½®å€¼</td></tr><tr><td>WEEK</td><td>è·å–æŒ‡å®šæ—¥æœŸæ˜¯ä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨ï¼Œè¿”å›å€¼çš„èŒƒå›´æ˜¯å¦ä¸º 0ã€œ52 æˆ– 1ã€œ53</td></tr><tr><td>DAYOFYEAR</td><td>è·å–æŒ‡å®šæ›°æœŸæ˜¯ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©ï¼Œè¿”å›å€¼èŒƒå›´æ˜¯1~366</td></tr><tr><td>DAYOFMONTH</td><td>è·å–æŒ‡å®šæ—¥æœŸæ˜¯ä¸€ä¸ªæœˆä¸­æ˜¯ç¬¬å‡ å¤©ï¼Œè¿”å›å€¼èŒƒå›´æ˜¯1~31</td></tr><tr><td>YEAR</td><td>è·å–å¹´ä»½ï¼Œè¿”å›å€¼èŒƒå›´æ˜¯ 1970ã€œ2069</td></tr><tr><td>TIME_TO_SEC</td><td>å°†æ—¶é—´å‚æ•°è½¬æ¢ä¸ºç§’æ•°</td></tr><tr><td>SEC_TO_TIME</td><td>å°†ç§’æ•°è½¬æ¢ä¸ºæ—¶é—´ï¼Œä¸TIME_TO_SEC äº’ä¸ºåå‡½æ•°</td></tr><tr><td>DATE_ADD å’Œ ADDDATE</td><td>ä¸¤ä¸ªå‡½æ•°åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯å‘æ—¥æœŸæ·»åŠ æŒ‡å®šçš„æ—¶é—´é—´éš”</td></tr><tr><td>DATE_SUB å’Œ SUBDATE</td><td>ä¸¤ä¸ªå‡½æ•°åŠŸèƒ½ç›¸åŒï¼Œéƒ½æ˜¯å‘æ—¥æœŸå‡å»æŒ‡å®šçš„æ—¶é—´é—´éš”</td></tr><tr><td>ADDTIME</td><td>æ—¶é—´åŠ æ³•è¿ç®—ï¼Œåœ¨åŸå§‹æ—¶é—´ä¸Šæ·»åŠ æŒ‡å®šçš„æ—¶é—´</td></tr><tr><td>SUBTIME</td><td>æ—¶é—´å‡æ³•è¿ç®—ï¼Œåœ¨åŸå§‹æ—¶é—´ä¸Šå‡å»æŒ‡å®šçš„æ—¶é—´</td></tr><tr><td>DATEDIFF</td><td>è·å–ä¸¤ä¸ªæ—¥æœŸä¹‹é—´é—´éš”ï¼Œè¿”å›å‚æ•° 1 å‡å»å‚æ•° 2 çš„å€¼</td></tr><tr><td>DATE_FORMAT</td><td>æ ¼å¼åŒ–æŒ‡å®šçš„æ—¥æœŸï¼Œæ ¹æ®å‚æ•°è¿”å›æŒ‡å®šæ ¼å¼çš„å€¼</td></tr><tr><td>WEEKDAY</td><td>è·å–æŒ‡å®šæ—¥æœŸåœ¨ä¸€å‘¨å†…çš„å¯¹åº”çš„å·¥ä½œæ—¥ç´¢å¼•</td></tr></tbody></table><hr><h4 id="æ­£åˆ™æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#æ­£åˆ™æŸ¥è¯¢" aria-hidden="true">#</a> æ­£åˆ™æŸ¥è¯¢</h4><p>æ­£åˆ™è¡¨è¾¾å¼ï¼ˆRegular Expressionï¼‰æ˜¯æŒ‡ä¸€ä¸ªç”¨æ¥æè¿°æˆ–è€…åŒ¹é…ä¸€ç³»åˆ—ç¬¦åˆæŸä¸ªå¥æ³•è§„åˆ™çš„å­—ç¬¦ä¸²çš„å•ä¸ªå­—ç¬¦ä¸²</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM emp WHERE name REGEXP &#39;^T&#39;;	-- åŒ¹é…ä»¥Tå¼€å¤´çš„nameå€¼
SELECT * FROM emp WHERE name REGEXP &#39;2$&#39;;	-- åŒ¹é…ä»¥2ç»“å°¾çš„nameå€¼
SELECT * FROM emp WHERE name REGEXP &#39;[uvw]&#39;;-- åŒ¹é…åŒ…å« uvw çš„nameå€¼
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>ç¬¦å·</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>^</td><td>åœ¨å­—ç¬¦ä¸²å¼€å§‹å¤„è¿›è¡ŒåŒ¹é…</td></tr><tr><td>$</td><td>åœ¨å­—ç¬¦ä¸²æœ«å°¾å¤„è¿›è¡ŒåŒ¹é…</td></tr><tr><td>.</td><td>åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦, åŒ…æ‹¬æ¢è¡Œç¬¦</td></tr><tr><td>[...]</td><td>åŒ¹é…å‡ºæ‹¬å·å†…çš„ä»»æ„å­—ç¬¦</td></tr><tr><td>[^...]</td><td>åŒ¹é…ä¸å‡ºæ‹¬å·å†…çš„ä»»æ„å­—ç¬¦</td></tr><tr><td>a*</td><td>åŒ¹é…é›¶ä¸ªæˆ–è€…å¤šä¸ªa(åŒ…æ‹¬ç©ºä¸²)</td></tr><tr><td>a+</td><td>åŒ¹é…ä¸€ä¸ªæˆ–è€…å¤šä¸ªa(ä¸åŒ…æ‹¬ç©ºä¸²)</td></tr><tr><td>a?</td><td>åŒ¹é…é›¶ä¸ªæˆ–è€…ä¸€ä¸ªa</td></tr><tr><td>a1|a2</td><td>åŒ¹é…a1æˆ–a2</td></tr><tr><td>a(m)</td><td>åŒ¹é…mä¸ªa</td></tr><tr><td>a(m,)</td><td>è‡³å°‘åŒ¹é…mä¸ªa</td></tr><tr><td>a(m,n)</td><td>åŒ¹é…mä¸ªa åˆ° nä¸ªa</td></tr><tr><td>a(,n)</td><td>åŒ¹é…0åˆ°nä¸ªa</td></tr><tr><td>(...)</td><td>å°†æ¨¡å¼å…ƒç´ ç»„æˆå•ä¸€å…ƒç´ </td></tr></tbody></table><hr><h4 id="æ’åºæŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#æ’åºæŸ¥è¯¢" aria-hidden="true">#</a> æ’åºæŸ¥è¯¢</h4><ul><li><p>æ’åºæŸ¥è¯¢è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å [WHERE æ¡ä»¶] ORDER BY åˆ—å1 æ’åºæ–¹å¼1,åˆ—å2 æ’åºæ–¹å¼2;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ’åºæ–¹å¼</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ASC:å‡åº
DESC:é™åº
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šå¤šä¸ªæ’åºæ¡ä»¶ï¼Œå½“å‰è¾¹çš„æ¡ä»¶å€¼ä¸€æ ·æ—¶ï¼Œæ‰ä¼šåˆ¤æ–­ç¬¬äºŒæ¡ä»¶</p></li><li><p>ä¾‹å¦‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- æŒ‰ç…§åº“å­˜å‡åºæ’åº
SELECT * FROM product ORDER BY stock ASC;

-- æŸ¥è¯¢åç§°ä¸­åŒ…å«æ‰‹æœºçš„å•†å“ä¿¡æ¯ã€‚æŒ‰ç…§é‡‘é¢é™åºæ’åº
SELECT * FROM product WHERE NAME LIKE &#39;%æ‰‹æœº%&#39; ORDER BY price DESC;

-- æŒ‰ç…§é‡‘é¢å‡åºæ’åºï¼Œå¦‚æœé‡‘é¢ç›¸åŒï¼ŒæŒ‰ç…§åº“å­˜é™åºæ’åˆ—
SELECT * FROM product ORDER BY price ASC,stock DESC;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="åˆ†ç»„æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#åˆ†ç»„æŸ¥è¯¢" aria-hidden="true">#</a> åˆ†ç»„æŸ¥è¯¢</h4><p>åˆ†ç»„æŸ¥è¯¢ä¼šè¿›è¡Œå»é‡</p><ul><li><p>åˆ†ç»„æŸ¥è¯¢è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å [WHERE æ¡ä»¶] GROUP BY åˆ†ç»„åˆ—å [HAVING åˆ†ç»„åæ¡ä»¶è¿‡æ»¤] [ORDER BY æ’åºåˆ—å æ’åºæ–¹å¼];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>WHERE è¿‡æ»¤è¡Œï¼ŒHAVING è¿‡æ»¤åˆ†ç»„ï¼Œè¡Œè¿‡æ»¤åº”å½“å…ˆäºåˆ†ç»„è¿‡æ»¤</p><p>åˆ†ç»„è§„å®šï¼š</p><ul><li>GROUP BY å­å¥å‡ºç°åœ¨ WHERE å­å¥ä¹‹åï¼ŒORDER BY å­å¥ä¹‹å‰</li><li>NULL çš„è¡Œä¼šå•ç‹¬åˆ†ä¸ºä¸€ç»„</li><li>å¤§å¤šæ•° SQL å®ç°ä¸æ”¯æŒ GROUP BY åˆ—å…·æœ‰å¯å˜é•¿åº¦çš„æ•°æ®ç±»å‹</li></ul></li><li><p>ä¾‹å¦‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- æŒ‰ç…§å“ç‰Œåˆ†ç»„ï¼Œè·å–æ¯ç»„å•†å“çš„æ€»é‡‘é¢
SELECT brand,SUM(price) FROM product GROUP BY brand;

-- å¯¹é‡‘é¢å¤§äº4000å…ƒçš„å•†å“ï¼ŒæŒ‰ç…§å“ç‰Œåˆ†ç»„,è·å–æ¯ç»„å•†å“çš„æ€»é‡‘é¢
SELECT brand,SUM(price) FROM product WHERE price &gt; 4000 GROUP BY brand;

-- å¯¹é‡‘é¢å¤§äº4000å…ƒçš„å•†å“ï¼ŒæŒ‰ç…§å“ç‰Œåˆ†ç»„ï¼Œè·å–æ¯ç»„å•†å“çš„æ€»é‡‘é¢ï¼Œåªæ˜¾ç¤ºæ€»é‡‘é¢å¤§äº7000å…ƒçš„
SELECT brand,SUM(price) AS getSum FROM product WHERE price &gt; 4000 GROUP BY brand HAVING getSum &gt; 7000;

-- å¯¹é‡‘é¢å¤§äº4000å…ƒçš„å•†å“ï¼ŒæŒ‰ç…§å“ç‰Œåˆ†ç»„ï¼Œè·å–æ¯ç»„å•†å“çš„æ€»é‡‘é¢ï¼Œåªæ˜¾ç¤ºæ€»é‡‘é¢å¤§äº7000å…ƒçš„ã€å¹¶æŒ‰ç…§æ€»é‡‘é¢çš„é™åºæ’åˆ—
SELECT brand,SUM(price) AS getSum FROM product WHERE price &gt; 4000 GROUP BY brand HAVING getSum &gt; 7000 ORDER BY getSum DESC;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="åˆ†é¡µæŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#åˆ†é¡µæŸ¥è¯¢" aria-hidden="true">#</a> åˆ†é¡µæŸ¥è¯¢</h4><ul><li><p>åˆ†é¡µæŸ¥è¯¢è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å [WHERE æ¡ä»¶] GROUP BY åˆ†ç»„åˆ—å [HAVING åˆ†ç»„åæ¡ä»¶è¿‡æ»¤] [ORDER BY æ’åºåˆ—å æ’åºæ–¹å¼] LIMIT å¼€å§‹ç´¢å¼•,æŸ¥è¯¢æ¡æ•°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å…¬å¼ï¼šå¼€å§‹ç´¢å¼• = (å½“å‰é¡µç -1) * æ¯é¡µæ˜¾ç¤ºçš„æ¡æ•°</p></li><li><p>ä¾‹å¦‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM product LIMIT 0,2;  -- ç¬¬ä¸€é¡µ å¼€å§‹ç´¢å¼•=(1-1) * 2
SELECT * FROM product LIMIT 2,2;  -- ç¬¬äºŒé¡µ å¼€å§‹ç´¢å¼•=(2-1) * 2
SELECT * FROM product LIMIT 4,2;  -- ç¬¬ä¸‰é¡µ å¼€å§‹ç´¢å¼•=(3-1) * 2
SELECT * FROM product LIMIT 6,2;  -- ç¬¬å››é¡µ å¼€å§‹ç´¢å¼•=(4-1) * 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-DQLåˆ†é¡µæŸ¥è¯¢å›¾è§£.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul><hr><h2 id="å¤šè¡¨æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å¤šè¡¨æ“ä½œ" aria-hidden="true">#</a> å¤šè¡¨æ“ä½œ</h2><h3 id="çº¦æŸåˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#çº¦æŸåˆ†ç±»" aria-hidden="true">#</a> çº¦æŸåˆ†ç±»</h3><h4 id="çº¦æŸä»‹ç»" tabindex="-1"><a class="header-anchor" href="#çº¦æŸä»‹ç»" aria-hidden="true">#</a> çº¦æŸä»‹ç»</h4><p>çº¦æŸï¼šå¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œé™å®šï¼Œä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ã€æœ‰æ•ˆæ€§ã€å®Œæ•´æ€§</p><p>çº¦æŸçš„åˆ†ç±»ï¼š</p><table><thead><tr><th>çº¦æŸ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>PRIMARY KEY</td><td>ä¸»é”®çº¦æŸ</td></tr><tr><td>PRIMARY KEY AUTO_INCREMENT</td><td>ä¸»é”®ã€è‡ªåŠ¨å¢é•¿</td></tr><tr><td>UNIQUE</td><td>å”¯ä¸€çº¦æŸ</td></tr><tr><td>NOT NULL</td><td>éç©ºçº¦æŸ</td></tr><tr><td>FOREIGN KEY</td><td>å¤–é”®çº¦æŸ</td></tr><tr><td>FOREIGN KEY ON UPDATE CASCADE</td><td>å¤–é”®çº§è”æ›´æ–°</td></tr><tr><td>FOREIGN KEY ON DELETE CASCADE</td><td>å¤–é”®çº§è”åˆ é™¤</td></tr></tbody></table><hr><h4 id="ä¸»é”®çº¦æŸ" tabindex="-1"><a class="header-anchor" href="#ä¸»é”®çº¦æŸ" aria-hidden="true">#</a> ä¸»é”®çº¦æŸ</h4><ul><li><p>ä¸»é”®çº¦æŸç‰¹ç‚¹ï¼š</p><ul><li>ä¸»é”®çº¦æŸé»˜è®¤åŒ…å«<strong>éç©ºå’Œå”¯ä¸€</strong>ä¸¤ä¸ªåŠŸèƒ½</li><li>ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®</li><li>ä¸»é”®ä¸€èˆ¬ç”¨äºè¡¨ä¸­æ•°æ®çš„å”¯ä¸€æ ‡è¯†</li></ul></li><li><p>å»ºè¡¨æ—¶æ·»åŠ ä¸»é”®çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE è¡¨å(
	åˆ—å æ•°æ®ç±»å‹ PRIMARY KEY,
    åˆ—å æ•°æ®ç±»å‹,
    ...
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ é™¤ä¸»é”®çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å DROP PRIMARY KEY;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å»ºè¡¨åå•ç‹¬æ·»åŠ ä¸»é”®çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å MODIFY åˆ—å æ•°æ®ç±»å‹ PRIMARY KEY;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¾‹å¦‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºstudentè¡¨
CREATE TABLE student(
	id INT PRIMARY KEY  -- ç»™idæ·»åŠ ä¸»é”®çº¦æŸ
);

-- æ·»åŠ æ•°æ®
INSERT INTO student VALUES (1),(2);
-- ä¸»é”®é»˜è®¤å”¯ä¸€ï¼Œæ·»åŠ é‡å¤æ•°æ®ï¼Œä¼šæŠ¥é”™
INSERT INTO student VALUES (2);
-- ä¸»é”®é»˜è®¤éç©ºï¼Œä¸èƒ½æ·»åŠ nullçš„æ•°æ®
INSERT INTO student VALUES (NULL);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="ä¸»é”®è‡ªå¢" tabindex="-1"><a class="header-anchor" href="#ä¸»é”®è‡ªå¢" aria-hidden="true">#</a> ä¸»é”®è‡ªå¢</h4><p>ä¸»é”®è‡ªå¢çº¦æŸå¯ä»¥ä¸ºç©ºï¼Œå¹¶è‡ªåŠ¨å¢é•¿ã€‚åˆ é™¤æŸæ¡æ•°æ®ä¸å½±å“è‡ªå¢çš„ä¸‹ä¸€ä¸ªæ•°å€¼ï¼Œä¾ç„¶æŒ‰ç…§å‰ä¸€ä¸ªå€¼è‡ªå¢</p><ul><li><p>å»ºè¡¨æ—¶æ·»åŠ ä¸»é”®è‡ªå¢çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE è¡¨å(
	åˆ—å æ•°æ®ç±»å‹ PRIMARY KEY AUTO_INCREMENT,
    åˆ—å æ•°æ®ç±»å‹,
    ...
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ é™¤ä¸»é”®è‡ªå¢çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å MODIFY åˆ—å æ•°æ®ç±»å‹;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å»ºè¡¨åå•ç‹¬æ·»åŠ ä¸»é”®è‡ªå¢çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å MODIFY åˆ—å æ•°æ®ç±»å‹ AUTO_INCREMENT;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¾‹å¦‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºstudent2è¡¨
CREATE TABLE student2(
	id INT PRIMARY KEY AUTO_INCREMENT    -- ç»™idæ·»åŠ ä¸»é”®è‡ªå¢çº¦æŸ
);

-- æ·»åŠ æ•°æ®
INSERT INTO student2 VALUES (1),(2);
-- æ·»åŠ nullå€¼ï¼Œä¼šè‡ªåŠ¨å¢é•¿
INSERT INTO student2 VALUES (NULL),(NULL);-- 3ï¼Œ4
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="å”¯ä¸€çº¦æŸ" tabindex="-1"><a class="header-anchor" href="#å”¯ä¸€çº¦æŸ" aria-hidden="true">#</a> å”¯ä¸€çº¦æŸ</h4><p>å”¯ä¸€çº¦æŸï¼šçº¦æŸä¸èƒ½æœ‰é‡å¤çš„æ•°æ®</p><ul><li><p>å»ºè¡¨æ—¶æ·»åŠ å”¯ä¸€çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE è¡¨å(
	åˆ—å æ•°æ®ç±»å‹ UNIQUE,
    åˆ—å æ•°æ®ç±»å‹,
    ...
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ é™¤å”¯ä¸€çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å DROP INDEX åˆ—å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å»ºè¡¨åå•ç‹¬æ·»åŠ å”¯ä¸€çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å MODIFY åˆ—å æ•°æ®ç±»å‹ UNIQUE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><hr><h4 id="éç©ºçº¦æŸ" tabindex="-1"><a class="header-anchor" href="#éç©ºçº¦æŸ" aria-hidden="true">#</a> éç©ºçº¦æŸ</h4><ul><li><p>å»ºè¡¨æ—¶æ·»åŠ éç©ºçº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE è¡¨å(
	åˆ—å æ•°æ®ç±»å‹ NOT NULL,
    åˆ—å æ•°æ®ç±»å‹,
    ...
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ é™¤éç©ºçº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å MODIFY åˆ—å æ•°æ®ç±»å‹;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å»ºè¡¨åå•ç‹¬æ·»åŠ éç©ºçº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å MODIFY åˆ—å æ•°æ®ç±»å‹ NOT NULL;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><hr><h4 id="å¤–é”®çº¦æŸ" tabindex="-1"><a class="header-anchor" href="#å¤–é”®çº¦æŸ" aria-hidden="true">#</a> å¤–é”®çº¦æŸ</h4><p>å¤–é”®çº¦æŸï¼šè®©è¡¨å’Œè¡¨ä¹‹é—´äº§ç”Ÿå…³ç³»ï¼Œä»è€Œä¿è¯æ•°æ®çš„å‡†ç¡®æ€§</p><ul><li><p>å»ºè¡¨æ—¶æ·»åŠ å¤–é”®çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE è¡¨å(
	åˆ—å æ•°æ®ç±»å‹ çº¦æŸ,
    ...
    CONSTRAINT å¤–é”®å FOREIGN KEY (æœ¬è¡¨å¤–é”®åˆ—å) REFERENCES ä¸»è¡¨å(ä¸»è¡¨ä¸»é”®åˆ—å)
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ é™¤å¤–é”®çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å DROP FOREIGN KEY å¤–é”®å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å»ºè¡¨åå•ç‹¬æ·»åŠ å¤–é”®çº¦æŸ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®å FOREIGN KEY (æœ¬è¡¨å¤–é”®åˆ—å) REFERENCES ä¸»è¡¨å(ä¸»è¡¨ä¸»é”®åˆ—å);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¾‹å¦‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºuserç”¨æˆ·è¡¨
CREATE TABLE USER(
	id INT PRIMARY KEY AUTO_INCREMENT,    -- id
	name VARCHAR(20) NOT NULL             -- å§“å
);
-- æ·»åŠ ç”¨æˆ·æ•°æ®
INSERT INTO USER VALUES (NULL,&#39;å¼ ä¸‰&#39;),(NULL,&#39;æå››&#39;),(NULL,&#39;ç‹äº”&#39;);

-- åˆ›å»ºorderlistè®¢å•è¡¨
CREATE TABLE orderlist(
	id INT PRIMARY KEY AUTO_INCREMENT,    -- id
	number VARCHAR(20) NOT NULL,          -- è®¢å•ç¼–å·
	uid INT,                              -- è®¢å•æ‰€å±ç”¨æˆ·
	CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id)   -- æ·»åŠ å¤–é”®çº¦æŸ
);
-- æ·»åŠ è®¢å•æ•°æ®
INSERT INTO orderlist VALUES (NULL,&#39;hm001&#39;,1),(NULL,&#39;hm002&#39;,1),
(NULL,&#39;hm003&#39;,2),(NULL,&#39;hm004&#39;,2),
(NULL,&#39;hm005&#39;,3),(NULL,&#39;hm006&#39;,3);

-- æ·»åŠ ä¸€ä¸ªè®¢å•ï¼Œä½†æ˜¯æ²¡æœ‰æ‰€å±ç”¨æˆ·ã€‚æ— æ³•æ·»åŠ 
INSERT INTO orderlist VALUES (NULL,&#39;hm007&#39;,8);
-- åˆ é™¤ç‹äº”è¿™ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯è®¢å•è¡¨ä¸­ç‹äº”è¿˜æœ‰å¾ˆå¤šä¸ªè®¢å•å‘¢ã€‚æ— æ³•åˆ é™¤
DELETE FROM USER WHERE NAME=&#39;ç‹äº”&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="å¤–é”®çº§è”" tabindex="-1"><a class="header-anchor" href="#å¤–é”®çº§è”" aria-hidden="true">#</a> å¤–é”®çº§è”</h4><p>çº§è”æ“ä½œï¼šå½“æŠŠä¸»è¡¨ä¸­çš„æ•°æ®è¿›è¡Œåˆ é™¤æˆ–æ›´æ–°æ—¶ï¼Œä»è¡¨ä¸­æœ‰å…³è”çš„æ•°æ®çš„ç›¸åº”æ“ä½œï¼ŒåŒ…æ‹¬ RESTRICTã€CASCADEã€SET NULL å’Œ NO ACTION</p><ul><li><p>RESTRICT å’Œ NO ACTIONç›¸åŒï¼Œ æ˜¯æŒ‡é™åˆ¶åœ¨å­è¡¨æœ‰å…³è”è®°å½•çš„æƒ…å†µä¸‹ï¼Œ çˆ¶è¡¨ä¸èƒ½æ›´æ–°</p></li><li><p>CASCADE è¡¨ç¤ºçˆ¶è¡¨åœ¨æ›´æ–°æˆ–è€…åˆ é™¤æ—¶ï¼Œæ›´æ–°æˆ–è€…åˆ é™¤å­è¡¨å¯¹åº”çš„è®°å½•</p></li><li><p>SET NULL åˆ™è¡¨ç¤ºçˆ¶è¡¨åœ¨æ›´æ–°æˆ–è€…åˆ é™¤çš„æ—¶å€™ï¼Œå­è¡¨çš„å¯¹åº”å­—æ®µè¢«SET NULL</p></li></ul><p>çº§è”æ“ä½œï¼š</p><ul><li><p>æ·»åŠ çº§è”æ›´æ–°</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®å FOREIGN KEY (æœ¬è¡¨å¤–é”®åˆ—å) REFERENCES ä¸»è¡¨å(ä¸»è¡¨ä¸»é”®åˆ—å) ON UPDATE [CASCADE | RESTRICT | SET NULL];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ·»åŠ çº§è”åˆ é™¤</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®å FOREIGN KEY (æœ¬è¡¨å¤–é”®åˆ—å) REFERENCES ä¸»è¡¨å(ä¸»è¡¨ä¸»é”®åˆ—å) ON DELETE CASCADE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>åŒæ—¶æ·»åŠ çº§è”æ›´æ–°å’Œçº§è”åˆ é™¤</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®å FOREIGN KEY (æœ¬è¡¨å¤–é”®åˆ—å) REFERENCES ä¸»è¡¨å(ä¸»è¡¨ä¸»é”®åˆ—å) ON UPDATE CASCADE ON DELETE CASCADE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><hr><h3 id="å¤šè¡¨è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#å¤šè¡¨è®¾è®¡" aria-hidden="true">#</a> å¤šè¡¨è®¾è®¡</h3><h4 id="ä¸€å¯¹ä¸€" tabindex="-1"><a class="header-anchor" href="#ä¸€å¯¹ä¸€" aria-hidden="true">#</a> ä¸€å¯¹ä¸€</h4><p>å¤šè¡¨ï¼šæœ‰å¤šå¼ æ•°æ®è¡¨ï¼Œè€Œè¡¨ä¸è¡¨ä¹‹é—´æœ‰ä¸€å®šçš„å…³è”å…³ç³»ï¼Œé€šè¿‡å¤–é”®çº¦æŸå®ç°ï¼Œåˆ†ä¸ºä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šä¸‰ç±»</p><p>ä¸¾ä¾‹ï¼šäººå’Œèº«ä»½è¯</p><p>å®ç°åŸåˆ™ï¼šåœ¨ä»»æ„ä¸€ä¸ªè¡¨å»ºç«‹å¤–é”®ï¼Œå»å…³è”å¦å¤–ä¸€ä¸ªè¡¨çš„ä¸»é”®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºpersonè¡¨
CREATE TABLE person(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- ä¸»é”®id
	NAME VARCHAR(20)                        -- å§“å
);
-- æ·»åŠ æ•°æ®
INSERT INTO person VALUES (NULL,&#39;å¼ ä¸‰&#39;),(NULL,&#39;æå››&#39;);

-- åˆ›å»ºcardè¡¨
CREATE TABLE card(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- ä¸»é”®id
	number VARCHAR(20) UNIQUE NOT NULL,	-- èº«ä»½è¯å·
	pid INT UNIQUE,                         -- å¤–é”®åˆ—
	CONSTRAINT cp_fk1 FOREIGN KEY (pid) REFERENCES person(id)
);
-- æ·»åŠ æ•°æ®
INSERT INTO card VALUES (NULL,&#39;12345&#39;,1),(NULL,&#39;56789&#39;,2);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/å¤šè¡¨è®¾è®¡ä¸€å¯¹ä¸€.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h4 id="ä¸€å¯¹å¤š" tabindex="-1"><a class="header-anchor" href="#ä¸€å¯¹å¤š" aria-hidden="true">#</a> ä¸€å¯¹å¤š</h4><p>ä¸¾ä¾‹ï¼šç”¨æˆ·å’Œè®¢å•ã€å•†å“åˆ†ç±»å’Œå•†å“</p><p>å®ç°åŸåˆ™ï¼šåœ¨å¤šçš„ä¸€æ–¹ï¼Œå»ºç«‹å¤–é”®çº¦æŸï¼Œæ¥å…³è”ä¸€çš„ä¸€æ–¹ä¸»é”®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºuserè¡¨
CREATE TABLE USER(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- ä¸»é”®id
	NAME VARCHAR(20)                        -- å§“å
);
-- æ·»åŠ æ•°æ®
INSERT INTO USER VALUES (NULL,&#39;å¼ ä¸‰&#39;),(NULL,&#39;æå››&#39;);

-- åˆ›å»ºorderlistè¡¨
CREATE TABLE orderlist(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- ä¸»é”®id
	number VARCHAR(20),                     -- è®¢å•ç¼–å·
	uid INT,				-- å¤–é”®åˆ—
	CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id)
);
-- æ·»åŠ æ•°æ®
INSERT INTO orderlist VALUES (NULL,&#39;hm001&#39;,1),(NULL,&#39;hm002&#39;,1),(NULL,&#39;hm003&#39;,2),(NULL,&#39;hm004&#39;,2);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/å¤šè¡¨è®¾è®¡ä¸€å¯¹å¤š.png" alt="å¤šè¡¨è®¾è®¡ä¸€å¯¹å¤š" tabindex="0" loading="lazy"><figcaption>å¤šè¡¨è®¾è®¡ä¸€å¯¹å¤š</figcaption></figure><hr><h4 id="å¤šå¯¹å¤š" tabindex="-1"><a class="header-anchor" href="#å¤šå¯¹å¤š" aria-hidden="true">#</a> å¤šå¯¹å¤š</h4><p>ä¸¾ä¾‹ï¼šå­¦ç”Ÿå’Œè¯¾ç¨‹ã€‚ä¸€ä¸ªå­¦ç”Ÿå¯ä»¥é€‰æ‹©å¤šä¸ªè¯¾ç¨‹ï¼Œä¸€ä¸ªè¯¾ç¨‹ä¹Ÿå¯ä»¥è¢«å¤šä¸ªå­¦ç”Ÿé€‰æ‹©</p><p>å®ç°åŸåˆ™ï¼šå€ŸåŠ©ç¬¬ä¸‰å¼ è¡¨ä¸­é—´è¡¨ï¼Œä¸­é—´è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªåˆ—ï¼Œè¿™ä¸¤ä¸ªåˆ—ä½œä¸ºä¸­é—´è¡¨çš„å¤–é”®ï¼Œåˆ†åˆ«å…³è”ä¸¤å¼ è¡¨çš„ä¸»é”®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºstudentè¡¨
CREATE TABLE student(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- ä¸»é”®id
	NAME VARCHAR(20)			-- å­¦ç”Ÿå§“å
);
-- æ·»åŠ æ•°æ®
INSERT INTO student VALUES (NULL,&#39;å¼ ä¸‰&#39;),(NULL,&#39;æå››&#39;);

-- åˆ›å»ºcourseè¡¨
CREATE TABLE course(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- ä¸»é”®id
	NAME VARCHAR(10)			-- è¯¾ç¨‹åç§°
);
-- æ·»åŠ æ•°æ®
INSERT INTO course VALUES (NULL,&#39;è¯­æ–‡&#39;),(NULL,&#39;æ•°å­¦&#39;);

-- åˆ›å»ºä¸­é—´è¡¨
CREATE TABLE stu_course(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- ä¸»é”®id
	sid INT,  -- ç”¨äºå’Œstudentè¡¨ä¸­çš„idè¿›è¡Œå¤–é”®å…³è”
	cid INT,  -- ç”¨äºå’Œcourseè¡¨ä¸­çš„idè¿›è¡Œå¤–é”®å…³è”
	CONSTRAINT sc_fk1 FOREIGN KEY (sid) REFERENCES student(id), -- æ·»åŠ å¤–é”®çº¦æŸ
	CONSTRAINT sc_fk2 FOREIGN KEY (cid) REFERENCES course(id)   -- æ·»åŠ å¤–é”®çº¦æŸ
);
-- æ·»åŠ æ•°æ®
INSERT INTO stu_course VALUES (NULL,1,1),(NULL,1,2),(NULL,2,1),(NULL,2,2);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/å¤šè¡¨è®¾è®¡å¤šå¯¹å¤š.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h3 id="è¿æ¥æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#è¿æ¥æŸ¥è¯¢" aria-hidden="true">#</a> è¿æ¥æŸ¥è¯¢</h3><h4 id="å†…å¤–è¿æ¥" tabindex="-1"><a class="header-anchor" href="#å†…å¤–è¿æ¥" aria-hidden="true">#</a> å†…å¤–è¿æ¥</h4><h5 id="å†…è¿æ¥" tabindex="-1"><a class="header-anchor" href="#å†…è¿æ¥" aria-hidden="true">#</a> å†…è¿æ¥</h5><p>è¿æ¥æŸ¥è¯¢çš„æ˜¯ä¸¤å¼ è¡¨æœ‰äº¤é›†çš„éƒ¨åˆ†æ•°æ®ï¼Œä¸¤å¼ è¡¨åˆ†ä¸º<strong>é©±åŠ¨è¡¨å’Œè¢«é©±åŠ¨è¡¨</strong>ï¼Œå¦‚æœç»“æœé›†ä¸­çš„æ¯æ¡è®°å½•éƒ½æ˜¯ä¸¤ä¸ªè¡¨ç›¸äº’åŒ¹é…çš„ç»„åˆï¼Œåˆ™ç§°è¿™æ ·çš„ç»“æœé›†ä¸ºç¬›å¡å°”ç§¯</p><p>å†…è¿æ¥æŸ¥è¯¢ï¼Œè‹¥é©±åŠ¨è¡¨ä¸­çš„è®°å½•åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ‰¾ä¸åˆ°åŒ¹é…çš„è®°å½•æ—¶ï¼Œåˆ™è¯¥è®°å½•ä¸ä¼šåŠ åˆ°æœ€åçš„ç»“æœé›†</p><ul><li><p>æ˜¾å¼å†…è¿æ¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å1 [INNER] JOIN è¡¨å2 ON æ¡ä»¶;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>éšå¼å†…è¿æ¥ï¼šå†…è¿æ¥ä¸­ WHERE å­å¥å’Œ ON å­å¥æ˜¯ç­‰ä»·çš„</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å1,è¡¨å2 WHERE æ¡ä»¶;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>STRAIGHT_JOINä¸ JOIN ç±»ä¼¼ï¼Œåªä¸è¿‡å·¦è¡¨å§‹ç»ˆåœ¨å³è¡¨ä¹‹å‰è¯»å–ï¼Œåªé€‚ç”¨äºå†…è¿æ¥</p><hr><h5 id="å¤–è¿æ¥" tabindex="-1"><a class="header-anchor" href="#å¤–è¿æ¥" aria-hidden="true">#</a> å¤–è¿æ¥</h5><p>å¤–è¿æ¥æŸ¥è¯¢ï¼Œè‹¥é©±åŠ¨è¡¨ä¸­çš„è®°å½•åœ¨è¢«é©±åŠ¨è¡¨ä¸­æ‰¾ä¸åˆ°åŒ¹é…çš„è®°å½•æ—¶ï¼Œåˆ™è¯¥è®°å½•ä¹Ÿä¼šåŠ åˆ°æœ€åçš„ç»“æœé›†ï¼Œåªæ˜¯å¯¹äºè¢«é©±åŠ¨è¡¨ä¸­<strong>ä¸åŒ¹é…è¿‡æ»¤æ¡ä»¶</strong>çš„è®°å½•ï¼Œå„ä¸ªå­—æ®µä½¿ç”¨ NULL å¡«å……</p><p>åº”ç”¨å®ä¾‹ï¼šæŸ¥å­¦ç”Ÿæˆç»©ï¼Œä¹Ÿæƒ³å±•ç¤ºå‡ºç¼ºè€ƒçš„äººçš„æˆç»©</p><ul><li><p>å·¦å¤–è¿æ¥ï¼šé€‰æ‹©å·¦ä¾§çš„è¡¨ä¸ºé©±åŠ¨è¡¨ï¼ŒæŸ¥è¯¢å·¦è¡¨çš„å…¨éƒ¨æ•°æ®ï¼Œå’Œå·¦å³ä¸¤å¼ è¡¨æœ‰äº¤é›†éƒ¨åˆ†çš„æ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å1 LEFT [OUTER] JOIN è¡¨å2 ON æ¡ä»¶;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å³å¤–è¿æ¥ï¼šé€‰æ‹©å³ä¾§çš„è¡¨ä¸ºé©±åŠ¨è¡¨ï¼ŒæŸ¥è¯¢å³è¡¨çš„å…¨éƒ¨æ•°æ®ï¼Œå’Œå·¦å³ä¸¤å¼ è¡¨æœ‰äº¤é›†éƒ¨åˆ†çš„æ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å1 RIGHT [OUTER] JOIN è¡¨å2 ON æ¡ä»¶;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-JOINæŸ¥è¯¢å›¾.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h4 id="å…³è”æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#å…³è”æŸ¥è¯¢" aria-hidden="true">#</a> å…³è”æŸ¥è¯¢</h4><p>è‡ªå…³è”æŸ¥è¯¢ï¼šåŒä¸€å¼ è¡¨ä¸­æœ‰æ•°æ®å…³è”ï¼Œå¯ä»¥å¤šæ¬¡æŸ¥è¯¢è¿™åŒä¸€ä¸ªè¡¨</p><ul><li><p>æ•°æ®å‡†å¤‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºå‘˜å·¥è¡¨
CREATE TABLE employee(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- å‘˜å·¥ç¼–å·
	NAME VARCHAR(20),					-- å‘˜å·¥å§“å
	mgr INT,							-- ä¸Šçº§ç¼–å·
	salary DOUBLE						-- å‘˜å·¥å·¥èµ„
);
-- æ·»åŠ æ•°æ®
INSERT INTO employee VALUES (1001,&#39;å­™æ‚Ÿç©º&#39;,1005,9000.00),..,(1009,&#39;å®‹æ±Ÿ&#39;,NULL,16000.00);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/è‡ªå…³è”æŸ¥è¯¢æ•°æ®å‡†å¤‡.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æ•°æ®æŸ¥è¯¢</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥çš„å§“ååŠå…¶ç›´æ¥ä¸Šçº§çš„å§“åï¼Œæ²¡æœ‰ä¸Šçº§çš„å‘˜å·¥ä¹Ÿéœ€è¦æŸ¥è¯¢
/*
åˆ†æ
	å‘˜å·¥ä¿¡æ¯ employeeè¡¨
	æ¡ä»¶ï¼šemployee.mgr = employee.id
	æŸ¥è¯¢å·¦è¡¨çš„å…¨éƒ¨æ•°æ®ï¼Œå’Œå·¦å³ä¸¤å¼ è¡¨æœ‰äº¤é›†éƒ¨åˆ†æ•°æ®ï¼Œå·¦å¤–è¿æ¥
*/
SELECT
	e1.id,
	e1.name,
	e1.mgr,
	e2.id,
	e2.name
FROM
	employee e1
LEFT OUTER JOIN
	employee e2
ON
	e1.mgr = e2.id;	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢ç»“æœ</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>id		name	mgr	   id	  name
1001	å­™æ‚Ÿç©º	  1005	1005	å”åƒ§
1002	çŒªå…«æˆ’	  1005	1005	å”åƒ§
1003	æ²™å’Œå°š	  1005	1005	å”åƒ§
1004	å°ç™½é¾™	  1005	1005	å”åƒ§
1005	å”åƒ§	   NULL	 NULL	 NULL
1006	æ­¦æ¾	   1009	 1009	 å®‹æ±Ÿ
1007	æé€µ	   1009	 1009	 å®‹æ±Ÿ
1008	æ—å†²	   1009	 1009	 å®‹æ±Ÿ
1009	å®‹æ±Ÿ	   NULL	 NULL	 NULL
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="è¿æ¥åŸç†" tabindex="-1"><a class="header-anchor" href="#è¿æ¥åŸç†" aria-hidden="true">#</a> è¿æ¥åŸç†</h4><p>Index Nested-Loop Join ç®—æ³•ï¼šæŸ¥è¯¢é©±åŠ¨è¡¨å¾—åˆ°<strong>æ•°æ®é›†</strong>ï¼Œç„¶åæ ¹æ®æ•°æ®é›†ä¸­çš„æ¯ä¸€æ¡è®°å½•çš„<strong>å…³è”å­—æ®µå†åˆ†åˆ«</strong>åˆ°è¢«é©±åŠ¨è¡¨ä¸­æŸ¥æ‰¾åŒ¹é…ï¼ˆ<strong>èµ°ç´¢å¼•</strong>ï¼‰ï¼Œæ‰€ä»¥é©±åŠ¨è¡¨åªéœ€è¦è®¿é—®ä¸€æ¬¡ï¼Œè¢«é©±åŠ¨è¡¨è¦è®¿é—®å¤šæ¬¡</p><p>MySQL å°†æŸ¥è¯¢é©±åŠ¨è¡¨åå¾—åˆ°çš„è®°å½•æˆä¸ºé©±åŠ¨è¡¨çš„æ‰‡å‡ºï¼Œè¿æ¥æŸ¥è¯¢çš„æˆæœ¬ï¼šå•æ¬¡è®¿é—®é©±åŠ¨è¡¨çš„æˆæœ¬ + æ‰‡å‡ºå€¼ * å•æ¬¡è®¿é—®è¢«é©±åŠ¨è¡¨çš„æˆæœ¬ï¼Œä¼˜åŒ–å™¨ä¼šé€‰æ‹©æˆæœ¬æœ€å°çš„è¡¨è¿æ¥é¡ºåºï¼ˆç¡®å®šè°æ˜¯é©±åŠ¨è¡¨ï¼Œè°æ˜¯è¢«é©±åŠ¨è¡¨ï¼‰ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œè¿›è¡Œè¿æ¥æŸ¥è¯¢ï¼Œä¼˜åŒ–æ–¹å¼ï¼š</p><ul><li>å‡å°‘é©±åŠ¨è¡¨çš„æ‰‡å‡ºï¼ˆè®©æ•°æ®é‡å°çš„è¡¨æ¥åšé©±åŠ¨è¡¨ï¼‰</li><li>é™ä½è®¿é—®è¢«é©±åŠ¨è¡¨çš„æˆæœ¬</li></ul><p>è¯´æ˜ï¼šSTRAIGHT_JOIN æ˜¯æŸ¥ä¸€æ¡é©±åŠ¨è¡¨ï¼Œç„¶åæ ¹æ®å…³è”å­—æ®µå»æŸ¥è¢«é©±åŠ¨è¡¨ï¼Œè¦è®¿é—®å¤šæ¬¡é©±åŠ¨è¡¨ï¼Œæ‰€ä»¥éœ€è¦ä¼˜åŒ–ä¸º INL ç®—æ³•</p><p>Block Nested-Loop Join ç®—æ³•ï¼šä¸€ç§<strong>ç©ºé—´æ¢æ—¶é—´</strong>çš„ä¼˜åŒ–æ–¹å¼ï¼ŒåŸºäºå—çš„å¾ªç¯è¿æ¥ï¼Œæ‰§è¡Œè¿æ¥æŸ¥è¯¢å‰ç”³è¯·ä¸€å—å›ºå®šå¤§å°çš„å†…å­˜ä½œä¸ºè¿æ¥ç¼“å†²åŒº Join Bufferï¼Œå…ˆæŠŠè‹¥å¹²æ¡é©±åŠ¨è¡¨ä¸­çš„æ‰‡å‡ºæš‚å­˜åœ¨ç¼“å†²åŒºï¼Œæ¯ä¸€æ¡è¢«é©±åŠ¨è¡¨ä¸­çš„è®°å½•ä¸€æ¬¡æ€§çš„ä¸ Buffer ä¸­å¤šæ¡è®°å½•è¿›è¡ŒåŒ¹é…ï¼ˆæ‰«æå…¨éƒ¨æ•°æ®ï¼Œä¸€æ¡ä¸€æ¡çš„åŒ¹é…ï¼‰ï¼Œå› ä¸ºæ˜¯åœ¨å†…å­˜ä¸­å®Œæˆï¼Œæ‰€ä»¥é€Ÿåº¦å¿«ï¼Œå¹¶ä¸”é™ä½äº† I/O æˆæœ¬</p><p>Join Buffer å¯ä»¥é€šè¿‡å‚æ•° <code>join_buffer_size</code> è¿›è¡Œé…ç½®ï¼Œé»˜è®¤å¤§å°æ˜¯ 256 KB</p><p>åœ¨æˆæœ¬åˆ†ææ—¶ï¼Œå¯¹äºå¾ˆå¤šå¼ è¡¨çš„è¿æ¥æŸ¥è¯¢ï¼Œè¿æ¥é¡ºåºæœ‰éå¸¸å¤šï¼ŒMySQL å¦‚æœæŒ¨ç€è¿›è¡Œéå†è®¡ç®—æˆæœ¬ï¼Œä¼šæ¶ˆè€—å¾ˆå¤šèµ„æº</p><ul><li><p>æå‰ç»“æŸæŸç§è¿æ¥é¡ºåºçš„æˆæœ¬è¯„ä¼°ï¼šç»´æŠ¤ä¸€ä¸ªå…¨å±€å˜é‡è®°å½•å½“å‰æˆæœ¬æœ€å°çš„è¿æ¥æ–¹å¼ï¼Œå¦‚æœä¸€ç§é¡ºåºåªè®¡ç®—äº†ä¸€éƒ¨åˆ†å°±å·²ç»è¶…è¿‡äº†æœ€å°æˆæœ¬ï¼Œå¯ä»¥æå‰ç»“æŸè®¡ç®—</p></li><li><p>ç³»ç»Ÿå˜é‡ optimizer_search_depthï¼šå¦‚æœè¿æ¥è¡¨çš„ä¸ªæ•°å°äºè¯¥å˜é‡ï¼Œå°±ç»§ç»­ç©·ä¸¾åˆ†ææ¯ä¸€ç§è¿æ¥æ•°é‡ï¼Œåä¹‹åªå¯¹æ•°é‡ä¸ depth å€¼ç›¸åŒçš„è¡¨è¿›è¡Œåˆ†æï¼Œè¯¥å€¼è¶Šå¤§æˆæœ¬åˆ†æçš„è¶Šç²¾ç¡®</p></li><li><p>ç³»ç»Ÿå˜é‡ optimizer_prune_levelï¼šæ§åˆ¶å¯å‘å¼è§„åˆ™çš„å¯ç”¨ï¼Œè¿™äº›è§„åˆ™å°±æ˜¯æ ¹æ®ä»¥å¾€ç»éªŒæŒ‡å®šçš„ï¼Œä¸æ»¡è¶³è§„åˆ™çš„è¿æ¥é¡ºåºä¸åˆ†ææˆæœ¬</p></li></ul><hr><h4 id="è¿æ¥ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#è¿æ¥ä¼˜åŒ–" aria-hidden="true">#</a> è¿æ¥ä¼˜åŒ–</h4><h5 id="bka" tabindex="-1"><a class="header-anchor" href="#bka" aria-hidden="true">#</a> BKA</h5><p>Batched Key Access ç®—æ³•æ˜¯å¯¹ NLJ ç®—æ³•çš„ä¼˜åŒ–ï¼Œåœ¨è¯»å–è¢«é©±åŠ¨è¡¨çš„è®°å½•æ—¶ä½¿ç”¨é¡ºåº IOï¼ŒExtra ä¿¡æ¯ä¸­ä¼šæœ‰ Batched Key Access ä¿¡æ¯</p><p>ä½¿ç”¨ BKA çš„è¡¨çš„ JOIN è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>è¿æ¥é©±åŠ¨è¡¨å°†æ»¡è¶³æ¡ä»¶çš„è®°å½•æ”¾å…¥ Join Bufferï¼Œå¹¶å°†ä¸¤è¡¨è¿æ¥çš„å­—æ®µæ”¾å…¥ä¸€ä¸ª DYNAMIC_ARRAY ranges ä¸­</li><li>åœ¨è¿›è¡Œè¡¨çš„è¿‡æ¥è¿‡ç¨‹ä¸­ï¼Œä¼šå°† ranges ç›¸å…³çš„ä¿¡æ¯ä¼ å…¥ Buffer ä¸­ï¼Œè¿›è¡Œè¢«é©±åŠ¨è¡¨ä¸»å»ºçš„æŸ¥æ‰¾åŠæ’åºæ“ä½œ</li><li>è°ƒç”¨æ­¥éª¤ 2 ä¸­äº§ç”Ÿçš„æœ‰åºä¸»å»ºï¼Œ<strong>é¡ºåºè¯»å–è¢«é©±åŠ¨è¡¨çš„æ•°æ®</strong></li><li>å½“ç¼“å†²åŒºçš„æ•°æ®è¢«è¯»å®Œåï¼Œä¼šé‡å¤è¿›è¡Œæ­¥éª¤ 2ã€3ï¼Œç›´åˆ°è®°å½•è¢«è¯»å–å®Œ</li></ul><p>ä½¿ç”¨ BKA ä¼˜åŒ–éœ€è¦è®¾è¿›è¡Œè®¾ç½®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET optimizer_switch=&#39;mrr=on,mrr_cost_based=off,batched_key_access=on&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¯´æ˜ï¼šå‰ä¸¤ä¸ªå‚æ•°çš„ä½œç”¨æ˜¯å¯ç”¨ MRRï¼Œå› ä¸º BKA ç®—æ³•çš„ä¼˜åŒ–è¦ä¾èµ–äº MRRï¼ˆç³»ç»Ÿä¼˜åŒ– â†’ å†…å­˜ä¼˜åŒ– â†’ Read è¯¦è§£ï¼‰</p><hr><h5 id="bnl" tabindex="-1"><a class="header-anchor" href="#bnl" aria-hidden="true">#</a> BNL</h5><h6 id="é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#é—®é¢˜" aria-hidden="true">#</a> é—®é¢˜</h6><p>BNL å³ Block Nested-Loop Join ç®—æ³•ï¼Œç”±äºè¦è®¿é—®å¤šæ¬¡è¢«é©±åŠ¨è¡¨ï¼Œä¼šäº§ç”Ÿä¸¤ä¸ªé—®é¢˜ï¼š</p><ul><li><p>Join è¯­å¥å¤šæ¬¡æ‰«æä¸€ä¸ªå†·è¡¨ï¼Œå¹¶ä¸”è¯­å¥æ‰§è¡Œæ—¶é—´å°äº 1 ç§’ï¼Œå°±ä¼šåœ¨å†æ¬¡æ‰«æå†·è¡¨æ—¶ï¼ŒæŠŠå†·è¡¨çš„æ•°æ®é¡µç§»åˆ° LRU é“¾è¡¨å¤´éƒ¨ï¼Œå¯¼è‡´çƒ­æ•°æ®è¢«æ·˜æ±°ï¼Œå½±å“ä¸šåŠ¡çš„æ­£å¸¸è¿è¡Œ</p><p>è¿™ç§æƒ…å†µå†·è¡¨çš„æ•°æ®é‡è¦å°äºæ•´ä¸ª Buffer Pool çš„ old åŒºåŸŸï¼Œèƒ½å¤Ÿå®Œå…¨æ”¾å…¥ old åŒºï¼Œæ‰ä¼šå†æ¬¡è¢«è¯»æ—¶åŠ åˆ° youngï¼Œå¦åˆ™è¯»å–ä¸‹ä¸€æ®µæ—¶å°±å·²ç»æŠŠä¸Šä¸€æ®µæ·˜æ±°</p></li><li><p>Join è¯­å¥åœ¨å¾ªç¯è¯»ç£ç›˜å’Œæ·˜æ±°å†…å­˜é¡µï¼Œè¿›å…¥ old åŒºåŸŸçš„æ•°æ®é¡µå¾ˆå¯èƒ½åœ¨ 1 ç§’ä¹‹å†…å°±è¢«æ·˜æ±°ï¼Œå°±ä¼šå¯¼è‡´ MySQL å®ä¾‹çš„ Buffer Pool åœ¨è¿™æ®µæ—¶é—´å†… young åŒºåŸŸçš„æ•°æ®é¡µæ²¡æœ‰è¢«åˆç†åœ°æ·˜æ±°</p></li></ul><p>å¤§è¡¨ Join æ“ä½œè™½ç„¶å¯¹ IO æœ‰å½±å“ï¼Œä½†æ˜¯åœ¨è¯­å¥æ‰§è¡Œç»“æŸåå¯¹ IO çš„å½±å“éšä¹‹ç»“æŸã€‚ä½†æ˜¯å¯¹ Buffer Pool çš„å½±å“å°±æ˜¯æŒç»­æ€§çš„ï¼Œéœ€è¦ä¾é åç»­çš„æŸ¥è¯¢è¯·æ±‚æ…¢æ…¢æ¢å¤å†…å­˜å‘½ä¸­ç‡</p><h6 id="ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–" aria-hidden="true">#</a> ä¼˜åŒ–</h6><p>å°† BNL ç®—æ³•è½¬æˆ BKA ç®—æ³•ï¼Œä¼˜åŒ–æ–¹å‘ï¼š</p><ul><li>åœ¨è¢«é©±åŠ¨è¡¨ä¸Šå»ºç´¢å¼•ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®ç´¢å¼•è¿›è¡Œé¡ºåº IO</li><li>ä½¿ç”¨ä¸´æ—¶è¡¨ï¼Œ<strong>åœ¨ä¸´æ—¶è¡¨ä¸Šå»ºç«‹ç´¢å¼•</strong>ï¼Œå°†è¢«é©±åŠ¨è¡¨å’Œä¸´æ—¶è¡¨è¿›è¡Œè¿æ¥æŸ¥è¯¢</li></ul><p>é©±åŠ¨è¡¨ t1ï¼Œè¢«é©±åŠ¨è¡¨ t2ï¼Œä½¿ç”¨ä¸´æ—¶è¡¨çš„å·¥ä½œæµç¨‹ï¼š</p><ul><li>æŠŠè¡¨ t1 ä¸­æ»¡è¶³æ¡ä»¶çš„æ•°æ®æ”¾åœ¨ä¸´æ—¶è¡¨ tmp_t ä¸­</li><li>ç»™ä¸´æ—¶è¡¨ tmp_t çš„å…³è”å­—æ®µåŠ ä¸Šç´¢å¼•ï¼Œä½¿ç”¨ BKA ç®—æ³•</li><li>è®©è¡¨ t2 å’Œ tmp_t åš Join æ“ä½œï¼ˆä¸´æ—¶è¡¨æ˜¯è¢«é©±åŠ¨è¡¨ï¼‰</li></ul><p>è¡¥å……ï¼šMySQL 8.0 æ”¯æŒ hash joinï¼Œjoin_buffer ç»´æŠ¤çš„ä¸å†æ˜¯ä¸€ä¸ªæ— åºæ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼ŒæŸ¥è¯¢æ•ˆç‡æ›´é«˜ï¼Œæ‰§è¡Œæ•ˆç‡æ¯”ä¸´æ—¶è¡¨æ›´é«˜</p><hr><h3 id="åµŒå¥—æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#åµŒå¥—æŸ¥è¯¢" aria-hidden="true">#</a> åµŒå¥—æŸ¥è¯¢</h3><h4 id="æŸ¥è¯¢åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢åˆ†ç±»" aria-hidden="true">#</a> æŸ¥è¯¢åˆ†ç±»</h4><p>æŸ¥è¯¢è¯­å¥ä¸­åµŒå¥—äº†æŸ¥è¯¢è¯­å¥ï¼Œ<strong>å°†åµŒå¥—æŸ¥è¯¢ç§°ä¸ºå­æŸ¥è¯¢</strong>ï¼ŒFROM å­å¥åé¢çš„å­æŸ¥è¯¢çš„ç»“æœé›†ç§°ä¸ºæ´¾ç”Ÿè¡¨</p><p>æ ¹æ®ç»“æœåˆ†ç±»ï¼š</p><ul><li><p>ç»“æœæ˜¯å•è¡Œå•åˆ—ï¼šå¯ä»¥å°†æŸ¥è¯¢çš„ç»“æœä½œä¸ºå¦ä¸€æ¡è¯­å¥çš„æŸ¥è¯¢æ¡ä»¶ï¼Œä½¿ç”¨è¿ç®—ç¬¦åˆ¤æ–­</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å WHERE åˆ—å=(SELECT åˆ—å/èšåˆå‡½æ•°(åˆ—å) FROM è¡¨å [WHERE æ¡ä»¶]);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ç»“æœæ˜¯å¤šè¡Œå•åˆ—ï¼šå¯ä»¥ä½œä¸ºæ¡ä»¶ï¼Œä½¿ç”¨è¿ç®—ç¬¦ IN æˆ– NOT IN è¿›è¡Œåˆ¤æ–­</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å WHERE åˆ—å [NOT] IN (SELECT åˆ—å FROM è¡¨å [WHERE æ¡ä»¶]); 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ç»“æœæ˜¯å¤šè¡Œå¤šåˆ—ï¼šæŸ¥è¯¢çš„ç»“æœå¯ä»¥ä½œä¸ºä¸€å¼ è™šæ‹Ÿè¡¨å‚ä¸æŸ¥è¯¢</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT åˆ—å FROM è¡¨å [åˆ«å],(SELECT åˆ—å FROM è¡¨å [WHERE æ¡ä»¶]) [åˆ«å] [WHERE æ¡ä»¶];

-- æŸ¥è¯¢è®¢å•è¡¨orderlistä¸­idå¤§äº4çš„è®¢å•ä¿¡æ¯å’Œæ‰€å±ç”¨æˆ·USERä¿¡æ¯
SELECT 
	* 
FROM 
	USER u,
	(SELECT * FROM orderlist WHERE id&gt;4) o 
WHERE 
	u.id=o.uid;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>ç›¸å…³æ€§åˆ†ç±»ï¼š</p><ul><li>ä¸ç›¸å…³å­æŸ¥è¯¢ï¼šå­æŸ¥è¯¢ä¸ä¾èµ–å¤–å±‚æŸ¥è¯¢çš„å€¼ï¼Œå¯ä»¥å•ç‹¬è¿è¡Œå‡ºç»“æœ</li><li>ç›¸å…³å­æŸ¥è¯¢ï¼šå­æŸ¥è¯¢çš„æ‰§è¡Œéœ€è¦ä¾èµ–å¤–å±‚æŸ¥è¯¢çš„å€¼</li></ul><hr><h4 id="æŸ¥è¯¢ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢ä¼˜åŒ–" aria-hidden="true">#</a> æŸ¥è¯¢ä¼˜åŒ–</h4><p>ä¸ç›¸å…³å­æŸ¥è¯¢çš„ç»“æœé›†ä¼šè¢«å†™å…¥ä¸€ä¸ªä¸´æ—¶è¡¨ï¼Œå¹¶ä¸”åœ¨å†™å…¥æ—¶<strong>å»é‡</strong>ï¼Œè¯¥è¿‡ç¨‹ç§°ä¸º<strong>ç‰©åŒ–</strong>ï¼Œå­˜å‚¨ç»“æœé›†çš„ä¸´æ—¶è¡¨ç§°ä¸ºç‰©åŒ–è¡¨</p><p>ç³»ç»Ÿå˜é‡ tmp_table_size æˆ–è€… max_heap_table_size ä¸ºè¡¨çš„æœ€å€¼</p><ul><li>å°äºç³»ç»Ÿå˜é‡æ—¶ï¼Œå†…å­˜ä¸­å¯ä»¥ä¿å­˜ï¼Œä¼šä¸ºå»ºç«‹<strong>åŸºäºå†…å­˜</strong>çš„ MEMORY å­˜å‚¨å¼•æ“çš„ä¸´æ—¶è¡¨ï¼Œå¹¶å»ºç«‹å“ˆå¸Œç´¢å¼•</li><li>å¤§äºä»»æ„ä¸€ä¸ªç³»ç»Ÿå˜é‡æ—¶ï¼Œç‰©åŒ–è¡¨ä¼šä½¿ç”¨<strong>åŸºäºç£ç›˜</strong>çš„ InnoDB å­˜å‚¨å¼•æ“æ¥ä¿å­˜ç»“æœé›†ä¸­çš„è®°å½•ï¼Œç´¢å¼•ç±»å‹ä¸º B+ æ ‘</li></ul><p>ç‰©åŒ–åï¼ŒåµŒå¥—æŸ¥è¯¢å°±ç›¸å½“äºå¤–å±‚æŸ¥è¯¢çš„è¡¨å’Œç‰©åŒ–è¡¨è¿›è¡Œå†…è¿æ¥æŸ¥è¯¢ï¼Œç„¶åç»è¿‡ä¼˜åŒ–å™¨é€‰æ‹©æˆæœ¬æœ€å°çš„è¡¨è¿æ¥é¡ºåºæ‰§è¡ŒæŸ¥è¯¢</p><p>å­æŸ¥è¯¢ç‰©åŒ–ä¼šäº§ç”Ÿå»ºç«‹ä¸´æ—¶è¡¨çš„æˆæœ¬ï¼Œä½†æ˜¯å°†å­æŸ¥è¯¢è½¬åŒ–ä¸ºè¿æ¥æŸ¥è¯¢å¯ä»¥å……åˆ†å‘æŒ¥ä¼˜åŒ–å™¨çš„ä½œç”¨ï¼Œæ‰€ä»¥å¼•å…¥ï¼šåŠè¿æ¥</p><ul><li>t1 å’Œ t2 è¡¨è¿›è¡ŒåŠè¿æ¥ï¼Œå¯¹äº t1 è¡¨ä¸­çš„æŸæ¡è®°å½•ï¼Œåªéœ€è¦å…³å¿ƒåœ¨ t2 è¡¨ä¸­æ˜¯å¦å­˜åœ¨ï¼Œè€Œä¸éœ€è¦å…³å¿ƒæœ‰å¤šå°‘æ¡è®°å½•ä¸ä¹‹åŒ¹é…ï¼Œæœ€ç»ˆç»“æœé›†åªä¿ç•™ t1 çš„è®°å½•</li><li>åŠè¿æ¥åªæ˜¯æ‰§è¡Œå­æŸ¥è¯¢çš„ä¸€ç§æ–¹å¼ï¼ŒMySQL å¹¶æ²¡æœ‰æä¾›é¢å‘ç”¨æˆ·çš„åŠè¿æ¥è¯­æ³•</li></ul><p>å‚è€ƒä¹¦ç±ï¼š<a href="https://book.douban.com/subject/35231266/" target="_blank" rel="noopener noreferrer">https://book.douban.com/subject/35231266/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="è”åˆæŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#è”åˆæŸ¥è¯¢" aria-hidden="true">#</a> è”åˆæŸ¥è¯¢</h4><p>UNION æ˜¯å–è¿™ä¸¤ä¸ªå­æŸ¥è¯¢ç»“æœçš„å¹¶é›†ï¼Œå¹¶è¿›è¡Œå»é‡ï¼ŒåŒæ—¶è¿›è¡Œé»˜è®¤è§„åˆ™çš„æ’åºï¼ˆunion æ˜¯è¡ŒåŠ èµ·æ¥ï¼Œjoin æ˜¯åˆ—åŠ èµ·æ¥ï¼‰</p><p>UNION ALL æ˜¯å¯¹ä¸¤ä¸ªç»“æœé›†è¿›è¡Œå¹¶é›†æ“ä½œä¸è¿›è¡Œå»é‡ï¼Œä¸è¿›è¡Œæ’åº</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>(select 1000 as f) union (select id from t1 order by id desc limit 2); #t1è¡¨ä¸­åŒ…å«id ä¸º 1-1000 çš„æ•°æ®
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¯­å¥çš„æ‰§è¡Œæµç¨‹ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªå†…å­˜ä¸´æ—¶è¡¨ï¼Œè¿™ä¸ªä¸´æ—¶è¡¨åªæœ‰ä¸€ä¸ªæ•´å‹å­—æ®µ fï¼Œå¹¶ä¸” f æ˜¯ä¸»é”®å­—æ®µ</li><li>æ‰§è¡Œç¬¬ä¸€ä¸ªå­æŸ¥è¯¢ï¼Œå¾—åˆ° 1000 è¿™ä¸ªå€¼ï¼Œå¹¶å­˜å…¥ä¸´æ—¶è¡¨ä¸­</li><li>æ‰§è¡Œç¬¬äºŒä¸ªå­æŸ¥è¯¢ï¼Œæ‹¿åˆ°ç¬¬ä¸€è¡Œ id=1000ï¼Œè¯•å›¾æ’å…¥ä¸´æ—¶è¡¨ä¸­ï¼Œä½†ç”±äº 1000 è¿™ä¸ªå€¼å·²ç»å­˜åœ¨äºä¸´æ—¶è¡¨äº†ï¼Œè¿åäº†å”¯ä¸€æ€§çº¦æŸï¼Œæ‰€ä»¥æ’å…¥å¤±è´¥ï¼Œç„¶åç»§ç»­æ‰§è¡Œ</li><li>å–åˆ°ç¬¬äºŒè¡Œ id=999ï¼Œæ’å…¥ä¸´æ—¶è¡¨æˆåŠŸ</li><li>ä»ä¸´æ—¶è¡¨ä¸­æŒ‰è¡Œå–å‡ºæ•°æ®ï¼Œè¿”å›ç»“æœå¹¶åˆ é™¤ä¸´æ—¶è¡¨ï¼Œç»“æœä¸­åŒ…å«ä¸¤è¡Œæ•°æ®åˆ†åˆ«æ˜¯ 1000 å’Œ 999</li></ul><hr><h3 id="æŸ¥è¯¢ç»ƒä¹ " tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢ç»ƒä¹ " aria-hidden="true">#</a> æŸ¥è¯¢ç»ƒä¹ </h3><p>æ•°æ®å‡†å¤‡ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºdb4æ•°æ®åº“
CREATE DATABASE db4;
-- ä½¿ç”¨db4æ•°æ®åº“
USE db4;

-- åˆ›å»ºuserè¡¨
CREATE TABLE USER(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- ç”¨æˆ·id
	NAME VARCHAR(20),					-- ç”¨æˆ·å§“å
	age INT                             -- ç”¨æˆ·å¹´é¾„
);

-- è®¢å•è¡¨
CREATE TABLE orderlist(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- è®¢å•id
	number VARCHAR(30),					-- è®¢å•ç¼–å·
	uid INT,   							-- å¤–é”®å­—æ®µ
	CONSTRAINT ou_fk1 FOREIGN KEY (uid) REFERENCES USER(id)
);

-- å•†å“åˆ†ç±»è¡¨
CREATE TABLE category(
	id INT PRIMARY KEY AUTO_INCREMENT,  -- å•†å“åˆ†ç±»id
	NAME VARCHAR(10)                    -- å•†å“åˆ†ç±»åç§°
);

-- å•†å“è¡¨
CREATE TABLE product(
	id INT PRIMARY KEY AUTO_INCREMENT,   -- å•†å“id
	NAME VARCHAR(30),                    -- å•†å“åç§°
	cid INT, -- å¤–é”®å­—æ®µ
	CONSTRAINT cp_fk1 FOREIGN KEY (cid) REFERENCES category(id)
);

-- ä¸­é—´è¡¨
CREATE TABLE us_pro(
	upid INT PRIMARY KEY AUTO_INCREMENT,  -- ä¸­é—´è¡¨id
	uid INT, 							  -- å¤–é”®å­—æ®µã€‚éœ€è¦å’Œç”¨æˆ·è¡¨çš„ä¸»é”®äº§ç”Ÿå…³è”
	pid INT,							  -- å¤–é”®å­—æ®µã€‚éœ€è¦å’Œå•†å“è¡¨çš„ä¸»é”®äº§ç”Ÿå…³è”
	CONSTRAINT up_fk1 FOREIGN KEY (uid) REFERENCES USER(id),
	CONSTRAINT up_fk2 FOREIGN KEY (pid) REFERENCES product(id)
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/å¤šè¡¨ç»ƒä¹ æ¶æ„è®¾è®¡.png" alt="å¤šè¡¨ç»ƒä¹ æ¶æ„è®¾è®¡" tabindex="0" loading="lazy"><figcaption>å¤šè¡¨ç»ƒä¹ æ¶æ„è®¾è®¡</figcaption></figure><p><strong>æ•°æ®æŸ¥è¯¢ï¼š</strong></p><ol><li><p>æŸ¥è¯¢ç”¨æˆ·çš„ç¼–å·ã€å§“åã€å¹´é¾„ã€è®¢å•ç¼–å·</p><p>æ•°æ®ï¼šç”¨æˆ·çš„ç¼–å·ã€å§“åã€å¹´é¾„åœ¨ user è¡¨ï¼Œè®¢å•ç¼–å·åœ¨ orderlist è¡¨</p><p>æ¡ä»¶ï¼š<a href="http://user.id" target="_blank" rel="noopener noreferrer">user.id<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> = orderlist.uid</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT
	u.*,
	o.number
FROM
	USER u,
	orderlist o
WHERE
	u.id = o.uid;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢æ‰€æœ‰çš„ç”¨æˆ·ï¼Œæ˜¾ç¤ºç”¨æˆ·çš„ç¼–å·ã€å§“åã€å¹´é¾„ã€è®¢å•ç¼–å·ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT
	u.*,
	o.number
FROM
	USER u
LEFT OUTER JOIN
	orderlist o
ON
	u.id = o.uid;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢ç”¨æˆ·å¹´é¾„å¤§äº 23 å²çš„ä¿¡æ¯ï¼Œæ˜¾ç¤ºç”¨æˆ·çš„ç¼–å·ã€å§“åã€å¹´é¾„ã€è®¢å•ç¼–å·</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT
	u.*,
	o.number
FROM
	USER u,
	orderlist o
WHERE
	u.id = o.uid
	AND
	u.age &gt; 23;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT
	u.*,
	o.number
FROM
	(SELECT * FROM USER WHERE age &gt; 23) u,-- åµŒå¥—æŸ¥è¯¢
	orderlist o
WHERE
	u.id = o.uid;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢å¼ ä¸‰å’Œæå››ç”¨æˆ·çš„ä¿¡æ¯ï¼Œæ˜¾ç¤ºç”¨æˆ·çš„ç¼–å·ã€å§“åã€å¹´é¾„ã€è®¢å•ç¼–å·ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT
	u.*,
	o.number
FROM
	USER u,
	orderlist o
WHERE
	u.id=o.uid
	AND
	u.name IN (&#39;å¼ ä¸‰&#39;,&#39;æå››&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢æ‰€æœ‰çš„ç”¨æˆ·å’Œè¯¥ç”¨æˆ·èƒ½æŸ¥çœ‹çš„æ‰€æœ‰çš„å•†å“ï¼Œæ˜¾ç¤ºç”¨æˆ·çš„ç¼–å·ã€å§“åã€å¹´é¾„ã€å•†å“åç§°</p><p>æ•°æ®ï¼šç”¨æˆ·çš„ç¼–å·ã€å§“åã€å¹´é¾„åœ¨ user è¡¨ï¼Œå•†å“åç§°åœ¨ product è¡¨ï¼Œä¸­é—´è¡¨ us_pro</p><p>æ¡ä»¶ï¼šus_pro.uid = <a href="http://user.id" target="_blank" rel="noopener noreferrer">user.id<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> AND us_pro.pid = <a href="http://product.id" target="_blank" rel="noopener noreferrer">product.id<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT
	u.id,
	u.name,
	u.age,
	p.name
FROM
	USER u,
	product p,
	us_pro up
WHERE
	up.uid = u.id
	AND
	up.pid=p.id;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢å¼ ä¸‰å’Œæå››è¿™ä¸¤ä¸ªç”¨æˆ·å¯ä»¥çœ‹åˆ°çš„å•†å“ï¼Œæ˜¾ç¤ºç”¨æˆ·çš„ç¼–å·ã€å§“åã€å¹´é¾„ã€å•†å“åç§°ã€‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT
	u.id,
	u.name,
	u.age,
	p.name
FROM
	USER u,
	product p,
	us_pro up
WHERE
	up.uid=u.id
	AND
	up.pid=p.id
	AND
	u.name IN (&#39;å¼ ä¸‰&#39;,&#39;æå››&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h2 id="é«˜çº§ç»“æ„" tabindex="-1"><a class="header-anchor" href="#é«˜çº§ç»“æ„" aria-hidden="true">#</a> é«˜çº§ç»“æ„</h2><h3 id="è§†å›¾" tabindex="-1"><a class="header-anchor" href="#è§†å›¾" aria-hidden="true">#</a> è§†å›¾</h3><h4 id="åŸºæœ¬ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h4><p>è§†å›¾æ¦‚å¿µï¼šè§†å›¾æ˜¯ä¸€ç§è™šæ‹Ÿå­˜åœ¨çš„æ•°æ®è¡¨ï¼Œè¿™ä¸ªè™šæ‹Ÿçš„è¡¨å¹¶ä¸åœ¨æ•°æ®åº“ä¸­å®é™…å­˜åœ¨</p><p>æœ¬è´¨ï¼šå°†ä¸€æ¡ SELECT æŸ¥è¯¢è¯­å¥çš„ç»“æœå°è£…åˆ°äº†ä¸€ä¸ªè™šæ‹Ÿè¡¨ä¸­ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºè§†å›¾çš„æ—¶å€™ï¼Œå·¥ä½œé‡å¿ƒè¦æ”¾åœ¨è¿™æ¡ SELECT æŸ¥è¯¢è¯­å¥ä¸Š</p><p>ä½œç”¨ï¼šå°†ä¸€äº›æ¯”è¾ƒå¤æ‚çš„æŸ¥è¯¢è¯­å¥çš„ç»“æœï¼Œå°è£…åˆ°ä¸€ä¸ªè™šæ‹Ÿè¡¨ä¸­ï¼Œå†æœ‰ç›¸åŒæŸ¥è¯¢éœ€æ±‚æ—¶ï¼Œç›´æ¥æŸ¥è¯¢è¯¥è™šæ‹Ÿè¡¨</p><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>ç®€å•ï¼šä½¿ç”¨è§†å›¾çš„ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒè¡¨çš„ç»“æ„ã€å…³è”æ¡ä»¶å’Œç­›é€‰æ¡ä»¶ï¼Œå› ä¸ºè™šæ‹Ÿè¡¨ä¸­å·²ç»æ˜¯è¿‡æ»¤å¥½çš„ç»“æœé›†</p></li><li><p>å®‰å…¨ï¼šä½¿ç”¨è§†å›¾çš„ç”¨æˆ·åªèƒ½è®¿é—®æŸ¥è¯¢çš„ç»“æœé›†ï¼Œå¯¹è¡¨çš„æƒé™ç®¡ç†å¹¶ä¸èƒ½é™åˆ¶åˆ°æŸä¸ªè¡ŒæŸä¸ªåˆ—</p></li><li><p>æ•°æ®ç‹¬ç«‹ï¼Œä¸€æ—¦è§†å›¾çš„ç»“æ„ç¡®å®šï¼Œå¯ä»¥å±è”½è¡¨ç»“æ„å˜åŒ–å¯¹ç”¨æˆ·çš„å½±å“ï¼Œæºè¡¨å¢åŠ åˆ—å¯¹è§†å›¾æ²¡æœ‰å½±å“ï¼›æºè¡¨ä¿®æ”¹åˆ—åï¼Œåˆ™å¯ä»¥é€šè¿‡ä¿®æ”¹è§†å›¾æ¥è§£å†³ï¼Œä¸ä¼šé€ æˆå¯¹è®¿é—®è€…çš„å½±å“</p></li></ul><hr><h4 id="è§†å›¾åˆ›å»º" tabindex="-1"><a class="header-anchor" href="#è§†å›¾åˆ›å»º" aria-hidden="true">#</a> è§†å›¾åˆ›å»º</h4><ul><li><p>åˆ›å»ºè§†å›¾</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE [OR REPLACE] 
VIEW è§†å›¾åç§° [(åˆ—ååˆ—è¡¨)] 
AS æŸ¥è¯¢è¯­å¥
[WITH [CASCADED | LOCAL] CHECK OPTION];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>WITH [CASCADED | LOCAL] CHECK OPTION</code> å†³å®šäº†æ˜¯å¦å…è®¸æ›´æ–°æ•°æ®ä½¿è®°å½•ä¸å†æ»¡è¶³è§†å›¾çš„æ¡ä»¶ï¼š</p><ul><li>LOCALï¼šåªè¦æ»¡è¶³æœ¬è§†å›¾çš„æ¡ä»¶å°±å¯ä»¥æ›´æ–°</li><li>CASCADEDï¼šå¿…é¡»æ»¡è¶³æ‰€æœ‰é’ˆå¯¹è¯¥è§†å›¾çš„æ‰€æœ‰è§†å›¾çš„æ¡ä»¶æ‰å¯ä»¥æ›´æ–°ï¼Œ é»˜è®¤å€¼</li></ul></li><li><p>ä¾‹å¦‚</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- æ•°æ®å‡†å¤‡ city
id	NAME	cid
1	æ·±åœ³	 	1
2	ä¸Šæµ·		1
3	çº½çº¦		2
4	è«æ–¯ç§‘	    3

-- æ•°æ®å‡†å¤‡ country
id	NAME
1	ä¸­å›½
2	ç¾å›½
3	ä¿„ç½—æ–¯

-- åˆ›å»ºcity_countryè§†å›¾ï¼Œä¿å­˜åŸå¸‚å’Œå›½å®¶çš„ä¿¡æ¯(ä½¿ç”¨æŒ‡å®šåˆ—å)
CREATE 
VIEW 
	city_country (city_id,city_name,country_name)
AS
    SELECT
        c1.id,
        c1.name,
        c2.name
    FROM
        city c1,
        country c2
    WHERE
        c1.cid=c2.id;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="è§†å›¾æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#è§†å›¾æŸ¥è¯¢" aria-hidden="true">#</a> è§†å›¾æŸ¥è¯¢</h4><ul><li><p>æŸ¥è¯¢æ‰€æœ‰æ•°æ®è¡¨ï¼Œè§†å›¾ä¹Ÿä¼šæŸ¥è¯¢å‡ºæ¥</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW TABLES;
SHOW TABLE STATUS [\G];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢è§†å›¾</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM è§†å›¾åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢æŸä¸ªè§†å›¾åˆ›å»º</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW CREATE VIEW è§†å›¾åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><hr><h4 id="è§†å›¾ä¿®æ”¹" tabindex="-1"><a class="header-anchor" href="#è§†å›¾ä¿®æ”¹" aria-hidden="true">#</a> è§†å›¾ä¿®æ”¹</h4><p>è§†å›¾è¡¨æ•°æ®ä¿®æ”¹ï¼Œä¼š<strong>è‡ªåŠ¨ä¿®æ”¹æºè¡¨ä¸­çš„æ•°æ®</strong>ï¼Œå› ä¸ºæ›´æ–°çš„æ˜¯è§†å›¾ä¸­çš„åŸºè¡¨ä¸­çš„æ•°æ®</p><ul><li><p>ä¿®æ”¹è§†å›¾è¡¨ä¸­çš„æ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>UPDATE è§†å›¾åç§° SET åˆ—å = å€¼ WHERE æ¡ä»¶;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹è§†å›¾çš„ç»“æ„</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER [ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]
VIEW è§†å›¾åç§° [(åˆ—ååˆ—è¡¨)] 
AS æŸ¥è¯¢è¯­å¥
[WITH [CASCADED | LOCAL] CHECK OPTION]

-- å°†è§†å›¾ä¸­çš„country_nameä¿®æ”¹ä¸ºname
ALTER 
VIEW 
	city_country (city_id,city_name,name) 
AS
    SELECT
        c1.id,
        c1.name,
        c2.name
    FROM
        city c1,
        country c2
    WHERE
        c1.cid=c2.id;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="è§†å›¾åˆ é™¤" tabindex="-1"><a class="header-anchor" href="#è§†å›¾åˆ é™¤" aria-hidden="true">#</a> è§†å›¾åˆ é™¤</h4><ul><li><p>åˆ é™¤è§†å›¾</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP VIEW è§†å›¾åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å¦‚æœå­˜åœ¨åˆ™åˆ é™¤</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP VIEW IF EXISTS è§†å›¾åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><hr><h3 id="å­˜å‚¨è¿‡ç¨‹" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨è¿‡ç¨‹" aria-hidden="true">#</a> å­˜å‚¨è¿‡ç¨‹</h3><h4 id="åŸºæœ¬ä»‹ç»-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-1" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h4><p>å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ï¼šå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°æ˜¯äº‹å…ˆç»è¿‡ç¼–è¯‘å¹¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ä¸€æ®µ SQL è¯­å¥çš„é›†åˆ</p><p>å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„å¥½å¤„ï¼š</p><ul><li>æé«˜ä»£ç çš„å¤ç”¨æ€§</li><li>å‡å°‘æ•°æ®åœ¨æ•°æ®åº“å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“ï¼Œæé«˜ä¼ è¾“æ•ˆç‡</li><li>å‡å°‘ä»£ç å±‚é¢çš„ä¸šåŠ¡å¤„ç†</li><li><strong>ä¸€æ¬¡ç¼–è¯‘æ°¸ä¹…æœ‰æ•ˆ</strong></li></ul><p>å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„åŒºåˆ«ï¼š</p><ul><li>å­˜å‚¨å‡½æ•°å¿…é¡»æœ‰è¿”å›å€¼</li><li>å­˜å‚¨è¿‡ç¨‹å¯ä»¥æ²¡æœ‰è¿”å›å€¼</li></ul><hr><h4 id="åŸºæœ¬æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ“ä½œ" aria-hidden="true">#</a> åŸºæœ¬æ“ä½œ</h4><p>DELIMITERï¼š</p><ul><li><p>DELIMITER å…³é”®å­—ç”¨æ¥å£°æ˜ sql è¯­å¥çš„åˆ†éš”ç¬¦ï¼Œå‘Šè¯‰ MySQL è¯¥æ®µå‘½ä»¤å·²ç»ç»“æŸ</p></li><li><p>MySQL è¯­å¥é»˜è®¤çš„åˆ†éš”ç¬¦æ˜¯åˆ†å·ï¼Œä½†æ˜¯æœ‰æ—¶éœ€è¦ä¸€æ¡åŠŸèƒ½ sql è¯­å¥ä¸­åŒ…å«åˆ†å·ï¼Œä½†æ˜¯å¹¶ä¸ä½œä¸ºç»“æŸæ ‡è¯†ï¼Œè¿™æ—¶ä½¿ç”¨ DELIMITER æ¥æŒ‡å®šåˆ†éš”ç¬¦ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER åˆ†éš”ç¬¦
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>å­˜å‚¨è¿‡ç¨‹çš„åˆ›å»ºè°ƒç”¨æŸ¥çœ‹å’Œåˆ é™¤ï¼š</p><ul><li><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- ä¿®æ”¹åˆ†éš”ç¬¦ä¸º$
DELIMITER $

-- æ ‡å‡†è¯­æ³•
CREATE PROCEDURE å­˜å‚¨è¿‡ç¨‹åç§°(å‚æ•°...)
BEGIN
	sqlè¯­å¥;
END$

-- ä¿®æ”¹åˆ†éš”ç¬¦ä¸ºåˆ†å·
DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CALL å­˜å‚¨è¿‡ç¨‹åç§°(å®é™…å‚æ•°);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM mysql.proc WHERE db=&#39;æ•°æ®åº“åç§°&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>åˆ é™¤å­˜å‚¨è¿‡ç¨‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP PROCEDURE [IF EXISTS] å­˜å‚¨è¿‡ç¨‹åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>ç»ƒä¹ ï¼š</p><ul><li><p>æ•°æ®å‡†å¤‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>id	NAME	age		gender	score
1	å¼ ä¸‰		23		ç”·		95
2	æå››		24		ç”·		98
3	ç‹äº”		25		å¥³		100
4	èµµå…­		26		å¥³		90
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ›å»º stu_group() å­˜å‚¨è¿‡ç¨‹ï¼Œå°è£…åˆ†ç»„æŸ¥è¯¢æ€»æˆç»©ï¼Œå¹¶æŒ‰ç…§æ€»æˆç»©å‡åºæ’åºçš„åŠŸèƒ½</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $

CREATE PROCEDURE stu_group()
BEGIN
	SELECT gender,SUM(score) getSum FROM student GROUP BY gender ORDER BY getSum ASC; 
END$

DELIMITER ;

-- è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
CALL stu_group();
-- åˆ é™¤å­˜å‚¨è¿‡ç¨‹
DROP PROCEDURE IF EXISTS stu_group;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="å­˜å‚¨è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨è¯­æ³•" aria-hidden="true">#</a> å­˜å‚¨è¯­æ³•</h4><h5 id="å˜é‡ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#å˜é‡ä½¿ç”¨" aria-hidden="true">#</a> å˜é‡ä½¿ç”¨</h5><p>å­˜å‚¨è¿‡ç¨‹æ˜¯å¯ä»¥è¿›è¡Œç¼–ç¨‹çš„ï¼Œæ„å‘³ç€å¯ä»¥ä½¿ç”¨å˜é‡ã€è¡¨è¾¾å¼ã€æ¡ä»¶æ§åˆ¶è¯­å¥ç­‰ï¼Œæ¥å®Œæˆæ¯”è¾ƒå¤æ‚çš„åŠŸèƒ½</p><ul><li><p>å®šä¹‰å˜é‡ï¼šDECLARE å®šä¹‰çš„æ˜¯å±€éƒ¨å˜é‡ï¼Œåªèƒ½ç”¨åœ¨ BEGIN END èŒƒå›´ä¹‹å†…</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DECLARE å˜é‡å æ•°æ®ç±»å‹ [DEFAULT é»˜è®¤å€¼];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å˜é‡çš„èµ‹å€¼</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET å˜é‡å = å˜é‡å€¼;
SELECT åˆ—å INTO å˜é‡å FROM è¡¨å [WHERE æ¡ä»¶];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ•°æ®å‡†å¤‡ï¼šè¡¨ student</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>id	NAME	age		gender	score
1	å¼ ä¸‰		23		ç”·		95
2	æå››		24		ç”·		98
3	ç‹äº”		25		å¥³		100
4	èµµå…­		26		å¥³		90
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å®šä¹‰ä¸¤ä¸ª int å˜é‡ï¼Œç”¨äºå­˜å‚¨ç”·å¥³åŒå­¦çš„æ€»åˆ†æ•°</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $
CREATE PROCEDURE pro_test3()
BEGIN
	-- å®šä¹‰ä¸¤ä¸ªå˜é‡
	DECLARE men,women INT;
	-- æŸ¥è¯¢ç”·åŒå­¦çš„æ€»åˆ†æ•°ï¼Œä¸ºmenèµ‹å€¼
	SELECT SUM(score) INTO men FROM student WHERE gender=&#39;ç”·&#39;;
	-- æŸ¥è¯¢å¥³åŒå­¦çš„æ€»åˆ†æ•°ï¼Œä¸ºwomenèµ‹å€¼
	SELECT SUM(score) INTO women FROM student WHERE gender=&#39;å¥³&#39;;
	-- ä½¿ç”¨å˜é‡
	SELECT men,women;
END$
DELIMITER ;
-- è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
CALL pro_test3();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h5 id="ifè¯­å¥" tabindex="-1"><a class="header-anchor" href="#ifè¯­å¥" aria-hidden="true">#</a> IFè¯­å¥</h5><ul><li><p>if è¯­å¥æ ‡å‡†è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>IF åˆ¤æ–­æ¡ä»¶1 THEN æ‰§è¡Œçš„sqlè¯­å¥1;
[ELSEIF åˆ¤æ–­æ¡ä»¶2 THEN æ‰§è¡Œçš„sqlè¯­å¥2;]
...
[ELSE æ‰§è¡Œçš„sqlè¯­å¥n;]
END IF;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ•°æ®å‡†å¤‡ï¼šè¡¨ student</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>id	NAME	age		gender	score
1	å¼ ä¸‰		23		ç”·		95
2	æå››		24		ç”·		98
3	ç‹äº”		25		å¥³		100
4	èµµå…­		26		å¥³		90
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ ¹æ®æ€»æˆç»©åˆ¤æ–­ï¼šå…¨ç­ 380 åˆ†åŠä»¥ä¸Šå­¦ä¹ ä¼˜ç§€ã€320 ~ 380 å­¦ä¹ è‰¯å¥½ã€320 ä»¥ä¸‹å­¦ä¹ ä¸€èˆ¬</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $
CREATE PROCEDURE pro_test4()
BEGIN
	DECLARE total INT;							-- å®šä¹‰æ€»åˆ†æ•°å˜é‡
	DECLARE description VARCHAR(10);			-- å®šä¹‰åˆ†æ•°æè¿°å˜é‡
	SELECT SUM(score) INTO total FROM student; 	-- ä¸ºæ€»åˆ†æ•°å˜é‡èµ‹å€¼
	-- åˆ¤æ–­æ€»åˆ†æ•°
	IF total &gt;= 380 THEN
		SET description = &#39;å­¦ä¹ ä¼˜ç§€&#39;;
	ELSEIF total &gt;=320 AND total &lt; 380 THEN
		SET description = &#39;å­¦ä¹ è‰¯å¥½&#39;;
	ELSE
		SET description = &#39;å­¦ä¹ ä¸€èˆ¬&#39;;
	END IF;
END$
DELIMITER ;
-- è°ƒç”¨pro_test4å­˜å‚¨è¿‡ç¨‹
CALL pro_test4();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h5 id="å‚æ•°ä¼ é€’" tabindex="-1"><a class="header-anchor" href="#å‚æ•°ä¼ é€’" aria-hidden="true">#</a> å‚æ•°ä¼ é€’</h5><ul><li><p>å‚æ•°ä¼ é€’çš„è¯­æ³•</p><p>INï¼šä»£è¡¨è¾“å…¥å‚æ•°ï¼Œéœ€è¦ç”±è°ƒç”¨è€…ä¼ é€’å®é™…æ•°æ®ï¼Œé»˜è®¤çš„<br> OUTï¼šä»£è¡¨è¾“å‡ºå‚æ•°ï¼Œè¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¿”å›å€¼<br> INOUTï¼šä»£è¡¨æ—¢å¯ä»¥ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè¾“å‡ºå‚æ•°</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $

-- æ ‡å‡†è¯­æ³•
CREATE PROCEDURE å­˜å‚¨è¿‡ç¨‹åç§°([IN|OUT|INOUT] å‚æ•°å æ•°æ®ç±»å‹)
BEGIN
	æ‰§è¡Œçš„sqlè¯­å¥;
END$

DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è¾“å…¥æ€»æˆç»©å˜é‡ï¼Œä»£è¡¨å­¦ç”Ÿæ€»æˆç»©ï¼Œè¾“å‡ºåˆ†æ•°æè¿°å˜é‡ï¼Œä»£è¡¨å­¦ç”Ÿæ€»æˆç»©çš„æè¿°</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $

CREATE PROCEDURE pro_test6(IN total INT, OUT description VARCHAR(10))
BEGIN
	-- åˆ¤æ–­æ€»åˆ†æ•°
	IF total &gt;= 380 THEN 
		SET description = &#39;å­¦ä¹ ä¼˜ç§€&#39;;
	ELSEIF total &gt;= 320 AND total &lt; 380 THEN 
		SET description = &#39;å­¦ä¹ ä¸é”™&#39;;
	ELSE 
		SET description = &#39;å­¦ä¹ ä¸€èˆ¬&#39;;
	END IF;
END$

DELIMITER ;
-- è°ƒç”¨pro_test6å­˜å‚¨è¿‡ç¨‹
CALL pro_test6(310,@description);
CALL pro_test6((SELECT SUM(score) FROM student), @description);
-- æŸ¥è¯¢æ€»æˆç»©æè¿°
SELECT @description;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹å‚æ•°æ–¹æ³•</p><ul><li>@å˜é‡å : <strong>ç”¨æˆ·ä¼šè¯å˜é‡</strong>ï¼Œä»£è¡¨æ•´ä¸ªä¼šè¯è¿‡ç¨‹ä»–éƒ½æ˜¯æœ‰ä½œç”¨çš„ï¼Œç±»ä¼¼äºå…¨å±€å˜é‡</li><li>@@å˜é‡å : <strong>ç³»ç»Ÿå˜é‡</strong></li></ul></li></ul><hr><h5 id="case" tabindex="-1"><a class="header-anchor" href="#case" aria-hidden="true">#</a> CASE</h5><ul><li><p>æ ‡å‡†è¯­æ³• 1</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CASE è¡¨è¾¾å¼
    WHEN å€¼1 THEN æ‰§è¡Œsqlè¯­å¥1;
    [WHEN å€¼2 THEN æ‰§è¡Œsqlè¯­å¥2;]
    ...
    [ELSE æ‰§è¡Œsqlè¯­å¥n;]
END CASE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ ‡å‡†è¯­æ³• 2</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>sCASE
    WHEN åˆ¤æ–­æ¡ä»¶1 THEN æ‰§è¡Œsqlè¯­å¥1;
    [WHEN åˆ¤æ–­æ¡ä»¶2 THEN æ‰§è¡Œsqlè¯­å¥2;]
    ...
    [ELSE æ‰§è¡Œsqlè¯­å¥n;]
END CASE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ¼”ç¤º</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $
CREATE PROCEDURE pro_test7(IN total INT)
BEGIN
	-- å®šä¹‰å˜é‡
	DECLARE description VARCHAR(10);
	-- ä½¿ç”¨caseåˆ¤æ–­
	CASE
	WHEN total &gt;= 380 THEN
		SET description = &#39;å­¦ä¹ ä¼˜ç§€&#39;;
	WHEN total &gt;= 320 AND total &lt; 380 THEN
		SET description = &#39;å­¦ä¹ ä¸é”™&#39;;
	ELSE 
		SET description = &#39;å­¦ä¹ ä¸€èˆ¬&#39;;
	END CASE;
	
	-- æŸ¥è¯¢åˆ†æ•°æè¿°ä¿¡æ¯
	SELECT description;
END$
DELIMITER ;
-- è°ƒç”¨pro_test7å­˜å‚¨è¿‡ç¨‹
CALL pro_test7(390);
CALL pro_test7((SELECT SUM(score) FROM student));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h5 id="while" tabindex="-1"><a class="header-anchor" href="#while" aria-hidden="true">#</a> WHILE</h5><ul><li><p>while å¾ªç¯è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>WHILE æ¡ä»¶åˆ¤æ–­è¯­å¥ DO
	å¾ªç¯ä½“è¯­å¥;
	æ¡ä»¶æ§åˆ¶è¯­å¥;
END WHILE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è®¡ç®— 1~100 ä¹‹é—´çš„å¶æ•°å’Œ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $
CREATE PROCEDURE pro_test6()
BEGIN
	-- å®šä¹‰æ±‚å’Œå˜é‡
	DECLARE result INT DEFAULT 0;
	-- å®šä¹‰åˆå§‹åŒ–å˜é‡
	DECLARE num INT DEFAULT 1;
	-- whileå¾ªç¯
	WHILE num &lt;= 100 DO
		IF num % 2 = 0 THEN
			SET result = result + num;
		END IF;
		SET num = num + 1;
	END WHILE;
	-- æŸ¥è¯¢æ±‚å’Œç»“æœ
	SELECT result;
END$
DELIMITER ;

-- è°ƒç”¨pro_test6å­˜å‚¨è¿‡ç¨‹
CALL pro_test6();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h5 id="repeat" tabindex="-1"><a class="header-anchor" href="#repeat" aria-hidden="true">#</a> REPEAT</h5><ul><li><p>repeat å¾ªç¯æ ‡å‡†è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>åˆå§‹åŒ–è¯­å¥;
REPEAT
	å¾ªç¯ä½“è¯­å¥;
	æ¡ä»¶æ§åˆ¶è¯­å¥;
	UNTIL æ¡ä»¶åˆ¤æ–­è¯­å¥
END REPEAT;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è®¡ç®— 1~10 ä¹‹é—´çš„å’Œ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $
CREATE PROCEDURE pro_test9()
BEGIN
	-- å®šä¹‰æ±‚å’Œå˜é‡
	DECLARE result INT DEFAULT 0;
	-- å®šä¹‰åˆå§‹åŒ–å˜é‡
	DECLARE num INT DEFAULT 1;
	-- repeatå¾ªç¯
	REPEAT
		-- ç´¯åŠ 
		SET result = result + num;
		-- è®©num+1
		SET num = num + 1;
		-- åœæ­¢å¾ªç¯
		UNTIL num &gt; 10
	END REPEAT;
	-- æŸ¥è¯¢æ±‚å’Œç»“æœ
	SELECT result;
END$

DELIMITER ;
-- è°ƒç”¨pro_test9å­˜å‚¨è¿‡ç¨‹
CALL pro_test9();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h5 id="loop" tabindex="-1"><a class="header-anchor" href="#loop" aria-hidden="true">#</a> LOOP</h5><p>LOOP å®ç°ç®€å•çš„å¾ªç¯ï¼Œé€€å‡ºå¾ªç¯çš„æ¡ä»¶éœ€è¦ä½¿ç”¨å…¶ä»–çš„è¯­å¥å®šä¹‰ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨ LEAVE è¯­å¥å®ç°ï¼Œå¦‚æœä¸åŠ é€€å‡ºå¾ªç¯çš„è¯­å¥ï¼Œé‚£ä¹ˆå°±å˜æˆäº†æ­»å¾ªç¯</p><ul><li><p>loop å¾ªç¯æ ‡å‡†è¯­æ³•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>[å¾ªç¯åç§°:] LOOP
	æ¡ä»¶åˆ¤æ–­è¯­å¥
		[LEAVE å¾ªç¯åç§°;]
	å¾ªç¯ä½“è¯­å¥;
	æ¡ä»¶æ§åˆ¶è¯­å¥;
END LOOP å¾ªç¯åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è®¡ç®— 1~10 ä¹‹é—´çš„å’Œ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $
CREATE PROCEDURE pro_test10()
BEGIN
	-- å®šä¹‰æ±‚å’Œå˜é‡
	DECLARE result INT DEFAULT 0;
	-- å®šä¹‰åˆå§‹åŒ–å˜é‡
	DECLARE num INT DEFAULT 1;
	-- loopå¾ªç¯
	l:LOOP
		-- æ¡ä»¶æˆç«‹ï¼Œåœæ­¢å¾ªç¯
		IF num &gt; 10 THEN
			LEAVE l;
		END IF;
		-- ç´¯åŠ 
		SET result = result + num;
		-- è®©num+1
		SET num = num + 1;
	END LOOP l;
	-- æŸ¥è¯¢æ±‚å’Œç»“æœ
	SELECT result;
END$
DELIMITER ;
-- è°ƒç”¨pro_test10å­˜å‚¨è¿‡ç¨‹
CALL pro_test10();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h5 id="æ¸¸æ ‡" tabindex="-1"><a class="header-anchor" href="#æ¸¸æ ‡" aria-hidden="true">#</a> æ¸¸æ ‡</h5><p>æ¸¸æ ‡æ˜¯ç”¨æ¥å­˜å‚¨æŸ¥è¯¢ç»“æœé›†çš„æ•°æ®ç±»å‹ï¼Œåœ¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨å…‰æ ‡å¯¹ç»“æœé›†è¿›è¡Œå¾ªç¯çš„å¤„ç†</p><ul><li>æ¸¸æ ‡å¯ä»¥éå†è¿”å›çš„å¤šè¡Œç»“æœï¼Œæ¯æ¬¡æ‹¿åˆ°ä¸€æ•´è¡Œæ•°æ®</li><li>ç®€å•æ¥è¯´æ¸¸æ ‡å°±ç±»ä¼¼äºé›†åˆçš„è¿­ä»£å™¨éå†</li><li>MySQL ä¸­çš„æ¸¸æ ‡åªèƒ½ç”¨åœ¨å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ä¸­</li></ul><p>æ¸¸æ ‡çš„è¯­æ³•</p><ul><li><p>åˆ›å»ºæ¸¸æ ‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DECLARE æ¸¸æ ‡åç§° CURSOR FOR æŸ¥è¯¢sqlè¯­å¥;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ‰“å¼€æ¸¸æ ‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>OPEN æ¸¸æ ‡åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä½¿ç”¨æ¸¸æ ‡è·å–æ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>FETCH æ¸¸æ ‡åç§° INTO å˜é‡å1,å˜é‡å2,...;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å…³é—­æ¸¸æ ‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CLOSE æ¸¸æ ‡åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Mysql é€šè¿‡ä¸€ä¸ª Error handler å£°æ˜æ¥åˆ¤æ–­æŒ‡é’ˆæ˜¯å¦åˆ°å°¾éƒ¨ï¼Œå¹¶ä¸”å¿…é¡»å’Œåˆ›å»ºæ¸¸æ ‡çš„ SQL è¯­å¥å£°æ˜åœ¨ä¸€èµ·ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DECLARE EXIT HANDLER FOR NOT FOUND (do some actionï¼Œä¸€èˆ¬æ˜¯è®¾ç½®æ ‡å¿—å˜é‡)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>æ¸¸æ ‡çš„åŸºæœ¬ä½¿ç”¨</p><ul><li><p>æ•°æ®å‡†å¤‡ï¼šè¡¨ student</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>id	NAME	age		gender	score
1	å¼ ä¸‰		23		ç”·		95
2	æå››		24		ç”·		98
3	ç‹äº”		25		å¥³		100
4	èµµå…­		26		å¥³		90
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ›å»º stu_score è¡¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE stu_score(
	id INT PRIMARY KEY AUTO_INCREMENT,
	score INT
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å°†studentè¡¨ä¸­æ‰€æœ‰çš„æˆç»©ä¿å­˜åˆ°stu_scoreè¡¨ä¸­</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $

CREATE PROCEDURE pro_test12()
BEGIN
	-- å®šä¹‰æˆç»©å˜é‡
	DECLARE s_score INT;
	-- å®šä¹‰æ ‡è®°å˜é‡
	DECLARE flag INT DEFAULT 0;
	
	-- åˆ›å»ºæ¸¸æ ‡ï¼ŒæŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿæˆç»©æ•°æ®
	DECLARE stu_result CURSOR FOR SELECT score FROM student;
	-- æ¸¸æ ‡ç»“æŸåï¼Œå°†æ ‡è®°å˜é‡æ”¹ä¸º1  è¿™ä¸¤ä¸ªå¿…é¡»å£°æ˜åœ¨ä¸€èµ·
	DECLARE EXIT HANDLER FOR NOT FOUND SET flag = 1;
	
	-- å¼€å¯æ¸¸æ ‡
	OPEN stu_result;
	-- å¾ªç¯ä½¿ç”¨æ¸¸æ ‡
	REPEAT
		-- ä½¿ç”¨æ¸¸æ ‡ï¼Œéå†ç»“æœ,æ‹¿åˆ°æ•°æ®
		FETCH stu_result INTO s_score;
		-- å°†æ•°æ®ä¿å­˜åˆ°stu_scoreè¡¨ä¸­
		INSERT INTO stu_score VALUES (NULL,s_score);
	UNTIL flag=1
	END REPEAT;
	-- å…³é—­æ¸¸æ ‡
	CLOSE stu_result;
END$

DELIMITER ;

-- è°ƒç”¨pro_test12å­˜å‚¨è¿‡ç¨‹
CALL pro_test12();
-- æŸ¥è¯¢stu_scoreè¡¨
SELECT * FROM stu_score;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="å­˜å‚¨å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨å‡½æ•°" aria-hidden="true">#</a> å­˜å‚¨å‡½æ•°</h4><p>å­˜å‚¨å‡½æ•°å’Œå­˜å‚¨è¿‡ç¨‹æ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œå­˜å‚¨å‡½æ•°å¯ä»¥åšçš„äº‹æƒ…ï¼Œå­˜å‚¨è¿‡ç¨‹ä¹Ÿå¯ä»¥åšåˆ°</p><p>å­˜å‚¨å‡½æ•°æœ‰è¿”å›å€¼ï¼Œå­˜å‚¨è¿‡ç¨‹æ²¡æœ‰è¿”å›å€¼ï¼ˆå‚æ•°çš„ out å…¶å®ä¹Ÿç›¸å½“äºæ˜¯è¿”å›æ•°æ®äº†ï¼‰</p><ul><li><p>åˆ›å»ºå­˜å‚¨å‡½æ•°</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $
-- æ ‡å‡†è¯­æ³•
CREATE FUNCTION å‡½æ•°åç§°(å‚æ•° æ•°æ®ç±»å‹)
RETURNS è¿”å›å€¼ç±»å‹
BEGIN
	æ‰§è¡Œçš„sqlè¯­å¥;
	RETURN ç»“æœ;
END$

DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è°ƒç”¨å­˜å‚¨å‡½æ•°ï¼Œå› ä¸ºæœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥ä½¿ç”¨ SELECT è°ƒç”¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT å‡½æ•°åç§°(å®é™…å‚æ•°);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>åˆ é™¤å­˜å‚¨å‡½æ•°</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP FUNCTION å‡½æ•°åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å®šä¹‰å­˜å‚¨å‡½æ•°ï¼Œè·å–å­¦ç”Ÿè¡¨ä¸­æˆç»©å¤§äº95åˆ†çš„å­¦ç”Ÿæ•°é‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $
CREATE FUNCTION fun_test()
RETURN INT
BEGIN
	-- å®šä¹‰ç»Ÿè®¡å˜é‡
	DECLARE result INT;
	-- æŸ¥è¯¢æˆç»©å¤§äº95åˆ†çš„å­¦ç”Ÿæ•°é‡ï¼Œç»™ç»Ÿè®¡å˜é‡èµ‹å€¼
	SELECT COUNT(score) INTO result FROM student WHERE score &gt; 95;
	-- è¿”å›ç»Ÿè®¡ç»“æœ
	SELECT result;
END
DELIMITER ;
-- è°ƒç”¨fun_testå­˜å‚¨å‡½æ•°
SELECT fun_test();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h3 id="è§¦å‘å™¨" tabindex="-1"><a class="header-anchor" href="#è§¦å‘å™¨" aria-hidden="true">#</a> è§¦å‘å™¨</h3><h4 id="åŸºæœ¬ä»‹ç»-2" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-2" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h4><p>è§¦å‘å™¨æ˜¯ä¸è¡¨æœ‰å…³çš„æ•°æ®åº“å¯¹è±¡ï¼Œåœ¨ insert/update/delete ä¹‹å‰æˆ–ä¹‹åè§¦å‘å¹¶æ‰§è¡Œè§¦å‘å™¨ä¸­å®šä¹‰çš„ SQL è¯­å¥</p><ul><li>è§¦å‘å™¨çš„è¿™ç§ç‰¹æ€§å¯ä»¥ååŠ©åº”ç”¨åœ¨æ•°æ®åº“ç«¯ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§ ã€æ—¥å¿—è®°å½• ã€æ•°æ®æ ¡éªŒç­‰æ“ä½œ</li></ul><ul><li>ä½¿ç”¨åˆ«å NEW å’Œ OLD æ¥å¼•ç”¨è§¦å‘å™¨ä¸­å‘ç”Ÿå˜åŒ–çš„è®°å½•å†…å®¹ï¼Œè¿™ä¸å…¶ä»–çš„æ•°æ®åº“æ˜¯ç›¸ä¼¼çš„</li><li>ç°åœ¨è§¦å‘å™¨è¿˜åªæ”¯æŒè¡Œçº§è§¦å‘ï¼Œä¸æ”¯æŒè¯­å¥çº§è§¦å‘</li></ul><table><thead><tr><th>è§¦å‘å™¨ç±»å‹</th><th>OLDçš„å«ä¹‰</th><th>NEWçš„å«ä¹‰</th></tr></thead><tbody><tr><td>INSERT å‹è§¦å‘å™¨</td><td>æ—  (å› ä¸ºæ’å…¥å‰çŠ¶æ€æ— æ•°æ®)</td><td>NEW è¡¨ç¤ºå°†è¦æˆ–è€…å·²ç»æ–°å¢çš„æ•°æ®</td></tr><tr><td>UPDATE å‹è§¦å‘å™¨</td><td>OLD è¡¨ç¤ºä¿®æ”¹ä¹‹å‰çš„æ•°æ®</td><td>NEW è¡¨ç¤ºå°†è¦æˆ–å·²ç»ä¿®æ”¹åçš„æ•°æ®</td></tr><tr><td>DELETE å‹è§¦å‘å™¨</td><td>OLD è¡¨ç¤ºå°†è¦æˆ–è€…å·²ç»åˆ é™¤çš„æ•°æ®</td><td>æ—  (å› ä¸ºåˆ é™¤åçŠ¶æ€æ— æ•°æ®)</td></tr></tbody></table><hr><h4 id="åŸºæœ¬æ“ä½œ-1" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ“ä½œ-1" aria-hidden="true">#</a> åŸºæœ¬æ“ä½œ</h4><ul><li><p>åˆ›å»ºè§¦å‘å™¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $

CREATE TRIGGER è§¦å‘å™¨åç§°
BEFORE|AFTER  INSERT|UPDATE|DELETE
ON è¡¨å
[FOR EACH ROW]  -- è¡Œçº§è§¦å‘å™¨
BEGIN
	è§¦å‘å™¨è¦æ‰§è¡Œçš„åŠŸèƒ½;
END$

DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹è§¦å‘å™¨çš„çŠ¶æ€ã€è¯­æ³•ç­‰ä¿¡æ¯</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW TRIGGERS;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>åˆ é™¤è§¦å‘å™¨ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š schema_nameï¼Œé»˜è®¤ä¸ºå½“å‰æ•°æ®åº“</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP TRIGGER [schema_name.]trigger_name;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><hr><h4 id="è§¦å‘æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#è§¦å‘æ¼”ç¤º" aria-hidden="true">#</a> è§¦å‘æ¼”ç¤º</h4><p>é€šè¿‡è§¦å‘å™¨è®°å½•è´¦æˆ·è¡¨çš„æ•°æ®å˜æ›´æ—¥å¿—ã€‚åŒ…å«ï¼šå¢åŠ ã€ä¿®æ”¹ã€åˆ é™¤</p><ul><li><p>æ•°æ®å‡†å¤‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºdb9æ•°æ®åº“
CREATE DATABASE db9;
-- ä½¿ç”¨db9æ•°æ®åº“
USE db9;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºè´¦æˆ·è¡¨account
CREATE TABLE account(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- è´¦æˆ·id
	NAME VARCHAR(20),					-- å§“å
	money DOUBLE						-- ä½™é¢
);
-- æ·»åŠ æ•°æ®
INSERT INTO account VALUES (NULL,&#39;å¼ ä¸‰&#39;,1000),(NULL,&#39;æå››&#39;,2000);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºæ—¥å¿—è¡¨account_log
CREATE TABLE account_log(
	id INT PRIMARY KEY AUTO_INCREMENT,	-- æ—¥å¿—id
	operation VARCHAR(20),				-- æ“ä½œç±»å‹ (insert update delete)
	operation_time DATETIME,			-- æ“ä½œæ—¶é—´
	operation_id INT,					-- æ“ä½œè¡¨çš„id
	operation_params VARCHAR(200)       -- æ“ä½œå‚æ•°
);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ›å»º INSERT å‹è§¦å‘å™¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $

CREATE TRIGGER account_insert
AFTER INSERT
ON account
FOR EACH ROW
BEGIN
	INSERT INTO account_log VALUES (NULL,&#39;INSERT&#39;,NOW(),new.id,CONCAT(&#39;æ’å…¥å{id=&#39;,new.id,&#39;,name=&#39;,new.name,&#39;,money=&#39;,new.money,&#39;}&#39;));
END$

DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- å‘accountè¡¨æ·»åŠ è®°å½•
INSERT INTO account VALUES (NULL,&#39;ç‹äº”&#39;,3000);

-- æŸ¥è¯¢æ—¥å¿—è¡¨
SELECT * FROM account_log;
/*
id	operation	operation_time		operation_id	operation_params
1	INSERT	   	2021-01-26 19:51:11		3	     æ’å…¥å{id=3,name=ç‹äº”money=2000}
*/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ›å»º UPDATE å‹è§¦å‘å™¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $

CREATE TRIGGER account_update
AFTER UPDATE
ON account
FOR EACH ROW
BEGIN
	INSERT INTO account_log VALUES (NULL,&#39;UPDATE&#39;,NOW(),new.id,CONCAT(&#39;ä¿®æ”¹å‰{id=&#39;,old.id,&#39;,name=&#39;,old.name,&#39;,money=&#39;,old.money,&#39;}&#39;,&#39;ä¿®æ”¹å{id=&#39;,new.id,&#39;,name=&#39;,new.name,&#39;,money=&#39;,new.money,&#39;}&#39;));
END$

DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- ä¿®æ”¹accountè¡¨
UPDATE account SET money=3500 WHERE id=3;

-- æŸ¥è¯¢æ—¥å¿—è¡¨
SELECT * FROM account_log;
/*
id	operation	operation_time		operation_id	  operation_params
2	UPDATE	   	2021-01-26 19:58:54		2		 æ›´æ–°å‰{id=2,name=æå››money=1000}
												 æ›´æ–°å{id=2,name=æå››money=200}
*/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ›å»º DELETE å‹è§¦å‘å™¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DELIMITER $

CREATE TRIGGER account_delete
AFTER DELETE
ON account
FOR EACH ROW
BEGIN
	INSERT INTO account_log VALUES (NULL,&#39;DELETE&#39;,NOW(),old.id,CONCAT(&#39;åˆ é™¤å‰{id=&#39;,old.id,&#39;,name=&#39;,old.name,&#39;,money=&#39;,old.money,&#39;}&#39;));
END$

DELIMITER ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ é™¤accountè¡¨æ•°æ®
DELETE FROM account WHERE id=3;

-- æŸ¥è¯¢æ—¥å¿—è¡¨
SELECT * FROM account_log;
/*
id	operation	operation_time		operation_id	operation_params
3	DELETE		2021-01-26 20:02:48		3	    åˆ é™¤å‰{id=3,name=ç‹äº”money=2000}
*/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h2 id="å­˜å‚¨å¼•æ“" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨å¼•æ“" aria-hidden="true">#</a> å­˜å‚¨å¼•æ“</h2><h3 id="åŸºæœ¬ä»‹ç»-3" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-3" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>å¯¹æ¯”å…¶ä»–æ•°æ®åº“ï¼ŒMySQL çš„æ¶æ„å¯ä»¥åœ¨ä¸åŒåœºæ™¯åº”ç”¨å¹¶å‘æŒ¥è‰¯å¥½ä½œç”¨ï¼Œä¸»è¦ä½“ç°åœ¨å­˜å‚¨å¼•æ“ï¼Œæ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„å°†æŸ¥è¯¢å¤„ç†å’Œå…¶ä»–çš„ç³»ç»Ÿä»»åŠ¡ä»¥åŠæ•°æ®çš„å­˜å‚¨æå–åˆ†ç¦»ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒçš„å­˜å‚¨éœ€æ±‚å¯ä»¥é€‰æ‹©æœ€ä¼˜çš„å­˜å‚¨å¼•æ“</p><p>å­˜å‚¨å¼•æ“çš„ä»‹ç»ï¼š</p><ul><li>MySQL æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„æœºåˆ¶å­˜å–è¡¨æ–‡ä»¶ , æœºåˆ¶çš„å·®åˆ«åœ¨äºä¸åŒçš„å­˜å‚¨æ–¹å¼ã€ç´¢å¼•æŠ€å·§ã€é”å®šæ°´å¹³ç­‰ä¸åŒçš„åŠŸèƒ½å’Œèƒ½åŠ›ï¼Œåœ¨ MySQL ä¸­ï¼Œå°†è¿™äº›ä¸åŒçš„æŠ€æœ¯åŠé…å¥—çš„åŠŸèƒ½ç§°ä¸ºå­˜å‚¨å¼•æ“</li><li>Oracleã€SqlServer ç­‰æ•°æ®åº“åªæœ‰ä¸€ç§å­˜å‚¨å¼•æ“ï¼ŒMySQL <strong>æä¾›äº†æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„</strong>ï¼Œæ‰€ä»¥ MySQL å­˜åœ¨å¤šç§å­˜å‚¨å¼•æ“ , å°±ä¼šè®©æ•°æ®åº“é‡‡å–äº†ä¸åŒçš„å¤„ç†æ•°æ®çš„æ–¹å¼å’Œæ‰©å±•åŠŸèƒ½</li><li>åœ¨å…³ç³»å‹æ•°æ®åº“ä¸­æ•°æ®çš„å­˜å‚¨æ˜¯ä»¥è¡¨çš„å½¢å¼å­˜è¿›è¡Œï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“ä¹Ÿç§°ä¸ºè¡¨ç±»å‹ï¼ˆå­˜å‚¨å’Œæ“ä½œæ­¤è¡¨çš„ç±»å‹ï¼‰</li><li>é€šè¿‡é€‰æ‹©ä¸åŒçš„å¼•æ“ï¼Œèƒ½å¤Ÿè·å–æœ€ä½³çš„æ–¹æ¡ˆ, ä¹Ÿèƒ½å¤Ÿè·å¾—é¢å¤–çš„é€Ÿåº¦æˆ–è€…åŠŸèƒ½ï¼Œæé«˜ç¨‹åºçš„æ•´ä½“æ•ˆæœã€‚</li></ul><p>MySQL æ”¯æŒçš„å­˜å‚¨å¼•æ“ï¼š</p><ul><li>MySQL æ”¯æŒçš„å¼•æ“åŒ…æ‹¬ï¼šInnoDBã€MyISAMã€MEMORYã€Archiveã€Federateã€CSVã€BLACKHOLE ç­‰</li><li>MySQL5.5 ä¹‹å‰çš„é»˜è®¤å­˜å‚¨å¼•æ“æ˜¯ MyISAMï¼Œ5.5 ä¹‹åå°±æ”¹ä¸ºäº† InnoDB</li></ul><hr><h3 id="å¼•æ“å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#å¼•æ“å¯¹æ¯”" aria-hidden="true">#</a> å¼•æ“å¯¹æ¯”</h3><p>MyISAM å­˜å‚¨å¼•æ“ï¼š</p><ul><li>ç‰¹ç‚¹ï¼šä¸æ”¯æŒäº‹åŠ¡å’Œå¤–é”®ï¼Œè¯»å–é€Ÿåº¦å¿«ï¼ŒèŠ‚çº¦èµ„æº</li><li>åº”ç”¨åœºæ™¯ï¼š<strong>é€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯</strong>ï¼Œå¯¹äº‹åŠ¡çš„å®Œæ•´æ€§è¦æ±‚ä¸é«˜ï¼Œæ¯”å¦‚ä¸€äº›æ•°ä»“ã€ç¦»çº¿æ•°æ®ã€æ”¯ä»˜å®çš„å¹´åº¦æ€»ç»“ä¹‹ç±»çš„åœºæ™¯ï¼Œä¸šåŠ¡è¿›è¡Œåªè¯»æ“ä½œï¼ŒæŸ¥è¯¢èµ·æ¥ä¼šæ›´å¿«</li><li>å­˜å‚¨æ–¹å¼ï¼š <ul><li>æ¯ä¸ª MyISAM åœ¨ç£ç›˜ä¸Šå­˜å‚¨æˆ 3 ä¸ªæ–‡ä»¶ï¼Œå…¶æ–‡ä»¶åéƒ½å’Œè¡¨åç›¸åŒï¼Œæ‹“å±•åä¸åŒ</li><li>è¡¨çš„å®šä¹‰ä¿å­˜åœ¨ .frm æ–‡ä»¶ï¼Œè¡¨æ•°æ®ä¿å­˜åœ¨ .MYD (MYData) æ–‡ä»¶ä¸­ï¼Œç´¢å¼•ä¿å­˜åœ¨ .MYI (MYIndex) æ–‡ä»¶ä¸­</li></ul></li></ul><p>InnoDB å­˜å‚¨å¼•æ“ï¼š(MySQL5.5 ç‰ˆæœ¬åé»˜è®¤çš„å­˜å‚¨å¼•æ“)</p><ul><li>ç‰¹ç‚¹ï¼š<strong>æ”¯æŒäº‹åŠ¡</strong>å’Œå¤–é”®æ“ä½œï¼Œæ”¯æŒå¹¶å‘æ§åˆ¶ã€‚å¯¹æ¯” MyISAM çš„å­˜å‚¨å¼•æ“ï¼ŒInnoDB å†™çš„å¤„ç†æ•ˆç‡å·®ä¸€äº›ï¼Œå¹¶ä¸”ä¼šå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ä»¥ä¿ç•™æ•°æ®å’Œç´¢å¼•</li><li>åº”ç”¨åœºæ™¯ï¼šå¯¹äº‹åŠ¡çš„å®Œæ•´æ€§æœ‰æ¯”è¾ƒé«˜çš„è¦æ±‚ï¼Œåœ¨å¹¶å‘æ¡ä»¶ä¸‹è¦æ±‚æ•°æ®çš„ä¸€è‡´æ€§ï¼Œè¯»å†™é¢‘ç¹çš„æ“ä½œ</li><li>å­˜å‚¨æ–¹å¼ï¼š <ul><li>ä½¿ç”¨å…±äº«è¡¨ç©ºé—´å­˜å‚¨ï¼Œ è¿™ç§æ–¹å¼åˆ›å»ºçš„è¡¨çš„è¡¨ç»“æ„ä¿å­˜åœ¨ .frm æ–‡ä»¶ä¸­ï¼Œ æ•°æ®å’Œç´¢å¼•ä¿å­˜åœ¨ innodb_data_home_dir å’Œ innodb_data_file_path å®šä¹‰çš„è¡¨ç©ºé—´ä¸­ï¼Œå¯ä»¥æ˜¯å¤šä¸ªæ–‡ä»¶</li><li>ä½¿ç”¨å¤šè¡¨ç©ºé—´å­˜å‚¨ï¼Œåˆ›å»ºçš„è¡¨çš„è¡¨ç»“æ„å­˜åœ¨ .frm æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªè¡¨çš„æ•°æ®å’Œç´¢å¼•å•ç‹¬ä¿å­˜åœ¨ .ibd ä¸­</li></ul></li></ul><p>MEMORY å­˜å‚¨å¼•æ“ï¼š</p><ul><li>ç‰¹ç‚¹ï¼šæ¯ä¸ª MEMORY è¡¨å®é™…å¯¹åº”ä¸€ä¸ªç£ç›˜æ–‡ä»¶ ï¼Œè¯¥æ–‡ä»¶ä¸­åªå­˜å‚¨è¡¨çš„ç»“æ„ï¼Œè¡¨æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸”é»˜è®¤<strong>ä½¿ç”¨ HASH ç´¢å¼•</strong>ï¼Œæ‰€ä»¥æ•°æ®é»˜è®¤å°±æ˜¯æ— åºçš„ï¼Œä½†æ˜¯åœ¨éœ€è¦å¿«é€Ÿå®šä½è®°å½•å¯ä»¥æä¾›æ›´å¿«çš„è®¿é—®ï¼Œ<strong>æœåŠ¡ä¸€æ—¦å…³é—­ï¼Œè¡¨ä¸­çš„æ•°æ®å°±ä¼šä¸¢å¤±</strong>ï¼Œå­˜å‚¨ä¸å®‰å…¨</li><li>åº”ç”¨åœºæ™¯ï¼š<strong>ç¼“å­˜å‹å­˜å‚¨å¼•æ“</strong>ï¼Œé€šå¸¸ç”¨äºæ›´æ–°ä¸å¤ªé¢‘ç¹çš„å°è¡¨ï¼Œç”¨ä»¥å¿«é€Ÿå¾—åˆ°è®¿é—®ç»“æœ</li><li>å­˜å‚¨æ–¹å¼ï¼šè¡¨ç»“æ„ä¿å­˜åœ¨ .frm ä¸­</li></ul><p>MERGE å­˜å‚¨å¼•æ“ï¼š</p><ul><li><p>ç‰¹ç‚¹ï¼š</p><ul><li>æ˜¯ä¸€ç»„ MyISAM è¡¨çš„ç»„åˆï¼Œè¿™äº› MyISAM è¡¨å¿…é¡»ç»“æ„å®Œå…¨ç›¸åŒï¼Œé€šè¿‡å°†ä¸åŒçš„è¡¨åˆ†å¸ƒåœ¨å¤šä¸ªç£ç›˜ä¸Š</li><li>MERGE è¡¨æœ¬èº«å¹¶æ²¡æœ‰å­˜å‚¨æ•°æ®ï¼Œå¯¹ MERGE ç±»å‹çš„è¡¨å¯ä»¥è¿›è¡ŒæŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤æ“ä½œï¼Œè¿™äº›æ“ä½œå®é™…ä¸Šæ˜¯å¯¹å†…éƒ¨çš„ MyISAM è¡¨è¿›è¡Œçš„</li></ul></li><li><p>åº”ç”¨åœºæ™¯ï¼šå°†ä¸€ç³»åˆ—ç­‰åŒçš„ MyISAM è¡¨ä»¥é€»è¾‘æ–¹å¼ç»„åˆåœ¨ä¸€èµ·ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªå¯¹è±¡å¼•ç”¨ä»–ä»¬ï¼Œé€‚åˆåšæ•°æ®ä»“åº“</p></li><li><p>æ“ä½œæ–¹å¼ï¼š</p><ul><li>æ’å…¥æ“ä½œæ˜¯é€šè¿‡ INSERT_METHOD å­å¥å®šä¹‰æ’å…¥çš„è¡¨ï¼Œä½¿ç”¨ FIRST æˆ– LAST å€¼ä½¿å¾—æ’å…¥æ“ä½œè¢«ç›¸åº”åœ°ä½œç”¨åœ¨ç¬¬ä¸€æˆ–è€…æœ€åä¸€ä¸ªè¡¨ä¸Šï¼›ä¸å®šä¹‰è¿™ä¸ªå­å¥æˆ–è€…å®šä¹‰ä¸º NOï¼Œè¡¨ç¤ºä¸èƒ½å¯¹ MERGE è¡¨æ‰§è¡Œæ’å…¥æ“ä½œ</li><li>å¯¹ MERGE è¡¨è¿›è¡Œ DROP æ“ä½œï¼Œä½†æ˜¯è¿™ä¸ªæ“ä½œåªæ˜¯åˆ é™¤ MERGE è¡¨çš„å®šä¹‰ï¼Œå¯¹å†…éƒ¨çš„è¡¨æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„</li></ul><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE order_1(
)ENGINE = MyISAM DEFAULT CHARSET=utf8;

CREATE TABLE order_2(
)ENGINE = MyISAM DEFAULT CHARSET=utf8;

CREATE TABLE order_all(
	-- ç»“æ„ä¸MyISAMè¡¨ç›¸åŒ
)ENGINE = MERGE UNION = (order_1,order_2) INSERT_METHOD=LAST DEFAULT CHARSET=utf8;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MERGE.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul><table><thead><tr><th>ç‰¹æ€§</th><th>MyISAM</th><th>InnoDB</th><th>MEMORY</th></tr></thead><tbody><tr><td>å­˜å‚¨é™åˆ¶</td><td>æœ‰ï¼ˆå¹³å°å¯¹æ–‡ä»¶ç³»ç»Ÿå¤§å°çš„é™åˆ¶ï¼‰</td><td>64TB</td><td>æœ‰ï¼ˆå¹³å°çš„å†…å­˜é™åˆ¶ï¼‰</td></tr><tr><td><strong>äº‹åŠ¡å®‰å…¨</strong></td><td><strong>ä¸æ”¯æŒ</strong></td><td><strong>æ”¯æŒ</strong></td><td><strong>ä¸æ”¯æŒ</strong></td></tr><tr><td><strong>é”æœºåˆ¶</strong></td><td><strong>è¡¨é”</strong></td><td><strong>è¡¨é”/è¡Œé”</strong></td><td><strong>è¡¨é”</strong></td></tr><tr><td>B+Tree ç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å“ˆå¸Œç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>é›†ç¾¤ç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>æ•°æ®ç´¢å¼•</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>æ•°æ®ç¼“å­˜</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>N/A</td></tr><tr><td>ç´¢å¼•ç¼“å­˜</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>N/A</td></tr><tr><td>æ•°æ®å¯å‹ç¼©</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>ç©ºé—´ä½¿ç”¨</td><td>ä½</td><td>é«˜</td><td>N/A</td></tr><tr><td>å†…å­˜ä½¿ç”¨</td><td>ä½</td><td>é«˜</td><td>ä¸­ç­‰</td></tr><tr><td>æ‰¹é‡æ’å…¥é€Ÿåº¦</td><td>é«˜</td><td>ä½</td><td>é«˜</td></tr><tr><td><strong>å¤–é”®</strong></td><td><strong>ä¸æ”¯æŒ</strong></td><td><strong>æ”¯æŒ</strong></td><td><strong>ä¸æ”¯æŒ</strong></td></tr></tbody></table><p>åªè¯»åœºæ™¯ MyISAM æ¯” InnoDB æ›´å¿«ï¼š</p><ul><li>åº•å±‚å­˜å‚¨ç»“æ„æœ‰å·®åˆ«ï¼ŒMyISAM æ˜¯éèšç°‡ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹ä¿å­˜çš„æ˜¯æ•°æ®çš„å…·ä½“åœ°å€ï¼Œä¸ç”¨å›è¡¨æŸ¥è¯¢</li><li>InnoDB æ¯æ¬¡æŸ¥è¯¢éœ€è¦ç»´æŠ¤ MVCC ç‰ˆæœ¬çŠ¶æ€ï¼Œä¿è¯å¹¶å‘çŠ¶æ€ä¸‹çš„è¯»å†™å†²çªé—®é¢˜</li></ul><hr><h3 id="å¼•æ“æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å¼•æ“æ“ä½œ" aria-hidden="true">#</a> å¼•æ“æ“ä½œ</h3><ul><li><p>æŸ¥è¯¢æ•°æ®åº“æ”¯æŒçš„å­˜å‚¨å¼•æ“</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW ENGINES;
SHOW VARIABLES LIKE &#39;%storage_engine%&#39;; -- æŸ¥çœ‹Mysqlæ•°æ®åº“é»˜è®¤çš„å­˜å‚¨å¼•æ“ 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢æŸä¸ªæ•°æ®åº“ä¸­æ‰€æœ‰æ•°æ®è¡¨çš„å­˜å‚¨å¼•æ“</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW TABLE STATUS FROM æ•°æ®åº“åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢æŸä¸ªæ•°æ®åº“ä¸­æŸä¸ªæ•°æ®è¡¨çš„å­˜å‚¨å¼•æ“</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW TABLE STATUS FROM æ•°æ®åº“åç§° WHERE NAME = &#39;æ•°æ®è¡¨åç§°&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>åˆ›å»ºæ•°æ®è¡¨ï¼ŒæŒ‡å®šå­˜å‚¨å¼•æ“</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE è¡¨å(
	åˆ—å,æ•°æ®ç±»å‹,
    ...
)ENGINE = å¼•æ“åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹æ•°æ®è¡¨çš„å­˜å‚¨å¼•æ“</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE è¡¨å ENGINE = å¼•æ“åç§°;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><hr><h2 id="ç´¢å¼•æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•æœºåˆ¶" aria-hidden="true">#</a> ç´¢å¼•æœºåˆ¶</h2><h3 id="ç´¢å¼•ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ä»‹ç»" aria-hidden="true">#</a> ç´¢å¼•ä»‹ç»</h3><h4 id="åŸºæœ¬ä»‹ç»-4" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-4" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h4><p>MySQL å®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆindexï¼‰æ˜¯å¸®åŠ© MySQL é«˜æ•ˆè·å–æ•°æ®çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œ**æœ¬è´¨æ˜¯æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„ã€‚**åœ¨è¡¨æ•°æ®ä¹‹å¤–ï¼Œæ•°æ®åº“ç³»ç»Ÿè¿˜ç»´æŠ¤ç€æ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œè¿™äº›æ•°æ®ç»“æ„ä»¥æŸç§æ–¹å¼æŒ‡å‘æ•°æ®ï¼Œ è¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ï¼Œè¿™ç§æ•°æ®ç»“æ„å°±æ˜¯ç´¢å¼•</p><p><strong>ç´¢å¼•æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚å®ç°çš„</strong>ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ç»Ÿä¸€çš„ç´¢å¼•æ ‡å‡†ï¼Œå³ä¸åŒå­˜å‚¨å¼•æ“çš„ç´¢å¼•çš„å·¥ä½œæ–¹å¼å¹¶ä¸ä¸€æ ·</p><p>ç´¢å¼•ä½¿ç”¨ï¼šä¸€å¼ æ•°æ®è¡¨ï¼Œç”¨äºä¿å­˜æ•°æ®ï¼›ä¸€ä¸ªç´¢å¼•é…ç½®æ–‡ä»¶ï¼Œç”¨äºä¿å­˜ç´¢å¼•ï¼›æ¯ä¸ªç´¢å¼•éƒ½æŒ‡å‘äº†æŸä¸€ä¸ªæ•°æ®<br><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ç´¢å¼•çš„ä»‹ç».png" alt="" loading="lazy"></p><p>å·¦è¾¹æ˜¯æ•°æ®è¡¨ï¼Œä¸€å…±æœ‰ä¸¤åˆ—ä¸ƒæ¡è®°å½•ï¼Œæœ€å·¦è¾¹çš„æ˜¯æ•°æ®è®°å½•çš„ç‰©ç†åœ°å€ï¼ˆæ³¨æ„é€»è¾‘ä¸Šç›¸é‚»çš„è®°å½•åœ¨ç£ç›˜ä¸Šä¹Ÿå¹¶ä¸æ˜¯ä¸€å®šç‰©ç†ç›¸é‚»çš„ï¼‰ã€‚ä¸ºäº†åŠ å¿« Col2 çš„æŸ¥æ‰¾ï¼Œå¯ä»¥ç»´æŠ¤ä¸€ä¸ªå³è¾¹æ‰€ç¤ºçš„äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«åŒ…å«ç´¢å¼•é”®å€¼å’Œä¸€ä¸ªæŒ‡å‘å¯¹åº”æ•°æ®çš„ç‰©ç†åœ°å€çš„æŒ‡é’ˆï¼Œè¿™æ ·å°±å¯ä»¥è¿ç”¨äºŒå‰æŸ¥æ‰¾å¿«é€Ÿè·å–åˆ°ç›¸åº”æ•°æ®</p><p>ç´¢å¼•çš„ä¼˜ç‚¹ï¼š</p><ul><li>ç±»ä¼¼äºä¹¦ç±çš„ç›®å½•ç´¢å¼•ï¼Œæé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„ IO æˆæœ¬</li><li>é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½ CPU çš„æ¶ˆè€—</li></ul><p>ç´¢å¼•çš„ç¼ºç‚¹ï¼š</p><ul><li>ä¸€èˆ¬æ¥è¯´ç´¢å¼•æœ¬èº«ä¹Ÿå¾ˆå¤§ï¼Œä¸å¯èƒ½å…¨éƒ¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤ç´¢å¼•å¾€å¾€ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼<strong>å­˜å‚¨åœ¨ç£ç›˜</strong>ä¸Š</li><li>è™½ç„¶ç´¢å¼•å¤§å¤§æé«˜äº†æŸ¥è¯¢æ•ˆç‡ï¼ŒåŒæ—¶å´ä¹Ÿé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ã€‚å¯¹è¡¨è¿›è¡Œ INSERTã€UPDATEã€DELETE æ“ä½œï¼ŒMySQL ä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶æ¯æ¬¡æ›´æ–°æ·»åŠ äº†ç´¢å¼•åˆ—çš„å­—æ®µï¼Œè¿˜ä¼šè°ƒæ•´å› ä¸ºæ›´æ–°æ‰€å¸¦æ¥çš„é”®å€¼å˜åŒ–åçš„ç´¢å¼•ä¿¡æ¯ï¼Œ<strong>ä½†æ˜¯æ›´æ–°æ•°æ®ä¹Ÿéœ€è¦å…ˆä»æ•°æ®åº“ä¸­è·å–</strong>ï¼Œç´¢å¼•åŠ å¿«äº†è·å–é€Ÿåº¦ï¼Œæ‰€ä»¥å¯ä»¥ç›¸äº’æŠµæ¶ˆä¸€ä¸‹ã€‚</li><li>ç´¢å¼•ä¼šå½±å“åˆ° WHERE çš„æŸ¥è¯¢æ¡ä»¶å’Œæ’åº ORDER BY ä¸¤å¤§åŠŸèƒ½</li></ul><hr><h4 id="ç´¢å¼•åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•åˆ†ç±»" aria-hidden="true">#</a> ç´¢å¼•åˆ†ç±»</h4><p>ç´¢å¼•ä¸€èˆ¬çš„åˆ†ç±»å¦‚ä¸‹ï¼š</p><ul><li><p>åŠŸèƒ½åˆ†ç±»</p><ul><li>ä¸»é”®ç´¢å¼•ï¼šä¸€ç§ç‰¹æ®Šçš„å”¯ä¸€ç´¢å¼•ï¼Œä¸å…è®¸æœ‰ç©ºå€¼ï¼Œä¸€èˆ¬åœ¨å»ºè¡¨æ—¶åŒæ—¶åˆ›å»ºä¸»é”®ç´¢å¼•</li><li>å•åˆ—ç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•ï¼ˆæ™®é€šç´¢å¼•ï¼‰</li><li>è”åˆç´¢å¼•ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†å•åˆ—ç´¢å¼•è¿›è¡Œç»„åˆ</li><li>å”¯ä¸€ç´¢å¼•ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œ<strong>å…è®¸æœ‰ç©ºå€¼</strong>ï¼Œå¦‚æœæ˜¯è”åˆç´¢å¼•ï¼Œåˆ™åˆ—å€¼ç»„åˆå¿…é¡»å”¯ä¸€ <ul><li>NULL å€¼å¯ä»¥å‡ºç°å¤šæ¬¡ï¼Œå› ä¸ºä¸¤ä¸ª NULL æ¯”è¾ƒçš„ç»“æœæ—¢ä¸ç›¸ç­‰ï¼Œä¹Ÿä¸ä¸ç­‰ï¼Œç»“æœä»ç„¶æ˜¯æœªçŸ¥</li><li>å¯ä»¥å£°æ˜ä¸å…è®¸å­˜å‚¨ NULL å€¼çš„éç©ºå”¯ä¸€ç´¢å¼•</li></ul></li><li>å¤–é”®ç´¢å¼•ï¼šåªæœ‰ InnoDB å¼•æ“æ”¯æŒå¤–é”®ç´¢å¼•ï¼Œç”¨æ¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€å®Œæ•´æ€§å’Œå®ç°çº§è”æ“ä½œ</li></ul></li><li><p>ç»“æ„åˆ†ç±»</p><ul><li>BTree ç´¢å¼•ï¼šMySQL ä½¿ç”¨æœ€é¢‘ç¹çš„ä¸€ä¸ªç´¢å¼•æ•°æ®ç»“æ„ï¼Œæ˜¯ InnoDB å’Œ MyISAM å­˜å‚¨å¼•æ“é»˜è®¤çš„ç´¢å¼•ç±»å‹ï¼Œåº•å±‚åŸºäº B+Tree</li><li>Hash ç´¢å¼•ï¼šMySQLä¸­ Memory å­˜å‚¨å¼•æ“é»˜è®¤æ”¯æŒçš„ç´¢å¼•ç±»å‹</li><li>R-tree ç´¢å¼•ï¼ˆç©ºé—´ç´¢å¼•ï¼‰ï¼šç©ºé—´ç´¢å¼•æ˜¯ MyISAM å¼•æ“çš„ä¸€ä¸ªç‰¹æ®Šç´¢å¼•ç±»å‹ï¼Œä¸»è¦ç”¨äºåœ°ç†ç©ºé—´æ•°æ®ç±»å‹</li><li>Full-text ç´¢å¼•ï¼ˆå…¨æ–‡ç´¢å¼•ï¼‰ï¼šå¿«é€ŸåŒ¹é…å…¨éƒ¨æ–‡æ¡£çš„æ–¹å¼ã€‚MyISAM æ”¯æŒï¼Œ InnoDB ä¸æ”¯æŒ FULLTEXT ç±»å‹çš„ç´¢å¼•ï¼Œä½†æ˜¯ InnoDB å¯ä»¥ä½¿ç”¨ sphinx æ’ä»¶æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼ŒMEMORY å¼•æ“ä¸æ”¯æŒ</li></ul><table><thead><tr><th>ç´¢å¼•</th><th>InnoDB</th><th>MyISAM</th><th>Memory</th></tr></thead><tbody><tr><td>BTREE</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>HASH</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>R-tree</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>Full-text</td><td>5.6 ç‰ˆæœ¬ä¹‹åæ”¯æŒ</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr></tbody></table></li></ul><p>è”åˆç´¢å¼•å›¾ç¤ºï¼šæ ¹æ®èº«é«˜å¹´é¾„å»ºç«‹çš„ç»„åˆç´¢å¼•ï¼ˆheightã€ageï¼‰</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ç»„åˆç´¢å¼•å›¾.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h3 id="ç´¢å¼•æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•æ“ä½œ" aria-hidden="true">#</a> ç´¢å¼•æ“ä½œ</h3><p>ç´¢å¼•åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™å¯ä»¥åŒæ—¶åˆ›å»ºï¼Œ ä¹Ÿå¯ä»¥éšæ—¶å¢åŠ æ–°çš„ç´¢å¼•</p><ul><li><p>åˆ›å»ºç´¢å¼•ï¼šå¦‚æœä¸€ä¸ªè¡¨ä¸­æœ‰ä¸€åˆ—æ˜¯ä¸»é”®ï¼Œé‚£ä¹ˆä¼š<strong>é»˜è®¤ä¸ºå…¶åˆ›å»ºä¸»é”®ç´¢å¼•</strong>ï¼ˆä¸»é”®åˆ—ä¸éœ€è¦å•ç‹¬åˆ›å»ºç´¢å¼•ï¼‰</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE [UNIQUE|FULLTEXT] INDEX ç´¢å¼•åç§° [USING ç´¢å¼•ç±»å‹] ON è¡¨å(åˆ—å...);
-- ç´¢å¼•ç±»å‹é»˜è®¤æ˜¯ B+TREE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹ç´¢å¼•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW INDEX FROM è¡¨å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ·»åŠ ç´¢å¼•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- å•åˆ—ç´¢å¼•
ALTER TABLE è¡¨å ADD INDEX ç´¢å¼•åç§°(åˆ—å);

-- ç»„åˆç´¢å¼•
ALTER TABLE è¡¨å ADD INDEX ç´¢å¼•åç§°(åˆ—å1,åˆ—å2,...);

-- ä¸»é”®ç´¢å¼•
ALTER TABLE è¡¨å ADD PRIMARY KEY(ä¸»é”®åˆ—å); 

-- å¤–é”®ç´¢å¼•(æ·»åŠ å¤–é”®çº¦æŸï¼Œå°±æ˜¯å¤–é”®ç´¢å¼•)
ALTER TABLE è¡¨å ADD CONSTRAINT å¤–é”®å FOREIGN KEY (æœ¬è¡¨å¤–é”®åˆ—å) REFERENCES ä¸»è¡¨å(ä¸»é”®åˆ—å);

-- å”¯ä¸€ç´¢å¼•
ALTER TABLE è¡¨å ADD UNIQUE ç´¢å¼•åç§°(åˆ—å);

-- å…¨æ–‡ç´¢å¼•(mysqlåªæ”¯æŒæ–‡æœ¬ç±»å‹)
ALTER TABLE è¡¨å ADD FULLTEXT ç´¢å¼•åç§°(åˆ—å);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ é™¤ç´¢å¼•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP INDEX ç´¢å¼•åç§° ON è¡¨å;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ¡ˆä¾‹ç»ƒä¹ </p><p>æ•°æ®å‡†å¤‡ï¼šstudent</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>id	NAME	 age	score
1	å¼ ä¸‰		23		99
2	æå››		24		95
3	ç‹äº”		25		98
4	èµµå…­		26		97
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç´¢å¼•æ“ä½œï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- ä¸ºstudentè¡¨ä¸­å§“ååˆ—åˆ›å»ºä¸€ä¸ªæ™®é€šç´¢å¼•
CREATE INDEX idx_name ON student(NAME);

-- ä¸ºstudentè¡¨ä¸­å¹´é¾„åˆ—åˆ›å»ºä¸€ä¸ªå”¯ä¸€ç´¢å¼•
CREATE UNIQUE INDEX idx_age ON student(age);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h3 id="èšç°‡ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#èšç°‡ç´¢å¼•" aria-hidden="true">#</a> èšç°‡ç´¢å¼•</h3><h4 id="ç´¢å¼•å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•å¯¹æ¯”" aria-hidden="true">#</a> ç´¢å¼•å¯¹æ¯”</h4><p>èšç°‡ç´¢å¼•æ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œå¹¶ä¸æ˜¯ä¸€ç§å•ç‹¬çš„ç´¢å¼•ç±»å‹</p><ul><li><p>èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼å’Œæ•°æ®è¡Œï¼Œæ”¯æŒè¦†ç›–ç´¢å¼•</p></li><li><p>éèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®å€¼æˆ–æŒ‡å‘æ•°æ®è¡Œçš„æŒ‡é’ˆï¼ˆç”±å­˜å‚¨å¼•æ“å†³å®šï¼‰</p></li></ul><p>åœ¨ Innodb ä¸‹ä¸»é”®ç´¢å¼•æ˜¯èšç°‡ç´¢å¼•ï¼Œåœ¨ MyISAM ä¸‹ä¸»é”®ç´¢å¼•æ˜¯éèšç°‡ç´¢å¼•</p><hr><h4 id="innodb" tabindex="-1"><a class="header-anchor" href="#innodb" aria-hidden="true">#</a> Innodb</h4><h5 id="èšç°‡ç´¢å¼•-1" tabindex="-1"><a class="header-anchor" href="#èšç°‡ç´¢å¼•-1" aria-hidden="true">#</a> èšç°‡ç´¢å¼•</h5><p>åœ¨ Innodb å­˜å‚¨å¼•æ“ï¼ŒB+ æ ‘ç´¢å¼•å¯ä»¥åˆ†ä¸ºèšç°‡ç´¢å¼•ï¼ˆä¹Ÿç§°èšé›†ç´¢å¼•ã€clustered indexï¼‰å’Œè¾…åŠ©ç´¢å¼•ï¼ˆä¹Ÿç§°éèšç°‡ç´¢å¼•æˆ–äºŒçº§ç´¢å¼•ã€secondary indexã€non-clustered indexï¼‰</p><p>InnoDB ä¸­ï¼Œèšç°‡ç´¢å¼•æ˜¯æŒ‰ç…§æ¯å¼ è¡¨çš„ä¸»é”®æ„é€ ä¸€é¢— B+ æ ‘ï¼Œå¶å­èŠ‚ç‚¹ä¸­å­˜æ”¾çš„å°±æ˜¯æ•´å¼ è¡¨çš„æ•°æ®ï¼Œå°†èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ç§°ä¸ºæ•°æ®é¡µ</p><ul><li>è¿™ä¸ªç‰¹æ€§å†³å®šäº†<strong>æ•°æ®ä¹Ÿæ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†</strong>ï¼Œæ‰€ä»¥ä¸€å¼ è¡¨åªèƒ½æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•</li><li>è¾…åŠ©ç´¢å¼•çš„å­˜åœ¨ä¸å½±å“èšç°‡ç´¢å¼•ä¸­æ•°æ®çš„ç»„ç»‡ï¼Œæ‰€ä»¥ä¸€å¼ è¡¨å¯ä»¥æœ‰å¤šä¸ªè¾…åŠ©ç´¢å¼•</li></ul><p>èšç°‡ç´¢å¼•çš„ä¼˜ç‚¹ï¼š</p><ul><li>æ•°æ®è®¿é—®æ›´å¿«ï¼Œèšç°‡ç´¢å¼•å°†ç´¢å¼•å’Œæ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ª B+ æ ‘ä¸­ï¼Œå› æ­¤ä»èšç°‡ç´¢å¼•ä¸­è·å–æ•°æ®æ¯”éèšç°‡ç´¢å¼•æ›´å¿«</li><li>èšç°‡ç´¢å¼•å¯¹äºä¸»é”®çš„æ’åºæŸ¥æ‰¾å’ŒèŒƒå›´æŸ¥æ‰¾é€Ÿåº¦éå¸¸å¿«</li></ul><p>èšç°‡ç´¢å¼•çš„ç¼ºç‚¹ï¼š</p><ul><li><p>æ’å…¥é€Ÿåº¦ä¸¥é‡ä¾èµ–äºæ’å…¥é¡ºåºï¼ŒæŒ‰ç…§ä¸»é”®çš„é¡ºåºï¼ˆé€’å¢ï¼‰æ’å…¥æ˜¯æœ€å¿«çš„æ–¹å¼ï¼Œå¦åˆ™å°†ä¼šå‡ºç°é¡µåˆ†è£‚ï¼Œä¸¥é‡å½±å“æ€§èƒ½ï¼Œæ‰€ä»¥å¯¹äº InnoDB è¡¨ï¼Œä¸€èˆ¬éƒ½ä¼šå®šä¹‰ä¸€ä¸ªè‡ªå¢çš„ ID åˆ—ä¸ºä¸»é”®</p></li><li><p>æ›´æ–°ä¸»é”®çš„ä»£ä»·å¾ˆé«˜ï¼Œå°†ä¼šå¯¼è‡´è¢«æ›´æ–°çš„è¡Œç§»åŠ¨ï¼Œæ‰€ä»¥å¯¹äº InnoDB è¡¨ï¼Œä¸€èˆ¬å®šä¹‰ä¸»é”®ä¸ºä¸å¯æ›´æ–°</p></li><li><p>äºŒçº§ç´¢å¼•è®¿é—®éœ€è¦ä¸¤æ¬¡ç´¢å¼•æŸ¥æ‰¾ï¼Œç¬¬ä¸€æ¬¡æ‰¾åˆ°ä¸»é”®å€¼ï¼Œç¬¬äºŒæ¬¡æ ¹æ®ä¸»é”®å€¼æ‰¾åˆ°è¡Œæ•°æ®</p></li></ul><hr><h5 id="è¾…åŠ©ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#è¾…åŠ©ç´¢å¼•" aria-hidden="true">#</a> è¾…åŠ©ç´¢å¼•</h5><p>åœ¨èšç°‡ç´¢å¼•ä¹‹ä¸Šåˆ›å»ºçš„ç´¢å¼•ç§°ä¹‹ä¸ºè¾…åŠ©ç´¢å¼•ï¼Œéèšç°‡ç´¢å¼•éƒ½æ˜¯è¾…åŠ©ç´¢å¼•ï¼Œåƒå¤åˆç´¢å¼•ã€å‰ç¼€ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ç­‰</p><p>è¾…åŠ©ç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯æ•°æ®çš„ç‰©ç†åœ°å€ï¼Œæ‰€ä»¥è®¿é—®æ•°æ®éœ€è¦äºŒæ¬¡æŸ¥æ‰¾ï¼Œæ¨èä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œå¯ä»¥å‡å°‘å›è¡¨æŸ¥è¯¢</p><p><strong>æ£€ç´¢è¿‡ç¨‹</strong>ï¼šè¾…åŠ©ç´¢å¼•æ‰¾åˆ°ä¸»é”®å€¼ï¼Œå†é€šè¿‡èšç°‡ç´¢å¼•ï¼ˆäºŒåˆ†ï¼‰æ‰¾åˆ°æ•°æ®é¡µï¼Œæœ€åé€šè¿‡æ•°æ®é¡µä¸­çš„ Page Directoryï¼ˆäºŒåˆ†ï¼‰æ‰¾åˆ°å¯¹åº”çš„æ•°æ®åˆ†ç»„ï¼Œéå†ç»„å†…æ‰€æ‰€æœ‰çš„æ•°æ®æ‰¾åˆ°æ•°æ®è¡Œ</p><p>è¡¥å……ï¼šæ— ç´¢å¼•èµ°å…¨è¡¨æŸ¥è¯¢ï¼ŒæŸ¥åˆ°æ•°æ®é¡µåå’Œä¸Šè¿°æ­¥éª¤ä¸€è‡´</p><hr><h5 id="ç´¢å¼•å®ç°" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•å®ç°" aria-hidden="true">#</a> ç´¢å¼•å®ç°</h5><p>InnoDB ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¹¶ä¸” InnoDB ä¸€å®šæœ‰ç´¢å¼•</p><p>ä¸»é”®ç´¢å¼•ï¼š</p><ul><li><p>åœ¨ InnoDB ä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰ B+Tree ç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œè¿™ä¸ªç´¢å¼•çš„ key æ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå¶å­èŠ‚ç‚¹ data åŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•</p></li><li><p>InnoDB çš„è¡¨æ•°æ®æ–‡ä»¶<strong>é€šè¿‡ä¸»é”®èšé›†æ•°æ®</strong>ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ä¸»é”®ï¼Œä¼šé€‰æ‹©éç©ºå”¯ä¸€ç´¢å¼•ä»£æ›¿ï¼Œå¦‚æœä¹Ÿæ²¡æœ‰è¿™æ ·çš„åˆ—ï¼ŒMySQL ä¼šè‡ªåŠ¨ä¸º InnoDB è¡¨ç”Ÿæˆä¸€ä¸ª<strong>éšå«å­—æ®µ row_id</strong> ä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º 6 ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å½¢</p></li></ul><p>è¾…åŠ©ç´¢å¼•ï¼š</p><ul><li><p>InnoDB çš„æ‰€æœ‰è¾…åŠ©ç´¢å¼•ï¼ˆäºŒçº§ç´¢å¼•ï¼‰éƒ½å¼•ç”¨ä¸»é”®ä½œä¸º data åŸŸ</p></li><li><p>InnoDB è¡¨æ˜¯åŸºäºèšç°‡ç´¢å¼•å»ºç«‹çš„ï¼Œå› æ­¤ InnoDB çš„ç´¢å¼•èƒ½æä¾›ä¸€ç§éå¸¸å¿«é€Ÿçš„ä¸»é”®æŸ¥æ‰¾æ€§èƒ½ã€‚ä¸è¿‡è¾…åŠ©ç´¢å¼•ä¹Ÿä¼šåŒ…å«ä¸»é”®åˆ—ï¼Œæ‰€ä»¥ä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œ<strong>è¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§</strong></p></li></ul><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDBèšç°‡å’Œè¾…åŠ©ç´¢å¼•ç»“æ„.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h4 id="myisam" tabindex="-1"><a class="header-anchor" href="#myisam" aria-hidden="true">#</a> MyISAM</h4><h5 id="éèšç°‡" tabindex="-1"><a class="header-anchor" href="#éèšç°‡" aria-hidden="true">#</a> éèšç°‡</h5><p>MyISAM çš„ä¸»é”®ç´¢å¼•ä½¿ç”¨çš„æ˜¯éèšç°‡ç´¢å¼•ï¼Œç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œ<strong>ç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®çš„åœ°å€</strong></p><ul><li>ä¸»é”®ç´¢å¼• B+ æ ‘çš„èŠ‚ç‚¹å­˜å‚¨äº†ä¸»é”®ï¼Œè¾…åŠ©é”®ç´¢å¼• B+ æ ‘å­˜å‚¨äº†è¾…åŠ©é”®ï¼Œè¡¨æ•°æ®å­˜å‚¨åœ¨ç‹¬ç«‹çš„åœ°æ–¹ï¼Œè¿™ä¸¤é¢— B+ æ ‘çš„å¶å­èŠ‚ç‚¹éƒ½ä½¿ç”¨ä¸€ä¸ªåœ°å€æŒ‡å‘çœŸæ­£çš„è¡¨æ•°æ®ï¼Œå¯¹äºè¡¨æ•°æ®æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªé”®æ²¡æœ‰ä»»ä½•å·®åˆ«</li><li>ç”±äºç´¢å¼•æ ‘æ˜¯ç‹¬ç«‹çš„ï¼Œé€šè¿‡è¾…åŠ©ç´¢å¼•æ£€ç´¢<strong>æ— éœ€å›è¡¨æŸ¥è¯¢</strong>è®¿é—®ä¸»é”®çš„ç´¢å¼•æ ‘</li></ul><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-èšç°‡ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•æ£€é”æ•°æ®å›¾.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h5 id="ç´¢å¼•å®ç°-1" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•å®ç°-1" aria-hidden="true">#</a> ç´¢å¼•å®ç°</h5><p>MyISAM çš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšéèšé›†çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸ InnoDB çš„èšé›†ç´¢å¼•åŒºåˆ†</p><p>ä¸»é”®ç´¢å¼•ï¼šMyISAM å¼•æ“ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶èŠ‚ç‚¹çš„ data åŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€</p><p>è¾…åŠ©ç´¢å¼•ï¼šMyISAM ä¸­ä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰åœ¨ç»“æ„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯ä¸»ç´¢å¼•è¦æ±‚ key æ˜¯å”¯ä¸€çš„ï¼Œè€Œè¾…åŠ©ç´¢å¼•çš„ key å¯ä»¥é‡å¤</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAMä¸»é”®å’Œè¾…åŠ©ç´¢å¼•ç»“æ„.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/lm1060891265/article/details/81482136" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/lm1060891265/article/details/81482136<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h3 id="ç´¢å¼•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ç»“æ„" aria-hidden="true">#</a> ç´¢å¼•ç»“æ„</h3><h4 id="æ•°æ®é¡µ" tabindex="-1"><a class="header-anchor" href="#æ•°æ®é¡µ" aria-hidden="true">#</a> æ•°æ®é¡µ</h4><p>æ–‡ä»¶ç³»ç»Ÿçš„æœ€å°å•å…ƒæ˜¯å—ï¼ˆblockï¼‰ï¼Œä¸€ä¸ªå—çš„å¤§å°æ˜¯ 4Kï¼Œç³»ç»Ÿä»ç£ç›˜è¯»å–æ•°æ®åˆ°å†…å­˜æ—¶æ˜¯ä»¥ç£ç›˜å—ä¸ºåŸºæœ¬å•ä½çš„ï¼Œä½äºåŒä¸€ä¸ªç£ç›˜å—ä¸­çš„æ•°æ®ä¼šè¢«ä¸€æ¬¡æ€§è¯»å–å‡ºæ¥ï¼Œè€Œä¸æ˜¯éœ€è¦ä»€ä¹ˆå–ä»€ä¹ˆ</p><p>InnoDB å­˜å‚¨å¼•æ“ä¸­æœ‰é¡µï¼ˆPageï¼‰çš„æ¦‚å¿µï¼Œé¡µæ˜¯ MySQL ç£ç›˜ç®¡ç†çš„æœ€å°å•ä½</p><ul><li><strong>InnoDB å­˜å‚¨å¼•æ“ä¸­é»˜è®¤æ¯ä¸ªé¡µçš„å¤§å°ä¸º 16KBï¼Œç´¢å¼•ä¸­ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªæ•°æ®é¡µ</strong>ï¼Œæ‰€ä»¥ä¼šä¸€æ¬¡æ€§è¯»å– 16KB çš„æ•°æ®åˆ°å†…å­˜</li><li>InnoDB å¼•æ“å°†è‹¥å¹²ä¸ªåœ°å€è¿æ¥ç£ç›˜å—ï¼Œä»¥æ­¤æ¥è¾¾åˆ°é¡µçš„å¤§å° 16KB</li><li>åœ¨æŸ¥è¯¢æ•°æ®æ—¶å¦‚æœä¸€ä¸ªé¡µä¸­çš„æ¯æ¡æ•°æ®éƒ½èƒ½æœ‰åŠ©äºå®šä½æ•°æ®è®°å½•çš„ä½ç½®ï¼Œè¿™å°†ä¼šå‡å°‘ç£ç›˜ I/O æ¬¡æ•°ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡</li></ul><p>è¶…è¿‡ 16KB çš„ä¸€æ¡è®°å½•ï¼Œä¸»é”®ç´¢å¼•é¡µåªä¼šå­˜å‚¨éƒ¨åˆ†æ•°æ®å’ŒæŒ‡å‘<strong>æº¢å‡ºé¡µ</strong>çš„æŒ‡é’ˆï¼Œå‰©ä½™æ•°æ®éƒ½ä¼šåˆ†æ•£å­˜å‚¨åœ¨æº¢å‡ºé¡µä¸­</p><p>æ•°æ®é¡µç‰©ç†ç»“æ„ï¼Œä»ä¸Šåˆ°ä¸‹ï¼š</p><ul><li>File Headerï¼šä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µçš„æŒ‡é’ˆã€è¯¥é¡µçš„ç±»å‹ï¼ˆç´¢å¼•é¡µã€æ•°æ®é¡µã€æ—¥å¿—é¡µç­‰ï¼‰ã€<strong>æ ¡éªŒå’Œ</strong>ã€LSNï¼ˆæœ€è¿‘ä¸€æ¬¡ä¿®æ”¹å½“å‰é¡µé¢æ—¶çš„ç³»ç»Ÿ lsn å€¼ï¼Œäº‹åŠ¡æŒä¹…æ€§éƒ¨åˆ†è¯¦è§£ï¼‰ç­‰ä¿¡æ¯</li><li>Page Headerï¼šè®°å½•çŠ¶æ€ä¿¡æ¯</li><li>Infimum + Supremumï¼šå½“å‰é¡µçš„æœ€å°è®°å½•å’Œæœ€å¤§è®°å½•ï¼ˆå¤´å°¾æŒ‡é’ˆï¼‰ï¼ŒInfimum æ‰€åœ¨åˆ†ç»„åªæœ‰ä¸€æ¡è®°å½•ï¼ŒSupremum æ‰€åœ¨åˆ†ç»„å¯ä»¥æœ‰ 1 ~ 8 æ¡è®°å½•ï¼Œå‰©ä½™çš„åˆ†ç»„å¯ä»¥æœ‰ 4 ~ 8 æ¡è®°å½•</li><li>User Recordsï¼šå­˜å‚¨æ•°æ®çš„è®°å½•</li><li>Free Spaceï¼šå°šæœªä½¿ç”¨çš„å­˜å‚¨ç©ºé—´</li><li>Page Directoryï¼šåˆ†ç»„çš„ç›®å½•ï¼Œå¯ä»¥é€šè¿‡ç›®å½•å¿«é€Ÿå®šä½ï¼ˆäºŒåˆ†æ³•ï¼‰æ•°æ®çš„åˆ†ç»„</li><li>File Trailerï¼šæ£€éªŒå’Œå­—æ®µï¼Œåœ¨åˆ·è„è¿‡ç¨‹ä¸­ï¼Œé¡µé¦–å’Œé¡µå°¾çš„æ ¡éªŒå’Œä¸€è‡´æ‰èƒ½è¯´æ˜é¡µé¢åˆ·æ–°æˆåŠŸï¼ŒäºŒè€…ä¸åŒè¯´æ˜åˆ·æ–°æœŸé—´å‘ç”Ÿäº†é”™è¯¯ï¼›LSN å­—æ®µï¼Œä¹Ÿæ˜¯ç”¨æ¥æ ¡éªŒé¡µé¢çš„å®Œæ•´æ€§</li></ul><p>æ•°æ®é¡µä¸­åŒ…å«æ•°æ®è¡Œï¼Œæ•°æ®çš„å­˜å‚¨æ˜¯åŸºäºæ•°æ®è¡Œçš„ï¼Œæ•°æ®è¡Œæœ‰ next_record å±æ€§æŒ‡å‘ä¸‹ä¸€ä¸ªè¡Œæ•°æ®ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥éå†çš„ï¼Œä½†æ˜¯ä¸€ç»„æ•°æ®è‡³å¤š 8 ä¸ªè¡Œï¼Œé€šè¿‡ Page Directory å…ˆå®šä½åˆ°ç»„ï¼Œç„¶åéå†è·å–æ‰€éœ€çš„æ•°æ®è¡Œå³å¯</p><p>æ•°æ®è¡Œä¸­æœ‰ä¸‰ä¸ªéšè—å­—æ®µï¼štrx_idã€roll_pointerã€row_idï¼ˆåœ¨äº‹åŠ¡ç« èŠ‚ä¼šè¯¦ç»†ä»‹ç»å®ƒä»¬çš„ä½œç”¨ï¼‰</p><hr><h4 id="btree" tabindex="-1"><a class="header-anchor" href="#btree" aria-hidden="true">#</a> BTree</h4><p>BTree çš„ç´¢å¼•ç±»å‹æ˜¯åŸºäº B+Tree æ ‘å‹æ•°æ®ç»“æ„çš„ï¼ŒB+Tree åˆæ˜¯ BTree æ•°æ®ç»“æ„çš„å˜ç§ï¼Œç”¨åœ¨æ•°æ®åº“å’Œæ“ä½œç³»ç»Ÿä¸­çš„æ–‡ä»¶ç³»ç»Ÿï¼Œç‰¹ç‚¹æ˜¯èƒ½å¤Ÿä¿æŒæ•°æ®ç¨³å®šæœ‰åº</p><p>BTree åˆå«å¤šè·¯å¹³è¡¡æœç´¢æ ‘ï¼Œä¸€é¢— m å‰çš„ BTree ç‰¹æ€§å¦‚ä¸‹ï¼š</p><ul><li>æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…å« m ä¸ªå­©å­</li><li>é™¤æ ¹èŠ‚ç‚¹ä¸å¶å­èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰ [ceil(m/2)] ä¸ªå­©å­</li><li>è‹¥æ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™è‡³å°‘æœ‰ä¸¤ä¸ªå­©å­</li><li>æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚</li><li>æ¯ä¸ªéå¶å­èŠ‚ç‚¹ç”± n ä¸ª key ä¸ n+1 ä¸ªæŒ‡é’ˆç»„æˆï¼Œå…¶ä¸­ [ceil(m/2)-1] &lt;= n &lt;= m-1</li></ul><p>5 å‰ï¼Œkey çš„æ•°é‡ [ceil(m/2)-1] &lt;= n &lt;= m-1 ä¸º 2 &lt;= n &lt;=4 ï¼Œå½“ n&gt;4 æ—¶ä¸­é—´èŠ‚ç‚¹åˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ï¼Œä¸¤è¾¹èŠ‚ç‚¹åˆ†è£‚</p><p>æ’å…¥ C N G A H E K Q M F W L T Z D P R X Y S æ•°æ®çš„å·¥ä½œæµç¨‹ï¼š</p><ul><li><p>æ’å…¥å‰ 4 ä¸ªå­—æ¯ C N G A</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-BTreeå·¥ä½œæµç¨‹1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æ’å…¥ Hï¼Œn&gt;4ï¼Œä¸­é—´å…ƒç´  G å­—æ¯å‘ä¸Šåˆ†è£‚åˆ°æ–°çš„èŠ‚ç‚¹</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-BTreeå·¥ä½œæµç¨‹2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æ’å…¥ Eã€Kã€Q ä¸éœ€è¦åˆ†è£‚</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-BTreeå·¥ä½œæµç¨‹3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æ’å…¥ Mï¼Œä¸­é—´å…ƒç´  M å­—æ¯å‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ G</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-BTreeå·¥ä½œæµç¨‹4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æ’å…¥ Fï¼ŒWï¼ŒLï¼ŒT ä¸éœ€è¦åˆ†è£‚</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-BTreeå·¥ä½œæµç¨‹5.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æ’å…¥ Zï¼Œä¸­é—´å…ƒç´  T å‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ä¸­</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-BTreeå·¥ä½œæµç¨‹6.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æ’å…¥ Dï¼Œä¸­é—´å…ƒç´  D å‘ä¸Šåˆ†è£‚åˆ°çˆ¶èŠ‚ç‚¹ä¸­ï¼Œç„¶åæ’å…¥ Pï¼ŒRï¼ŒXï¼ŒY ä¸éœ€è¦åˆ†è£‚</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-BTreeå·¥ä½œæµç¨‹7.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æœ€åæ’å…¥ Sï¼ŒNPQR èŠ‚ç‚¹ n&gt;5ï¼Œä¸­é—´èŠ‚ç‚¹ Q å‘ä¸Šåˆ†è£‚ï¼Œä½†åˆ†è£‚åçˆ¶èŠ‚ç‚¹ DGMT çš„ n&gt;5ï¼Œä¸­é—´èŠ‚ç‚¹ M å‘ä¸Šåˆ†è£‚</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-BTreeå·¥ä½œæµç¨‹8.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul><p>BTree æ ‘å°±å·²ç»æ„å»ºå®Œæˆäº†ï¼ŒBTree æ ‘å’ŒäºŒå‰æ ‘ç›¸æ¯”ï¼Œ æŸ¥è¯¢æ•°æ®çš„æ•ˆç‡æ›´é«˜ï¼Œ å› ä¸ºå¯¹äºç›¸åŒçš„æ•°æ®é‡æ¥è¯´ï¼Œ<strong>BTree çš„å±‚çº§ç»“æ„æ¯”äºŒå‰æ ‘å°‘</strong>ï¼Œæ‰€ä»¥æœç´¢é€Ÿåº¦å¿«</p><p>BTree ç»“æ„çš„æ•°æ®å¯ä»¥è®©ç³»ç»Ÿé«˜æ•ˆçš„æ‰¾åˆ°æ•°æ®æ‰€åœ¨çš„ç£ç›˜å—ï¼Œå®šä¹‰ä¸€æ¡è®°å½•ä¸ºä¸€ä¸ªäºŒå…ƒç»„ [key, data] ï¼Œkey ä¸ºè®°å½•çš„é”®å€¼ï¼Œå¯¹åº”è¡¨ä¸­çš„ä¸»é”®å€¼ï¼Œdata ä¸ºä¸€è¡Œè®°å½•ä¸­é™¤ä¸»é”®å¤–çš„æ•°æ®ã€‚å¯¹äºä¸åŒçš„è®°å½•ï¼Œkey å€¼äº’ä¸ç›¸åŒï¼ŒBTree ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ ¹æ®å®é™…æƒ…å†µå¯ä»¥åŒ…å«å¤§é‡çš„å…³é”®å­—ä¿¡æ¯å’Œåˆ†æ”¯<br><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/ç´¢å¼•çš„åŸç†1.png" alt="" loading="lazy"></p><p>ç¼ºç‚¹ï¼šå½“è¿›è¡ŒèŒƒå›´æŸ¥æ‰¾æ—¶ä¼šå‡ºç°å›æ—‹æŸ¥æ‰¾</p><hr><h4 id="b-tree" tabindex="-1"><a class="header-anchor" href="#b-tree" aria-hidden="true">#</a> B+Tree</h4><h5 id="æ•°æ®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#æ•°æ®ç»“æ„" aria-hidden="true">#</a> æ•°æ®ç»“æ„</h5><p>BTree æ•°æ®ç»“æ„ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸­ä¸ä»…åŒ…å«æ•°æ®çš„ key å€¼ï¼Œè¿˜æœ‰ data å€¼ã€‚ç£ç›˜ä¸­æ¯ä¸€é¡µçš„å­˜å‚¨ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¦‚æœ data æ•°æ®è¾ƒå¤§æ—¶å°†ä¼šå¯¼è‡´æ¯ä¸ªèŠ‚ç‚¹ï¼ˆå³ä¸€ä¸ªé¡µï¼‰èƒ½å­˜å‚¨çš„ key çš„æ•°é‡å¾ˆå°ï¼Œå½“å­˜å‚¨çš„æ•°æ®é‡å¾ˆå¤§æ—¶åŒæ ·ä¼šå¯¼è‡´ B-Tree çš„æ·±åº¦è¾ƒå¤§ï¼Œå¢å¤§æŸ¥è¯¢æ—¶çš„ç£ç›˜ I/O æ¬¡æ•°ï¼Œè¿›è€Œå½±å“æŸ¥è¯¢æ•ˆç‡ï¼Œæ‰€ä»¥å¼•å…¥ B+Tree</p><p>B+Tree ä¸º BTree çš„å˜ç§ï¼ŒB+Tree ä¸ BTree çš„åŒºåˆ«ä¸ºï¼š</p><ul><li>n å‰ B+Tree æœ€å¤šå«æœ‰ n ä¸ª keyï¼ˆå“ˆå¸Œå€¼ï¼‰ï¼Œè€Œ BTree æœ€å¤šå«æœ‰ n-1 ä¸ª key</li></ul><ul><li>æ‰€æœ‰<strong>éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼ key</strong> ä¿¡æ¯ï¼Œåªè¿›è¡Œæ•°æ®ç´¢å¼•ï¼Œä½¿æ¯ä¸ªéå¶å­èŠ‚ç‚¹æ‰€èƒ½ä¿å­˜çš„å…³é”®å­—å¤§å¤§å¢åŠ </li><li>æ‰€æœ‰<strong>æ•°æ®éƒ½å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹</strong>ï¼Œæ‰€ä»¥æ¯æ¬¡æ•°æ®æŸ¥è¯¢çš„æ¬¡æ•°éƒ½ä¸€æ ·</li><li><strong>å¶å­èŠ‚ç‚¹æŒ‰ç…§ key å¤§å°é¡ºåºæ’åˆ—ï¼Œå·¦è¾¹ç»“å°¾æ•°æ®éƒ½ä¼šä¿å­˜å³è¾¹èŠ‚ç‚¹å¼€å§‹æ•°æ®çš„æŒ‡é’ˆï¼Œå½¢æˆä¸€ä¸ªé“¾è¡¨</strong></li><li>æ‰€æœ‰èŠ‚ç‚¹ä¸­çš„ key åœ¨å¶å­èŠ‚ç‚¹ä¸­ä¹Ÿå­˜åœ¨ï¼ˆæ¯”å¦‚ 5)ï¼Œ<strong>key å…è®¸é‡å¤</strong>ï¼ŒB æ ‘ä¸åŒèŠ‚ç‚¹ä¸å­˜åœ¨é‡å¤çš„ key</li></ul><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-BåŠ Treeæ•°æ®ç»“æ„.png" style="zoom:67%;"><p>B* æ ‘ï¼šæ˜¯ B+ æ ‘çš„å˜ä½“ï¼Œåœ¨ B+ æ ‘çš„éæ ¹å’Œéå¶å­ç»“ç‚¹å†å¢åŠ æŒ‡å‘å…„å¼Ÿçš„æŒ‡é’ˆ</p><hr><h5 id="ä¼˜åŒ–ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–ç»“æ„" aria-hidden="true">#</a> ä¼˜åŒ–ç»“æ„</h5><p>MySQL ç´¢å¼•æ•°æ®ç»“æ„å¯¹ç»å…¸çš„ B+Tree è¿›è¡Œäº†ä¼˜åŒ–ï¼Œåœ¨åŸ B+Tree çš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºæŒ‡é’ˆçš„ B+Treeï¼Œ<strong>æé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œé˜²æ­¢å›æ—‹æŸ¥æ‰¾</strong></p><p>åŒºé—´è®¿é—®çš„æ„æ€æ˜¯è®¿é—®ç´¢å¼•ä¸º 5 - 15 çš„æ•°æ®ï¼Œå¯ä»¥ç›´æ¥æ ¹æ®ç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆéå†</p><p>B+ æ ‘çš„<strong>å¶å­èŠ‚ç‚¹æ˜¯æ•°æ®é¡µ</strong>ï¼ˆpageï¼‰ï¼Œä¸€ä¸ªé¡µé‡Œé¢å¯ä»¥å­˜å¤šä¸ªæ•°æ®è¡Œ</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/ç´¢å¼•çš„åŸç†2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>é€šå¸¸åœ¨ B+Tree ä¸Šæœ‰ä¸¤ä¸ªå¤´æŒ‡é’ˆï¼Œ<strong>ä¸€ä¸ªæŒ‡å‘æ ¹èŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªæŒ‡å‘å…³é”®å­—æœ€å°çš„å¶å­èŠ‚ç‚¹</strong>ï¼Œè€Œä¸”æ‰€æœ‰å¶å­èŠ‚ç‚¹ï¼ˆå³æ•°æ®èŠ‚ç‚¹ï¼‰ä¹‹é—´æ˜¯ä¸€ç§é“¾å¼ç¯ç»“æ„ã€‚å¯ä»¥å¯¹ B+Tree è¿›è¡Œä¸¤ç§æŸ¥æ‰¾è¿ç®—ï¼š</p><ul><li>æœ‰èŒƒå›´ï¼šå¯¹äºä¸»é”®çš„èŒƒå›´æŸ¥æ‰¾å’Œåˆ†é¡µæŸ¥æ‰¾</li><li>æœ‰é¡ºåºï¼šä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œè¿›è¡ŒéšæœºæŸ¥æ‰¾ï¼Œé¡ºåºæŸ¥æ‰¾</li></ul><p>InnoDB ä¸­æ¯ä¸ªæ•°æ®é¡µçš„å¤§å°é»˜è®¤æ˜¯ 16KBï¼Œ</p><ul><li>ç´¢å¼•è¡Œï¼šä¸€èˆ¬è¡¨çš„ä¸»é”®ç±»å‹ä¸º INTï¼ˆ4 å­—èŠ‚ï¼‰æˆ– BIGINTï¼ˆ8 å­—èŠ‚ï¼‰ï¼ŒæŒ‡é’ˆå¤§å°åœ¨ InnoDB ä¸­è®¾ç½®ä¸º 6 å­—èŠ‚èŠ‚ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªé¡µå¤§æ¦‚å­˜å‚¨ 16KB/(8B+6B)=1K ä¸ªé”®å€¼ï¼ˆä¼°å€¼ï¼‰ã€‚åˆ™ä¸€ä¸ªæ·±åº¦ä¸º 3 çš„ B+Tree ç´¢å¼•å¯ä»¥ç»´æŠ¤ <code>10^3 * 10^3 * 10^3 = 10äº¿</code> æ¡è®°å½•</li><li>æ•°æ®è¡Œï¼šä¸€è¡Œæ•°æ®çš„å¤§å°å¯èƒ½æ˜¯ 1kï¼Œä¸€ä¸ªæ•°æ®é¡µå¯ä»¥å­˜å‚¨ 16 è¡Œ</li></ul><p>å®é™…æƒ…å†µä¸­æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½ä¸èƒ½å¡«å……æ»¡ï¼Œå› æ­¤åœ¨æ•°æ®åº“ä¸­ï¼ŒB+Tree çš„é«˜åº¦ä¸€èˆ¬éƒ½åœ¨ 2-4 å±‚ã€‚MySQL çš„ InnoDB å­˜å‚¨å¼•æ“åœ¨è®¾è®¡æ—¶æ˜¯<strong>å°†æ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜çš„</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æŸ¥æ‰¾æŸä¸€é”®å€¼çš„è¡Œè®°å½•æ—¶æœ€å¤šåªéœ€è¦ 1~3 æ¬¡ç£ç›˜ I/O æ“ä½œ</p><p>B+Tree ä¼˜ç‚¹ï¼šæé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œå‡å°‘ç£ç›˜çš„ IO æ¬¡æ•°ï¼Œæ ‘å½¢ç»“æ„è¾ƒå°</p><hr><h5 id="ç´¢å¼•ç»´æŠ¤" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ç»´æŠ¤" aria-hidden="true">#</a> ç´¢å¼•ç»´æŠ¤</h5><p>B+ æ ‘ä¸ºäº†ä¿æŒç´¢å¼•çš„æœ‰åºæ€§ï¼Œåœ¨æ’å…¥æ–°å€¼çš„æ—¶å€™éœ€è¦åšç›¸åº”çš„ç»´æŠ¤</p><p>æ¯ä¸ªç´¢å¼•ä¸­æ¯ä¸ªå—å­˜å‚¨åœ¨ç£ç›˜é¡µä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœæ‰€åœ¨çš„æ•°æ®é¡µå·²ç»æ»¡äº†ï¼Œè¿™æ—¶å€™éœ€è¦ç”³è¯·ä¸€ä¸ªæ–°çš„æ•°æ®é¡µï¼Œç„¶åæŒªåŠ¨éƒ¨åˆ†æ•°æ®è¿‡å»ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸º<strong>é¡µåˆ†è£‚</strong>ï¼ŒåŸæœ¬æ”¾åœ¨ä¸€ä¸ªé¡µçš„æ•°æ®ç°åœ¨åˆ†åˆ°ä¸¤ä¸ªé¡µä¸­ï¼Œé™ä½äº†ç©ºé—´åˆ©ç”¨ç‡</li><li>å½“ç›¸é‚»ä¸¤ä¸ªé¡µç”±äºåˆ é™¤äº†æ•°æ®ï¼Œåˆ©ç”¨ç‡å¾ˆä½ä¹‹åï¼Œä¼šå°†æ•°æ®é¡µåš<strong>é¡µåˆå¹¶</strong>ï¼Œåˆå¹¶çš„è¿‡ç¨‹å¯ä»¥è®¤ä¸ºæ˜¯åˆ†è£‚è¿‡ç¨‹çš„é€†è¿‡ç¨‹</li><li>è¿™ä¸¤ä¸ªæƒ…å†µéƒ½æ˜¯ç”± B+ æ ‘çš„ç»“æ„å†³å®šçš„</li></ul><p>ä¸€èˆ¬é€‰ç”¨æ•°æ®å°çš„å­—æ®µåšç´¢å¼•ï¼Œå­—æ®µé•¿åº¦è¶Šå°ï¼Œæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹å°±è¶Šå°ï¼Œæ™®é€šç´¢å¼•å ç”¨çš„ç©ºé—´ä¹Ÿå°±è¶Šå°</p><p>è‡ªå¢ä¸»é”®çš„æ’å…¥æ•°æ®æ¨¡å¼ï¼Œå¯ä»¥è®©ä¸»é”®ç´¢å¼•å°½é‡åœ°ä¿æŒé€’å¢é¡ºåºæ’å…¥ï¼Œä¸æ¶‰åŠåˆ°æŒªåŠ¨å…¶ä»–è®°å½•ï¼Œ<strong>é¿å…äº†é¡µåˆ†è£‚</strong>ï¼Œé¡µåˆ†è£‚çš„ç›®çš„å°±æ˜¯ä¿è¯åä¸€ä¸ªæ•°æ®é¡µä¸­çš„æ‰€æœ‰è¡Œä¸»é”®å€¼æ¯”å‰ä¸€ä¸ªæ•°æ®é¡µä¸­ä¸»é”®å€¼å¤§</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://developer.aliyun.com/article/919861" target="_blank" rel="noopener noreferrer">https://developer.aliyun.com/article/919861<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h3 id="è®¾è®¡åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#è®¾è®¡åŸåˆ™" aria-hidden="true">#</a> è®¾è®¡åŸåˆ™</h3><p>ç´¢å¼•çš„è®¾è®¡å¯ä»¥éµå¾ªä¸€äº›å·²æœ‰çš„åŸåˆ™ï¼Œåˆ›å»ºç´¢å¼•çš„æ—¶å€™è¯·å°½é‡è€ƒè™‘ç¬¦åˆè¿™äº›åŸåˆ™ï¼Œä¾¿äºæå‡ç´¢å¼•çš„ä½¿ç”¨æ•ˆç‡</p><p>åˆ›å»ºç´¢å¼•æ—¶çš„åŸåˆ™ï¼š</p><ul><li>å¯¹æŸ¥è¯¢é¢‘æ¬¡è¾ƒé«˜ï¼Œä¸”æ•°æ®é‡æ¯”è¾ƒå¤§çš„è¡¨å»ºç«‹ç´¢å¼•</li><li>ä½¿ç”¨å”¯ä¸€ç´¢å¼•ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜</li><li>ç´¢å¼•å­—æ®µçš„é€‰æ‹©ï¼Œæœ€ä½³å€™é€‰åˆ—åº”å½“ä» where å­å¥çš„æ¡ä»¶ä¸­æå–ï¼Œä½¿ç”¨è¦†ç›–ç´¢å¼•</li><li>ä½¿ç”¨çŸ­ç´¢å¼•ï¼Œç´¢å¼•åˆ›å»ºä¹‹åä¹Ÿæ˜¯ä½¿ç”¨ç¡¬ç›˜æ¥å­˜å‚¨çš„ï¼Œå› æ­¤æå‡ç´¢å¼•è®¿é—®çš„ I/O æ•ˆç‡ï¼Œä¹Ÿå¯ä»¥æå‡æ€»ä½“çš„è®¿é—®æ•ˆç‡ã€‚å‡å¦‚æ„æˆç´¢å¼•çš„å­—æ®µæ€»é•¿åº¦æ¯”è¾ƒçŸ­ï¼Œé‚£ä¹ˆåœ¨ç»™å®šå¤§å°çš„å­˜å‚¨å—å†…å¯ä»¥å­˜å‚¨æ›´å¤šçš„ç´¢å¼•å€¼ï¼Œç›¸åº”çš„å¯ä»¥æœ‰æ•ˆçš„æå‡ MySQL è®¿é—®ç´¢å¼•çš„ I/O æ•ˆç‡</li><li>ç´¢å¼•å¯ä»¥æœ‰æ•ˆçš„æå‡æŸ¥è¯¢æ•°æ®çš„æ•ˆç‡ï¼Œä½†ç´¢å¼•æ•°é‡ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•çš„ä»£ä»·è¶Šé«˜ã€‚å¯¹äºæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰ DML æ“ä½œæ¯”è¾ƒé¢‘ç¹çš„è¡¨æ¥è¯´ï¼Œç´¢å¼•è¿‡å¤šï¼Œä¼šå¼•å…¥ç›¸å½“é«˜çš„ç»´æŠ¤ä»£ä»·ï¼Œé™ä½ DML æ“ä½œçš„æ•ˆç‡ï¼Œå¢åŠ ç›¸åº”æ“ä½œçš„æ—¶é—´æ¶ˆè€—ï¼›å¦å¤–ç´¢å¼•è¿‡å¤šçš„è¯ï¼ŒMySQL ä¹Ÿä¼šçŠ¯é€‰æ‹©å›°éš¾ç—…ï¼Œè™½ç„¶æœ€ç»ˆä»ç„¶ä¼šæ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„ç´¢å¼•ï¼Œä½†æé«˜äº†é€‰æ‹©çš„ä»£ä»·</li></ul><ul><li><p>MySQL å»ºç«‹è”åˆç´¢å¼•æ—¶ä¼šéµå®ˆ<strong>æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™</strong>ï¼Œå³æœ€å·¦ä¼˜å…ˆï¼Œåœ¨æ£€ç´¢æ•°æ®æ—¶ä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…</p><p>N ä¸ªåˆ—ç»„åˆè€Œæˆçš„ç»„åˆç´¢å¼•ï¼Œç›¸å½“äºåˆ›å»ºäº† N ä¸ªç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢æ—¶ where å¥ä¸­ä½¿ç”¨äº†ç»„æˆè¯¥ç´¢å¼•çš„<strong>å‰</strong>å‡ ä¸ªå­—æ®µï¼Œé‚£ä¹ˆè¿™æ¡æŸ¥è¯¢ SQL å¯ä»¥åˆ©ç”¨ç»„åˆç´¢å¼•æ¥æå‡æŸ¥è¯¢æ•ˆç‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- å¯¹nameã€addressã€phoneåˆ—å»ºä¸€ä¸ªè”åˆç´¢å¼•
ALTER TABLE user ADD INDEX index_three(name,address,phone);
-- æŸ¥è¯¢è¯­å¥æ‰§è¡Œæ—¶ä¼šä¾ç…§æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ï¼Œæ£€ç´¢æ—¶åˆ†åˆ«ä¼šä½¿ç”¨ç´¢å¼•è¿›è¡Œæ•°æ®åŒ¹é…ã€‚
(name,address,phone)
(name,address)
(name,phone)	-- åªæœ‰nameå­—æ®µèµ°äº†ç´¢å¼•
(name)

-- ç´¢å¼•çš„å­—æ®µå¯ä»¥æ˜¯ä»»æ„é¡ºåºçš„ï¼Œä¼˜åŒ–å™¨ä¼šå¸®åŠ©æˆ‘ä»¬è°ƒæ•´é¡ºåºï¼Œä¸‹é¢çš„SQLè¯­å¥å¯ä»¥å‘½ä¸­ç´¢å¼•
SELECT * FROM user WHERE address = &#39;åŒ—äº¬&#39; AND phone = &#39;12345&#39; AND name = &#39;å¼ ä¸‰&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- å¦‚æœè”åˆç´¢å¼•ä¸­æœ€å·¦è¾¹çš„åˆ—ä¸åŒ…å«åœ¨æ¡ä»¶æŸ¥è¯¢ä¸­ï¼ŒSQLè¯­å¥å°±ä¸ä¼šå‘½ä¸­ç´¢å¼•ï¼Œæ¯”å¦‚ï¼š
SELECT * FROM user WHERE address = &#39;åŒ—äº¬&#39; AND phone = &#39;12345&#39;; 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>å“ªäº›æƒ…å†µä¸è¦å»ºç«‹ç´¢å¼•ï¼š</p><ul><li>è®°å½•å¤ªå°‘çš„è¡¨</li><li>ç»å¸¸å¢åˆ æ”¹çš„è¡¨</li><li>é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸é€‚åˆåˆ›å»ºç´¢å¼•</li><li>where æ¡ä»¶é‡Œç”¨ä¸åˆ°çš„å­—æ®µä¸åˆ›å»ºç´¢å¼•</li></ul><hr><h3 id="ç´¢å¼•ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ä¼˜åŒ–" aria-hidden="true">#</a> ç´¢å¼•ä¼˜åŒ–</h3><h4 id="è¦†ç›–ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#è¦†ç›–ç´¢å¼•" aria-hidden="true">#</a> è¦†ç›–ç´¢å¼•</h4><p>è¦†ç›–ç´¢å¼•ï¼šåŒ…å«æ‰€æœ‰æ»¡è¶³æŸ¥è¯¢éœ€è¦çš„æ•°æ®çš„ç´¢å¼•ï¼ˆSELECT åé¢çš„å­—æ®µåˆšå¥½æ˜¯ç´¢å¼•å­—æ®µï¼‰ï¼Œå¯ä»¥åˆ©ç”¨è¯¥ç´¢å¼•è¿”å› SELECT åˆ—è¡¨çš„å­—æ®µï¼Œè€Œä¸å¿…æ ¹æ®ç´¢å¼•å»èšç°‡ç´¢å¼•ä¸Šè¯»å–æ•°æ®æ–‡ä»¶</p><p>å›è¡¨æŸ¥è¯¢ï¼šè¦æŸ¥æ‰¾çš„å­—æ®µä¸åœ¨éä¸»é”®ç´¢å¼•æ ‘ä¸Šæ—¶ï¼Œéœ€è¦é€šè¿‡å¶å­èŠ‚ç‚¹çš„ä¸»é”®å€¼å»ä¸»é”®ç´¢å¼•ä¸Šè·å–å¯¹åº”çš„è¡Œæ•°æ®</p><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé˜²æ­¢å›è¡¨æŸ¥è¯¢ï¼š</p><ul><li><p>è¡¨ user ä¸»é”®ä¸º idï¼Œæ™®é€šç´¢å¼•ä¸º ageï¼ŒæŸ¥è¯¢è¯­å¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM user WHERE age = 30;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŸ¥è¯¢è¿‡ç¨‹ï¼šå…ˆé€šè¿‡æ™®é€šç´¢å¼• age=30 å®šä½åˆ°ä¸»é”®å€¼ id=1ï¼Œå†é€šè¿‡èšé›†ç´¢å¼• id=1 å®šä½åˆ°è¡Œè®°å½•æ•°æ®ï¼Œéœ€è¦ä¸¤æ¬¡æ‰«æ B+ æ ‘</p></li><li><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP INDEX idx_age ON user;
CREATE INDEX idx_age_name ON user(age,name);
SELECT id,age FROM user WHERE age = 30;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸€æ£µç´¢å¼•æ ‘ä¸Šå°±èƒ½è·å–æŸ¥è¯¢æ‰€éœ€çš„æ•°æ®ï¼Œæ— éœ€å›è¡¨é€Ÿåº¦æ›´å¿«</p></li></ul><p>ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œè¦æ³¨æ„ SELECT åˆ—è¡¨ä¸­åªå–å‡ºéœ€è¦çš„åˆ—ï¼Œä¸å¯ç”¨ SELECT *ï¼Œæ‰€æœ‰å­—æ®µä¸€èµ·åšç´¢å¼•ä¼šå¯¼è‡´ç´¢å¼•æ–‡ä»¶è¿‡å¤§ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¸‹é™</p><hr><h4 id="ç´¢å¼•ä¸‹æ¨" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ä¸‹æ¨" aria-hidden="true">#</a> ç´¢å¼•ä¸‹æ¨</h4><p>ç´¢å¼•æ¡ä»¶ä¸‹æ¨ä¼˜åŒ–ï¼ˆIndex Condition Pushdownï¼ŒICPï¼‰æ˜¯ MySQL5.6 æ·»åŠ ï¼Œå¯ä»¥åœ¨ç´¢å¼•éå†è¿‡ç¨‹ä¸­ï¼Œå¯¹ç´¢å¼•ä¸­åŒ…å«çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œç›´æ¥è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°</p><p>ç´¢å¼•ä¸‹æ¨å……åˆ†åˆ©ç”¨äº†ç´¢å¼•ä¸­çš„æ•°æ®ï¼Œåœ¨æŸ¥è¯¢å‡ºæ•´è¡Œæ•°æ®ä¹‹å‰è¿‡æ»¤æ‰æ— æ•ˆçš„æ•°æ®ï¼Œå†å»ä¸»é”®ç´¢å¼•æ ‘ä¸ŠæŸ¥æ‰¾</p><ul><li><p>ä¸ä½¿ç”¨ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–æ—¶å­˜å‚¨å¼•æ“é€šè¿‡ç´¢å¼•æ£€ç´¢åˆ°æ•°æ®ï¼Œç„¶åå›è¡¨æŸ¥è¯¢è®°å½•è¿”å›ç»™ Server å±‚ï¼Œ<strong>æœåŠ¡å™¨åˆ¤æ–­æ•°æ®æ˜¯å¦ç¬¦åˆæ¡ä»¶</strong></p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¸ä½¿ç”¨ç´¢å¼•ä¸‹æ¨.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>ä½¿ç”¨ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–æ—¶ï¼Œå¦‚æœ<strong>å­˜åœ¨æŸäº›è¢«ç´¢å¼•çš„åˆ—çš„åˆ¤æ–­æ¡ä»¶</strong>æ—¶ï¼Œç”±å­˜å‚¨å¼•æ“åœ¨ç´¢å¼•éå†çš„è¿‡ç¨‹ä¸­åˆ¤æ–­æ•°æ®æ˜¯å¦ç¬¦åˆä¼ é€’çš„æ¡ä»¶ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„æ•°æ®è¿›è¡Œå›è¡¨ï¼Œæ£€ç´¢å‡ºæ¥è¿”å›ç»™æœåŠ¡å™¨ï¼Œç”±æ­¤å‡å°‘ IO æ¬¡æ•°</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä½¿ç”¨ç´¢å¼•ä¸‹æ¨.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul><p><strong>é€‚ç”¨æ¡ä»¶</strong>ï¼š</p><ul><li>éœ€è¦å­˜å‚¨å¼•æ“å°†ç´¢å¼•ä¸­çš„æ•°æ®ä¸æ¡ä»¶è¿›è¡Œåˆ¤æ–­ï¼ˆæ‰€ä»¥<strong>æ¡ä»¶åˆ—å¿…é¡»éƒ½åœ¨åŒä¸€ä¸ªç´¢å¼•ä¸­</strong>ï¼‰ï¼Œæ‰€ä»¥ä¼˜åŒ–æ˜¯åŸºäºå­˜å‚¨å¼•æ“çš„ï¼Œåªæœ‰ç‰¹å®šå¼•æ“å¯ä»¥ä½¿ç”¨ï¼Œé€‚ç”¨äº InnoDB å’Œ MyISAM</li><li>å­˜å‚¨å¼•æ“æ²¡æœ‰è°ƒç”¨è·¨å­˜å‚¨å¼•æ“çš„èƒ½åŠ›ï¼Œè·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½æœ‰å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ï¼Œæ‰€ä»¥è°ƒç”¨è¿™äº›åŠŸèƒ½çš„ä¸å¯ä»¥è¿›è¡Œç´¢å¼•ä¸‹æ¨ä¼˜åŒ–</li><li>å¯¹äº InnoDB å¼•æ“åªé€‚ç”¨äºäºŒçº§ç´¢å¼•ï¼ŒInnoDB çš„èšç°‡ç´¢å¼•ä¼šå°†æ•´è¡Œæ•°æ®è¯»åˆ°ç¼“å†²åŒºï¼Œä¸å†éœ€è¦å»å›è¡¨æŸ¥è¯¢äº†</li></ul><p>å·¥ä½œè¿‡ç¨‹ï¼šç”¨æˆ·è¡¨ userï¼Œ(name, age) æ˜¯è”åˆç´¢å¼•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM user WHERE name LIKE &#39;å¼ %&#39; ANDã€€age = 10;	-- å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…ä¼šé€ æˆç´¢å¼•å¤±æ•ˆ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><p>ä¼˜åŒ–å‰ï¼šåœ¨éä¸»é”®ç´¢å¼•æ ‘ä¸Šæ‰¾åˆ°æ»¡è¶³ç¬¬ä¸€ä¸ªæ¡ä»¶çš„è¡Œï¼Œç„¶åé€šè¿‡å¶å­èŠ‚ç‚¹è®°å½•çš„ä¸»é”®å€¼å†å›åˆ°ä¸»é”®ç´¢å¼•æ ‘ä¸ŠæŸ¥æ‰¾åˆ°å¯¹åº”çš„è¡Œæ•°æ®ï¼Œå†å¯¹æ¯” AND åçš„æ¡ä»¶æ˜¯å¦ç¬¦åˆï¼Œç¬¦åˆè¿”å›æ•°æ®ï¼Œéœ€è¦ 4 æ¬¡å›è¡¨</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>ä¼˜åŒ–åï¼šæ£€æŸ¥ç´¢å¼•ä¸­å­˜å‚¨çš„åˆ—ä¿¡æ¯æ˜¯å¦ç¬¦åˆç´¢å¼•æ¡ä»¶ï¼Œç„¶åäº¤ç”±å­˜å‚¨å¼•æ“ç”¨å‰©ä½™çš„åˆ¤æ–­æ¡ä»¶åˆ¤æ–­æ­¤è¡Œæ•°æ®æ˜¯å¦ç¬¦åˆè¦æ±‚ï¼Œ<strong>ä¸æ»¡è¶³æ¡ä»¶çš„ä¸å»è¯»å–è¡¨ä¸­çš„æ•°æ®</strong>ï¼Œæ»¡è¶³ä¸‹æ¨æ¡ä»¶çš„å°±æ ¹æ®ä¸»é”®å€¼è¿›è¡Œå›è¡¨æŸ¥è¯¢ï¼Œ2 æ¬¡å›è¡¨<br><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–2.png" alt="" loading="lazy"></p></li></ul><p>å½“ä½¿ç”¨ EXPLAIN è¿›è¡Œåˆ†ææ—¶ï¼Œå¦‚æœä½¿ç”¨äº†ç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼ŒExtra ä¼šæ˜¾ç¤º Using index condition</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/sinat_29774479/article/details/103470244" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/sinat_29774479/article/details/103470244<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://time.geekbang.org/column/article/69636" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/69636<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="å‰ç¼€ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#å‰ç¼€ç´¢å¼•" aria-hidden="true">#</a> å‰ç¼€ç´¢å¼•</h4><p>å½“è¦ç´¢å¼•çš„åˆ—å­—ç¬¦å¾ˆå¤šæ—¶ï¼Œç´¢å¼•ä¼šå˜å¤§å˜æ…¢ï¼Œå¯ä»¥åªç´¢å¼•åˆ—å¼€å§‹çš„éƒ¨åˆ†å­—ç¬¦ä¸²ï¼ŒèŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œæé«˜ç´¢å¼•æ•ˆç‡</p><p>æ³¨æ„ï¼šä½¿ç”¨å‰ç¼€ç´¢å¼•å°±ç³»ç»Ÿå°±å¿½ç•¥è¦†ç›–ç´¢å¼•å¯¹æŸ¥è¯¢æ€§èƒ½çš„ä¼˜åŒ–äº†</p><p>ä¼˜åŒ–åŸåˆ™ï¼š<strong>é™ä½é‡å¤çš„ç´¢å¼•å€¼</strong></p><p>æ¯”å¦‚åœ°åŒºè¡¨ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>area			gdp		code
chinaShanghai	100		aaa
chinaDalian		200		bbb
usaNewYork		300		ccc
chinaFuxin		400		ddd
chinaBeijing	500		eee
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‘ç° area å­—æ®µå¾ˆå¤šéƒ½æ˜¯ä»¥ china å¼€å¤´çš„ï¼Œé‚£ä¹ˆå¦‚æœä»¥å‰ 1-5 ä½å­—ç¬¦åšå‰ç¼€ç´¢å¼•å°±ä¼šå‡ºç°å¤§é‡ç´¢å¼•å€¼é‡å¤çš„æƒ…å†µï¼Œç´¢å¼•å€¼é‡å¤æ€§è¶Šä½ï¼ŒæŸ¥è¯¢æ•ˆç‡ä¹Ÿå°±è¶Šé«˜ï¼Œæ‰€ä»¥éœ€è¦å»ºç«‹å‰ 6 ä½å­—ç¬¦çš„ç´¢å¼•ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE INDEX idx_area ON table_name(area(7));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœºæ™¯ï¼šå­˜å‚¨èº«ä»½è¯</p><ul><li>ç›´æ¥åˆ›å»ºå®Œæ•´ç´¢å¼•ï¼Œè¿™æ ·å¯èƒ½æ¯”è¾ƒå ç”¨ç©ºé—´</li><li>åˆ›å»ºå‰ç¼€ç´¢å¼•ï¼ŒèŠ‚çœç©ºé—´ï¼Œä½†ä¼šå¢åŠ æŸ¥è¯¢æ‰«ææ¬¡æ•°ï¼Œå¹¶ä¸”ä¸èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•</li><li>å€’åºå­˜å‚¨ï¼Œå†åˆ›å»ºå‰ç¼€ç´¢å¼•ï¼Œç”¨äºç»•è¿‡å­—ç¬¦ä¸²æœ¬èº«å‰ç¼€çš„åŒºåˆ†åº¦ä¸å¤Ÿçš„é—®é¢˜ï¼ˆå‰ 6 ä½ç›¸åŒçš„å¾ˆå¤šï¼‰</li><li>åˆ›å»º hash å­—æ®µç´¢å¼•ï¼ŒæŸ¥è¯¢æ€§èƒ½ç¨³å®šï¼Œæœ‰é¢å¤–çš„å­˜å‚¨å’Œè®¡ç®—æ¶ˆè€—ï¼Œè·Ÿç¬¬ä¸‰ç§æ–¹å¼ä¸€æ ·ï¼Œéƒ½ä¸æ”¯æŒèŒƒå›´æ‰«æ</li></ul><hr><h4 id="ç´¢å¼•åˆå¹¶" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•åˆå¹¶" aria-hidden="true">#</a> ç´¢å¼•åˆå¹¶</h4><p>ä½¿ç”¨å¤šä¸ªç´¢å¼•æ¥å®Œæˆä¸€æ¬¡æŸ¥è¯¢çš„æ‰§è¡Œæ–¹æ³•å«åšç´¢å¼•åˆå¹¶ index merge</p><ul><li><p>Intersection ç´¢å¼•åˆå¹¶ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_test <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span> <span class="token operator">AND</span> key3 <span class="token operator">=</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">;</span> <span class="token comment"># key1 å’Œ key3 åˆ—éƒ½æ˜¯å•åˆ—ç´¢å¼•ã€äºŒçº§ç´¢å¼•</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»ä¸åŒç´¢å¼•ä¸­æ‰«æåˆ°çš„è®°å½•çš„ id å€¼å–<strong>äº¤é›†</strong>ï¼ˆç›¸åŒ idï¼‰ï¼Œç„¶åæ‰§è¡Œå›è¡¨æ“ä½œï¼Œè¦æ±‚ä»æ¯ä¸ªäºŒçº§ç´¢å¼•è·å–åˆ°çš„è®°å½•éƒ½æ˜¯æŒ‰ç…§ä¸»é”®å€¼æ’åº</p></li><li><p>Union ç´¢å¼•åˆå¹¶ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_test <span class="token keyword">WHERE</span> key1 <span class="token operator">=</span> <span class="token string">&#39;a&#39;</span> <span class="token operator">OR</span> key3 <span class="token operator">=</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»ä¸åŒç´¢å¼•ä¸­æ‰«æåˆ°çš„è®°å½•çš„ id å€¼å–<strong>å¹¶é›†</strong>ï¼Œç„¶åæ‰§è¡Œå›è¡¨æ“ä½œï¼Œè¦æ±‚ä»æ¯ä¸ªäºŒçº§ç´¢å¼•è·å–åˆ°çš„è®°å½•éƒ½æ˜¯æŒ‰ç…§ä¸»é”®å€¼æ’åº</p></li><li><p>Sort-Union ç´¢å¼•åˆå¹¶</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> table_test <span class="token keyword">WHERE</span> key1 <span class="token operator">&lt;</span> <span class="token string">&#39;a&#39;</span> <span class="token operator">OR</span> key3 <span class="token operator">&gt;</span> <span class="token string">&#39;b&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å…ˆå°†ä»ä¸åŒç´¢å¼•ä¸­æ‰«æåˆ°çš„è®°å½•çš„ä¸»é”®å€¼è¿›è¡Œæ’åºï¼Œå†æŒ‰ç…§ Union ç´¢å¼•åˆå¹¶çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢</p></li></ul><p>ç´¢å¼•åˆå¹¶ç®—æ³•çš„æ•ˆç‡å¹¶ä¸å¥½ï¼Œé€šè¿‡å°†å…¶ä¸­çš„ä¸€ä¸ªç´¢å¼•æ”¹æˆè”åˆç´¢å¼•ä¼šä¼˜åŒ–æ•ˆç‡</p><hr><h2 id="ç³»ç»Ÿä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ç³»ç»Ÿä¼˜åŒ–" aria-hidden="true">#</a> ç³»ç»Ÿä¼˜åŒ–</h2><h3 id="è¡¨ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#è¡¨ä¼˜åŒ–" aria-hidden="true">#</a> è¡¨ä¼˜åŒ–</h3><h4 id="åˆ†åŒºè¡¨" tabindex="-1"><a class="header-anchor" href="#åˆ†åŒºè¡¨" aria-hidden="true">#</a> åˆ†åŒºè¡¨</h4><h5 id="åŸºæœ¬ä»‹ç»-5" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-5" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h5><p>åˆ†åŒºè¡¨æ˜¯å°†å¤§è¡¨çš„æ•°æ®æŒ‰åˆ†åŒºå­—æ®µåˆ†æˆè®¸å¤šå°çš„å­é›†ï¼Œå»ºç«‹ä¸€ä¸ªä»¥ ftime å¹´ä»½ä¸ºåˆ†åŒºçš„è¡¨ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE `t` (
    `ftime` datetime NOT NULL,
    `c` int(11) DEFAULT NULL,
    KEY (`ftime`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1
PARTITION BY RANGE (YEAR(ftime))
(PARTITION p_2017 VALUES LESS THAN (2017) ENGINE = InnoDB,
 PARTITION p_2018 VALUES LESS THAN (2018) ENGINE = InnoDB,
 PARTITION p_2019 VALUES LESS THAN (2019) ENGINE = InnoDB,
 PARTITION p_others VALUES LESS THAN MAXVALUE ENGINE = InnoDB);
INSERT INTO t VALUES(&#39;2017-4-1&#39;,1),(&#39;2018-4-1&#39;,1);-- è¿™ä¸¤è¡Œè®°å½•åˆ†åˆ«è½åœ¨ p_2018 å’Œ p_2019 è¿™ä¸¤ä¸ªåˆ†åŒºä¸Š
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªè¡¨åŒ…å«äº†ä¸€ä¸ª.frm æ–‡ä»¶å’Œ 4 ä¸ª.ibd æ–‡ä»¶ï¼Œæ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ª.ibd æ–‡ä»¶</p><ul><li>å¯¹äºå¼•æ“å±‚æ¥è¯´ï¼Œè¿™æ˜¯ 4 ä¸ªè¡¨ï¼Œé’ˆå¯¹æ¯ä¸ªåˆ†åŒºè¡¨çš„æ“ä½œä¸ä¼šç›¸äº’å½±å“</li><li>å¯¹äº Server å±‚æ¥è¯´ï¼Œè¿™æ˜¯ 1 ä¸ªè¡¨</li></ul><hr><h5 id="åˆ†åŒºç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#åˆ†åŒºç­–ç•¥" aria-hidden="true">#</a> åˆ†åŒºç­–ç•¥</h5><p>æ‰“å¼€è¡¨è¡Œä¸ºï¼šç¬¬ä¸€æ¬¡è®¿é—®ä¸€ä¸ªåˆ†åŒºè¡¨æ—¶ï¼ŒMySQL éœ€è¦<strong>æŠŠæ‰€æœ‰çš„åˆ†åŒºéƒ½è®¿é—®ä¸€é</strong>ï¼Œå¦‚æœåˆ†åŒºè¡¨çš„æ•°é‡å¾ˆå¤šï¼Œè¶…è¿‡äº† open_files_limit å‚æ•°ï¼ˆé»˜è®¤å€¼ 1024ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è®¿é—®è¿™ä¸ªè¡¨æ—¶æ‰“å¼€æ‰€æœ‰çš„æ–‡ä»¶ï¼Œå¯¼è‡´æ‰“å¼€è¡¨æ–‡ä»¶çš„ä¸ªæ•°è¶…è¿‡äº†ä¸Šé™è€ŒæŠ¥é”™</p><p>é€šç”¨åˆ†åŒºç­–ç•¥ï¼šMyISAM åˆ†åŒºè¡¨ä½¿ç”¨çš„åˆ†åŒºç­–ç•¥ï¼Œæ¯æ¬¡è®¿é—®åˆ†åŒºéƒ½ç”± Server å±‚æ§åˆ¶ï¼Œåœ¨æ–‡ä»¶ç®¡ç†ã€è¡¨ç®¡ç†çš„å®ç°ä¸Šå¾ˆç²—ç³™ï¼Œå› æ­¤æœ‰æ¯”è¾ƒä¸¥é‡çš„æ€§èƒ½é—®é¢˜</p><p>æœ¬åœ°åˆ†åŒºç­–ç•¥ï¼šä» MySQL 5.7.9 å¼€å§‹ï¼ŒInnoDB å¼•æ“å†…éƒ¨è‡ªå·±ç®¡ç†æ‰“å¼€åˆ†åŒºçš„è¡Œä¸ºï¼ŒInnoDB å¼•æ“æ‰“å¼€æ–‡ä»¶è¶…è¿‡ innodb_open_files æ—¶å°±ä¼š<strong>å…³æ‰ä¸€äº›ä¹‹å‰æ‰“å¼€çš„æ–‡ä»¶</strong>ï¼Œæ‰€ä»¥å³ä½¿åˆ†åŒºä¸ªæ•°å¤§äº open_files_limitï¼Œä¹Ÿä¸ä¼šæŠ¥é”™</p><p>ä» MySQL 8.0 ç‰ˆæœ¬å¼€å§‹ï¼Œå°±ä¸å…è®¸åˆ›å»º MyISAM åˆ†åŒºè¡¨ï¼Œåªå…è®¸åˆ›å»ºå·²ç»å®ç°äº†æœ¬åœ°åˆ†åŒºç­–ç•¥çš„å¼•æ“ï¼Œç›®å‰åªæœ‰ InnoDB å’Œ NDB è¿™ä¸¤ä¸ªå¼•æ“æ”¯æŒäº†æœ¬åœ°åˆ†åŒºç­–ç•¥</p><hr><h5 id="server-å±‚" tabindex="-1"><a class="header-anchor" href="#server-å±‚" aria-hidden="true">#</a> Server å±‚</h5><p>ä» Server å±‚çœ‹ä¸€ä¸ªåˆ†åŒºè¡¨å°±åªæ˜¯ä¸€ä¸ªè¡¨</p><ul><li><p>Session Aï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM t WHERE ftime = &#39;2018-4-1&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>Session Bï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ALTER TABLE t TRUNCATE PARTITION p_2017; -- blocked
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>ç°è±¡ï¼šSession B åªæ“ä½œ p_2017 åˆ†åŒºï¼Œä½†æ˜¯ç”±äº Session A æŒæœ‰æ•´ä¸ªè¡¨ t çš„ MDL è¯»é”ï¼Œå°±å¯¼è‡´ B çš„ ALTER è¯­å¥è·å– MDL å†™é”é˜»å¡</p><p>åˆ†åŒºè¡¨çš„ç‰¹ç‚¹ï¼š</p><ul><li>ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™éœ€è¦è®¿é—®æ‰€æœ‰åˆ†åŒº</li><li>åœ¨ Server å±‚è®¤ä¸ºè¿™æ˜¯åŒä¸€å¼ è¡¨ï¼Œå› æ­¤<strong>æ‰€æœ‰åˆ†åŒºå…±ç”¨åŒä¸€ä¸ª MDL é”</strong></li><li>åœ¨å¼•æ“å±‚è®¤ä¸ºè¿™æ˜¯ä¸åŒçš„è¡¨ï¼Œå› æ­¤ MDL é”ä¹‹åçš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæ ¹æ®åˆ†åŒºè¡¨è§„åˆ™ï¼Œåªè®¿é—®éœ€è¦çš„åˆ†åŒº</li></ul><hr><h5 id="åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯" aria-hidden="true">#</a> åº”ç”¨åœºæ™¯</h5><p>åˆ†åŒºè¡¨çš„ä¼˜ç‚¹ï¼š</p><ul><li><p>å¯¹ä¸šåŠ¡é€æ˜ï¼Œç›¸å¯¹äºç”¨æˆ·åˆ†è¡¨æ¥è¯´ï¼Œä½¿ç”¨åˆ†åŒºè¡¨çš„ä¸šåŠ¡ä»£ç æ›´ç®€æ´</p></li><li><p>åˆ†åŒºè¡¨å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ¸…ç†å†å²æ•°æ®ã€‚æŒ‰ç…§æ—¶é—´åˆ†åŒºçš„åˆ†åŒºè¡¨ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡ <code>alter table t drop partition</code> è¿™ä¸ªè¯­æ³•ç›´æ¥åˆ é™¤åˆ†åŒºæ–‡ä»¶ï¼Œä»è€Œåˆ æ‰è¿‡æœŸçš„å†å²æ•°æ®ï¼Œä¸ä½¿ç”¨ drop è¯­å¥åˆ é™¤æ•°æ®ç›¸æ¯”ï¼Œä¼˜åŠ¿æ˜¯é€Ÿåº¦å¿«ã€å¯¹ç³»ç»Ÿå½±å“å°</p></li></ul><p>ä½¿ç”¨åˆ†åŒºè¡¨ï¼Œä¸å»ºè®®åˆ›å»ºå¤ªå¤šçš„åˆ†åŒºï¼Œæ³¨æ„äº‹é¡¹ï¼š</p><ul><li>åˆ†åŒºå¹¶ä¸æ˜¯è¶Šç»†è¶Šå¥½ï¼Œå•è¡¨æˆ–è€…å•åˆ†åŒºçš„æ•°æ®ä¸€åƒä¸‡è¡Œï¼Œåªè¦æ²¡æœ‰ç‰¹åˆ«å¤§çš„ç´¢å¼•ï¼Œå¯¹äºç°åœ¨çš„ç¡¬ä»¶èƒ½åŠ›æ¥è¯´éƒ½å·²ç»æ˜¯å°è¡¨</li><li>åˆ†åŒºä¸è¦æå‰é¢„ç•™å¤ªå¤šï¼Œåœ¨ä½¿ç”¨ä¹‹å‰é¢„å…ˆåˆ›å»ºå³å¯ã€‚æ¯”å¦‚æ˜¯æŒ‰æœˆåˆ†åŒºï¼Œæ¯å¹´å¹´åº•æ—¶å†æŠŠä¸‹ä¸€å¹´åº¦çš„ 12 ä¸ªæ–°åˆ†åŒºåˆ›å»ºä¸Šå³å¯ï¼Œå¹¶ä¸”å¯¹äºæ²¡æœ‰æ•°æ®çš„å†å²åˆ†åŒºï¼Œè¦åŠæ—¶çš„ drop æ‰</li></ul><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://time.geekbang.org/column/article/82560" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/82560<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="ä¸´æ—¶è¡¨" tabindex="-1"><a class="header-anchor" href="#ä¸´æ—¶è¡¨" aria-hidden="true">#</a> ä¸´æ—¶è¡¨</h4><h5 id="åŸºæœ¬ä»‹ç»-6" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-6" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h5><p>ä¸´æ—¶è¡¨åˆ†ä¸ºå†…éƒ¨ä¸´æ—¶è¡¨å’Œç”¨æˆ·ä¸´æ—¶è¡¨</p><ul><li><p>å†…éƒ¨ä¸´æ—¶è¡¨ï¼šç³»ç»Ÿæ‰§è¡Œ SQL è¯­å¥ä¼˜åŒ–æ—¶äº§ç”Ÿçš„è¡¨ï¼Œä¾‹å¦‚ Join è¿æ¥æŸ¥è¯¢ã€å»é‡æŸ¥è¯¢ç­‰</p></li><li><p>ç”¨æˆ·ä¸´æ—¶è¡¨ï¼šç”¨æˆ·ä¸»åŠ¨åˆ›å»ºçš„ä¸´æ—¶è¡¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TEMPORARY TABLE temp_t like table_1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>ä¸´æ—¶è¡¨å¯ä»¥æ˜¯å†…å­˜è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ç£ç›˜è¡¨ï¼ˆå¤šè¡¨æ“ä½œ â†’ åµŒå¥—æŸ¥è¯¢ç« èŠ‚æåŠï¼‰</p><ul><li>å†…å­˜è¡¨æŒ‡çš„æ˜¯ä½¿ç”¨ Memory å¼•æ“çš„è¡¨ï¼Œå»ºç«‹å“ˆå¸Œç´¢å¼•ï¼Œå»ºè¡¨è¯­æ³•æ˜¯ <code>create table â€¦ engine=memory</code>ï¼Œè¿™ç§è¡¨çš„æ•°æ®éƒ½ä¿å­˜åœ¨å†…å­˜é‡Œï¼Œç³»ç»Ÿé‡å¯æ—¶ä¼šè¢«æ¸…ç©ºï¼Œä½†æ˜¯è¡¨ç»“æ„è¿˜åœ¨</li><li>ç£ç›˜è¡¨æ˜¯ä½¿ç”¨ InnoDB å¼•æ“æˆ–è€… MyISAM å¼•æ“çš„ä¸´æ—¶è¡¨ï¼Œå»ºç«‹ B+ æ ‘ç´¢å¼•ï¼Œå†™æ•°æ®çš„æ—¶å€™æ˜¯å†™åˆ°ç£ç›˜ä¸Šçš„</li></ul><p>ä¸´æ—¶è¡¨çš„ç‰¹ç‚¹ï¼š</p><ul><li>ä¸€ä¸ªä¸´æ—¶è¡¨åªèƒ½è¢«åˆ›å»ºå®ƒçš„ session è®¿é—®ï¼Œå¯¹å…¶ä»–çº¿ç¨‹ä¸å¯è§ï¼Œæ‰€ä»¥ä¸åŒ session çš„ä¸´æ—¶è¡¨æ˜¯<strong>å¯ä»¥é‡å</strong>çš„</li><li>ä¸´æ—¶è¡¨å¯ä»¥ä¸æ™®é€šè¡¨åŒåï¼Œä¼šè¯å†…æœ‰åŒåçš„ä¸´æ—¶è¡¨å’Œæ™®é€šè¡¨æ—¶ï¼Œæ‰§è¡Œ show create è¯­å¥ä»¥åŠå¢åˆ æ”¹æŸ¥è¯­å¥è®¿é—®çš„éƒ½æ˜¯ä¸´æ—¶è¡¨</li><li>show tables å‘½ä»¤ä¸æ˜¾ç¤ºä¸´æ—¶è¡¨</li><li>æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ä¸éœ€è¦æ‹…å¿ƒæ•°æ®åˆ é™¤é—®é¢˜ï¼Œä¸´æ—¶è¡¨ä¼š<strong>è‡ªåŠ¨å›æ”¶</strong></li></ul><hr><h5 id="é‡ååŸç†" tabindex="-1"><a class="header-anchor" href="#é‡ååŸç†" aria-hidden="true">#</a> é‡ååŸç†</h5><p>æ‰§è¡Œåˆ›å»ºä¸´æ—¶è¡¨çš„ SQLï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>create temporary table temp_t(id int primary key)engine=innodb;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>MySQL ç»™ InnoDB è¡¨åˆ›å»ºä¸€ä¸ª frm æ–‡ä»¶ä¿å­˜è¡¨ç»“æ„å®šä¹‰ï¼Œåœ¨ ibd ä¿å­˜è¡¨æ•°æ®ã€‚frm æ–‡ä»¶æ”¾åœ¨ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åçš„åç¼€æ˜¯ .frmï¼Œ<strong>å‰ç¼€æ˜¯</strong> <code>#sql{è¿›ç¨‹ id}_{çº¿ç¨‹ id}_ åºåˆ—å·</code>ï¼Œä½¿ç”¨ <code>select @@tmpdir</code> å‘½ä»¤ï¼Œæ¥æ˜¾ç¤ºå®ä¾‹çš„ä¸´æ—¶æ–‡ä»¶ç›®å½•</p><p>MySQL ç»´æŠ¤æ•°æ®è¡¨ï¼Œé™¤äº†ç‰©ç†ç£ç›˜ä¸Šçš„æ–‡ä»¶å¤–ï¼Œå†…å­˜é‡Œä¹Ÿæœ‰ä¸€å¥—æœºåˆ¶åŒºåˆ«ä¸åŒçš„è¡¨ï¼Œæ¯ä¸ªè¡¨éƒ½å¯¹åº”ä¸€ä¸ª table_def_key</p><ul><li>ä¸€ä¸ªæ™®é€šè¡¨çš„ table_def_key çš„å€¼æ˜¯ç”± <code>åº“å + è¡¨å</code> å¾—åˆ°çš„ï¼Œæ‰€ä»¥å¦‚æœåœ¨åŒä¸€ä¸ªåº“ä¸‹åˆ›å»ºä¸¤ä¸ªåŒåçš„æ™®é€šè¡¨ï¼Œåˆ›å»ºç¬¬äºŒä¸ªè¡¨çš„è¿‡ç¨‹ä¸­å°±ä¼šå‘ç° table_def_key å·²ç»å­˜åœ¨äº†</li><li>å¯¹äºä¸´æ—¶è¡¨ï¼Œtable_def_key åœ¨ <code>åº“å + è¡¨å</code> åŸºç¡€ä¸Šï¼ŒåˆåŠ å…¥äº† <code>server_id + thread_id</code>ï¼Œæ‰€ä»¥ä¸åŒçº¿ç¨‹ä¹‹é—´ï¼Œä¸´æ—¶è¡¨å¯ä»¥é‡å</li></ul><p>å®ç°åŸç†ï¼šæ¯ä¸ªçº¿ç¨‹éƒ½ç»´æŠ¤äº†è‡ªå·±çš„ä¸´æ—¶è¡¨é“¾è¡¨ï¼Œæ¯æ¬¡ session å†…æ“ä½œè¡¨æ—¶ï¼Œå…ˆéå†é“¾è¡¨ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰è¿™ä¸ªåå­—çš„ä¸´æ—¶è¡¨ï¼Œå¦‚æœæœ‰å°±<strong>ä¼˜å…ˆæ“ä½œä¸´æ—¶è¡¨</strong>ï¼Œå¦‚æœæ²¡æœ‰å†æ“ä½œæ™®é€šè¡¨ï¼›åœ¨ session ç»“æŸæ—¶å¯¹é“¾è¡¨é‡Œçš„æ¯ä¸ªä¸´æ—¶è¡¨ï¼Œæ‰§è¡Œ <code>DROP TEMPORARY TABLE + è¡¨å</code> æ“ä½œ</p><p>æ‰§è¡Œ rename table è¯­å¥æ— æ³•ä¿®æ”¹ä¸´æ—¶è¡¨ï¼Œå› ä¸ºä¼šæŒ‰ç…§ <code>åº“å / è¡¨å.frm</code> çš„è§„åˆ™å»ç£ç›˜æ‰¾æ–‡ä»¶ï¼Œä½†æ˜¯ä¸´æ—¶è¡¨æ–‡ä»¶åçš„è§„åˆ™æ˜¯ <code>#sql{è¿›ç¨‹ id}_{çº¿ç¨‹ id}_ åºåˆ—å·.frm</code>ï¼Œå› æ­¤ä¼šæŠ¥æ‰¾ä¸åˆ°æ–‡ä»¶åçš„é”™è¯¯</p><hr><h5 id="ä¸»å¤‡å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¸»å¤‡å¤åˆ¶" aria-hidden="true">#</a> ä¸»å¤‡å¤åˆ¶</h5><p>åˆ›å»ºä¸´æ—¶è¡¨çš„è¯­å¥ä¼šä¼ åˆ°å¤‡åº“æ‰§è¡Œï¼Œå› æ­¤å¤‡åº“çš„åŒæ­¥çº¿ç¨‹å°±ä¼šåˆ›å»ºè¿™ä¸ªä¸´æ—¶è¡¨ã€‚ä¸»åº“åœ¨çº¿ç¨‹é€€å‡ºæ—¶ä¼šè‡ªåŠ¨åˆ é™¤ä¸´æ—¶è¡¨ï¼Œä½†å¤‡åº“åŒæ­¥çº¿ç¨‹æ˜¯æŒç»­åœ¨è¿è¡Œçš„å¹¶ä¸ä¼šé€€å‡ºï¼Œæ‰€ä»¥è¿™æ—¶å°±éœ€è¦åœ¨ä¸»åº“ä¸Šå†å†™ä¸€ä¸ª DROP TEMPORARY TABLE ä¼ ç»™å¤‡åº“æ‰§è¡Œ</p><p>binlog æ—¥å¿—å†™å…¥è§„åˆ™ï¼š</p><ul><li>binlog_format=rowï¼Œè·Ÿä¸´æ—¶è¡¨æœ‰å…³çš„è¯­å¥å°±ä¸ä¼šè®°å½•åˆ° binlog</li><li>binlog_format=statment/mixedï¼Œbinlog ä¸­æ‰ä¼šè®°å½•ä¸´æ—¶è¡¨çš„æ“ä½œï¼Œä¹Ÿå°±ä¼šè®°å½• <code>DROP TEMPORARY TABLE</code> è¿™æ¡å‘½ä»¤</li></ul><p>ä¸»åº“ä¸Šä¸åŒçš„çº¿ç¨‹åˆ›å»ºåŒåçš„ä¸´æ—¶è¡¨æ˜¯ä¸å†²çªçš„ï¼Œä½†æ˜¯å¤‡åº“åªæœ‰ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹ï¼Œæ‰€ä»¥ MySQL åœ¨è®°å½• binlog æ—¶ä¼šæŠŠä¸»åº“æ‰§è¡Œè¿™ä¸ªè¯­å¥çš„çº¿ç¨‹ id å†™åˆ° binlog ä¸­ï¼Œåœ¨å¤‡åº“çš„åº”ç”¨çº¿ç¨‹å°±å¯ä»¥è·å–æ‰§è¡Œæ¯ä¸ªè¯­å¥çš„ä¸»åº“çº¿ç¨‹ idï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªçº¿ç¨‹ id æ¥æ„é€ ä¸´æ—¶è¡¨çš„ table_def_key</p><ul><li>session A çš„ä¸´æ—¶è¡¨ t1ï¼Œåœ¨å¤‡åº“çš„ table_def_key å°±æ˜¯ï¼š<code>åº“å + t1 +â€œM çš„ serverid&quot; + &quot;session A çš„ thread_idâ€</code></li><li>session B çš„ä¸´æ—¶è¡¨ t1ï¼Œåœ¨å¤‡åº“çš„ table_def_key å°±æ˜¯ ï¼š<code>åº“å + t1 +&quot;M çš„ serverid&quot; + &quot;session B çš„ thread_id&quot;</code></li></ul><p>MySQL åœ¨è®°å½• binlog çš„æ—¶ä¸è®ºæ˜¯ create table è¿˜æ˜¯ alter table è¯­å¥éƒ½æ˜¯åŸæ ·è®°å½•ï¼Œä½†æ˜¯å¦‚æœæ‰§è¡Œ drop tableï¼Œç³»ç»Ÿè®°å½• binlog å°±ä¼šè¢«æœåŠ¡ç«¯æ”¹å†™</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP TABLE `t_normal` /* generated by server */
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h5 id="è·¨åº“æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#è·¨åº“æŸ¥è¯¢" aria-hidden="true">#</a> è·¨åº“æŸ¥è¯¢</h5><p>åˆ†åº“åˆ†è¡¨ç³»ç»Ÿçš„è·¨åº“æŸ¥è¯¢ä½¿ç”¨ä¸´æ—¶è¡¨ä¸ç”¨æ‹…å¿ƒçº¿ç¨‹ä¹‹é—´çš„é‡åå†²çªï¼Œåˆ†åº“åˆ†è¡¨å°±æ˜¯è¦æŠŠä¸€ä¸ªé€»è¾‘ä¸Šçš„å¤§è¡¨åˆ†æ•£åˆ°ä¸åŒçš„æ•°æ®åº“å®ä¾‹ä¸Š</p><p>æ¯”å¦‚å°†ä¸€ä¸ªå¤§è¡¨ htï¼ŒæŒ‰ç…§å­—æ®µ fï¼Œæ‹†åˆ†æˆ 1024 ä¸ªåˆ†è¡¨ï¼Œåˆ†å¸ƒåˆ° 32 ä¸ªæ•°æ®åº“å®ä¾‹ä¸Šï¼Œä¸€èˆ¬æƒ…å†µä¸‹éƒ½æœ‰ä¸€ä¸ªä¸­é—´å±‚ proxy è§£æ SQL è¯­å¥ï¼Œé€šè¿‡åˆ†åº“è§„åˆ™é€šè¿‡åˆ†è¡¨è§„åˆ™ï¼ˆæ¯”å¦‚ N%1024ï¼‰ç¡®å®šå°†è¿™æ¡è¯­å¥è·¯ç”±åˆ°å“ªä¸ªåˆ†è¡¨åšæŸ¥è¯¢</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select v from ht where f=N;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœè¿™ä¸ªè¡¨ä¸Šè¿˜æœ‰å¦å¤–ä¸€ä¸ªç´¢å¼• kï¼Œå¹¶ä¸”æŸ¥è¯¢è¯­å¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>select v from ht where k &gt;= M order by t_modified desc limit 100;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŸ¥è¯¢æ¡ä»¶é‡Œé¢æ²¡æœ‰ç”¨åˆ°åˆ†åŒºå­—æ®µ fï¼Œåªèƒ½<strong>åˆ°æ‰€æœ‰çš„åˆ†åŒº</strong>ä¸­å»æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰è¡Œï¼Œç„¶åç»Ÿä¸€åš order by æ“ä½œï¼Œä¸¤ç§æ–¹å¼ï¼š</p><ul><li>åœ¨ proxy å±‚çš„è¿›ç¨‹ä»£ç ä¸­å®ç°æ’åºï¼Œæ‹¿åˆ°åˆ†åº“çš„æ•°æ®ä»¥åï¼Œç›´æ¥åœ¨å†…å­˜ä¸­å‚ä¸è®¡ç®—ï¼Œä½†æ˜¯å¯¹ proxy ç«¯çš„å‹åŠ›æ¯”è¾ƒå¤§ï¼Œå¾ˆå®¹æ˜“å‡ºç°å†…å­˜ä¸å¤Ÿç”¨å’Œ CPU ç“¶é¢ˆé—®é¢˜</li><li>æŠŠå„ä¸ªåˆ†åº“æ‹¿åˆ°çš„æ•°æ®ï¼Œæ±‡æ€»åˆ°ä¸€ä¸ª MySQL å®ä¾‹çš„ä¸€ä¸ªè¡¨ä¸­ï¼Œç„¶ååœ¨è¿™ä¸ªæ±‡æ€»å®ä¾‹ä¸Šåšé€»è¾‘æ“ä½œï¼Œæ‰§è¡Œæµç¨‹ï¼š <ul><li>åœ¨æ±‡æ€»åº“ä¸Šåˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨ temp_htï¼Œè¡¨é‡ŒåŒ…å«ä¸‰ä¸ªå­—æ®µ vã€kã€t_modified</li><li>åœ¨å„ä¸ªåˆ†åº“æ‰§è¡Œï¼š<code>select v,k,t_modified from ht_x where k &gt;= M order by t_modified desc limit 100</code></li><li>æŠŠåˆ†åº“æ‰§è¡Œçš„ç»“æœæ’å…¥åˆ° temp_ht è¡¨ä¸­</li><li>åœ¨ä¸´æ—¶è¡¨ä¸Šæ‰§è¡Œï¼š<code>select v from temp_ht order by t_modified desc limit 100</code></li></ul></li></ul><hr><h3 id="ä¼˜åŒ–æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–æ­¥éª¤" aria-hidden="true">#</a> ä¼˜åŒ–æ­¥éª¤</h3><h4 id="æ‰§è¡Œé¢‘ç‡" tabindex="-1"><a class="header-anchor" href="#æ‰§è¡Œé¢‘ç‡" aria-hidden="true">#</a> æ‰§è¡Œé¢‘ç‡</h4><p>MySQL å®¢æˆ·ç«¯è¿æ¥æˆåŠŸåï¼ŒæŸ¥è¯¢æœåŠ¡å™¨çŠ¶æ€ä¿¡æ¯ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW [SESSION|GLOBAL] STATUS LIKE &#39;&#39;;
-- SESSION: æ˜¾ç¤ºå½“å‰ä¼šè¯è¿æ¥çš„ç»Ÿè®¡ç»“æœï¼Œé»˜è®¤å‚æ•°
-- GLOBAL: æ˜¾ç¤ºè‡ªæ•°æ®åº“ä¸Šæ¬¡å¯åŠ¨è‡³ä»Šçš„ç»Ÿè®¡ç»“æœ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>æŸ¥çœ‹ SQL æ‰§è¡Œé¢‘ç‡ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW STATUS LIKE &#39;Com_____&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Com_xxx è¡¨ç¤ºæ¯ç§è¯­å¥æ‰§è¡Œçš„æ¬¡æ•°</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-SQLè¯­å¥æ‰§è¡Œé¢‘ç‡.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æŸ¥è¯¢ SQL è¯­å¥å½±å“çš„è¡Œæ•°ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW STATUS LIKE &#39;Innodb_rows_%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-SQLè¯­å¥å½±å“çš„è¡Œæ•°.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul><p>Com_xxxxï¼šè¿™äº›å‚æ•°å¯¹äºæ‰€æœ‰å­˜å‚¨å¼•æ“çš„è¡¨æ“ä½œéƒ½ä¼šè¿›è¡Œç´¯è®¡</p><p>Innodb_xxxxï¼šè¿™å‡ ä¸ªå‚æ•°åªæ˜¯é’ˆå¯¹ InnoDB å­˜å‚¨å¼•æ“çš„ï¼Œç´¯åŠ çš„ç®—æ³•ä¹Ÿç•¥æœ‰ä¸åŒ</p><table><thead><tr><th style="text-align:left;">å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:left;">Com_select</td><td>æ‰§è¡Œ SELECT æ“ä½œçš„æ¬¡æ•°ï¼Œä¸€æ¬¡æŸ¥è¯¢åªç´¯åŠ  1</td></tr><tr><td style="text-align:left;">Com_insert</td><td>æ‰§è¡Œ INSERT æ“ä½œçš„æ¬¡æ•°ï¼Œå¯¹äºæ‰¹é‡æ’å…¥çš„ INSERT æ“ä½œï¼Œåªç´¯åŠ ä¸€æ¬¡</td></tr><tr><td style="text-align:left;">Com_update</td><td>æ‰§è¡Œ UPDATE æ“ä½œçš„æ¬¡æ•°</td></tr><tr><td style="text-align:left;">Com_delete</td><td>æ‰§è¡Œ DELETE æ“ä½œçš„æ¬¡æ•°</td></tr><tr><td style="text-align:left;">Innodb_rows_read</td><td>æ‰§è¡Œ SELECT æŸ¥è¯¢è¿”å›çš„è¡Œæ•°</td></tr><tr><td style="text-align:left;">Innodb_rows_inserted</td><td>æ‰§è¡Œ INSERT æ“ä½œæ’å…¥çš„è¡Œæ•°</td></tr><tr><td style="text-align:left;">Innodb_rows_updated</td><td>æ‰§è¡Œ UPDATE æ“ä½œæ›´æ–°çš„è¡Œæ•°</td></tr><tr><td style="text-align:left;">Innodb_rows_deleted</td><td>æ‰§è¡Œ DELETE æ“ä½œåˆ é™¤çš„è¡Œæ•°</td></tr><tr><td style="text-align:left;">Connections</td><td>è¯•å›¾è¿æ¥ MySQL æœåŠ¡å™¨çš„æ¬¡æ•°</td></tr><tr><td style="text-align:left;">Uptime</td><td>æœåŠ¡å™¨å·¥ä½œæ—¶é—´</td></tr><tr><td style="text-align:left;">Slow_queries</td><td>æ…¢æŸ¥è¯¢çš„æ¬¡æ•°</td></tr></tbody></table><hr><h4 id="å®šä½ä½æ•ˆ" tabindex="-1"><a class="header-anchor" href="#å®šä½ä½æ•ˆ" aria-hidden="true">#</a> å®šä½ä½æ•ˆ</h4><p>SQL æ‰§è¡Œæ…¢æœ‰ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¶å°”æ…¢ï¼šDB åœ¨åˆ·æ–°è„é¡µï¼ˆå­¦å®Œäº‹åŠ¡å°±æ‡‚äº†ï¼‰ <ul><li>redo log å†™æ»¡äº†</li><li>å†…å­˜ä¸å¤Ÿç”¨ï¼Œè¦ä» LRU é“¾è¡¨ä¸­æ·˜æ±°</li><li>MySQL è®¤ä¸ºç³»ç»Ÿç©ºé—²çš„æ—¶å€™</li><li>MySQL å…³é—­æ—¶</li></ul></li><li>ä¸€ç›´æ…¢çš„åŸå› ï¼šç´¢å¼•æ²¡æœ‰è®¾è®¡å¥½ã€SQL è¯­å¥æ²¡å†™å¥½ã€MySQL é€‰é”™äº†ç´¢å¼•</li></ul><p>é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼å®šä½æ‰§è¡Œæ•ˆç‡è¾ƒä½çš„ SQL è¯­å¥</p><ul><li><p>æ…¢æ—¥å¿—æŸ¥è¯¢ï¼š æ…¢æŸ¥è¯¢æ—¥å¿—åœ¨æŸ¥è¯¢ç»“æŸä»¥åæ‰è®°å½•ï¼Œæ‰§è¡Œæ•ˆç‡å‡ºç°é—®é¢˜æ—¶æŸ¥è¯¢æ—¥å¿—å¹¶ä¸èƒ½å®šä½é—®é¢˜</p><p>é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼šä¿®æ”¹ .cnf æ–‡ä»¶ <code>vim /etc/mysql/my.cnf</code>ï¼Œé‡å¯ MySQL æœåŠ¡å™¨</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">slow_query_log</span><span class="token operator">=</span>ON
<span class="token assign-left variable">slow_query_log_file</span><span class="token operator">=</span>/usr/local/mysql/var/localhost-slow.log
<span class="token assign-left variable">long_query_time</span><span class="token operator">=</span><span class="token number">1</span>	<span class="token comment">#è®°å½•è¶…è¿‡long_query_timeç§’çš„SQLè¯­å¥çš„æ—¥å¿—</span>
log-queries-not-using-indexes <span class="token operator">=</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨å‘½ä»¤é…ç½®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysql&gt; SET slow_query_log=ON;
mysql&gt; SET GLOBAL slow_query_log=ON;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹æ˜¯å¦é…ç½®æˆåŠŸï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW VARIABLES LIKE &#39;%query%&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>SHOW PROCESSLISTï¼š<strong>å®æ—¶æŸ¥çœ‹</strong>å½“å‰ MySQL åœ¨è¿›è¡Œçš„è¿æ¥çº¿ç¨‹ï¼ŒåŒ…æ‹¬çº¿ç¨‹çš„çŠ¶æ€ã€æ˜¯å¦é”è¡¨ã€SQL çš„æ‰§è¡Œæƒ…å†µï¼ŒåŒæ—¶å¯¹ä¸€äº›é”è¡¨æ“ä½œè¿›è¡Œä¼˜åŒ–</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-SHOW_PROCESSLISTå‘½ä»¤.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul><hr><h4 id="explain" tabindex="-1"><a class="header-anchor" href="#explain" aria-hidden="true">#</a> EXPLAIN</h4><h5 id="æ‰§è¡Œè®¡åˆ’" tabindex="-1"><a class="header-anchor" href="#æ‰§è¡Œè®¡åˆ’" aria-hidden="true">#</a> æ‰§è¡Œè®¡åˆ’</h5><p>é€šè¿‡ EXPLAIN å‘½ä»¤è·å–æ‰§è¡Œ SQL è¯­å¥çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬åœ¨ SELECT è¯­å¥æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚ä½•è¿æ¥å’Œè¿æ¥çš„é¡ºåºï¼Œæ‰§è¡Œè®¡åˆ’åœ¨ä¼˜åŒ–å™¨ä¼˜åŒ–å®Œæˆåã€æ‰§è¡Œå™¨ä¹‹å‰ç”Ÿæˆï¼Œç„¶åæ‰§è¡Œå™¨ä¼šè°ƒç”¨å­˜å‚¨å¼•æ“æ£€ç´¢æ•°æ®</p><p>æŸ¥è¯¢ SQL è¯­å¥çš„æ‰§è¡Œè®¡åˆ’ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM table_1 WHERE id = 1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-explainæŸ¥è¯¢SQLè¯­å¥çš„æ‰§è¡Œè®¡åˆ’.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>id</td><td>SELECT çš„åºåˆ—å·</td></tr><tr><td>select_type</td><td>è¡¨ç¤º SELECT çš„ç±»å‹</td></tr><tr><td>table</td><td>è®¿é—®æ•°æ®åº“ä¸­è¡¨åç§°ï¼Œæœ‰æ—¶å¯èƒ½æ˜¯ç®€ç§°æˆ–è€…ä¸´æ—¶è¡¨åç§°ï¼ˆ&lt;table_name&gt;ï¼‰</td></tr><tr><td>type</td><td>è¡¨ç¤ºè¡¨çš„è¿æ¥ç±»å‹</td></tr><tr><td>possible_keys</td><td>è¡¨ç¤ºæŸ¥è¯¢æ—¶ï¼Œå¯èƒ½ä½¿ç”¨çš„ç´¢å¼•</td></tr><tr><td>key</td><td>è¡¨ç¤ºå®é™…ä½¿ç”¨çš„ç´¢å¼•</td></tr><tr><td>key_len</td><td>ç´¢å¼•å­—æ®µçš„é•¿åº¦</td></tr><tr><td>ref</td><td>è¡¨ç¤ºä¸ç´¢å¼•åˆ—è¿›è¡Œç­‰å€¼åŒ¹é…çš„å¯¹è±¡ï¼Œå¸¸æ•°ã€æŸä¸ªåˆ—ã€å‡½æ•°ç­‰ï¼Œtype å¿…é¡»åœ¨ï¼ˆrange, const] ä¹‹é—´ï¼Œå·¦é—­å³å¼€</td></tr><tr><td>rows</td><td>æ‰«æå‡ºçš„è¡Œæ•°ï¼Œè¡¨ç¤º MySQL æ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œ<strong>ä¼°ç®—</strong>çš„æ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰«æçš„è¡Œæ•°</td></tr><tr><td>filtered</td><td>æ¡ä»¶è¿‡æ»¤çš„è¡Œç™¾åˆ†æ¯”ï¼Œå•è¡¨æŸ¥è¯¢æ²¡æ„ä¹‰ï¼Œç”¨äºè¿æ¥æŸ¥è¯¢ä¸­å¯¹é©±åŠ¨è¡¨çš„æ‰‡å‡ºè¿›è¡Œè¿‡æ»¤ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨é¢„æµ‹æ‰€æœ‰æ‰‡å‡ºå€¼æ»¡è¶³å‰©ä½™æŸ¥è¯¢æ¡ä»¶çš„ç™¾åˆ†æ¯”ï¼Œç›¸ä¹˜ä»¥åè¡¨ç¤ºå¤šè¡¨æŸ¥è¯¢ä¸­è¿˜è¦å¯¹è¢«é©±åŠ¨æ‰§è¡ŒæŸ¥è¯¢çš„æ¬¡æ•°</td></tr><tr><td>extra</td><td>æ‰§è¡Œæƒ…å†µçš„è¯´æ˜å’Œæè¿°</td></tr></tbody></table><p>MySQL <strong>æ‰§è¡Œè®¡åˆ’çš„å±€é™</strong>ï¼š</p><ul><li>åªæ˜¯è®¡åˆ’ï¼Œä¸æ˜¯æ‰§è¡Œ SQL è¯­å¥ï¼Œå¯ä»¥éšç€åº•å±‚ä¼˜åŒ–å™¨è¾“å…¥çš„æ›´æ”¹è€Œæ›´æ”¹</li><li>EXPLAIN ä¸ä¼šå‘Šè¯‰æ˜¾ç¤ºå…³äºè§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„ä¿¡æ¯å¯¹æŸ¥è¯¢çš„å½±å“æƒ…å†µï¼Œ ä¸è€ƒè™‘å„ç§ Cache</li><li>EXPLAIN ä¸èƒ½æ˜¾ç¤º MySQL åœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶çš„åŠ¨æ€ï¼Œå› ä¸ºæ‰§è¡Œè®¡åˆ’åœ¨æ‰§è¡Œ<strong>æŸ¥è¯¢ä¹‹å‰ç”Ÿæˆ</strong></li><li>EXPALIN åªèƒ½è§£é‡Š SELECT æ“ä½œï¼Œå…¶ä»–æ“ä½œè¦é‡å†™ä¸º SELECT åæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</li><li>EXPLAIN PLAN æ˜¾ç¤ºçš„æ˜¯åœ¨è§£é‡Šè¯­å¥æ—¶æ•°æ®åº“å°†å¦‚ä½•è¿è¡Œ SQL è¯­å¥ï¼Œç”±äºæ‰§è¡Œç¯å¢ƒå’Œ EXPLAIN PLAN ç¯å¢ƒçš„ä¸åŒï¼Œæ­¤è®¡åˆ’å¯èƒ½ä¸ SQL è¯­å¥<strong>å®é™…çš„æ‰§è¡Œè®¡åˆ’ä¸åŒ</strong>ï¼Œéƒ¨åˆ†ç»Ÿè®¡ä¿¡æ¯æ˜¯ä¼°ç®—çš„ï¼Œå¹¶éç²¾ç¡®å€¼</li></ul><p>SHOW WARINGSï¼šåœ¨ä½¿ç”¨ EXPALIN å‘½ä»¤åæ‰§è¡Œè¯¥è¯­å¥ï¼Œå¯ä»¥æŸ¥è¯¢ä¸æ‰§è¡Œè®¡åˆ’ç›¸å…³çš„æ‹“å±•ä¿¡æ¯ï¼Œå±•ç¤ºå‡º Levelã€Codeã€Message ä¸‰ä¸ªå­—æ®µï¼Œå½“ Code ä¸º 1003 æ—¶ï¼ŒMessage å­—æ®µå±•ç¤ºçš„ä¿¡æ¯ç±»ä¼¼äºå°†æŸ¥è¯¢è¯­å¥é‡å†™åçš„ä¿¡æ¯ï¼Œä½†æ˜¯ä¸æ˜¯ç­‰ä»·ï¼Œä¸èƒ½æ‰§è¡Œå¤åˆ¶è¿‡æ¥è¿è¡Œ</p><p>ç¯å¢ƒå‡†å¤‡ï¼š</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æ‰§è¡Œè®¡åˆ’ç¯å¢ƒå‡†å¤‡.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h5 id="id" tabindex="-1"><a class="header-anchor" href="#id" aria-hidden="true">#</a> id</h5><p>id ä»£è¡¨ SQL æ‰§è¡Œçš„é¡ºåºçš„æ ‡è¯†ï¼Œæ¯ä¸ª SELECT å…³é”®å­—å¯¹åº”ä¸€ä¸ªå”¯ä¸€ idï¼Œæ‰€ä»¥åœ¨åŒä¸€ä¸ª SELECT å…³é”®å­—ä¸­çš„è¡¨çš„ id éƒ½æ˜¯ç›¸åŒçš„ã€‚SELECT åçš„ FROM å¯ä»¥è·Ÿéšå¤šä¸ªè¡¨ï¼Œæ¯ä¸ªè¡¨éƒ½ä¼šå¯¹åº”ä¸€æ¡è®°å½•ï¼Œè¿™äº›è®°å½•çš„ id éƒ½æ˜¯ç›¸åŒçš„ï¼Œ</p><ul><li><p>id ç›¸åŒæ—¶ï¼Œæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹ã€‚è¿æ¥æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼Œè®°å½•çš„ id å€¼éƒ½æ˜¯ç›¸åŒçš„ï¼Œå‡ºç°åœ¨å‰é¢çš„è¡¨ä¸ºé©±åŠ¨è¡¨ï¼Œåé¢ä¸ºè¢«é©±åŠ¨è¡¨</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM t_role r, t_user u, user_role ur WHERE r.id = ur.role_id AND u.id = ur.user_id ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-explainä¹‹idç›¸åŒ.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>id ä¸åŒæ—¶ï¼Œid å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM t_role WHERE id = (SELECT role_id FROM user_role WHERE user_id = (SELECT id FROM t_user WHERE username = &#39;stu1&#39;))
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-explainä¹‹idä¸åŒ.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>id æœ‰ç›¸åŒä¹Ÿæœ‰ä¸åŒæ—¶ï¼Œid ç›¸åŒçš„å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ç»„ï¼Œä»ä¸Šå¾€ä¸‹é¡ºåºæ‰§è¡Œï¼›åœ¨æ‰€æœ‰çš„ç»„ä¸­ï¼Œid çš„å€¼è¶Šå¤§çš„ç»„ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆæ‰§è¡Œ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM t_role r , (SELECT * FROM user_role ur WHERE ur.`user_id` = &#39;2&#39;) a WHERE r.id = a.role_id ; 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-explainä¹‹idç›¸åŒå’Œä¸åŒ.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>id ä¸º NULL æ—¶ä»£è¡¨çš„æ˜¯ä¸´æ—¶è¡¨</p></li></ul><hr><h5 id="select" tabindex="-1"><a class="header-anchor" href="#select" aria-hidden="true">#</a> select</h5><p>è¡¨ç¤ºæŸ¥è¯¢ä¸­æ¯ä¸ª select å­å¥çš„ç±»å‹ï¼ˆç®€å• OR å¤æ‚ï¼‰</p><table><thead><tr><th>select_type</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>SIMPLE</td><td>ç®€å•çš„ SELECT æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­ä¸åŒ…å«å­æŸ¥è¯¢æˆ–è€… UNION</td></tr><tr><td>PRIMARY</td><td>æŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­æŸ¥è¯¢ï¼Œæœ€å¤–å±‚ï¼ˆä¹Ÿå°±æ˜¯æœ€å·¦ä¾§ï¼‰æŸ¥è¯¢æ ‡è®°ä¸ºè¯¥æ ‡è¯†</td></tr><tr><td>UNION</td><td>å¯¹äº UNION æˆ–è€… UNION ALL çš„å¤æ‚æŸ¥è¯¢ï¼Œé™¤äº†æœ€å·¦ä¾§çš„æŸ¥è¯¢ï¼Œå…¶ä½™çš„å°æŸ¥è¯¢éƒ½æ˜¯ UNION</td></tr><tr><td>UNION RESULT</td><td>UNION éœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨è¿›è¡Œå»é‡ï¼Œä¸´æ—¶è¡¨çš„æ˜¯ UNION RESULT</td></tr><tr><td>DEPENDENT UNION</td><td>å¯¹äº UNION æˆ–è€… UNION ALL çš„å¤æ‚æŸ¥è¯¢ï¼Œå¦‚æœå„ä¸ªå°æŸ¥è¯¢éƒ½ä¾èµ–å¤–å±‚æŸ¥è¯¢ï¼Œæ˜¯ç›¸å…³å­æŸ¥è¯¢ï¼Œé™¤äº†æœ€å·¦ä¾§çš„å°æŸ¥è¯¢ä¸º DEPENDENT SUBQUERYï¼Œå…¶ä½™éƒ½æ˜¯ DEPENDENT UNION</td></tr><tr><td>SUBQUERY</td><td>å­æŸ¥è¯¢ä¸æ˜¯ç›¸å…³å­æŸ¥è¯¢ï¼Œè¯¥å­æŸ¥è¯¢ç¬¬ä¸€ä¸ª SELECT ä»£è¡¨çš„æŸ¥è¯¢å°±æ˜¯è¿™ç§ç±»å‹ï¼Œä¼šè¿›è¡Œç‰©åŒ–ï¼ˆè¯¥å­æŸ¥è¯¢åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼‰</td></tr><tr><td>DEPENDENT SUBQUERY</td><td>å­æŸ¥è¯¢æ˜¯ç›¸å…³å­æŸ¥è¯¢ï¼Œè¯¥å­æŸ¥è¯¢ç¬¬ä¸€ä¸ª SELECT ä»£è¡¨çš„æŸ¥è¯¢å°±æ˜¯è¿™ç§ç±»å‹ï¼Œä¸ä¼šç‰©åŒ–ï¼ˆè¯¥å­æŸ¥è¯¢éœ€è¦æ‰§è¡Œå¤šæ¬¡ï¼‰</td></tr><tr><td>DERIVED</td><td>åœ¨ FROM åˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢ï¼Œè¢«æ ‡è®°ä¸º DERIVEDï¼ˆè¡ç”Ÿï¼‰ï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆç‰©åŒ–æ´¾ç”Ÿè¡¨çš„è¿™ä¸ªå­æŸ¥è¯¢</td></tr><tr><td>MATERIALIZED</td><td>å°†å­æŸ¥è¯¢ç‰©åŒ–åä¸ä¸å¤–å±‚è¿›è¡Œè¿æ¥æŸ¥è¯¢ï¼Œç”Ÿæˆç‰©åŒ–è¡¨çš„å­æŸ¥è¯¢</td></tr></tbody></table><p>å­æŸ¥è¯¢ä¸º DERIVEDï¼š<code>SELECT * FROM (SELECT key1 FROM t1) AS derived_1 WHERE key1 &gt; 10</code></p><p>å­æŸ¥è¯¢ä¸º MATERIALIZEDï¼š<code>SELECT * FROM t1 WHERE key1 IN (SELECT key1 FROM t2)</code></p><hr><h5 id="type" tabindex="-1"><a class="header-anchor" href="#type" aria-hidden="true">#</a> type</h5><p>å¯¹è¡¨çš„è®¿é—®æ–¹å¼ï¼Œè¡¨ç¤º MySQL åœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼ï¼Œåˆç§°è®¿é—®ç±»å‹</p><table><thead><tr><th>type</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>ALL</td><td>å…¨è¡¨æ‰«æï¼Œå¦‚æœæ˜¯ InnoDB å¼•æ“æ˜¯æ‰«æèšç°‡ç´¢å¼•</td></tr><tr><td>index</td><td>å¯ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œä½†éœ€è¦æ‰«æå…¨éƒ¨ç´¢å¼•</td></tr><tr><td>range</td><td>ç´¢å¼•èŒƒå›´æ‰«æï¼Œå¸¸è§äº betweenã€&lt;ã€&gt; ç­‰çš„æŸ¥è¯¢</td></tr><tr><td>index_subquery</td><td>å­æŸ¥è¯¢å¯ä»¥æ™®é€šç´¢å¼•ï¼Œåˆ™å­æŸ¥è¯¢çš„ type ä¸º index_subquery</td></tr><tr><td>unique_subquery</td><td>å­æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ä¸»é”®æˆ–å”¯ä¸€äºŒçº§ç´¢å¼•ï¼Œåˆ™å­æŸ¥è¯¢çš„ type ä¸º index_subquery</td></tr><tr><td>index_merge</td><td>ç´¢å¼•åˆå¹¶</td></tr><tr><td>ref_or_null</td><td>éå”¯ä¸€æ€§ç´¢å¼•ï¼ˆæ™®é€šäºŒçº§ç´¢å¼•ï¼‰å¹¶ä¸”å¯ä»¥å­˜å‚¨ NULLï¼Œè¿›è¡Œç­‰å€¼åŒ¹é…</td></tr><tr><td>ref</td><td>éå”¯ä¸€æ€§ç´¢å¼•ä¸å¸¸é‡ç­‰å€¼åŒ¹é…</td></tr><tr><td>eq_ref</td><td>å”¯ä¸€æ€§ç´¢å¼•ï¼ˆä¸»é”®æˆ–ä¸å­˜å‚¨ NULL çš„å”¯ä¸€äºŒçº§ç´¢å¼•ï¼‰è¿›è¡Œç­‰å€¼åŒ¹é…ï¼Œå¦‚æœäºŒçº§ç´¢å¼•æ˜¯è”åˆç´¢å¼•ï¼Œé‚£ä¹ˆæ‰€æœ‰è”åˆçš„åˆ—éƒ½è¦è¿›è¡Œç­‰å€¼åŒ¹é…</td></tr><tr><td>const</td><td>é€šè¿‡ä¸»é”®æˆ–è€…å”¯ä¸€äºŒçº§ç´¢å¼•ä¸å¸¸é‡è¿›è¡Œç­‰å€¼åŒ¹é…</td></tr><tr><td>system</td><td>system æ˜¯ const ç±»å‹çš„ç‰¹ä¾‹ï¼Œå½“æŸ¥è¯¢çš„è¡¨åªæœ‰ä¸€æ¡è®°å½•çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ system</td></tr><tr><td>NULL</td><td>MySQL åœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­åˆ†è§£è¯­å¥ï¼Œæ‰§è¡Œæ—¶ç”šè‡³ä¸ç”¨è®¿é—®è¡¨æˆ–ç´¢å¼•</td></tr></tbody></table><p>ä»ä¸Šåˆ°ä¸‹ï¼Œæ€§èƒ½ä»å·®åˆ°å¥½ï¼Œä¸€èˆ¬æ¥è¯´éœ€è¦ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ° range çº§åˆ«ï¼Œ æœ€å¥½è¾¾åˆ° ref</p><hr><h5 id="key" tabindex="-1"><a class="header-anchor" href="#key" aria-hidden="true">#</a> key</h5><p>possible_keysï¼š</p><ul><li>æŒ‡å‡º MySQL èƒ½ä½¿ç”¨å“ªä¸ªç´¢å¼•åœ¨è¡¨ä¸­æ‰¾åˆ°è®°å½•ï¼ŒæŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢ä½¿ç”¨</li><li>å¦‚æœè¯¥åˆ—æ˜¯ NULLï¼Œåˆ™æ²¡æœ‰ç›¸å…³çš„ç´¢å¼•</li></ul><p>keyï¼š</p><ul><li>æ˜¾ç¤º MySQL åœ¨æŸ¥è¯¢ä¸­å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œè‹¥æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œæ˜¾ç¤ºä¸º NULL</li><li>æŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†<strong>è¦†ç›–ç´¢å¼•</strong>ï¼Œåˆ™è¯¥ç´¢å¼•å¯èƒ½å‡ºç°åœ¨ key åˆ—è¡¨ï¼Œä¸å‡ºç°åœ¨ possible_keys</li></ul><p>key_lenï¼š</p><ul><li>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦</li><li>key_len æ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œå³ key_len æ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢å‡ºçš„</li><li>åœ¨ä¸æŸå¤±ç²¾ç¡®æ€§çš„å‰æä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½</li></ul><hr><h5 id="extra" tabindex="-1"><a class="header-anchor" href="#extra" aria-hidden="true">#</a> Extra</h5><p>å…¶ä»–çš„é¢å¤–çš„æ‰§è¡Œè®¡åˆ’ä¿¡æ¯ï¼Œåœ¨è¯¥åˆ—å±•ç¤ºï¼š</p><ul><li>No tables usedï¼šæŸ¥è¯¢è¯­å¥ä¸­ä½¿ç”¨ FROM dual æˆ–è€…æ²¡æœ‰ FROM è¯­å¥</li><li>Impossible WHEREï¼šæŸ¥è¯¢è¯­å¥ä¸­çš„ WHERE å­å¥æ¡ä»¶æ°¸è¿œä¸º FALSEï¼Œä¼šå¯¼è‡´æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è¡Œ</li><li>Using indexï¼šè¯¥å€¼è¡¨ç¤ºç›¸åº”çš„ SELECT æ“ä½œä¸­ä½¿ç”¨äº†<strong>è¦†ç›–ç´¢å¼•</strong>ï¼ˆCovering Indexï¼‰</li><li>Using index conditionï¼šç¬¬ä¸€ç§æƒ…å†µæ˜¯æœç´¢æ¡ä»¶ä¸­è™½ç„¶å‡ºç°äº†ç´¢å¼•åˆ—ï¼Œä½†æ˜¯éƒ¨åˆ†æ¡ä»¶æ— æ³•å½¢æˆæ‰«æåŒºé—´ï¼ˆ<strong>ç´¢å¼•å¤±æ•ˆ</strong>ï¼‰ï¼Œä¼šæ ¹æ®å¯ç”¨ç´¢å¼•çš„æ¡ä»¶å…ˆæœç´¢ä¸€éå†åŒ¹é…æ— æ³•ä½¿ç”¨ç´¢å¼•çš„æ¡ä»¶ï¼Œå›è¡¨æŸ¥è¯¢æ•°æ®ï¼›ç¬¬äºŒç§æ˜¯ä½¿ç”¨äº†<strong>ç´¢å¼•æ¡ä»¶ä¸‹æ¨</strong>ä¼˜åŒ–</li><li>Using whereï¼šæœç´¢çš„æ•°æ®éœ€è¦åœ¨ Server å±‚åˆ¤æ–­ï¼Œæ— æ³•ä½¿ç”¨ç´¢å¼•ä¸‹æ¨</li><li>Using join bufferï¼šè¿æ¥æŸ¥è¯¢è¢«é©±åŠ¨è¡¨æ— æ³•åˆ©ç”¨ç´¢å¼•ï¼Œéœ€è¦è¿æ¥ç¼“å†²åŒºæ¥å­˜å‚¨ä¸­é—´ç»“æœ</li><li>Using filesortï¼šæ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºï¼ˆä¼˜åŒ–æ–¹å‘ï¼‰ï¼Œéœ€è¦å¯¹æ•°æ®ä½¿ç”¨å¤–éƒ¨æ’åºç®—æ³•ï¼Œå°†å–å¾—çš„æ•°æ®åœ¨å†…å­˜æˆ–ç£ç›˜ä¸­è¿›è¡Œæ’åº</li><li>Using temporaryï¼šè¡¨ç¤º MySQL éœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨æ¥å­˜å‚¨ç»“æœé›†ï¼Œå¸¸è§äº<strong>æ’åºã€å»é‡ï¼ˆUNIONï¼‰ã€åˆ†ç»„</strong>ç­‰åœºæ™¯</li><li>Select tables optimized awayï¼šè¯´æ˜ä»…é€šè¿‡ä½¿ç”¨ç´¢å¼•ï¼Œä¼˜åŒ–å™¨å¯èƒ½ä»…ä»èšåˆå‡½æ•°ç»“æœä¸­è¿”å›ä¸€è¡Œ</li><li>No tables usedï¼šQuery è¯­å¥ä¸­ä½¿ç”¨ from dual æˆ–ä¸å«ä»»ä½• from å­å¥</li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/ggjucheng/archive/2012/11/11/2765237.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/ggjucheng/archive/2012/11/11/2765237.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="profiles" tabindex="-1"><a class="header-anchor" href="#profiles" aria-hidden="true">#</a> PROFILES</h4><p>SHOW PROFILES èƒ½å¤Ÿåœ¨åš SQL ä¼˜åŒ–æ—¶åˆ†æå½“å‰ä¼šè¯ä¸­è¯­å¥æ‰§è¡Œçš„<strong>èµ„æºæ¶ˆè€—</strong>æƒ…å†µ</p><ul><li><p>é€šè¿‡ have_profiling å‚æ•°ï¼Œèƒ½å¤Ÿçœ‹åˆ°å½“å‰ MySQL æ˜¯å¦æ”¯æŒ profileï¼š<br><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-have_profiling.png" alt="" loading="lazy"></p></li><li><p>é»˜è®¤ profiling æ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡ set è¯­å¥åœ¨ Session çº§åˆ«å¼€å¯ profilingï¼š</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-profiling.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET profiling=1; #å¼€å¯profiling å¼€å…³ï¼›
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ‰§è¡Œ SHOW PROFILES æŒ‡ä»¤ï¼Œ æ¥æŸ¥çœ‹ SQL è¯­å¥æ‰§è¡Œçš„è€—æ—¶:</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW PROFILES;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æŸ¥çœ‹SQLè¯­å¥æ‰§è¡Œè€—æ—¶.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æŸ¥çœ‹åˆ°è¯¥ SQL æ‰§è¡Œè¿‡ç¨‹ä¸­æ¯ä¸ªçº¿ç¨‹çš„çŠ¶æ€å’Œæ¶ˆè€—çš„æ—¶é—´ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW PROFILE FOR QUERY query_id;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-SQLæ‰§è¡Œæ¯ä¸ªçŠ¶æ€æ¶ˆè€—çš„æ—¶é—´.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>åœ¨è·å–åˆ°æœ€æ¶ˆè€—æ—¶é—´çš„çº¿ç¨‹çŠ¶æ€åï¼ŒMySQL æ”¯æŒé€‰æ‹© allã€cpuã€block io ã€context switchã€page faults ç­‰ç±»å‹æŸ¥çœ‹ MySQL åœ¨ä½¿ç”¨ä»€ä¹ˆèµ„æºä¸Šè€—è´¹äº†è¿‡é«˜çš„æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œé€‰æ‹©æŸ¥çœ‹ CPU çš„è€—è´¹æ—¶é—´ï¼š</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-SQLæ‰§è¡Œæ¯ä¸ªçŠ¶æ€æ¶ˆè€—çš„CPU.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>Statusï¼šSQL è¯­å¥æ‰§è¡Œçš„çŠ¶æ€</li><li>Durationsqlï¼šæ‰§è¡Œè¿‡ç¨‹ä¸­æ¯ä¸€ä¸ªæ­¥éª¤çš„è€—æ—¶</li><li>CPU_userï¼šå½“å‰ç”¨æˆ·å æœ‰çš„ CPU</li><li>CPU_systemï¼šç³»ç»Ÿå æœ‰çš„ CPU</li></ul></li></ul><hr><h4 id="trace" tabindex="-1"><a class="header-anchor" href="#trace" aria-hidden="true">#</a> TRACE</h4><p>MySQL æä¾›äº†å¯¹ SQL çš„è·Ÿè¸ªï¼Œ é€šè¿‡ trace æ–‡ä»¶å¯ä»¥æŸ¥çœ‹ä¼˜åŒ–å™¨<strong>ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„è¿‡ç¨‹</strong></p><ul><li><p>æ‰“å¼€ trace åŠŸèƒ½ï¼Œè®¾ç½®æ ¼å¼ä¸º JSONï¼Œå¹¶è®¾ç½® trace çš„æœ€å¤§ä½¿ç”¨å†…å­˜ï¼Œé¿å…è§£æè¿‡ç¨‹ä¸­å› é»˜è®¤å†…å­˜è¿‡å°è€Œä¸èƒ½å¤Ÿå®Œæ•´å±•ç¤º</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET optimizer_trace=&quot;enabled=on&quot;,end_markers_in_json=ON;	-- ä¼šè¯å†…æœ‰æ•ˆ
SET optimizer_trace_max_mem_size=1000000;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ‰§è¡Œ SQL è¯­å¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM tb_item WHERE id &lt; 4;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ£€æŸ¥ information_schema.optimizer_traceï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM information_schema.optimizer_trace \G; -- \Gä»£è¡¨ç«–åˆ—å±•ç¤º
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ‰§è¡Œä¿¡æ¯ä¸»è¦æœ‰ä¸‰ä¸ªé˜¶æ®µï¼šprepare é˜¶æ®µã€optimize é˜¶æ®µï¼ˆæˆæœ¬åˆ†æï¼‰ã€execute é˜¶æ®µï¼ˆæ‰§è¡Œï¼‰</p></li></ul><hr><h3 id="ç´¢å¼•ä¼˜åŒ–-1" tabindex="-1"><a class="header-anchor" href="#ç´¢å¼•ä¼˜åŒ–-1" aria-hidden="true">#</a> ç´¢å¼•ä¼˜åŒ–</h3><h4 id="åˆ›å»ºç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºç´¢å¼•" aria-hidden="true">#</a> åˆ›å»ºç´¢å¼•</h4><p>ç´¢å¼•æ˜¯æ•°æ®åº“ä¼˜åŒ–æœ€é‡è¦çš„æ‰‹æ®µä¹‹ä¸€ï¼Œé€šè¿‡ç´¢å¼•é€šå¸¸å¯ä»¥å¸®åŠ©ç”¨æˆ·è§£å†³å¤§å¤šæ•°çš„ MySQL çš„æ€§èƒ½ä¼˜åŒ–é—®é¢˜</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE `tb_seller` (
	`sellerid` varchar (100),
	`name` varchar (100),
	`nickname` varchar (50),
	`password` varchar (60),
	`status` varchar (1),
	`address` varchar (100),
	`createtime` datetime,
    PRIMARY KEY(`sellerid`)
)ENGINE=INNODB DEFAULT CHARSET=utf8mb4;
INSERT INTO `tb_seller` (`sellerid`, `name`, `nickname`, `password`, `status`, `address`, `createtime`) values(&#39;xiaomi&#39;,&#39;å°ç±³ç§‘æŠ€&#39;,&#39;å°ç±³å®˜æ–¹æ——èˆ°åº—&#39;,&#39;e10adc3949ba59abbe56e057f20f883e&#39;,&#39;1&#39;,&#39;è¥¿å®‰å¸‚&#39;,&#39;2088-01-01 12:00:00&#39;);
CREATE INDEX idx_seller_name_sta_addr ON tb_seller(name, status, address); # è”åˆç´¢å¼•
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•ç¯å¢ƒå‡†å¤‡.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h4 id="é¿å…å¤±æ•ˆ" tabindex="-1"><a class="header-anchor" href="#é¿å…å¤±æ•ˆ" aria-hidden="true">#</a> é¿å…å¤±æ•ˆ</h4><h5 id="è¯­å¥é”™è¯¯" tabindex="-1"><a class="header-anchor" href="#è¯­å¥é”™è¯¯" aria-hidden="true">#</a> è¯­å¥é”™è¯¯</h5><ul><li><p>å…¨å€¼åŒ¹é…ï¼šå¯¹ç´¢å¼•ä¸­æ‰€æœ‰åˆ—éƒ½æŒ‡å®šå…·ä½“å€¼ï¼Œè¿™ç§æƒ…å†µç´¢å¼•ç”Ÿæ•ˆï¼Œæ‰§è¡Œæ•ˆç‡é«˜</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE name=&#39;å°ç±³ç§‘æŠ€&#39; AND status=&#39;1&#39; AND address=&#39;è¥¿å®‰å¸‚&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p><strong>æœ€å·¦å‰ç¼€æ³•åˆ™</strong>ï¼šè”åˆç´¢å¼•éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™</p><p>åŒ¹é…æœ€å·¦å‰ç¼€æ³•åˆ™ï¼Œèµ°ç´¢å¼•ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE name=&#39;å°ç±³ç§‘æŠ€&#39;;
EXPLAIN SELECT * FROM tb_seller WHERE name=&#39;å°ç±³ç§‘æŠ€&#39; AND status=&#39;1&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>è¿æ³•æœ€å·¦å‰ç¼€æ³•åˆ™ ï¼Œ ç´¢å¼•å¤±æ•ˆï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE status=&#39;1&#39;;
EXPLAIN SELECT * FROM tb_seller WHERE status=&#39;1&#39; AND address=&#39;è¥¿å®‰å¸‚&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å¦‚æœç¬¦åˆæœ€å·¦æ³•åˆ™ï¼Œä½†æ˜¯å‡ºç°è·³è·ƒæŸä¸€åˆ—ï¼Œåªæœ‰æœ€å·¦åˆ—ç´¢å¼•ç”Ÿæ•ˆï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE name=&#39;å°ç±³ç§‘æŠ€&#39; AND address=&#39;è¥¿å®‰å¸‚&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>è™½ç„¶ç´¢å¼•åˆ—å¤±æ•ˆï¼Œä½†æ˜¯ç³»ç»Ÿä¼š<strong>ä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨è¿›è¡Œäº†ä¼˜åŒ–</strong></p></li><li><p><strong>èŒƒå›´æŸ¥è¯¢</strong>å³è¾¹çš„åˆ—ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE name=&#39;å°ç±³ç§‘æŠ€&#39; AND status&gt;&#39;1&#39; AND address=&#39;è¥¿å®‰å¸‚&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ ¹æ®å‰é¢çš„ä¸¤ä¸ªå­—æ®µ name ï¼Œ status æŸ¥è¯¢æ˜¯èµ°ç´¢å¼•çš„ï¼Œ ä½†æ˜¯æœ€åä¸€ä¸ªæ¡ä»¶ address æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œä½¿ç”¨äº†ç´¢å¼•ä¸‹æ¨</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•5.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>åœ¨ç´¢å¼•åˆ—ä¸Š<strong>å‡½æ•°æˆ–è€…è¿ç®—ï¼ˆ+ - æ•°å€¼ï¼‰æ“ä½œ</strong>ï¼Œ ç´¢å¼•å°†å¤±æ•ˆï¼šä¼šç ´åç´¢å¼•å€¼çš„æœ‰åºæ€§</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE SUBSTRING(name,3,2) = &#39;ç§‘æŠ€&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•6.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p><strong>å­—ç¬¦ä¸²ä¸åŠ å•å¼•å·</strong>ï¼Œé€ æˆç´¢å¼•å¤±æ•ˆï¼šéšå¼ç±»å‹è½¬æ¢ï¼Œå½“å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒæ—¶ä¼š<strong>æŠŠå­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ•°å­—</strong></p><p>æ²¡æœ‰å¯¹å­—ç¬¦ä¸²åŠ å•å¼•å·ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šè°ƒç”¨ CAST å‡½æ•°å°† status è½¬æ¢ä¸º int è¿›è¡Œæ¯”è¾ƒï¼Œé€ æˆç´¢å¼•å¤±æ•ˆ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE name=&#39;å°ç±³ç§‘æŠ€&#39; AND status = 1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•7.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å¦‚æœ status æ˜¯ int ç±»å‹ï¼ŒSQL ä¸º <code>SELECT * FROM tb_seller WHERE status = &#39;1&#39; </code> å¹¶ä¸ä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼Œå› ä¸ºä¼šå°† <code>&#39;1&#39;</code> è½¬æ¢ä¸º <code>1</code>ï¼Œå¹¶<strong>ä¸ä¼šå¯¹ç´¢å¼•åˆ—äº§ç”Ÿæ“ä½œ</strong></p></li><li><p>å¤šè¡¨è¿æ¥æŸ¥è¯¢æ—¶ï¼Œå¦‚æœä¸¤å¼ è¡¨çš„<strong>å­—ç¬¦é›†ä¸åŒ</strong>ï¼Œä¼šé€ æˆç´¢å¼•å¤±æ•ˆï¼Œå› ä¸ºä¼šè¿›è¡Œç±»å‹è½¬æ¢</p><p>è§£å†³æ–¹æ³•ï¼šCONVERT å‡½æ•°æ˜¯åŠ åœ¨è¾“å…¥å‚æ•°ä¸Šã€ä¿®æ”¹è¡¨çš„å­—ç¬¦é›†</p></li><li><p><strong>ç”¨ OR åˆ†å‰²æ¡ä»¶ï¼Œç´¢å¼•å¤±æ•ˆ</strong>ï¼Œå¯¼è‡´å…¨è¡¨æŸ¥è¯¢ï¼š</p><p>OR å‰çš„æ¡ä»¶ä¸­çš„åˆ—æœ‰ç´¢å¼•è€Œåé¢çš„åˆ—ä¸­æ²¡æœ‰ç´¢å¼•æˆ– OR å‰åä¸¤ä¸ªåˆ—æ˜¯åŒä¸€ä¸ªå¤åˆç´¢å¼•ï¼Œéƒ½é€ æˆç´¢å¼•å¤±æ•ˆ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE name=&#39;é˜¿é‡Œå·´å·´&#39; OR createtime = &#39;2088-01-01 12:00:00&#39;;
EXPLAIN SELECT * FROM tb_seller WHERE name=&#39;å°ç±³ç§‘æŠ€&#39; OR status=&#39;1&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•10.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>AND åˆ†å‰²çš„æ¡ä»¶ä¸å½±å“</strong>ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE name=&#39;é˜¿é‡Œå·´å·´&#39; AND createtime = &#39;2088-01-01 12:00:00&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•11.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p><strong>ä»¥ % å¼€å¤´çš„ LIKE æ¨¡ç³ŠæŸ¥è¯¢</strong>ï¼Œç´¢å¼•å¤±æ•ˆï¼š</p><p>å¦‚æœæ˜¯å°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•ä¸ä¼šå¤±æ•ˆï¼›å¦‚æœæ˜¯å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•å¤±æ•ˆ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE name like &#39;%ç§‘æŠ€%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•12.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>è§£å†³æ–¹æ¡ˆï¼šé€šè¿‡è¦†ç›–ç´¢å¼•æ¥è§£å†³</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT sellerid,name,status FROM tb_seller WHERE name like &#39;%ç§‘æŠ€%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•13.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>åŸå› ï¼šåœ¨è¦†ç›–ç´¢å¼•çš„è¿™æ£µ B+ æ•°ä¸Šåªéœ€è¦è¿›è¡Œ like çš„åŒ¹é…ï¼Œæˆ–è€…æ˜¯åŸºäºè¦†ç›–ç´¢å¼•æŸ¥è¯¢å†è¿›è¡Œ WHERE çš„åˆ¤æ–­å°±å¯ä»¥è·å¾—ç»“æœ</p></li></ul><hr><h5 id="ç³»ç»Ÿä¼˜åŒ–-1" tabindex="-1"><a class="header-anchor" href="#ç³»ç»Ÿä¼˜åŒ–-1" aria-hidden="true">#</a> ç³»ç»Ÿä¼˜åŒ–</h5><p>ç³»ç»Ÿä¼˜åŒ–ä¸ºå…¨è¡¨æ‰«æï¼š</p><ul><li><p>å¦‚æœ MySQL è¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•ï¼Œç´¢å¼•å¤±æ•ˆï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE INDEX idx_address ON tb_seller(address);
EXPLAIN SELECT * FROM tb_seller WHERE address=&#39;è¥¿å®‰å¸‚&#39;;
EXPLAIN SELECT * FROM tb_seller WHERE address=&#39;åŒ—äº¬å¸‚&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åŒ—äº¬å¸‚çš„é”®å€¼å  9/10ï¼ˆåŒºåˆ†åº¦ä½ï¼‰ï¼Œæ‰€ä»¥ä¼˜åŒ–ä¸ºå…¨è¡¨æ‰«æï¼Œtype = ALL</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•14.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>IS NULLã€IS NOT NULL <strong>æœ‰æ—¶</strong>ç´¢å¼•å¤±æ•ˆï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE name IS NULL;
EXPLAIN SELECT * FROM tb_seller WHERE name IS NOT NULL;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>NOT NULL å¤±æ•ˆçš„åŸå› æ˜¯ name åˆ—å…¨éƒ¨ä¸æ˜¯ nullï¼Œä¼˜åŒ–ä¸ºå…¨è¡¨æ‰«æï¼Œå½“ NULL è¿‡å¤šæ—¶ï¼ŒIS NULL å¤±æ•ˆ</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•15.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>IN è‚¯å®šä¼šèµ°ç´¢å¼•ï¼Œä½†æ˜¯å½“ IN çš„å–å€¼èŒƒå›´è¾ƒå¤§æ—¶ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œèµ°å…¨è¡¨æ‰«æï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller WHERE sellerId IN (&#39;alibaba&#39;,&#39;huawei&#39;);-- éƒ½èµ°ç´¢å¼•
EXPLAIN SELECT * FROM tb_seller WHERE sellerId NOT IN (&#39;alibaba&#39;,&#39;huawei&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><a href="https://time.geekbang.org/column/article/74687" target="_blank" rel="noopener noreferrer">MySQL å®æˆ˜ 45 è®²<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>è¯¥ç« èŠ‚æœ€åæå‡ºäº†ä¸€ç§æ…¢æŸ¥è¯¢åœºæ™¯ï¼Œè·å–åˆ°æ•°æ®ä»¥å Server å±‚è¿˜ä¼šåšåˆ¤æ–­</p></li></ul><hr><h4 id="åº•å±‚åŸç†" tabindex="-1"><a class="header-anchor" href="#åº•å±‚åŸç†" aria-hidden="true">#</a> åº•å±‚åŸç†</h4><p>ç´¢å¼•å¤±æ•ˆä¸€èˆ¬æ˜¯é’ˆå¯¹è”åˆç´¢å¼•ï¼Œè”åˆç´¢å¼•ä¸€èˆ¬ç”±å‡ ä¸ªå­—æ®µç»„æˆï¼Œæ’åºæ–¹å¼æ˜¯å…ˆæŒ‰ç…§ç¬¬ä¸€ä¸ªå­—æ®µè¿›è¡Œæ’åºï¼Œç„¶åæ’åºç¬¬äºŒä¸ªï¼Œä¾æ­¤ç±»æ¨ï¼Œå›¾ç¤ºï¼ˆa, bï¼‰ç´¢å¼•ï¼Œ<strong>a ç›¸ç­‰çš„æƒ…å†µä¸‹ b æ˜¯æœ‰åºçš„</strong></p><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ç´¢å¼•å¤±æ•ˆåº•å±‚åŸç†1.png" style="zoom:67%;"><ul><li><p>æœ€å·¦å‰ç¼€æ³•åˆ™ï¼šå½“ä¸åŒ¹é…å‰é¢çš„å­—æ®µçš„æ—¶å€™ï¼Œåé¢çš„å­—æ®µéƒ½æ˜¯æ— åºçš„ã€‚è¿™ç§æ— åºä¸ä»…ä½“ç°åœ¨å¶å­èŠ‚ç‚¹ï¼Œä¹Ÿä¼š<strong>å¯¼è‡´æŸ¥è¯¢æ—¶æ‰«æçš„éå¶å­èŠ‚ç‚¹ä¹Ÿæ˜¯æ— åºçš„</strong>ï¼Œå› ä¸ºç´¢å¼•æ ‘ç›¸å½“äºå¿½ç•¥çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼Œå°±æ— æ³•ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾</p></li><li><p>èŒƒå›´æŸ¥è¯¢å³è¾¹çš„åˆ—ï¼Œä¸èƒ½ä½¿ç”¨ç´¢å¼•ï¼Œæ¯”å¦‚è¯­å¥ï¼š <code>WHERE a &gt; 1 AND b = 1 </code>ï¼Œåœ¨ a å¤§äº 1 çš„æ—¶å€™ï¼Œb æ˜¯æ— åºçš„ï¼Œa &gt; 1 æ˜¯æ‰«ææ—¶æœ‰åºçš„ï¼Œä½†æ˜¯æ‰¾åˆ°ä»¥åè¿›è¡Œå¯»æ‰¾ b æ—¶ï¼Œç´¢å¼•æ ‘å°±ä¸æ˜¯æœ‰åºçš„äº†</p><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ç´¢å¼•å¤±æ•ˆåº•å±‚åŸç†2.png" style="zoom:67%;"></li><li><p>ä»¥ % å¼€å¤´çš„ LIKE æ¨¡ç³ŠæŸ¥è¯¢ï¼Œç´¢å¼•å¤±æ•ˆï¼Œæ¯”å¦‚è¯­å¥ï¼š<code>WHERE a LIKE &#39;%d&#39;</code>ï¼Œå‰é¢çš„ä¸ç¡®å®šï¼Œå¯¼è‡´ä¸ç¬¦åˆæœ€å·¦åŒ¹é…ï¼Œç›´æ¥å»ç´¢å¼•ä¸­æœç´¢ä»¥ d ç»“å°¾çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥æ²¡æœ‰é¡ºåº<br><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ç´¢å¼•å¤±æ•ˆåº•å±‚åŸç†3.png" alt="" loading="lazy"></p></li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://mp.weixin.qq.com/s/B_M09dzLe9w7cT46rdGIeQ" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/B_M09dzLe9w7cT46rdGIeQ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="æŸ¥çœ‹ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹ç´¢å¼•" aria-hidden="true">#</a> æŸ¥çœ‹ç´¢å¼•</h4><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW STATUS LIKE &#39;Handler_read%&#39;;	
SHOW GLOBAL STATUS LIKE &#39;Handler_read%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLæŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li><p>Handler_read_firstï¼šç´¢å¼•ä¸­ç¬¬ä¸€æ¡è¢«è¯»çš„æ¬¡æ•°ï¼Œå¦‚æœè¾ƒé«˜ï¼Œè¡¨ç¤ºæœåŠ¡å™¨æ­£æ‰§è¡Œå¤§é‡å…¨ç´¢å¼•æ‰«æï¼ˆè¿™ä¸ªå€¼è¶Šä½è¶Šå¥½ï¼‰</p></li><li><p>Handler_read_keyï¼šå¦‚æœç´¢å¼•æ­£åœ¨å·¥ä½œï¼Œè¿™ä¸ªå€¼ä»£è¡¨ä¸€ä¸ªè¡Œè¢«ç´¢å¼•å€¼è¯»çš„æ¬¡æ•°ï¼Œå€¼è¶Šä½è¡¨ç¤ºç´¢å¼•ä¸ç»å¸¸ä½¿ç”¨ï¼ˆè¿™ä¸ªå€¼è¶Šé«˜è¶Šå¥½ï¼‰</p></li><li><p>Handler_read_nextï¼šæŒ‰ç…§é”®é¡ºåºè¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ï¼Œå¦‚æœèŒƒå›´çº¦æŸæˆ–æ‰§è¡Œç´¢å¼•æ‰«ææ¥æŸ¥è¯¢ç´¢å¼•åˆ—ï¼Œå€¼å¢åŠ </p></li><li><p>Handler_read_prevï¼šæŒ‰ç…§é”®é¡ºåºè¯»å‰ä¸€è¡Œçš„è¯·æ±‚æ•°ï¼Œè¯¥è¯»æ–¹æ³•ä¸»è¦ç”¨äºä¼˜åŒ– ORDER BY ... DESC</p></li><li><p>Handler_read_rndï¼šæ ¹æ®å›ºå®šä½ç½®è¯»ä¸€è¡Œçš„è¯·æ±‚æ•°ï¼Œå¦‚æœæ‰§è¡Œå¤§é‡æŸ¥è¯¢å¹¶å¯¹ç»“æœè¿›è¡Œæ’åºåˆ™è¯¥å€¼è¾ƒé«˜ï¼Œå¯èƒ½æ˜¯ä½¿ç”¨äº†å¤§é‡éœ€è¦ MySQL æ‰«ææ•´ä¸ªè¡¨çš„æŸ¥è¯¢æˆ–è¿æ¥ï¼Œè¿™ä¸ªå€¼è¾ƒé«˜æ„å‘³ç€è¿è¡Œæ•ˆç‡ä½ï¼Œåº”è¯¥å»ºç«‹ç´¢å¼•æ¥è§£å†³</p></li><li><p>Handler_read_rnd_nextï¼šåœ¨æ•°æ®æ–‡ä»¶ä¸­è¯»ä¸‹ä¸€è¡Œçš„è¯·æ±‚æ•°ï¼Œå¦‚æœæ­£è¿›è¡Œå¤§é‡çš„è¡¨æ‰«æï¼Œè¯¥å€¼è¾ƒé«˜ï¼Œè¯´æ˜è¡¨ç´¢å¼•ä¸æ­£ç¡®æˆ–å†™å…¥çš„æŸ¥è¯¢æ²¡æœ‰åˆ©ç”¨ç´¢å¼•</p></li></ul><hr><h3 id="sql-ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#sql-ä¼˜åŒ–" aria-hidden="true">#</a> SQL ä¼˜åŒ–</h3><h4 id="è‡ªå¢ä¸»é”®" tabindex="-1"><a class="header-anchor" href="#è‡ªå¢ä¸»é”®" aria-hidden="true">#</a> è‡ªå¢ä¸»é”®</h4><h5 id="è‡ªå¢æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#è‡ªå¢æœºåˆ¶" aria-hidden="true">#</a> è‡ªå¢æœºåˆ¶</h5><p>è‡ªå¢ä¸»é”®å¯ä»¥è®©ä¸»é”®ç´¢å¼•å°½é‡åœ°ä¿æŒåœ¨æ•°æ®é¡µä¸­é€’å¢é¡ºåºæ’å…¥ï¼Œä¸è‡ªå¢éœ€è¦å¯»æ‰¾å…¶ä»–é¡µæ’å…¥ï¼Œå¯¼è‡´éšæœº IO å’Œé¡µåˆ†è£‚çš„æƒ…å†µ</p><p>è¡¨çš„ç»“æ„å®šä¹‰å­˜æ”¾åœ¨åç¼€åä¸º.frm çš„æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯å¹¶ä¸ä¼šä¿å­˜è‡ªå¢å€¼ï¼Œä¸åŒçš„å¼•æ“å¯¹äºè‡ªå¢å€¼çš„ä¿å­˜ç­–ç•¥ä¸åŒï¼š</p><ul><li>MyISAM å¼•æ“çš„è‡ªå¢å€¼ä¿å­˜åœ¨æ•°æ®æ–‡ä»¶ä¸­</li><li>InnoDB å¼•æ“çš„è‡ªå¢å€¼ä¿å­˜åœ¨äº†å†…å­˜é‡Œï¼Œæ¯æ¬¡æ‰“å¼€è¡¨éƒ½ä¼šå»æ‰¾è‡ªå¢å€¼çš„æœ€å¤§å€¼ max(id)ï¼Œç„¶åå°† max(id)+1 ä½œä¸ºå½“å‰çš„è‡ªå¢å€¼ï¼›8.0 ç‰ˆæœ¬åï¼Œæ‰æœ‰äº†è‡ªå¢å€¼æŒä¹…åŒ–çš„èƒ½åŠ›ï¼Œå°†è‡ªå¢å€¼çš„å˜æ›´è®°å½•åœ¨äº† redo log ä¸­ï¼Œé‡å¯çš„æ—¶å€™ä¾é  redo log æ¢å¤é‡å¯ä¹‹å‰çš„å€¼</li></ul><p>åœ¨æ’å…¥ä¸€è¡Œæ•°æ®çš„æ—¶å€™ï¼Œè‡ªå¢å€¼çš„è¡Œä¸ºå¦‚ä¸‹ï¼š</p><ul><li>å¦‚æœæ’å…¥æ•°æ®æ—¶ id å­—æ®µæŒ‡å®šä¸º 0ã€null æˆ–æœªæŒ‡å®šå€¼ï¼Œé‚£ä¹ˆå°±æŠŠè¿™ä¸ªè¡¨å½“å‰çš„ AUTO_INCREMENT å€¼å¡«åˆ°è‡ªå¢å­—æ®µ</li><li>å¦‚æœæ’å…¥æ•°æ®æ—¶ id å­—æ®µæŒ‡å®šäº†å…·ä½“çš„å€¼ï¼Œæ¯”å¦‚æŸæ¬¡è¦æ’å…¥çš„å€¼æ˜¯ Xï¼Œå½“å‰çš„è‡ªå¢å€¼æ˜¯ Y <ul><li>å¦‚æœ X&lt;Yï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨çš„è‡ªå¢å€¼ä¸å˜</li><li>å¦‚æœ Xâ‰¥Yï¼Œå°±éœ€è¦æŠŠå½“å‰è‡ªå¢å€¼ä¿®æ”¹ä¸ºæ–°çš„è‡ªå¢å€¼</li></ul></li></ul><p>å‚æ•°è¯´æ˜ï¼šauto_increment_offset å’Œ auto_increment_increment åˆ†åˆ«è¡¨ç¤ºè‡ªå¢çš„åˆå§‹å€¼å’Œæ­¥é•¿ï¼Œé»˜è®¤å€¼éƒ½æ˜¯ 1</p><p>è¯­å¥æ‰§è¡Œå¤±è´¥ä¹Ÿä¸å›é€€è‡ªå¢ idï¼Œæ‰€ä»¥ä¿è¯äº†è‡ªå¢ id æ˜¯é€’å¢çš„ï¼Œä½†ä¸ä¿è¯æ˜¯è¿ç»­çš„ï¼ˆä¸èƒ½å›é€€ï¼Œæ‰€ä»¥æœ‰äº›å›æ»šäº‹åŠ¡çš„è‡ªå¢ id å°±ä¸ä¼šé‡æ–°ä½¿ç”¨ï¼Œå¯¼è‡´å‡ºç°ä¸è¿ç»­ï¼‰</p><hr><h5 id="è‡ªå¢-id" tabindex="-1"><a class="header-anchor" href="#è‡ªå¢-id" aria-hidden="true">#</a> è‡ªå¢ ID</h5><p>MySQL ä¸åŒçš„è‡ªå¢ id åœ¨è¾¾åˆ°ä¸Šé™åçš„è¡¨ç°ä¸åŒï¼š</p><ul><li><p>è¡¨çš„è‡ªå¢ id å¦‚æœæ˜¯ int ç±»å‹ï¼Œè¾¾åˆ°ä¸Šé™ 2^32-1 åï¼Œå†ç”³è¯·æ—¶å€¼å°±ä¸ä¼šæ”¹å˜ï¼Œè¿›è€Œå¯¼è‡´ç»§ç»­æ’å…¥æ•°æ®æ—¶æŠ¥ä¸»é”®å†²çªçš„é”™è¯¯</p></li><li><p>row_id é•¿åº¦ä¸º 6 ä¸ªå­—èŠ‚ï¼Œè¾¾åˆ°ä¸Šé™ååˆ™ä¼šå½’ 0 å†é‡æ–°é€’å¢ï¼Œå¦‚æœå‡ºç°ç›¸åŒçš„ row_idï¼Œåå†™çš„æ•°æ®ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ï¼Œé€ æˆæ—§æ•°æ®ä¸¢å¤±ï¼Œå½±å“çš„æ˜¯æ•°æ®å¯é æ€§ï¼Œæ‰€ä»¥åº”è¯¥åœ¨ InnoDB è¡¨ä¸­ä¸»åŠ¨åˆ›å»ºè‡ªå¢ä¸»é”®æŠ¥ä¸»é”®å†²çªï¼Œæ’å…¥å¤±è´¥å½±å“çš„æ˜¯å¯ç”¨æ€§ï¼Œè€Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<strong>å¯é æ€§ä¼˜å…ˆäºå¯ç”¨æ€§</strong></p></li><li><p>Xid é•¿åº¦ 8 å­—èŠ‚ï¼Œç”± Server å±‚ç»´æŠ¤ï¼Œåªéœ€è¦ä¸åœ¨åŒä¸€ä¸ª binlog æ–‡ä»¶ä¸­å‡ºç°é‡å¤å€¼å³å¯ï¼Œè™½ç„¶ç†è®ºä¸Šä¼šå‡ºç°é‡å¤å€¼ï¼Œä½†æ˜¯æ¦‚ç‡æå°</p></li><li><p>InnoDB çš„ max_trx_id é€’å¢å€¼æ¯æ¬¡ MySQL é‡å¯éƒ½ä¼šè¢«ä¿å­˜èµ·æ¥ï¼Œé‡å¯ä¹Ÿä¸ä¼šé‡ç½®ä¸º 0ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ä¸€ç›´å¢åŠ åˆ°è¾¾ä¸Šé™ï¼Œç„¶åä» 0 å¼€å§‹ï¼Œè¿™æ—¶åŸäº‹åŠ¡ 0 ä¿®æ”¹çš„æ•°æ®å¯¹å½“å‰äº‹åŠ¡å°±æ˜¯å¯è§çš„ï¼Œäº§ç”Ÿè„è¯»çš„ç°è±¡</p><p>åªè¯»äº‹åŠ¡ä¸åˆ†é… trx_idï¼Œæ‰€ä»¥ trx_id çš„å¢åŠ é€Ÿåº¦å˜æ…¢äº†</p></li><li><p>thread_id é•¿åº¦ 4 ä¸ªå­—èŠ‚ï¼Œåˆ°è¾¾ä¸Šé™åå°±ä¼šé‡ç½®ä¸º 0ï¼ŒMySQL è®¾è®¡äº†ä¸€ä¸ªå”¯ä¸€æ•°ç»„çš„é€»è¾‘ï¼Œç»™æ–°çº¿ç¨‹åˆ†é… thread_id æ—¶åšåˆ¤æ–­ï¼Œä¿è¯ä¸ä¼šå‡ºç°ä¸¤ä¸ªç›¸åŒçš„ thread_idï¼š</p><div class="language-c++ line-numbers-mode" data-ext="c++"><pre class="language-c++"><code>do {
	new_id = thread_id_counter++;
} while (!thread_ids.insert_unique(new_id).second);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://time.geekbang.org/column/article/83183" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/83183<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="è¦†ç›–ç´¢å¼•-1" tabindex="-1"><a class="header-anchor" href="#è¦†ç›–ç´¢å¼•-1" aria-hidden="true">#</a> è¦†ç›–ç´¢å¼•</h4><p>å¤åˆç´¢å¼•å¶å­èŠ‚ç‚¹ä¸ä»…ä¿å­˜äº†å¤åˆç´¢å¼•çš„å€¼ï¼Œè¿˜æœ‰ä¸»é”®ç´¢å¼•ï¼Œæ‰€ä»¥ä½¿ç”¨è¦†ç›–ç´¢å¼•çš„æ—¶å€™ï¼ŒåŠ ä¸Šä¸»é”®ä¹Ÿä¼šç”¨åˆ°ç´¢å¼•</p><p>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å… SELECT *ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT name,status,address FROM tb_seller WHERE name=&#39;å°ç±³ç§‘æŠ€&#39; AND status=&#39;1&#39; AND address=&#39;è¥¿å®‰å¸‚&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•8.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å¦‚æœæŸ¥è¯¢åˆ—ï¼Œè¶…å‡ºç´¢å¼•åˆ—ï¼Œä¹Ÿä¼šé™ä½æ€§èƒ½ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT name,status,address,password FROM tb_seller WHERE name=&#39;å°ç±³ç§‘æŠ€&#39; AND status=&#39;1&#39; AND address=&#39;è¥¿å®‰å¸‚&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨ç´¢å¼•9.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h4 id="å‡å°‘è®¿é—®" tabindex="-1"><a class="header-anchor" href="#å‡å°‘è®¿é—®" aria-hidden="true">#</a> å‡å°‘è®¿é—®</h4><p>é¿å…å¯¹æ•°æ®è¿›è¡Œé‡å¤æ£€ç´¢ï¼šèƒ½å¤Ÿä¸€æ¬¡è¿æ¥å°±è·å–åˆ°ç»“æœçš„ï¼Œå°±ä¸ç”¨ä¸¤æ¬¡è¿æ¥ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘å¯¹æ•°æ®åº“æ— ç”¨çš„é‡å¤è¯·æ±‚</p><ul><li><p>æŸ¥è¯¢æ•°æ®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT id,name FROM tb_book;
SELECT id,status FROM tb_book; -- å‘æ•°æ®åº“æäº¤ä¸¤æ¬¡è¯·æ±‚ï¼Œæ•°æ®åº“å°±è¦åšä¸¤æ¬¡æŸ¥è¯¢æ“ä½œ
-- &gt; ä¼˜åŒ–ä¸º:
SELECT id,name,statu FROM tb_book;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ’å…¥æ•°æ®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>INSERT INTO tb_test VALUES(1,&#39;Tom&#39;);
INSERT INTO tb_test VALUES(2,&#39;Cat&#39;);
INSERT INTO tb_test VALUES(3,&#39;Jerry&#39;);	-- è¿æ¥ä¸‰æ¬¡æ•°æ®åº“
-- &gt;ä¼˜åŒ–ä¸º
INSERT INTO tb_test VALUES(1,&#39;Tom&#39;),(2,&#39;Cat&#39;)ï¼Œ(3,&#39;Jerry&#39;);	-- è¿æ¥ä¸€æ¬¡
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åœ¨äº‹åŠ¡ä¸­è¿›è¡Œæ•°æ®æ’å…¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>start transaction;
INSERT INTO tb_test VALUES(1,&#39;Tom&#39;);
INSERT INTO tb_test VALUES(2,&#39;Cat&#39;);
INSERT INTO tb_test VALUES(3,&#39;Jerry&#39;);
commit;	-- æ‰‹åŠ¨æäº¤ï¼Œåˆ†æ®µæäº¤
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ•°æ®æœ‰åºæ’å…¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>INSERT INTO tb_test VALUES(1,&#39;Tom&#39;);
INSERT INTO tb_test VALUES(2,&#39;Cat&#39;);
INSERT INTO tb_test VALUES(3,&#39;Jerry&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>å¢åŠ  cache å±‚ï¼šåœ¨åº”ç”¨ä¸­å¢åŠ ç¼“å­˜å±‚æ¥è¾¾åˆ°å‡è½»æ•°æ®åº“è´Ÿæ‹…çš„ç›®çš„ã€‚å¯ä»¥éƒ¨åˆ†æ•°æ®ä»æ•°æ®åº“ä¸­æŠ½å–å‡ºæ¥æ”¾åˆ°åº”ç”¨ç«¯ä»¥æ–‡æœ¬æ–¹å¼å­˜å‚¨ï¼Œæˆ–è€…ä½¿ç”¨æ¡†æ¶ï¼ˆMybatisï¼‰æä¾›çš„ä¸€çº§ç¼“å­˜ / äºŒçº§ç¼“å­˜ï¼Œæˆ–è€…ä½¿ç”¨ Redis æ•°æ®åº“æ¥ç¼“å­˜æ•°æ®</p><hr><h4 id="æ•°æ®æ’å…¥" tabindex="-1"><a class="header-anchor" href="#æ•°æ®æ’å…¥" aria-hidden="true">#</a> æ•°æ®æ’å…¥</h4><p>å½“ä½¿ç”¨ load å‘½ä»¤å¯¼å…¥æ•°æ®çš„æ—¶å€™ï¼Œé€‚å½“çš„è®¾ç½®å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š</p><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-%E4%BC%98%E5%8C%96SQL" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> load data.png)</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>LOAD DATA LOCAL INFILE = &#39;/home/seazean/sql1.log&#39; INTO TABLE `tb_user_1` FIELD TERMINATED BY &#39;,&#39; LINES TERMINATED BY &#39;\n&#39;; -- æ–‡ä»¶æ ¼å¼å¦‚ä¸Šå›¾
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¯¹äº InnoDB ç±»å‹çš„è¡¨ï¼Œæœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼å¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ï¼š</p><ol><li><p><strong>ä¸»é”®é¡ºåºæ’å…¥</strong>ï¼šå› ä¸º InnoDB ç±»å‹çš„è¡¨æ˜¯æŒ‰ç…§ä¸»é”®çš„é¡ºåºä¿å­˜çš„ï¼Œæ‰€ä»¥å°†å¯¼å…¥çš„æ•°æ®æŒ‰ç…§ä¸»é”®çš„é¡ºåºæ’åˆ—ï¼Œå¯ä»¥æœ‰æ•ˆçš„æé«˜å¯¼å…¥æ•°æ®çš„æ•ˆç‡ï¼Œå¦‚æœ InnoDB è¡¨æ²¡æœ‰ä¸»é”®ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè‡ªåŠ¨é»˜è®¤åˆ›å»ºä¸€ä¸ªå†…éƒ¨åˆ—ä½œä¸ºä¸»é”®</p><p>ä¸»é”®æ˜¯å¦è¿ç»­å¯¹æ€§èƒ½å½±å“ä¸å¤§ï¼Œåªè¦æ˜¯é€’å¢çš„å°±å¯ä»¥ï¼Œæ¯”å¦‚é›ªèŠ±ç®—æ³•äº§ç”Ÿçš„ ID ä¸æ˜¯è¿ç»­çš„ï¼Œä½†æ˜¯æ˜¯é€’å¢çš„ï¼Œå› ä¸ºé€’å¢å¯ä»¥è®©ä¸»é”®ç´¢å¼•å°½é‡åœ°ä¿æŒé¡ºåºæ’å…¥ï¼Œ<strong>é¿å…äº†é¡µåˆ†è£‚</strong>ï¼Œå› æ­¤ç´¢å¼•æ›´ç´§å‡‘</p><ul><li>æ’å…¥ ID é¡ºåºæ’åˆ—æ•°æ®ï¼š</li></ul><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLæ’å…¥IDé¡ºåºæ’åˆ—æ•°æ®.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>æ’å…¥ ID æ— åºæ’åˆ—æ•°æ®ï¼š</li></ul><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLæ’å…¥IDæ— åºæ’åˆ—æ•°æ®.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p><strong>å…³é—­å”¯ä¸€æ€§æ ¡éªŒ</strong>ï¼šåœ¨å¯¼å…¥æ•°æ®å‰æ‰§è¡Œ <code>SET UNIQUE_CHECKS=0</code>ï¼Œå…³é—­å”¯ä¸€æ€§æ ¡éªŒï¼›å¯¼å…¥ç»“æŸåæ‰§è¡Œ <code>SET UNIQUE_CHECKS=1</code>ï¼Œæ¢å¤å”¯ä¸€æ€§æ ¡éªŒï¼Œå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLæ’å…¥æ•°æ®å…³é—­å”¯ä¸€æ€§æ ¡éªŒ.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p><strong>æ‰‹åŠ¨æäº¤äº‹åŠ¡</strong>ï¼šå¦‚æœåº”ç”¨ä½¿ç”¨è‡ªåŠ¨æäº¤çš„æ–¹å¼ï¼Œå»ºè®®åœ¨å¯¼å…¥å‰æ‰§è¡Œ<code>SET AUTOCOMMIT=0</code>ï¼Œå…³é—­è‡ªåŠ¨æäº¤ï¼›å¯¼å…¥ç»“æŸåå†æ‰“å¼€è‡ªåŠ¨æäº¤ï¼Œå¯ä»¥æé«˜å¯¼å…¥çš„æ•ˆç‡ã€‚</p><p>äº‹åŠ¡éœ€è¦æ§åˆ¶å¤§å°ï¼Œäº‹åŠ¡å¤ªå¤§å¯èƒ½ä¼šå½±å“æ‰§è¡Œçš„æ•ˆç‡ã€‚MySQL æœ‰ innodb_log_buffer_size é…ç½®é¡¹ï¼Œè¶…è¿‡è¿™ä¸ªå€¼çš„æ—¥å¿—ä¼šå†™å…¥ç£ç›˜æ•°æ®ï¼Œæ•ˆç‡ä¼šä¸‹é™ï¼Œæ‰€ä»¥åœ¨äº‹åŠ¡å¤§å°è¾¾åˆ°é…ç½®é¡¹æ•°æ®çº§å‰è¿›è¡Œäº‹åŠ¡æäº¤å¯ä»¥æé«˜æ•ˆç‡</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLæ’å…¥æ•°æ®æ‰‹åŠ¨æäº¤äº‹åŠ¡.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ol><hr><h4 id="åˆ†ç»„æ’åº" tabindex="-1"><a class="header-anchor" href="#åˆ†ç»„æ’åº" aria-hidden="true">#</a> åˆ†ç»„æ’åº</h4><h5 id="order" tabindex="-1"><a class="header-anchor" href="#order" aria-hidden="true">#</a> ORDER</h5><p>æ•°æ®å‡†å¤‡ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE `emp` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100) NOT NULL,
  `age` INT(3) NOT NULL,
  `salary` INT(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=INNODB DEFAULT CHARSET=utf8mb4;
INSERT INTO `emp` (`id`, `name`, `age`, `salary`) VALUES(&#39;1&#39;,&#39;Tom&#39;,&#39;25&#39;,&#39;2300&#39;);-- ...
CREATE INDEX idx_emp_age_salary ON emp(age, salary);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>ç¬¬ä¸€ç§æ˜¯é€šè¿‡å¯¹è¿”å›æ•°æ®è¿›è¡Œæ’åºï¼Œæ‰€æœ‰ä¸é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›ç»“æœçš„æ’åºéƒ½å« FileSort æ’åºï¼Œä¼šåœ¨å†…å­˜ä¸­é‡æ–°æ’åº</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM emp ORDER BY age DESC;	-- å¹´é¾„é™åº
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-%E4%BC%98%E5%8C%96SQL" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ORDER BYæ’åº1.png)</p></li><li><p>ç¬¬äºŒç§é€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›<strong>æœ‰åºæ•°æ®</strong>ï¼Œè¿™ç§æƒ…å†µä¸º Using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT id, age, salary FROM emp ORDER BY age DESC;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-%E4%BC%98%E5%8C%96SQL" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ORDER BYæ’åº2.png)</p></li><li><p>å¤šå­—æ®µæ’åºï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT id,age,salary FROM emp ORDER BY age DESC, salary DESC;
EXPLAIN SELECT id,age,salary FROM emp ORDER BY salary DESC, age DESC;
EXPLAIN SELECT id,age,salary FROM emp ORDER BY age DESC, salary ASC;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-%E4%BC%98%E5%8C%96SQL" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ORDER BYæ’åº3.png)</p><p>å°½é‡å‡å°‘é¢å¤–çš„æ’åºï¼Œé€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æœ‰åºæ•°æ®ã€‚<strong>éœ€è¦æ»¡è¶³ Order by ä½¿ç”¨ç›¸åŒçš„ç´¢å¼•ã€Order By çš„é¡ºåºå’Œç´¢å¼•é¡ºåºç›¸åŒã€Order by çš„å­—æ®µéƒ½æ˜¯å‡åºæˆ–éƒ½æ˜¯é™åº</strong>ï¼Œå¦åˆ™éœ€è¦é¢å¤–çš„æ“ä½œï¼Œå°±ä¼šå‡ºç° FileSort</p></li><li><p>ORDER BY RAND() å‘½ä»¤ç”¨æ¥è¿›è¡Œéšæœºæ’åºï¼Œä¼šä½¿ç”¨äº†ä¸´æ—¶å†…å­˜è¡¨ï¼Œä¸´æ—¶å†…å­˜è¡¨æ’åºçš„æ—¶ä½¿ç”¨ rowid æ’åºæ–¹æ³•</p></li></ul><p>ä¼˜åŒ–æ–¹å¼ï¼šåˆ›å»ºåˆé€‚çš„ç´¢å¼•èƒ½å¤Ÿå‡å°‘ Filesort çš„å‡ºç°ï¼Œä½†æ˜¯æŸäº›æƒ…å†µä¸‹æ¡ä»¶é™åˆ¶ä¸èƒ½è®© Filesort æ¶ˆå¤±ï¼Œå°±è¦åŠ å¿« Filesort çš„æ’åºæ“ä½œ</p><p>å†…å­˜ä¸´æ—¶è¡¨ï¼ŒMySQL æœ‰ä¸¤ç§ Filesort æ’åºç®—æ³•ï¼š</p><ul><li><p>rowid æ’åºï¼šé¦–å…ˆæ ¹æ®æ¡ä»¶å–å‡ºæ’åºå­—æ®µå’Œä¿¡æ¯ï¼Œç„¶ååœ¨<strong>æ’åºåŒº sort bufferï¼ˆServer å±‚ï¼‰<strong>ä¸­æ’åºï¼Œå¦‚æœ sort buffer ä¸å¤Ÿï¼Œåˆ™åœ¨ä¸´æ—¶è¡¨ temporary table ä¸­å­˜å‚¨æ’åºç»“æœã€‚å®Œæˆæ’åºåå†æ ¹æ®è¡ŒæŒ‡é’ˆ</strong>å›è¡¨è¯»å–è®°å½•</strong>ï¼Œè¯¥æ“ä½œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡éšæœº I/O æ“ä½œ</p><p>è¯´æ˜ï¼šå¯¹äºä¸´æ—¶å†…å­˜è¡¨ï¼Œå›è¡¨è¿‡ç¨‹åªæ˜¯ç®€å•åœ°æ ¹æ®æ•°æ®è¡Œçš„ä½ç½®ï¼Œç›´æ¥è®¿é—®å†…å­˜å¾—åˆ°æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´å¤šè®¿é—®ç£ç›˜ï¼Œä¼˜å…ˆé€‰æ‹©è¯¥æ–¹å¼</p></li><li><p>å…¨å­—æ®µæ’åºï¼šä¸€æ¬¡æ€§å–å‡ºæ»¡è¶³æ¡ä»¶çš„æ‰€æœ‰æ•°æ®ï¼Œéœ€è¦å›è¡¨ï¼Œç„¶ååœ¨æ’åºåŒº sort buffer ä¸­æ’åºåç›´æ¥è¾“å‡ºç»“æœé›†ã€‚æ’åºæ—¶å†…å­˜å¼€é”€è¾ƒå¤§ï¼Œä½†æ˜¯æ’åºæ•ˆç‡æ¯”ä¸¤æ¬¡æ‰«æç®—æ³•é«˜</p></li></ul><p>å…·ä½“çš„é€‰æ‹©æ–¹å¼ï¼š</p><ul><li><p>MySQL é€šè¿‡æ¯”è¾ƒç³»ç»Ÿå˜é‡ max_length_for_sort_data çš„å¤§å°å’Œ Query è¯­å¥å–å‡ºçš„å­—æ®µçš„å¤§å°ï¼Œæ¥åˆ¤å®šä½¿ç”¨å“ªç§æ’åºç®—æ³•ã€‚å¦‚æœå‰è€…å¤§ï¼Œåˆ™è¯´æ˜ sort buffer ç©ºé—´è¶³å¤Ÿï¼Œä½¿ç”¨ç¬¬äºŒç§ä¼˜åŒ–ä¹‹åçš„ç®—æ³•ï¼Œå¦åˆ™ä½¿ç”¨ç¬¬ä¸€ç§ã€‚</p></li><li><p>å¯ä»¥é€‚å½“æé«˜ sort_buffer_size å’Œ max_length_for_sort_data ç³»ç»Ÿå˜é‡ï¼Œæ¥å¢å¤§æ’åºåŒºçš„å¤§å°ï¼Œæé«˜æ’åºçš„æ•ˆç‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET @@max_length_for_sort_data = 10000; 		-- è®¾ç½®å…¨å±€å˜é‡
SET max_length_for_sort_data = 10240; 			-- è®¾ç½®ä¼šè¯å˜é‡
SHOW VARIABLES LIKE &#39;max_length_for_sort_data&#39;;	-- é»˜è®¤1024
SHOW VARIABLES LIKE &#39;sort_buffer_size&#39;;			-- é»˜è®¤262114
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>ç£ç›˜ä¸´æ—¶è¡¨ï¼šæ’åºä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆå †ï¼‰çš„æ–¹å¼</p><hr><h5 id="group" tabindex="-1"><a class="header-anchor" href="#group" aria-hidden="true">#</a> GROUP</h5><p>GROUP BY ä¹Ÿä¼šè¿›è¡Œæ’åºæ“ä½œï¼Œä¸ ORDER BY ç›¸æ¯”ï¼ŒGROUP BY ä¸»è¦åªæ˜¯å¤šäº†æ’åºä¹‹åçš„åˆ†ç»„æ“ä½œï¼Œæ‰€ä»¥åœ¨ GROUP BY çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œä¸ ORDER BY ä¸€æ ·ä¹Ÿå¯ä»¥åˆ©ç”¨åˆ°ç´¢å¼•</p><ul><li><p>åˆ†ç»„æŸ¥è¯¢ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>DROP INDEX idx_emp_age_salary ON emp;
EXPLAIN SELECT age,COUNT(*) FROM emp GROUP BY age;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-%E4%BC%98%E5%8C%96SQL" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> GROUP BYæ’åº1.png)</p><p>Using temporaryï¼šè¡¨ç¤º MySQL éœ€è¦ä½¿ç”¨ä¸´æ—¶è¡¨ï¼ˆä¸æ˜¯ sort bufferï¼‰æ¥å­˜å‚¨ç»“æœé›†ï¼Œå¸¸è§äºæ’åºå’Œåˆ†ç»„æŸ¥è¯¢</p></li><li><p>æŸ¥è¯¢åŒ…å« GROUP BY ä½†æ˜¯ç”¨æˆ·æƒ³è¦é¿å…æ’åºç»“æœçš„æ¶ˆè€—ï¼Œ åˆ™å¯ä»¥æ‰§è¡Œ ORDER BY NULL ç¦æ­¢æ’åºï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT age,COUNT(*) FROM emp GROUP BY age ORDER BY NULL;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-%E4%BC%98%E5%8C%96SQL" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> GROUP BYæ’åº2.png)</p></li><li><p>åˆ›å»ºç´¢å¼•ï¼šç´¢å¼•æœ¬èº«æœ‰åºï¼Œä¸éœ€è¦ä¸´æ—¶è¡¨ï¼Œä¹Ÿä¸éœ€è¦å†é¢å¤–æ’åº</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE INDEX idx_emp_age_salary ON emp(age, salary);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-%E4%BC%98%E5%8C%96SQL" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> GROUP BYæ’åº3.png)</p></li><li><p>æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œä½¿ç”¨ SQL_BIG_RESULT æç¤ºä¼˜åŒ–å™¨ç›´æ¥ä½¿ç”¨ç›´æ¥ç”¨ç£ç›˜ä¸´æ—¶è¡¨</p></li></ul><hr><h4 id="è”åˆæŸ¥è¯¢-1" tabindex="-1"><a class="header-anchor" href="#è”åˆæŸ¥è¯¢-1" aria-hidden="true">#</a> è”åˆæŸ¥è¯¢</h4><p>å¯¹äºåŒ…å« OR çš„æŸ¥è¯¢å­å¥ï¼Œå¦‚æœè¦åˆ©ç”¨ç´¢å¼•ï¼Œåˆ™ OR ä¹‹é—´çš„<strong>æ¯ä¸ªæ¡ä»¶åˆ—éƒ½å¿…é¡»ç”¨åˆ°ç´¢å¼•ï¼Œè€Œä¸”ä¸èƒ½ä½¿ç”¨åˆ°æ¡ä»¶ä¹‹é—´çš„å¤åˆç´¢å¼•</strong>ï¼Œå¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œåˆ™åº”è¯¥è€ƒè™‘å¢åŠ ç´¢å¼•</p><ul><li><p>æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM emp WHERE id = 1 OR age = 30;	-- ä¸¤ä¸ªç´¢å¼•ï¼Œå¹¶ä¸”ä¸æ˜¯å¤åˆç´¢å¼•
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-%E4%BC%98%E5%8C%96SQL" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ORæ¡ä»¶æŸ¥è¯¢1.png)</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Extra: Using sort_union<span class="token punctuation">(</span>idx_emp_age_salary,PRIMARY<span class="token punctuation">)</span><span class="token punctuation">;</span> Using where
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä½¿ç”¨ UNION æ›¿æ¢ ORï¼Œæ±‚å¹¶é›†ï¼š</p><p>æ³¨æ„ï¼šè¯¥ä¼˜åŒ–åªé’ˆå¯¹å¤šä¸ªç´¢å¼•åˆ—æœ‰æ•ˆï¼Œå¦‚æœæœ‰åˆ—æ²¡æœ‰è¢«ç´¢å¼•ï¼ŒæŸ¥è¯¢æ•ˆç‡å¯èƒ½ä¼šå› ä¸ºæ²¡æœ‰é€‰æ‹© OR è€Œé™ä½</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM emp WHERE id = 1 UNION SELECT * FROM emp WHERE age = 30;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-%E4%BC%98%E5%8C%96SQL" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ORæ¡ä»¶æŸ¥è¯¢2.png)</p></li><li><p>UNION è¦ä¼˜äº OR çš„åŸå› ï¼š</p><ul><li>UNION è¯­å¥çš„ type å€¼ä¸º refï¼ŒOR è¯­å¥çš„ type å€¼ä¸º range</li><li>UNION è¯­å¥çš„ ref å€¼ä¸º constï¼ŒOR è¯­å¥çš„ ref å€¼ä¸º nullï¼Œconst è¡¨ç¤ºæ˜¯å¸¸é‡å€¼å¼•ç”¨ï¼Œéå¸¸å¿«</li></ul></li></ul><hr><h4 id="åµŒå¥—æŸ¥è¯¢-1" tabindex="-1"><a class="header-anchor" href="#åµŒå¥—æŸ¥è¯¢-1" aria-hidden="true">#</a> åµŒå¥—æŸ¥è¯¢</h4><p>MySQL 4.1 ç‰ˆæœ¬ä¹‹åï¼Œå¼€å§‹æ”¯æŒ SQL çš„å­æŸ¥è¯¢</p><ul><li>å¯ä»¥ä½¿ç”¨ SELECT è¯­å¥æ¥åˆ›å»ºä¸€ä¸ªå•åˆ—çš„æŸ¥è¯¢ç»“æœï¼Œç„¶åæŠŠç»“æœä½œä¸ºè¿‡æ»¤æ¡ä»¶ç”¨åœ¨å¦ä¸€ä¸ªæŸ¥è¯¢ä¸­</li><li>ä½¿ç”¨å­æŸ¥è¯¢å¯ä»¥ä¸€æ¬¡æ€§çš„å®Œæˆé€»è¾‘ä¸Šéœ€è¦å¤šä¸ªæ­¥éª¤æ‰èƒ½å®Œæˆçš„ SQL æ“ä½œï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é¿å…äº‹åŠ¡æˆ–è€…è¡¨é”æ­»</li><li>åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œ<strong>å­æŸ¥è¯¢æ˜¯å¯ä»¥è¢«æ›´é«˜æ•ˆçš„è¿æ¥ï¼ˆJOINï¼‰æ›¿ä»£</strong></li></ul><p>ä¾‹å¦‚æŸ¥æ‰¾æœ‰è§’è‰²çš„æ‰€æœ‰çš„ç”¨æˆ·ä¿¡æ¯ï¼š</p><ul><li><p>æ‰§è¡Œè®¡åˆ’ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM t_user WHERE id IN (SELECT user_id FROM user_role);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLåµŒå¥—æŸ¥è¯¢1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>ä¼˜åŒ–åï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM t_user u , user_role ur WHERE u.id = ur.user_id;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLåµŒå¥—æŸ¥è¯¢2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>è¿æ¥æŸ¥è¯¢ä¹‹æ‰€ä»¥æ•ˆç‡æ›´é«˜ ï¼Œæ˜¯å› ä¸º<strong>ä¸éœ€è¦åœ¨å†…å­˜ä¸­åˆ›å»ºä¸´æ—¶è¡¨</strong>æ¥å®Œæˆé€»è¾‘ä¸Šéœ€è¦ä¸¤ä¸ªæ­¥éª¤çš„æŸ¥è¯¢å·¥ä½œ</p></li></ul><hr><h4 id="åˆ†é¡µæŸ¥è¯¢-1" tabindex="-1"><a class="header-anchor" href="#åˆ†é¡µæŸ¥è¯¢-1" aria-hidden="true">#</a> åˆ†é¡µæŸ¥è¯¢</h4><p>ä¸€èˆ¬åˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œé€šè¿‡åˆ›å»ºè¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°æé«˜æ€§èƒ½</p><p>ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ <code>LIMIT 200000,10</code>ï¼Œæ­¤æ—¶éœ€è¦ MySQL æ‰«æå‰ 200010 è®°å½•ï¼Œä»…ä»…è¿”å› 200000 - 200010 ä¹‹é—´çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§</p><ul><li><p>åˆ†é¡µæŸ¥è¯¢ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_user_1 LIMIT 200000,10;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLåˆ†é¡µæŸ¥è¯¢1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>ä¼˜åŒ–æ–¹å¼ä¸€ï¼šå†…è¿æ¥æŸ¥è¯¢ï¼Œåœ¨ç´¢å¼•åˆ— id ä¸Šå®Œæˆæ’åºåˆ†é¡µæ“ä½œï¼Œæœ€åæ ¹æ®ä¸»é”®å…³è”å›åŸè¡¨æŸ¥è¯¢æ‰€éœ€è¦çš„å…¶ä»–åˆ—å†…å®¹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_user_1 t,(SELECT id FROM tb_user_1 ORDER BY id LIMIT 200000,10) a WHERE t.id = a.id;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLåˆ†é¡µæŸ¥è¯¢2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>ä¼˜åŒ–æ–¹å¼äºŒï¼šæ–¹æ¡ˆé€‚ç”¨äºä¸»é”®è‡ªå¢çš„è¡¨ï¼Œå¯ä»¥æŠŠ LIMIT æŸ¥è¯¢è½¬æ¢æˆæŸä¸ªä½ç½®çš„æŸ¥è¯¢</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_user_1 WHERE id &gt; 200000 LIMIT 10;			-- å†™æ³• 1
EXPLAIN SELECT * FROM tb_user_1 WHERE id BETWEEN 200000 and 200010;	-- å†™æ³• 2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLåˆ†é¡µæŸ¥è¯¢3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul><hr><h4 id="ä½¿ç”¨æç¤º" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æç¤º" aria-hidden="true">#</a> ä½¿ç”¨æç¤º</h4><p>SQL æç¤ºï¼Œæ˜¯ä¼˜åŒ–æ•°æ®åº“çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œå°±æ˜¯åœ¨ SQL è¯­å¥ä¸­åŠ å…¥ä¸€äº›æç¤ºæ¥è¾¾åˆ°ä¼˜åŒ–æ“ä½œçš„ç›®çš„</p><ul><li><p>USE INDEXï¼šåœ¨æŸ¥è¯¢è¯­å¥ä¸­è¡¨åçš„åé¢æ·»åŠ  USE INDEX æ¥æä¾› MySQL å»å‚è€ƒçš„ç´¢å¼•åˆ—è¡¨ï¼Œå¯ä»¥è®© MySQL ä¸å†è€ƒè™‘å…¶ä»–å¯ç”¨çš„ç´¢å¼•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE INDEX idx_seller_name ON tb_seller(name);
EXPLAIN SELECT * FROM tb_seller USE INDEX(idx_seller_name) WHERE name=&#39;å°ç±³ç§‘æŠ€&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨æç¤º1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>IGNORE INDEXï¼šè®© MySQL å¿½ç•¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªç´¢å¼•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ IGNORE INDEX ä½œä¸ºæç¤º</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller IGNORE INDEX(idx_seller_name) WHERE name = &#39;å°ç±³ç§‘æŠ€&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨æç¤º2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>FORCE INDEXï¼šå¼ºåˆ¶ MySQL ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„ç´¢å¼•</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>EXPLAIN SELECT * FROM tb_seller FORCE INDEX(idx_seller_name_sta_addr) WHERE NAME=&#39;å°ç±³ç§‘æŠ€&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¼˜åŒ–SQLä½¿ç”¨æç¤º3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul><hr><h4 id="ç»Ÿè®¡è®¡æ•°" tabindex="-1"><a class="header-anchor" href="#ç»Ÿè®¡è®¡æ•°" aria-hidden="true">#</a> ç»Ÿè®¡è®¡æ•°</h4><p>åœ¨ä¸åŒçš„ MySQL å¼•æ“ä¸­ï¼Œcount(*) æœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼š</p><ul><li>MyISAM å¼•æ“æŠŠä¸€ä¸ªè¡¨çš„æ€»è¡Œæ•°å­˜åœ¨äº†ç£ç›˜ä¸Šï¼Œå› æ­¤æ‰§è¡Œ count(*) çš„æ—¶å€™ä¼šç›´æ¥è¿”å›è¿™ä¸ªæ•°ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œä½†ä¸æ”¯æŒäº‹åŠ¡</li><li>show table status å‘½ä»¤é€šè¿‡é‡‡æ ·ä¼°ç®—å¯ä»¥å¿«é€Ÿè·å–ï¼Œä½†æ˜¯ä¸å‡†ç¡®</li><li>InnoDB è¡¨æ‰§è¡Œ count(*) ä¼šéå†å…¨è¡¨ï¼Œè™½ç„¶ç»“æœå‡†ç¡®ï¼Œä½†ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜</li></ul><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>è®¡æ•°ä¿å­˜åœ¨ Redis ä¸­ï¼Œä½†æ˜¯æ›´æ–° MySQL å’Œ Redis çš„æ“ä½œä¸æ˜¯åŸå­çš„ï¼Œä¼šå­˜åœ¨æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜</p></li><li><p>è®¡æ•°ç›´æ¥æ”¾åˆ°æ•°æ®åº“é‡Œå•ç‹¬çš„ä¸€å¼ è®¡æ•°è¡¨ä¸­ï¼Œåˆ©ç”¨äº‹åŠ¡è§£å†³è®¡æ•°ç²¾ç¡®é—®é¢˜ï¼š</p><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-è®¡æ•°countä¼˜åŒ–.png" style="zoom:50%;"><p>ä¼šè¯ B çš„è¯»æ“ä½œåœ¨ T3 æ‰§è¡Œçš„ï¼Œè¿™æ—¶æ›´æ–°äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥è®¡æ•°å€¼åŠ  1 è¿™ä¸ªæ“ä½œå¯¹ä¼šè¯ B è¿˜ä¸å¯è§ï¼Œå› æ­¤ä¼šè¯ B æŸ¥è¯¢çš„è®¡æ•°å€¼å’Œæœ€è¿‘ 100 æ¡è®°å½•ï¼Œè¿”å›çš„ç»“æœé€»è¾‘ä¸Šå°±æ˜¯ä¸€è‡´çš„</p><p>å¹¶å‘ç³»ç»Ÿæ€§èƒ½çš„è§’åº¦è€ƒè™‘ï¼Œåº”è¯¥å…ˆæ’å…¥æ“ä½œè®°å½•å†æ›´æ–°è®¡æ•°è¡¨ï¼Œå› ä¸ºæ›´æ–°è®¡æ•°è¡¨æ¶‰åŠåˆ°è¡Œé”çš„ç«äº‰ï¼Œ<strong>å…ˆæ’å…¥å†æ›´æ–°èƒ½æœ€å¤§ç¨‹åº¦åœ°å‡å°‘äº‹åŠ¡ä¹‹é—´çš„é”ç­‰å¾…ï¼Œæå‡å¹¶å‘åº¦</strong></p></li></ul><p>count å‡½æ•°çš„æŒ‰ç…§æ•ˆç‡æ’åºï¼š<code>count(å­—æ®µ) &lt; count(ä¸»é”®id) &lt; count(1) â‰ˆ count(*)</code>ï¼Œæ‰€ä»¥å»ºè®®å°½é‡ä½¿ç”¨ count(*)</p><ul><li>count(ä¸»é”® id)ï¼šInnoDB å¼•æ“ä¼šéå†æ•´å¼ è¡¨ï¼ŒæŠŠæ¯ä¸€è¡Œçš„ id å€¼éƒ½å–å‡ºæ¥è¿”å›ç»™ Server å±‚ï¼ŒServer åˆ¤æ–­ id ä¸ä¸ºç©ºå°±æŒ‰è¡Œç´¯åŠ </li><li>count(1)ï¼šInnoDB å¼•æ“éå†æ•´å¼ è¡¨ä½†ä¸å–å€¼ï¼ŒServer å±‚å¯¹äºè¿”å›çš„æ¯ä¸€è¡Œï¼Œæ”¾ä¸€ä¸ªæ•°å­— 1 è¿›å»ï¼Œåˆ¤æ–­ä¸ä¸ºç©ºå°±æŒ‰è¡Œç´¯åŠ </li><li>count(å­—æ®µ)ï¼šå¦‚æœè¿™ä¸ªå­—æ®µæ˜¯å®šä¹‰ä¸º not null çš„è¯ï¼Œä¸€è¡Œè¡Œåœ°ä»è®°å½•é‡Œé¢è¯»å‡ºè¿™ä¸ªå­—æ®µï¼Œåˆ¤æ–­ä¸èƒ½ä¸º nullï¼ŒæŒ‰è¡Œç´¯åŠ ï¼›å¦‚æœè¿™ä¸ªå­—æ®µå®šä¹‰å…è®¸ä¸º nullï¼Œé‚£ä¹ˆæ‰§è¡Œçš„æ—¶å€™ï¼Œåˆ¤æ–­åˆ°æœ‰å¯èƒ½æ˜¯ nullï¼Œè¿˜è¦æŠŠå€¼å–å‡ºæ¥å†åˆ¤æ–­ä¸€ä¸‹ï¼Œä¸æ˜¯ null æ‰ç´¯åŠ </li><li>count(*)ï¼šä¸å–å€¼ï¼ŒæŒ‰è¡Œç´¯åŠ </li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://time.geekbang.org/column/article/72775" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/72775<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h3 id="ç¼“å†²ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ç¼“å†²ä¼˜åŒ–" aria-hidden="true">#</a> ç¼“å†²ä¼˜åŒ–</h3><h4 id="ä¼˜åŒ–åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–åŸåˆ™" aria-hidden="true">#</a> ä¼˜åŒ–åŸåˆ™</h4><p>ä¸‰ä¸ªåŸåˆ™ï¼š</p><ul><li>å°†å°½é‡å¤šçš„å†…å­˜åˆ†é…ç»™ MySQL åšç¼“å­˜ï¼Œä½†ä¹Ÿè¦ç»™æ“ä½œç³»ç»Ÿå’Œå…¶ä»–ç¨‹åºé¢„ç•™è¶³å¤Ÿå†…å­˜</li><li>MyISAM å­˜å‚¨å¼•æ“çš„æ•°æ®æ–‡ä»¶è¯»å–ä¾èµ–äºæ“ä½œç³»ç»Ÿè‡ªèº«çš„ IO ç¼“å­˜ï¼Œå¦‚æœæœ‰ MyISAM è¡¨ï¼Œå°±è¦é¢„ç•™æ›´å¤šçš„å†…å­˜ç»™æ“ä½œç³»ç»Ÿåš IO ç¼“å­˜</li><li>æ’åºåŒºã€è¿æ¥åŒºç­‰ç¼“å­˜æ˜¯åˆ†é…ç»™æ¯ä¸ªæ•°æ®åº“ä¼šè¯ï¼ˆSessionï¼‰ä¸“ç”¨çš„ï¼Œå€¼çš„è®¾ç½®è¦æ ¹æ®æœ€å¤§è¿æ¥æ•°åˆç†åˆ†é…ï¼Œå¦‚æœè®¾ç½®å¤ªå¤§ï¼Œä¸ä½†æµªè´¹èµ„æºï¼Œè€Œä¸”åœ¨å¹¶å‘æ•°è¾ƒé«˜æ—¶ä¼šå¯¼è‡´ç‰©ç†å†…å­˜è€—å°½</li></ul><hr><h4 id="ç¼“å†²å†…å­˜" tabindex="-1"><a class="header-anchor" href="#ç¼“å†²å†…å­˜" aria-hidden="true">#</a> ç¼“å†²å†…å­˜</h4><p>Buffer Pool æœ¬è´¨ä¸Šæ˜¯ InnoDB å‘æ“ä½œç³»ç»Ÿç”³è¯·çš„ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ã€‚InnoDB çš„æ•°æ®æ˜¯æŒ‰æ•°æ®é¡µä¸ºå•ä½æ¥è¯»å†™ï¼Œæ¯ä¸ªæ•°æ®é¡µçš„å¤§å°é»˜è®¤æ˜¯ 16KBã€‚æ•°æ®æ˜¯å­˜æ”¾åœ¨ç£ç›˜ä¸­ï¼Œæ¯æ¬¡è¯»å†™æ•°æ®éƒ½éœ€è¦è¿›è¡Œç£ç›˜ IO å°†æ•°æ®è¯»å…¥å†…å­˜è¿›è¡Œæ“ä½œï¼Œæ•ˆç‡ä¼šå¾ˆä½ï¼Œæ‰€ä»¥æä¾›äº† Buffer Pool æ¥æš‚å­˜è¿™äº›æ•°æ®é¡µï¼Œç¼“å­˜ä¸­çš„è¿™äº›é¡µåˆå«ç¼“å†²é¡µ</p><p>å·¥ä½œåŸç†ï¼š</p><ul><li>ä»æ•°æ®åº“è¯»å–æ•°æ®æ—¶ï¼Œä¼šé¦–å…ˆä»ç¼“å­˜ä¸­è¯»å–ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™ä»ç£ç›˜è¯»å–åæ”¾å…¥ Buffer Pool</li><li>å‘æ•°æ®åº“å†™å…¥æ•°æ®æ—¶ï¼Œä¼šå†™å…¥ç¼“å­˜ï¼Œç¼“å­˜ä¸­ä¿®æ”¹çš„æ•°æ®ä¼š<strong>å®šæœŸåˆ·æ–°</strong>åˆ°ç£ç›˜ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºåˆ·è„</li></ul><p>Buffer Pool ä¸­æ¯ä¸ªç¼“å†²é¡µéƒ½æœ‰å¯¹åº”çš„æ§åˆ¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡¨ç©ºé—´ç¼–å·ã€é¡µå·ã€åç§»é‡ã€é“¾è¡¨ä¿¡æ¯ç­‰ï¼Œæ§åˆ¶ä¿¡æ¯å­˜æ”¾åœ¨å ç”¨çš„å†…å­˜ç§°ä¸ºæ§åˆ¶å—ï¼Œæ§åˆ¶å—ä¸ç¼“å†²é¡µæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä½†å¹¶ä¸æ˜¯ç‰©ç†ä¸Šç›¸è¿çš„ï¼Œéƒ½åœ¨ç¼“å†²æ± ä¸­</p><p>MySQL æä¾›äº†ç¼“å†²é¡µçš„å¿«é€ŸæŸ¥æ‰¾æ–¹å¼ï¼š<strong>å“ˆå¸Œè¡¨</strong>ï¼Œä½¿ç”¨è¡¨ç©ºé—´å·å’Œé¡µå·ä½œä¸º Keyï¼Œç¼“å†²é¡µæ§åˆ¶å—çš„åœ°å€ä½œä¸º Value åˆ›å»ºä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œè·å–æ•°æ®é¡µæ—¶æ ¹æ® Key è¿›è¡Œå“ˆå¸Œå¯»å€ï¼š</p><ul><li>å¦‚æœä¸å­˜åœ¨å¯¹åº”çš„ç¼“å­˜é¡µï¼Œå°±ä» free é“¾è¡¨ä¸­é€‰ä¸€ä¸ªç©ºé—²ç¼“å†²é¡µï¼ŒæŠŠç£ç›˜ä¸­çš„å¯¹åº”é¡µåŠ è½½åˆ°è¯¥ä½ç½®</li><li>å¦‚æœå­˜åœ¨å¯¹åº”çš„ç¼“å­˜é¡µï¼Œç›´æ¥è·å–ä½¿ç”¨ï¼Œæé«˜æŸ¥è¯¢æ•°æ®çš„æ•ˆç‡</li></ul><p>å½“å†…å­˜æ•°æ®é¡µè·Ÿç£ç›˜æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´æ—¶ï¼Œç§°è¿™ä¸ªå†…å­˜é¡µä¸ºè„é¡µï¼›å†…å­˜æ•°æ®å†™å…¥ç£ç›˜åï¼Œå†…å­˜å’Œç£ç›˜ä¸Šçš„æ•°æ®é¡µä¸€è‡´ï¼Œç§°ä¸ºå¹²å‡€é¡µ</p><hr><h4 id="å†…å­˜ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#å†…å­˜ç®¡ç†" aria-hidden="true">#</a> å†…å­˜ç®¡ç†</h4><h5 id="free-é“¾è¡¨" tabindex="-1"><a class="header-anchor" href="#free-é“¾è¡¨" aria-hidden="true">#</a> Free é“¾è¡¨</h5><p>MySQL å¯åŠ¨æ—¶å®Œæˆå¯¹ Buffer Pool çš„åˆå§‹åŒ–ï¼Œå…ˆå‘æ“ä½œç³»ç»Ÿç”³è¯·è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œç„¶åå°†å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²å¯¹æ§åˆ¶å—å’Œç¼“å†²é¡µã€‚ä¸ºäº†åŒºåˆ†ç©ºé—²å’Œå·²å ç”¨çš„æ•°æ®é¡µï¼Œå°†æ‰€æœ‰ç©ºé—²ç¼“å†²é¡µå¯¹åº”çš„<strong>æ§åˆ¶å—ä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹</strong>æ”¾å…¥ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œå°±æ˜¯ Free é“¾è¡¨ï¼ˆ<strong>ç©ºé—²é“¾è¡¨</strong>ï¼‰</p><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ç©ºé—²é“¾è¡¨.png" style="zoom:50%;"><p>åŸºèŠ‚ç‚¹ï¼šæ˜¯ä¸€å—å•ç‹¬ç”³è¯·çš„å†…å­˜ç©ºé—´ï¼ˆå  40 å­—èŠ‚ï¼‰ï¼Œå¹¶ä¸åœ¨ Buffer Pool çš„é‚£ä¸€å¤§ç‰‡è¿ç»­å†…å­˜ç©ºé—´é‡Œ</p><p>ç£ç›˜åŠ è½½é¡µçš„æµç¨‹ï¼š</p><ul><li>ä» Free é“¾è¡¨ä¸­å–å‡ºä¸€ä¸ªç©ºé—²çš„ç¼“å†²é¡µ</li><li>æŠŠç¼“å†²é¡µå¯¹åº”çš„æ§åˆ¶å—çš„ä¿¡æ¯å¡«ä¸Šï¼ˆé¡µæ‰€åœ¨çš„è¡¨ç©ºé—´ã€é¡µå·ä¹‹ç±»çš„ä¿¡æ¯ï¼‰</li><li>æŠŠç¼“å†²é¡µå¯¹åº”çš„ Free é“¾è¡¨èŠ‚ç‚¹ï¼ˆæ§åˆ¶å—ï¼‰ä»é“¾è¡¨ä¸­ç§»é™¤ï¼Œè¡¨ç¤ºè¯¥ç¼“å†²é¡µå·²ç»è¢«ä½¿ç”¨</li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/li1325169021/article/details/121124440" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/li1325169021/article/details/121124440<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h5 id="flush-é“¾è¡¨" tabindex="-1"><a class="header-anchor" href="#flush-é“¾è¡¨" aria-hidden="true">#</a> Flush é“¾è¡¨</h5><p>Flush é“¾è¡¨æ˜¯ä¸€ä¸ªç”¨æ¥<strong>å­˜å‚¨è„é¡µ</strong>çš„é“¾è¡¨ï¼Œå¯¹äºå·²ç»ä¿®æ”¹è¿‡çš„ç¼“å†²è„é¡µï¼Œç¬¬ä¸€æ¬¡ä¿®æ”¹ååŠ å…¥åˆ°<strong>é“¾è¡¨å¤´éƒ¨</strong>ï¼Œä»¥åæ¯æ¬¡ä¿®æ”¹éƒ½ä¸ä¼šé‡æ–°åŠ å…¥ï¼Œåªä¿®æ”¹éƒ¨åˆ†æ§åˆ¶ä¿¡æ¯ï¼Œå‡ºäºæ€§èƒ½è€ƒè™‘å¹¶ä¸æ˜¯ç›´æ¥æ›´æ–°åˆ°ç£ç›˜ï¼Œè€Œæ˜¯åœ¨æœªæ¥çš„æŸä¸ªæ—¶é—´è¿›è¡Œåˆ·è„</p><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-è„é¡µé“¾è¡¨.png" style="zoom:50%;"><p><strong>åå°æœ‰ä¸“é—¨çš„çº¿ç¨‹æ¯éš”ä¸€æ®µæ—¶é—´æŠŠè„é¡µåˆ·æ–°åˆ°ç£ç›˜</strong>ï¼š</p><ul><li>ä» Flush é“¾è¡¨ä¸­åˆ·æ–°ä¸€éƒ¨åˆ†é¡µé¢åˆ°ç£ç›˜ï¼š <ul><li><strong>åå°çº¿ç¨‹å®šæ—¶</strong>ä» Flush é“¾è¡¨åˆ·è„ï¼Œæ ¹æ®ç³»ç»Ÿçš„ç¹å¿™ç¨‹åº¦æ¥å†³å®šåˆ·æ–°é€Ÿç‡ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º BUF_FLUSH_LIST</li><li>çº¿ç¨‹åˆ·è„çš„æ¯”è¾ƒæ…¢ï¼Œå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åŠ è½½ä¸€ä¸ªæ–°çš„æ•°æ®é¡µæ—¶å‘ç°æ²¡æœ‰ç©ºé—²ç¼“å†²é¡µï¼Œæ­¤æ—¶ä¼šå°è¯•ä» LRU é“¾è¡¨å°¾éƒ¨å¯»æ‰¾ç¼“å†²é¡µç›´æ¥é‡Šæ”¾ï¼Œå¦‚æœè¯¥é¡µé¢æ˜¯å·²ç»ä¿®æ”¹è¿‡çš„è„é¡µå°±<strong>åŒæ­¥åˆ·æ–°</strong>åˆ°ç£ç›˜ï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º BUF_FLUSH_SINGLE_PAGE</li></ul></li><li>ä» LRU é“¾è¡¨çš„å†·æ•°æ®ä¸­åˆ·æ–°ä¸€éƒ¨åˆ†é¡µé¢åˆ°ç£ç›˜ï¼Œå³ï¼šBUF_FLUSH_LRU <ul><li>åå°çº¿ç¨‹ä¼šå®šæ—¶ä» LRU é“¾è¡¨çš„å°¾éƒ¨å¼€å§‹æ‰«æä¸€äº›é¡µé¢ï¼Œæ‰«æçš„é¡µé¢æ•°é‡å¯ä»¥é€šè¿‡ç³»ç»Ÿå˜é‡ <code>innodb_lru_scan_depth</code> æŒ‡å®šï¼Œå¦‚æœåœ¨ LRU é“¾è¡¨ä¸­å‘ç°è„é¡µï¼Œåˆ™æŠŠå®ƒä»¬åˆ·æ–°åˆ°ç£ç›˜ï¼Œè¿™ç§æ–¹å¼ç§°ä¸º BUF_FLUSH_LRU</li><li>æ§åˆ¶å—é‡Œä¼šå­˜å‚¨è¯¥ç¼“å†²é¡µæ˜¯å¦è¢«ä¿®æ”¹çš„ä¿¡æ¯ï¼Œæ‰€ä»¥å¯ä»¥å¾ˆå®¹æ˜“çš„è·å–åˆ°æŸä¸ªç¼“å†²é¡µæ˜¯å¦æ˜¯è„é¡µ</li></ul></li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/li1325169021/article/details/121125765" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/li1325169021/article/details/121125765<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h5 id="lru-é“¾è¡¨" tabindex="-1"><a class="header-anchor" href="#lru-é“¾è¡¨" aria-hidden="true">#</a> LRU é“¾è¡¨</h5><p>Buffer Pool éœ€è¦ä¿è¯ç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œæ‰€ä»¥ MySQL åˆ›å»ºäº†ä¸€ä¸ª LRU é“¾è¡¨ï¼Œå½“è®¿é—®æŸä¸ªé¡µæ—¶ï¼š</p><ul><li>å¦‚æœè¯¥é¡µä¸åœ¨ Buffer Pool ä¸­ï¼ŒæŠŠè¯¥é¡µä»ç£ç›˜åŠ è½½è¿›æ¥åä¼šå°†è¯¥ç¼“å†²é¡µå¯¹åº”çš„æ§åˆ¶å—ä½œä¸ºèŠ‚ç‚¹æ”¾å…¥ <strong>LRU é“¾è¡¨çš„å¤´éƒ¨</strong>ï¼Œä¿è¯çƒ­ç‚¹æ•°æ®åœ¨é“¾è¡¨å¤´</li><li>å¦‚æœè¯¥é¡µåœ¨ Buffer Pool ä¸­ï¼Œåˆ™ç›´æ¥æŠŠè¯¥é¡µå¯¹åº”çš„æ§åˆ¶å—ç§»åŠ¨åˆ° LRU é“¾è¡¨çš„å¤´éƒ¨ï¼Œæ‰€ä»¥ LRU é“¾è¡¨å°¾éƒ¨å°±æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ç¼“å†²é¡µ</li></ul><p>MySQL åŸºäºå±€éƒ¨æ€§åŸç†æä¾›äº†é¢„è¯»åŠŸèƒ½ï¼š</p><ul><li>çº¿æ€§é¢„è¯»ï¼šç³»ç»Ÿå˜é‡ <code>innodb_read_ahead_threshold</code>ï¼Œå¦‚æœé¡ºåºè®¿é—®æŸä¸ªåŒºï¼ˆextentï¼š16 KB çš„é¡µï¼Œè¿ç»­ 64 ä¸ªå½¢æˆä¸€ä¸ªåŒºï¼Œä¸€ä¸ªåŒºé»˜è®¤ 1MB å¤§å°ï¼‰çš„é¡µé¢æ•°è¶…è¿‡äº†è¯¥ç³»ç»Ÿå˜é‡å€¼ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡<strong>å¼‚æ­¥è¯»å–</strong>ä¸‹ä¸€ä¸ªåŒºä¸­å…¨éƒ¨çš„é¡µé¢åˆ° Buffer Pool ä¸­</li><li>éšæœºé¢„è¯»ï¼šå¦‚æœæŸä¸ªåŒº 13 ä¸ªè¿ç»­çš„é¡µé¢éƒ½è¢«åŠ è½½åˆ° Buffer Poolï¼Œæ— è®ºè¿™äº›é¡µé¢æ˜¯å¦æ˜¯é¡ºåºè¯»å–ï¼Œéƒ½ä¼šè§¦å‘ä¸€æ¬¡<strong>å¼‚æ­¥è¯»å–</strong>æœ¬åŒºæ‰€æœ‰çš„å…¶ä»–é¡µé¢åˆ° Buffer Pool ä¸­</li></ul><p>é¢„è¯»ä¼šé€ æˆåŠ è½½å¤ªå¤šç”¨ä¸åˆ°çš„æ•°æ®é¡µï¼Œé€ æˆé‚£äº›ä½¿ç”¨é¢‘ç‡å¾ˆé«˜çš„æ•°æ®é¡µè¢«æŒ¤åˆ° LRU é“¾è¡¨å°¾éƒ¨ï¼Œæ‰€ä»¥ InnoDB å°† LRU é“¾è¡¨åˆ†æˆä¸¤æ®µï¼Œ<strong>å†·çƒ­æ•°æ®éš”ç¦»</strong>ï¼š</p><ul><li>ä¸€éƒ¨åˆ†å­˜å‚¨ä½¿ç”¨é¢‘ç‡å¾ˆé«˜çš„æ•°æ®é¡µï¼Œè¿™éƒ¨åˆ†é“¾è¡¨ä¹Ÿå«çƒ­æ•°æ®ï¼Œyoung åŒºï¼Œé è¿‘é“¾è¡¨å¤´éƒ¨çš„åŒºåŸŸ</li><li>ä¸€éƒ¨åˆ†å­˜å‚¨ä½¿ç”¨é¢‘ç‡ä¸é«˜çš„å†·æ•°æ®ï¼Œold åŒºï¼Œé è¿‘é“¾è¡¨å°¾éƒ¨ï¼Œé»˜è®¤å  37%ï¼Œå¯ä»¥é€šè¿‡ç³»ç»Ÿå˜é‡ <code>innodb_old_blocks_pct</code> æŒ‡å®š</li></ul><p>å½“ç£ç›˜ä¸Šçš„æŸæ•°æ®é¡µè¢«åˆæ¬¡åŠ è½½åˆ° Buffer Pool ä¸­ä¼šè¢«æ”¾å…¥ old åŒºï¼Œæ·˜æ±°æ—¶ä¼˜å…ˆæ·˜æ±° old åŒº</p><ul><li>å½“å¯¹ old åŒºçš„æ•°æ®è¿›è¡Œè®¿é—®æ—¶ï¼Œä¼šåœ¨æ§åˆ¶å—è®°å½•ä¸‹è®¿é—®æ—¶é—´ï¼Œç­‰å¾…åç»­çš„è®¿é—®æ—¶é—´ä¸ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶é—´æ˜¯å¦åœ¨æŸä¸ªæ—¶é—´é—´éš”å†…ï¼Œé€šè¿‡ç³»ç»Ÿå˜é‡ <code>innodb_old_blocks_time</code> æŒ‡å®šæ—¶é—´é—´éš”ï¼Œé»˜è®¤ 1000msï¼Œæˆç«‹å°±<strong>ç§»åŠ¨åˆ° young åŒºçš„é“¾è¡¨å¤´éƒ¨</strong></li><li><code>innodb_old_blocks_time</code> ä¸º 0 æ—¶ï¼Œæ¯æ¬¡è®¿é—®ä¸€ä¸ªé¡µé¢éƒ½ä¼šæ”¾å…¥ young åŒºçš„å¤´éƒ¨</li></ul><hr><h4 id="å‚æ•°ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#å‚æ•°ä¼˜åŒ–" aria-hidden="true">#</a> å‚æ•°ä¼˜åŒ–</h4><p>InnoDB ç”¨ä¸€å—å†…å­˜åŒºåš IO ç¼“å­˜æ± ï¼Œè¯¥ç¼“å­˜æ± ä¸ä»…ç”¨æ¥ç¼“å­˜ InnoDB çš„ç´¢å¼•å—ï¼Œä¹Ÿç”¨æ¥ç¼“å­˜ InnoDB çš„æ•°æ®å—ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æŒ‡ä»¤æŸ¥çœ‹ Buffer Pool çš„çŠ¶æ€ä¿¡æ¯ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW ENGINE INNODB STATUS\G
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>Buffer pool hit rate</code> å­—æ®µä»£è¡¨<strong>å†…å­˜å‘½ä¸­ç‡</strong>ï¼Œè¡¨ç¤º Buffer Pool å¯¹æŸ¥è¯¢çš„åŠ é€Ÿæ•ˆæœ</p><p>æ ¸å¿ƒå‚æ•°ï¼š</p><ul><li><p><code>innodb_buffer_pool_size</code>ï¼šè¯¥å˜é‡å†³å®šäº† Innodb å­˜å‚¨å¼•æ“è¡¨æ•°æ®å’Œç´¢å¼•æ•°æ®çš„æœ€å¤§ç¼“å­˜åŒºå¤§å°ï¼Œé»˜è®¤ 128M</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW VARIABLES LIKE &#39;innodb_buffer_pool_size&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨ä¿è¯æ“ä½œç³»ç»ŸåŠå…¶ä»–ç¨‹åºæœ‰è¶³å¤Ÿå†…å­˜å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œ<code>innodb_buffer_pool_size</code> çš„å€¼è¶Šå¤§ï¼Œç¼“å­˜å‘½ä¸­ç‡è¶Šé«˜ï¼Œå»ºè®®è®¾ç½®æˆå¯ç”¨ç‰©ç†å†…å­˜çš„ 60%~80%</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">innodb_buffer_pool_size</span><span class="token operator">=</span>512M
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p><code>innodb_log_buffer_size</code>ï¼šè¯¥å€¼å†³å®šäº† Innodb æ—¥å¿—ç¼“å†²åŒºçš„å¤§å°ï¼Œä¿å­˜è¦å†™å…¥ç£ç›˜ä¸Šçš„æ—¥å¿—æ–‡ä»¶æ•°æ®</p><p>å¯¹äºå¯èƒ½äº§ç”Ÿå¤§é‡æ›´æ–°è®°å½•çš„å¤§äº‹åŠ¡ï¼Œå¢åŠ è¯¥å€¼çš„å¤§å°ï¼Œå¯ä»¥é¿å… Innodb åœ¨äº‹åŠ¡æäº¤å‰å°±æ‰§è¡Œä¸å¿…è¦çš„æ—¥å¿—å†™å…¥ç£ç›˜æ“ä½œï¼Œå½±å“æ‰§è¡Œæ•ˆç‡ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">innodb_log_buffer_size</span><span class="token operator">=</span>10M
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>åœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œè®¿é—® Buffer Pool ä¸­çš„å„ç§é“¾è¡¨éƒ½éœ€è¦åŠ é”ï¼Œæ‰€ä»¥å°† Buffer Pool æ‹†æˆè‹¥å¹²ä¸ªå°å®ä¾‹ï¼Œ<strong>æ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªå®ä¾‹</strong>ï¼Œç‹¬ç«‹ç®¡ç†å†…å­˜ç©ºé—´å’Œå„ç§é“¾è¡¨ï¼ˆç±»ä¼¼ ThreadLocalï¼‰ï¼Œå¤šçº¿ç¨‹è®¿é—®å„è‡ªå®ä¾‹äº’ä¸å½±å“ï¼Œæé«˜äº†å¹¶å‘èƒ½åŠ›</p><p>MySQL 5.7.5 ä¹‹å‰ <code>innodb_buffer_pool_size</code> åªæ”¯æŒåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ä¿®æ”¹ï¼Œç°åœ¨å·²ç»æ”¯æŒè¿è¡Œæ—¶ä¿®æ”¹ Buffer Pool çš„å¤§å°ï¼Œä½†æ˜¯æ¯æ¬¡è°ƒæ•´å‚æ•°éƒ½ä¼šé‡æ–°å‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œ<strong>å°†æ—§çš„ç¼“å†²æ± çš„å†…å®¹æ‹·è´åˆ°æ–°ç©ºé—´</strong>éå¸¸è€—æ—¶ï¼Œæ‰€ä»¥ MySQL å¼€å§‹ä»¥ä¸€ä¸ª chunk ä¸ºå•ä½å‘æ“ä½œç³»ç»Ÿç”³è¯·å†…å­˜ï¼Œæ‰€ä»¥ä¸€ä¸ª Buffer Pool å®ä¾‹å¯ä»¥ç”±å¤šä¸ª chunk ç»„æˆ</p><ul><li>åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è®¾ç½®ç³»ç»Ÿå˜é‡ <code>innodb_buffer_pool_instance</code> å¯ä»¥æŒ‡å®š Buffer Pool å®ä¾‹çš„ä¸ªæ•°ï¼Œä½†æ˜¯å½“ Buffer Pool å°äº 1GB æ—¶ï¼Œè®¾ç½®å¤šä¸ªå®ä¾‹æ—¶æ— æ•ˆçš„</li><li>æŒ‡å®šç³»ç»Ÿå˜é‡ <code>innodb_buffer_pool_chunk_size</code> æ¥æ”¹å˜ chunk çš„å¤§å°ï¼Œåªèƒ½åœ¨å¯åŠ¨æ—¶ä¿®æ”¹ï¼Œè¿è¡Œä¸­ä¸èƒ½ä¿®æ”¹ï¼Œè€Œä¸”è¯¥å˜é‡å¹¶ä¸åŒ…å«ç¼“å†²é¡µçš„æ§åˆ¶å—çš„å†…å­˜å¤§å°</li><li><code>innodb_buffer_pool_size</code> å¿…é¡»æ˜¯ <code>innodb_buffer_pool_chunk_size Ã— innodb_buffer_pool_instance</code> çš„å€æ•°ï¼Œé»˜è®¤å€¼æ˜¯ <code>128M Ã— 16 = 2G</code>ï¼ŒBuffer Pool å¿…é¡»æ˜¯ 2G çš„æ•´æ•°å€ï¼Œå¦‚æœæŒ‡å®š 5Gï¼Œä¼šè‡ªåŠ¨è°ƒæ•´æˆ 6G</li><li>å¦‚æœå¯åŠ¨æ—¶ <code>chunk Ã— instances</code> &gt; <code>pool_size</code>ï¼Œé‚£ä¹ˆ chunk çš„å€¼ä¼šè‡ªåŠ¨è®¾ç½®ä¸º <code>pool_size Ã· instances</code></li></ul><hr><h3 id="å†…å­˜ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#å†…å­˜ä¼˜åŒ–" aria-hidden="true">#</a> å†…å­˜ä¼˜åŒ–</h3><h4 id="change" tabindex="-1"><a class="header-anchor" href="#change" aria-hidden="true">#</a> Change</h4><p>InnoDB ç®¡ç†çš„ Buffer Pool ä¸­æœ‰ä¸€å—å†…å­˜å« Change Buffer ç”¨æ¥å¯¹<strong>å¢åˆ æ”¹æ“ä½œ</strong>æä¾›ç¼“å­˜ï¼Œå¯ä»¥é€šè¿‡å‚æ•°æ¥åŠ¨æ€è®¾ç½®ï¼Œè®¾ç½®ä¸º 50 æ—¶è¡¨ç¤º Change Buffer çš„å¤§å°æœ€å¤šå ç”¨ Buffer Pool çš„ 50%</p><ul><li>å”¯ä¸€ç´¢å¼•çš„æ›´æ–°ä¸èƒ½ä½¿ç”¨ Change Bufferï¼Œéœ€è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œåˆ¤æ–­æ²¡æœ‰å†²çªåœ¨å†™å…¥</li><li>æ™®é€šç´¢å¼•å¯ä»¥ä½¿ç”¨ Change Bufferï¼Œ<strong>ç›´æ¥å†™å…¥ Buffer å°±ç»“æŸ</strong>ï¼Œä¸ç”¨æ ¡éªŒå”¯ä¸€æ€§</li></ul><p>Change Buffer å¹¶ä¸æ˜¯æ•°æ®é¡µï¼Œåªæ˜¯å¯¹æ“ä½œçš„ç¼“å­˜ï¼Œæ‰€ä»¥éœ€è¦å°† Change Buffer ä¸­çš„æ“ä½œåº”ç”¨åˆ°æ—§æ•°æ®é¡µï¼Œå¾—åˆ°æ–°çš„æ•°æ®é¡µï¼ˆè„é¡µï¼‰çš„è¿‡ç¨‹ç§°ä¸º Merge</p><ul><li>è§¦å‘æ—¶æœºï¼šè®¿é—®æ•°æ®é¡µæ—¶ä¼šè§¦å‘ Mergeã€åå°æœ‰å®šæ—¶çº¿ç¨‹è¿›è¡Œ Mergeã€åœ¨æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆshutdownï¼‰çš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šè§¦å‘</li><li>å·¥ä½œæµç¨‹ï¼šé¦–å…ˆä»ç£ç›˜è¯»å…¥æ•°æ®é¡µåˆ°å†…å­˜ï¼ˆå› ä¸º Buffer Pool ä¸­ä¸ä¸€å®šå­˜åœ¨å¯¹åº”çš„æ•°æ®é¡µï¼‰ï¼Œä» Change Buffer ä¸­æ‰¾åˆ°å¯¹åº”çš„æ“ä½œåº”ç”¨åˆ°æ•°æ®é¡µï¼Œå¾—åˆ°æ–°çš„æ•°æ®é¡µå³ä¸ºè„é¡µï¼Œç„¶åå†™å…¥ redo logï¼Œç­‰å¾…åˆ·è„å³å¯</li></ul><p>è¯´æ˜ï¼šChange Buffer ä¸­çš„è®°å½•ï¼Œåœ¨äº‹åŠ¡æäº¤æ—¶ä¹Ÿä¼šå†™å…¥ redo logï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ä¿è¯ä¸ä¸¢å¤±çš„</p><p>ä¸šåŠ¡åœºæ™¯ï¼š</p><ul><li><p>å¯¹äº<strong>å†™å¤šè¯»å°‘</strong>çš„ä¸šåŠ¡æ¥è¯´ï¼Œé¡µé¢åœ¨å†™å®Œä»¥åé©¬ä¸Šè¢«è®¿é—®åˆ°çš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œæ­¤æ—¶ Change Buffer çš„ä½¿ç”¨æ•ˆæœæœ€å¥½ï¼Œå¸¸è§çš„å°±æ˜¯è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿ</p></li><li><p>ä¸€ä¸ªä¸šåŠ¡çš„æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥åé©¬ä¸ŠåšæŸ¥è¯¢ï¼Œé‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶ï¼Œå°†æ›´æ–°å…ˆè®°å½•åœ¨ Change Bufferï¼Œä½†ä¹‹åç”±äºé©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µï¼Œä¼šç«‹å³è§¦å‘ Merge è¿‡ç¨‹ï¼Œè¿™æ ·éšæœºè®¿é—® IO çš„æ¬¡æ•°ä¸ä¼šå‡å°‘ï¼Œå¹¶ä¸”å¢åŠ äº† Change Buffer çš„ç»´æŠ¤ä»£ä»·</p></li></ul><p>è¡¥å……ï¼šChange Buffer çš„å‰èº«æ˜¯ Insert Bufferï¼Œåªèƒ½å¯¹ Insert æ“ä½œä¼˜åŒ–ï¼Œåæ¥å¢åŠ äº† Update/Delete çš„æ”¯æŒï¼Œæ”¹ä¸º Change Buffer</p><hr><h4 id="net" tabindex="-1"><a class="header-anchor" href="#net" aria-hidden="true">#</a> Net</h4><p>Server å±‚é’ˆå¯¹ä¼˜åŒ–<strong>æŸ¥è¯¢</strong>çš„å†…å­˜ä¸º Net Bufferï¼Œå†…å­˜çš„å¤§å°æ˜¯ç”±å‚æ•° <code>net_buffer_length</code>å®šä¹‰ï¼Œé»˜è®¤ 16kï¼Œå®ç°æµç¨‹ï¼š</p><ul><li>è·å–ä¸€è¡Œæ•°æ®å†™å…¥ Net Bufferï¼Œé‡å¤è·å–ç›´åˆ° Net Buffer å†™æ»¡ï¼Œè°ƒç”¨ç½‘ç»œæ¥å£å‘å‡ºå»</li><li>è‹¥å‘é€æˆåŠŸå°±æ¸…ç©º Net Bufferï¼Œç„¶åç»§ç»­å–ä¸‹ä¸€è¡Œï¼›è‹¥å‘é€å‡½æ•°è¿”å› EAGAIN æˆ– WSAEWOULDBLOCKï¼Œè¡¨ç¤ºæœ¬åœ°ç½‘ç»œæ ˆ <code>socket send buffer</code> å†™æ»¡äº†ï¼Œ<strong>è¿›å…¥ç­‰å¾…</strong>ï¼Œç›´åˆ°ç½‘ç»œæ ˆé‡æ–°å¯å†™å†ç»§ç»­å‘é€</li></ul><p>MySQL é‡‡ç”¨çš„æ˜¯è¾¹è¯»è¾¹å‘çš„é€»è¾‘ï¼Œå› æ­¤å¯¹äºæ•°æ®é‡å¾ˆå¤§çš„æŸ¥è¯¢æ¥è¯´ï¼Œä¸ä¼šåœ¨ Server ç«¯ä¿å­˜å®Œæ•´çš„ç»“æœé›†ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯»ç»“æœä¸åŠæ—¶ï¼Œä¼šå µä½ MySQL çš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œä½†æ˜¯<strong>ä¸ä¼šæŠŠå†…å­˜æ‰“çˆ†å¯¼è‡´ OOM</strong></p><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æŸ¥è¯¢å†…å­˜ä¼˜åŒ–.png" style="zoom:50%;"><p>SHOW PROCESSLIST è·å–çº¿ç¨‹ä¿¡æ¯åï¼Œå¤„äº Sending to client çŠ¶æ€ä»£è¡¨æœåŠ¡å™¨ç«¯çš„ç½‘ç»œæ ˆå†™æ»¡ï¼Œç­‰å¾…å®¢æˆ·ç«¯æ¥æ”¶æ•°æ®</p><p>å‡è®¾æœ‰ä¸€ä¸ªä¸šåŠ¡çš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæ¯è¯»ä¸€è¡Œæ•°æ®ä»¥åè¦å¤„ç†å¾ˆä¹…çš„é€»è¾‘ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¦è¿‡å¾ˆä¹…æ‰ä¼šå»å–ä¸‹ä¸€è¡Œæ•°æ®ï¼Œå¯¼è‡´ MySQL çš„é˜»å¡ï¼Œä¸€ç›´å¤„äº Sending to client çš„çŠ¶æ€</p><p>è§£å†³æ–¹æ³•ï¼šå¦‚æœä¸€ä¸ªæŸ¥è¯¢çš„è¿”å›ç»“æœå¾ˆæ˜¯å¾ˆå¤šï¼Œå»ºè®®ä½¿ç”¨ mysql_store_result è¿™ä¸ªæ¥å£ï¼Œç›´æ¥æŠŠæŸ¥è¯¢ç»“æœä¿å­˜åˆ°æœ¬åœ°å†…å­˜</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/qq_33589510/article/details/117673449" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_33589510/article/details/117673449<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="read" tabindex="-1"><a class="header-anchor" href="#read" aria-hidden="true">#</a> Read</h4><p>read_rnd_buffer æ˜¯ MySQL çš„éšæœºè¯»ç¼“å†²åŒºï¼Œå½“æŒ‰ä»»æ„é¡ºåºè¯»å–è®°å½•è¡Œæ—¶å°†åˆ†é…ä¸€ä¸ªéšæœºè¯»å–ç¼“å†²åŒºï¼Œè¿›è¡Œæ’åºæŸ¥è¯¢æ—¶ï¼ŒMySQL ä¼šé¦–å…ˆæ‰«æä¸€éè¯¥ç¼“å†²ï¼Œä»¥é¿å…ç£ç›˜æœç´¢ï¼Œæé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œå¤§å°æ˜¯ç”± read_rnd_buffer_size å‚æ•°æ§åˆ¶çš„</p><p>Multi-Range Read ä¼˜åŒ–ï¼Œ<strong>å°†éšæœº IO è½¬åŒ–ä¸ºé¡ºåº IO</strong> ä»¥é™ä½æŸ¥è¯¢è¿‡ç¨‹ä¸­ IO å¼€é”€ï¼Œå› ä¸ºå¤§å¤šæ•°çš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§ä¸»é”®é€’å¢é¡ºåºæ’å…¥å¾—åˆ°ï¼Œæ‰€ä»¥æŒ‰ç…§ä¸»é”®çš„é€’å¢é¡ºåºæŸ¥è¯¢çš„è¯ï¼Œå¯¹ç£ç›˜çš„è¯»æ¯”è¾ƒæ¥è¿‘é¡ºåºè¯»ï¼Œèƒ½å¤Ÿæå‡è¯»æ€§èƒ½</p><p>äºŒçº§ç´¢å¼•ä¸º aï¼Œèšç°‡ç´¢å¼•ä¸º idï¼Œä¼˜åŒ–å›è¡¨æµç¨‹ï¼š</p><ul><li>æ ¹æ®ç´¢å¼• aï¼Œå®šä½åˆ°æ»¡è¶³æ¡ä»¶çš„è®°å½•ï¼Œå°† id å€¼æ”¾å…¥ read_rnd_buffer ä¸­</li><li>å°† read_rnd_buffer ä¸­çš„ id è¿›è¡Œ<strong>é€’å¢æ’åº</strong></li><li>æ’åºåçš„ id æ•°ç»„ï¼Œä¾æ¬¡å›è¡¨åˆ°ä¸»é”® id ç´¢å¼•ä¸­æŸ¥è®°å½•ï¼Œå¹¶ä½œä¸ºç»“æœè¿”å›</li></ul><p>è¯´æ˜ï¼šå¦‚æœæ­¥éª¤ 1 ä¸­ read_rnd_buffer æ”¾æ»¡äº†ï¼Œå°±ä¼šå…ˆæ‰§è¡Œæ­¥éª¤ 2 å’Œ 3ï¼Œç„¶åæ¸…ç©º read_rnd_bufferï¼Œä¹‹åç»§ç»­æ‰¾ç´¢å¼• a çš„ä¸‹ä¸ªè®°å½•</p><p>ä½¿ç”¨ MRR ä¼˜åŒ–éœ€è¦è®¾è¿›è¡Œè®¾ç½®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET optimizer_switch=&#39;mrr_cost_based=off&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h4 id="key-1" tabindex="-1"><a class="header-anchor" href="#key-1" aria-hidden="true">#</a> Key</h4><p>MyISAM å­˜å‚¨å¼•æ“ä½¿ç”¨ key_buffer ç¼“å­˜ç´¢å¼•å—ï¼ŒåŠ é€Ÿ MyISAM ç´¢å¼•çš„è¯»å†™é€Ÿåº¦ã€‚å¯¹äº MyISAM è¡¨çš„æ•°æ®å—æ²¡æœ‰ç‰¹åˆ«çš„ç¼“å­˜æœºåˆ¶ï¼Œå®Œå…¨ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ IO ç¼“å­˜</p><ul><li><p>key_buffer_sizeï¼šè¯¥å˜é‡å†³å®š MyISAM ç´¢å¼•å—ç¼“å­˜åŒºçš„å¤§å°ï¼Œç›´æ¥å½±å“åˆ° MyISAM è¡¨çš„å­˜å–æ•ˆç‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW VARIABLES LIKE &#39;key_buffer_size&#39;;	-- å•ä½æ˜¯å­—èŠ‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åœ¨ MySQL é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è¯¥å€¼ï¼Œå»ºè®®è‡³å°‘å°†1/4å¯ç”¨å†…å­˜åˆ†é…ç»™ key_buffer_sizeï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/mysql/my.cnf
<span class="token assign-left variable">key_buffer_size</span><span class="token operator">=</span>1024M
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>read_buffer_sizeï¼šå¦‚æœéœ€è¦ç»å¸¸é¡ºåºæ‰«æ MyISAM è¡¨ï¼Œå¯ä»¥é€šè¿‡å¢å¤§ read_buffer_size çš„å€¼æ¥æ”¹å–„æ€§èƒ½ã€‚ä½† read_buffer_size æ˜¯æ¯ä¸ª Session ç‹¬å çš„ï¼Œå¦‚æœé»˜è®¤å€¼è®¾ç½®å¤ªå¤§ï¼Œå¹¶å‘ç¯å¢ƒå°±ä¼šé€ æˆå†…å­˜æµªè´¹</p></li><li><p>read_rnd_buffer_sizeï¼šå¯¹äºéœ€è¦åšæ’åºçš„ MyISAM è¡¨çš„æŸ¥è¯¢ï¼Œå¦‚å¸¦æœ‰ ORDER BY å­å¥çš„è¯­å¥ï¼Œé€‚å½“å¢åŠ è¯¥çš„å€¼ï¼Œå¯ä»¥æ”¹å–„æ­¤ç±»çš„ SQL çš„æ€§èƒ½ï¼Œä½†æ˜¯ read_rnd_buffer_size æ˜¯æ¯ä¸ª Session ç‹¬å çš„ï¼Œå¦‚æœé»˜è®¤å€¼è®¾ç½®å¤ªå¤§ï¼Œå°±ä¼šé€ æˆå†…å­˜æµªè´¹</p></li></ul><hr><h3 id="å­˜å‚¨ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#å­˜å‚¨ä¼˜åŒ–" aria-hidden="true">#</a> å­˜å‚¨ä¼˜åŒ–</h3><h4 id="æ•°æ®å­˜å‚¨" tabindex="-1"><a class="header-anchor" href="#æ•°æ®å­˜å‚¨" aria-hidden="true">#</a> æ•°æ®å­˜å‚¨</h4><p>ç³»ç»Ÿè¡¨ç©ºé—´æ˜¯ç”¨æ¥æ”¾ç³»ç»Ÿä¿¡æ¯çš„ï¼Œæ¯”å¦‚æ•°æ®å­—å…¸ä»€ä¹ˆçš„ï¼Œå¯¹åº”çš„ç£ç›˜æ–‡ä»¶æ˜¯ ibdataï¼Œæ•°æ®è¡¨ç©ºé—´æ˜¯ä¸€ä¸ªä¸ªçš„è¡¨æ•°æ®æ–‡ä»¶ï¼Œå¯¹åº”çš„ç£ç›˜æ–‡ä»¶å°±æ˜¯è¡¨å.ibd</p><p>è¡¨æ•°æ®æ—¢å¯ä»¥å­˜åœ¨å…±äº«è¡¨ç©ºé—´é‡Œï¼Œä¹Ÿå¯ä»¥æ˜¯å•ç‹¬çš„æ–‡ä»¶ï¼Œè¿™ä¸ªè¡Œä¸ºæ˜¯ç”±å‚æ•° innodb_file_per_table æ§åˆ¶çš„ï¼š</p><ul><li>OFFï¼šè¡¨ç¤ºè¡¨çš„æ•°æ®æ”¾åœ¨ç³»ç»Ÿå…±äº«è¡¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è·Ÿæ•°æ®å­—å…¸æ”¾åœ¨ä¸€èµ·</li><li>ON ï¼šè¡¨ç¤ºæ¯ä¸ª InnoDB è¡¨æ•°æ®å­˜å‚¨åœ¨ä¸€ä¸ªä»¥ .ibd ä¸ºåç¼€çš„æ–‡ä»¶ä¸­ï¼ˆé»˜è®¤ï¼‰</li></ul><p>ä¸€ä¸ªè¡¨å•ç‹¬å­˜å‚¨ä¸ºä¸€ä¸ªæ–‡ä»¶æ›´å®¹æ˜“ç®¡ç†ï¼Œåœ¨ä¸éœ€è¦è¿™ä¸ªè¡¨æ—¶é€šè¿‡ drop table å‘½ä»¤ï¼Œç³»ç»Ÿå°±ä¼šç›´æ¥åˆ é™¤è¿™ä¸ªæ–‡ä»¶ï¼›å¦‚æœæ˜¯æ”¾åœ¨å…±äº«è¡¨ç©ºé—´ä¸­ï¼Œå³ä½¿è¡¨åˆ æ‰äº†ï¼Œç©ºé—´ä¹Ÿæ˜¯ä¸ä¼šå›æ”¶çš„</p><hr><h4 id="æ•°æ®åˆ é™¤" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åˆ é™¤" aria-hidden="true">#</a> æ•°æ®åˆ é™¤</h4><p>MySQL çš„æ•°æ®åˆ é™¤å°±æ˜¯ç§»é™¤æ‰æŸä¸ªè®°å½•åï¼Œè¯¥ä½ç½®å°±è¢«æ ‡è®°ä¸º<strong>å¯å¤ç”¨</strong>ï¼Œå¦‚æœæœ‰ç¬¦åˆèŒƒå›´æ¡ä»¶çš„æ•°æ®å¯ä»¥æ’å…¥åˆ°è¿™é‡Œã€‚ç¬¦åˆèŒƒå›´æ¡ä»¶çš„æ„æ€æ˜¯å‡è®¾åˆ é™¤è®°å½• R4ï¼Œä¹‹åè¦å†æ’å…¥ä¸€ä¸ª ID åœ¨ 300 å’Œ 600 ä¹‹é—´çš„è®°å½•æ—¶ï¼Œå°±ä¼šå¤ç”¨è¿™ä¸ªä½ç½®</p><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-åˆ é™¤æ•°æ®.png" style="zoom:50%;"><p>InnoDB çš„æ•°æ®æ˜¯æŒ‰é¡µå­˜å‚¨çš„å¦‚æœåˆ æ‰äº†ä¸€ä¸ªæ•°æ®é¡µä¸Šçš„æ‰€æœ‰è®°å½•ï¼Œæ•´ä¸ªæ•°æ®é¡µå°±å¯ä»¥è¢«å¤ç”¨äº†ï¼Œå¦‚æœç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®é¡µåˆ©ç”¨ç‡éƒ½å¾ˆå°ï¼Œç³»ç»Ÿå°±ä¼šæŠŠè¿™ä¸¤ä¸ªé¡µä¸Šçš„æ•°æ®åˆåˆ°å…¶ä¸­ä¸€ä¸ªé¡µä¸Šï¼Œå¦å¤–ä¸€ä¸ªæ•°æ®é¡µå°±è¢«æ ‡è®°ä¸ºå¯å¤ç”¨</p><p>åˆ é™¤å‘½ä»¤å…¶å®åªæ˜¯æŠŠè®°å½•çš„ä½ç½®ï¼Œæˆ–è€…<strong>æ•°æ®é¡µæ ‡è®°ä¸ºäº†å¯å¤ç”¨ï¼Œä½†ç£ç›˜æ–‡ä»¶çš„å¤§å°æ˜¯ä¸ä¼šå˜çš„</strong>ï¼Œè¿™äº›å¯ä»¥å¤ç”¨è¿˜æ²¡æœ‰è¢«ä½¿ç”¨çš„ç©ºé—´ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯ç©ºæ´ï¼Œé€ æˆæ•°æ®åº“çš„ç¨€ç–ï¼Œå› æ­¤éœ€è¦è¿›è¡Œç´§å‡‘å¤„ç†</p><hr><h4 id="é‡å»ºæ•°æ®" tabindex="-1"><a class="header-anchor" href="#é‡å»ºæ•°æ®" aria-hidden="true">#</a> é‡å»ºæ•°æ®</h4><p>é‡å»ºè¡¨å°±æ˜¯æŒ‰ç…§ä¸»é”® ID é€’å¢çš„é¡ºåºï¼ŒæŠŠæ•°æ®ä¸€è¡Œä¸€è¡Œåœ°ä»æ—§è¡¨ä¸­è¯»å‡ºæ¥å†æ’å…¥åˆ°æ–°è¡¨ä¸­ï¼Œè®©æ•°æ®æ›´åŠ ç´§å‡‘ã€‚é‡å»ºè¡¨æ—¶ MySQL ä¼šè‡ªåŠ¨å®Œæˆè½¬å­˜æ•°æ®ã€äº¤æ¢è¡¨åã€åˆ é™¤æ—§è¡¨çš„æ“ä½œï¼Œçº¿ä¸Šæ“ä½œä¼šé˜»å¡å¤§é‡çš„çº¿ç¨‹å¢åˆ æ”¹æŸ¥çš„æ“ä½œ</p><p>é‡å»ºå‘½ä»¤ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> A <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å·¥ä½œæµç¨‹ï¼šæ–°å»ºä¸´æ—¶è¡¨ tmp_table Bï¼ˆåœ¨ Server å±‚åˆ›å»ºçš„ï¼‰ï¼ŒæŠŠè¡¨ A ä¸­çš„æ•°æ®å¯¼å…¥åˆ°è¡¨ B ä¸­ï¼Œæ“ä½œå®Œæˆåç”¨è¡¨ B æ›¿æ¢è¡¨ Aï¼Œå®Œæˆé‡å»º</p><p>é‡å»ºè¡¨çš„æ­¥éª¤éœ€è¦ DDL ä¸æ˜¯ Online çš„ï¼Œå› ä¸ºåœ¨å¯¼å…¥æ•°æ®çš„è¿‡ç¨‹æœ‰æ–°çš„æ•°æ®è¦å†™å…¥åˆ°è¡¨ A çš„è¯ï¼Œå°±ä¼šé€ æˆæ•°æ®ä¸¢å¤±</p><p>MySQL 5.6 ç‰ˆæœ¬å¼€å§‹å¼•å…¥çš„ <strong>Online DDL</strong>ï¼Œé‡å»ºè¡¨çš„å‘½ä»¤é»˜è®¤æ‰§è¡Œæ­¤æ­¥éª¤ï¼š</p><ul><li>å»ºç«‹ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ tmp_fileï¼ˆInnoDB åˆ›å»ºï¼‰ï¼Œæ‰«æè¡¨ A ä¸»é”®çš„æ‰€æœ‰æ•°æ®é¡µ</li><li>ç”¨æ•°æ®é¡µä¸­è¡¨ A çš„è®°å½•ç”Ÿæˆ B+ æ ‘ï¼Œå­˜å‚¨åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­</li><li>ç”Ÿæˆä¸´æ—¶æ–‡ä»¶çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ‰€æœ‰å¯¹ A çš„æ“ä½œè®°å½•åœ¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆrow logï¼‰ä¸­ï¼Œå¯¹åº”çš„æ˜¯å›¾ä¸­ state2 çš„çŠ¶æ€</li><li>ä¸´æ—¶æ–‡ä»¶ç”Ÿæˆåï¼Œå°†æ—¥å¿—æ–‡ä»¶ä¸­çš„æ“ä½œåº”ç”¨åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªé€»è¾‘æ•°æ®ä¸Šä¸è¡¨ A ç›¸åŒçš„æ•°æ®æ–‡ä»¶ï¼Œå¯¹åº”çš„å°±æ˜¯å›¾ä¸­ state3</li><li>ç”¨ä¸´æ—¶æ–‡ä»¶æ›¿æ¢è¡¨ A çš„æ•°æ®æ–‡ä»¶</li></ul><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-é‡å»ºè¡¨.png" style="zoom:67%;"><p>Online DDL æ“ä½œä¼šå…ˆè·å– MDL å†™é”ï¼Œå†é€€åŒ–æˆ MDL è¯»é”ã€‚ä½† MDL å†™é”æŒæœ‰æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œæ‰€ä»¥å¯ä»¥ç§°ä¸º Onlineï¼› è€Œ MDL è¯»é”ï¼Œä¸é˜»æ­¢æ•°æ®å¢åˆ æŸ¥æ”¹ï¼Œä½†ä¼šé˜»æ­¢å…¶å®ƒçº¿ç¨‹ä¿®æ”¹è¡¨ç»“æ„ï¼ˆå¯ä»¥å¯¹æ¯” <code>ANALYZE TABLE t</code> å‘½ä»¤ï¼‰</p><p>é—®é¢˜ï¼šé‡å»ºè¡¨å¯ä»¥æ”¶ç¼©è¡¨ç©ºé—´ï¼Œä½†æ˜¯æ‰§è¡ŒæŒ‡ä»¤åæ•´ä½“å ç”¨ç©ºé—´å¢å¤§</p><p>åŸå› ï¼šåœ¨é‡å»ºè¡¨å InnoDB ä¸ä¼šæŠŠæ•´å¼ è¡¨å æ»¡ï¼Œæ¯ä¸ªé¡µç•™äº† 1/16 ç»™åç»­çš„æ›´æ–°ä½¿ç”¨ã€‚è¡¨åœ¨æœªæ•´ç†ä¹‹å‰é¡µå·²ç»å ç”¨ 15/16 ä»¥ä¸Šï¼Œæ”¶ç¼©ä¹‹åéœ€è¦ä¿æŒæ•°æ®å ç”¨ç©ºé—´åœ¨ 15/16ï¼Œæ‰€ä»¥æ–‡ä»¶å ç”¨ç©ºé—´æ›´å¤§æ‰èƒ½ä¿æŒ</p><p>æ³¨æ„ï¼šä¸´æ—¶æ–‡ä»¶ä¹Ÿè¦å ç”¨ç©ºé—´ï¼Œå¦‚æœç©ºé—´ä¸è¶³ä¼šé‡å»ºå¤±è´¥</p><hr><h4 id="åŸåœ°ç½®æ¢" tabindex="-1"><a class="header-anchor" href="#åŸåœ°ç½®æ¢" aria-hidden="true">#</a> åŸåœ°ç½®æ¢</h4><p>DDL ä¸­çš„ä¸´æ—¶è¡¨ tmp_table æ˜¯åœ¨ Server å±‚åˆ›å»ºçš„ï¼ŒOnline DDL ä¸­çš„ä¸´æ—¶æ–‡ä»¶ tmp_file æ˜¯ InnoDB åœ¨å†…éƒ¨åˆ›å»ºå‡ºæ¥çš„ï¼Œæ•´ä¸ª DDL è¿‡ç¨‹éƒ½åœ¨ InnoDB å†…éƒ¨å®Œæˆï¼Œå¯¹äº Server å±‚æ¥è¯´ï¼Œæ²¡æœ‰æŠŠæ•°æ®æŒªåŠ¨åˆ°ä¸´æ—¶è¡¨ï¼Œæ˜¯ä¸€ä¸ªåŸåœ°æ“ä½œï¼Œè¿™å°±æ˜¯ inplace</p><p>ä¸¤è€…çš„å…³ç³»ï¼š</p><ul><li>DDL è¿‡ç¨‹å¦‚æœæ˜¯ Online çš„ï¼Œå°±ä¸€å®šæ˜¯ inplace çš„</li><li>inplace çš„ DDLï¼Œæœ‰å¯èƒ½ä¸æ˜¯ Online çš„ï¼Œæˆªæ­¢åˆ° MySQL 8.0ï¼Œå…¨æ–‡ç´¢å¼•ï¼ˆFULLTEXTï¼‰å’Œç©ºé—´ç´¢å¼•ï¼ˆSPATIALï¼‰å±äºè¿™ç§æƒ…å†µ</li></ul><hr><h3 id="å¹¶å‘ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#å¹¶å‘ä¼˜åŒ–" aria-hidden="true">#</a> å¹¶å‘ä¼˜åŒ–</h3><p>MySQL Server æ˜¯å¤šçº¿ç¨‹ç»“æ„ï¼ŒåŒ…æ‹¬åå°çº¿ç¨‹å’Œå®¢æˆ·æœåŠ¡çº¿ç¨‹ã€‚å¤šçº¿ç¨‹å¯ä»¥æœ‰æ•ˆåˆ©ç”¨æœåŠ¡å™¨èµ„æºï¼Œæé«˜æ•°æ®åº“çš„å¹¶å‘æ€§èƒ½ã€‚åœ¨ MySQL ä¸­ï¼Œæ§åˆ¶å¹¶å‘è¿æ¥å’Œçº¿ç¨‹çš„ä¸»è¦å‚æ•°ï¼š</p><ul><li><p>max_connectionsï¼šæ§åˆ¶å…è®¸è¿æ¥åˆ° MySQL æ•°æ®åº“çš„æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤å€¼æ˜¯ 151</p><p>å¦‚æœçŠ¶æ€å˜é‡ connection_errors_max_connections ä¸ä¸ºé›¶ï¼Œå¹¶ä¸”ä¸€ç›´å¢é•¿ï¼Œåˆ™è¯´æ˜ä¸æ–­æœ‰è¿æ¥è¯·æ±‚å› æ•°æ®åº“è¿æ¥æ•°å·²è¾¾åˆ°å…è®¸æœ€å¤§å€¼è€Œå¤±è´¥ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘å¢å¤§ max_connections çš„å€¼</p><p>MySQL æœ€å¤§å¯æ”¯æŒçš„è¿æ¥æ•°å–å†³äºå¾ˆå¤šå› ç´ ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿå¹³å°çš„çº¿ç¨‹åº“çš„è´¨é‡ã€å†…å­˜å¤§å°ã€æ¯ä¸ªè¿æ¥çš„è´Ÿè·ã€CPUçš„å¤„ç†é€Ÿåº¦ã€æœŸæœ›çš„å“åº”æ—¶é—´ç­‰ã€‚åœ¨ Linux å¹³å°ä¸‹ï¼Œæ€§èƒ½å¥½çš„æœåŠ¡å™¨ï¼Œå¯ä»¥æ”¯æŒ 500-1000 ä¸ªè¿æ¥ï¼Œéœ€è¦æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è¿›è¡Œè¯„ä¼°è®¾å®š</p></li><li><p>innodb_thread_concurrencyï¼šå¹¶å‘çº¿ç¨‹æ•°ï¼Œä»£è¡¨ç³»ç»Ÿå†…åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ï¼ˆå·²ç»è¢«ç§»é™¤ï¼‰</p></li><li><p>back_logï¼šæ§åˆ¶ MySQL ç›‘å¬ TCP ç«¯å£æ—¶çš„ç§¯å‹è¯·æ±‚æ ˆçš„å¤§å°</p><p>å¦‚æœ Mysql çš„è¿æ¥æ•°è¾¾åˆ° max_connections æ—¶ï¼Œæ–°æ¥çš„è¯·æ±‚å°†ä¼šè¢«å­˜åœ¨å †æ ˆä¸­ï¼Œä»¥ç­‰å¾…æŸä¸€è¿æ¥é‡Šæ”¾èµ„æºï¼Œè¯¥å †æ ˆçš„æ•°é‡å³ back_logã€‚å¦‚æœç­‰å¾…è¿æ¥çš„æ•°é‡è¶…è¿‡ back_logï¼Œå°†ä¸è¢«æˆäºˆè¿æ¥èµ„æºç›´æ¥æŠ¥é”™</p><p>5.6.6 ç‰ˆæœ¬ä¹‹å‰é»˜è®¤å€¼ä¸º 50ï¼Œä¹‹åçš„ç‰ˆæœ¬é»˜è®¤ä¸º <code>50 + (max_connections/5)</code>ï¼Œä½†æœ€å¤§ä¸è¶…è¿‡900ï¼Œå¦‚æœéœ€è¦æ•°æ®åº“åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å¤„ç†å¤§é‡è¿æ¥è¯·æ±‚ï¼Œ å¯ä»¥è€ƒè™‘é€‚å½“å¢å¤§ back_log çš„å€¼</p></li><li><p>table_open_cacheï¼šæ§åˆ¶æ‰€æœ‰ SQL è¯­å¥æ‰§è¡Œçº¿ç¨‹å¯æ‰“å¼€è¡¨ç¼“å­˜çš„æ•°é‡</p><p>åœ¨æ‰§è¡Œ SQL è¯­å¥æ—¶ï¼Œæ¯ä¸ªæ‰§è¡Œçº¿ç¨‹è‡³å°‘è¦æ‰“å¼€1ä¸ªè¡¨ç¼“å­˜ï¼Œè¯¥å‚æ•°çš„å€¼åº”è¯¥æ ¹æ®è®¾ç½®çš„æœ€å¤§è¿æ¥æ•°ä»¥åŠæ¯ä¸ªè¿æ¥æ‰§è¡Œå…³è”æŸ¥è¯¢ä¸­æ¶‰åŠçš„è¡¨çš„æœ€å¤§æ•°é‡æ¥è®¾å®šï¼š<code>max_connections * N</code></p></li><li><p>thread_cache_sizeï¼šå¯æ§åˆ¶ MySQL ç¼“å­˜å®¢æˆ·æœåŠ¡çº¿ç¨‹çš„æ•°é‡</p><p>ä¸ºäº†åŠ å¿«è¿æ¥æ•°æ®åº“çš„é€Ÿåº¦ï¼ŒMySQL ä¼šç¼“å­˜ä¸€å®šæ•°é‡çš„å®¢æˆ·æœåŠ¡çº¿ç¨‹ä»¥å¤‡é‡ç”¨ï¼Œæ± åŒ–æ€æƒ³</p></li><li><p>innodb_lock_wait_timeoutï¼šè®¾ç½® InnoDB äº‹åŠ¡ç­‰å¾…è¡Œé”çš„æ—¶é—´ï¼Œé»˜è®¤å€¼æ˜¯ 50ms</p><p>å¯¹äºéœ€è¦å¿«é€Ÿåé¦ˆçš„ä¸šåŠ¡ç³»ç»Ÿï¼Œå¯ä»¥å°†è¡Œé”çš„ç­‰å¾…æ—¶é—´è°ƒå°ï¼Œä»¥é¿å…äº‹åŠ¡è¢«é•¿æ—¶é—´æŒ‚èµ·ï¼› å¯¹äºåå°è¿è¡Œçš„æ‰¹é‡å¤„ç†ç¨‹åºæ¥è¯´ï¼Œå¯ä»¥å°†è¡Œé”çš„ç­‰å¾…æ—¶é—´è°ƒå¤§ï¼Œä»¥é¿å…å‘ç”Ÿå¤§çš„å›æ»šæ“ä½œ</p></li></ul><hr><h2 id="äº‹åŠ¡æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡æœºåˆ¶" aria-hidden="true">#</a> äº‹åŠ¡æœºåˆ¶</h2><h3 id="åŸºæœ¬ä»‹ç»-7" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-7" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>äº‹åŠ¡ï¼ˆTransactionï¼‰æ˜¯è®¿é—®å’Œæ›´æ–°æ•°æ®åº“çš„ç¨‹åºæ‰§è¡Œå•å…ƒï¼›äº‹åŠ¡ä¸­å¯èƒ½åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª SQL è¯­å¥ï¼Œè¿™äº›è¯­å¥è¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œï¼Œä½œä¸ºä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ï¼ŒMySQL æ”¯æŒäº‹åŠ¡ã€‚</p><p>å•å…ƒä¸­çš„æ¯æ¡ SQL è¯­å¥éƒ½ç›¸äº’ä¾èµ–ï¼Œå½¢æˆä¸€ä¸ªæ•´ä½“</p><ul><li><p>å¦‚æœæŸæ¡ SQL è¯­å¥æ‰§è¡Œå¤±è´¥æˆ–è€…å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆæ•´ä¸ªå•å…ƒå°±ä¼šå›æ»šï¼Œæ’¤å›åˆ°äº‹åŠ¡æœ€åˆçš„çŠ¶æ€</p></li><li><p>å¦‚æœå•å…ƒä¸­æ‰€æœ‰çš„ SQL è¯­å¥éƒ½æ‰§è¡ŒæˆåŠŸï¼Œåˆ™äº‹åŠ¡å°±é¡ºåˆ©æ‰§è¡Œ</p></li></ul><p>äº‹åŠ¡çš„å››å¤§ç‰¹å¾ï¼šACID</p><ul><li>åŸå­æ€§ (atomicity)</li><li>ä¸€è‡´æ€§ (consistency)</li><li>éš”ç¦»æ€§ (isolaction)</li><li>æŒä¹…æ€§ (durability)</li></ul><p>äº‹åŠ¡çš„å‡ ç§çŠ¶æ€ï¼š</p><ul><li>æ´»åŠ¨çš„ï¼ˆactiveï¼‰ï¼šäº‹åŠ¡å¯¹åº”çš„æ•°æ®åº“æ“ä½œæ­£åœ¨æ‰§è¡Œä¸­</li><li>éƒ¨åˆ†æäº¤çš„ï¼ˆpartially committedï¼‰ï¼šäº‹åŠ¡çš„æœ€åä¸€ä¸ªæ“ä½œæ‰§è¡Œå®Œï¼Œä½†æ˜¯å†…å­˜è¿˜æ²¡åˆ·æ–°è‡³ç£ç›˜</li><li>å¤±è´¥çš„ï¼ˆfailedï¼‰ï¼šå½“äº‹åŠ¡å¤„äºæ´»åŠ¨çŠ¶æ€æˆ–éƒ¨åˆ†æäº¤çŠ¶æ€æ—¶ï¼Œå¦‚æœæ•°æ®åº“é‡åˆ°äº†é”™è¯¯æˆ–åˆ·è„å¤±è´¥ï¼Œæˆ–è€…ç”¨æˆ·ä¸»åŠ¨åœæ­¢å½“å‰çš„äº‹åŠ¡</li><li>ä¸­æ­¢çš„ï¼ˆabortedï¼‰ï¼šå¤±è´¥çŠ¶æ€çš„äº‹åŠ¡å›æ»šå®Œæˆåçš„çŠ¶æ€</li><li>æäº¤çš„ï¼ˆcommittedï¼‰ï¼šå½“å¤„äºéƒ¨åˆ†æäº¤çŠ¶æ€çš„äº‹åŠ¡åˆ·è„æˆåŠŸï¼Œå°±å¤„äºæäº¤çŠ¶æ€</li></ul><hr><h3 id="äº‹åŠ¡ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡ç®¡ç†" aria-hidden="true">#</a> äº‹åŠ¡ç®¡ç†</h3><h4 id="åŸºæœ¬æ“ä½œ-2" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ“ä½œ-2" aria-hidden="true">#</a> åŸºæœ¬æ“ä½œ</h4><p>äº‹åŠ¡ç®¡ç†çš„ä¸‰ä¸ªæ­¥éª¤</p><ol><li><p>å¼€å¯äº‹åŠ¡ï¼šè®°å½•å›æ»šç‚¹ï¼Œå¹¶é€šçŸ¥æœåŠ¡å™¨ï¼Œå°†è¦æ‰§è¡Œä¸€ç»„æ“ä½œï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸã€è¦ä¹ˆåŒæ—¶å¤±è´¥</p></li><li><p>æ‰§è¡Œ SQL è¯­å¥ï¼šæ‰§è¡Œå…·ä½“çš„ä¸€æ¡æˆ–å¤šæ¡ SQL è¯­å¥</p></li><li><p>ç»“æŸäº‹åŠ¡ï¼ˆæäº¤|å›æ»šï¼‰</p><ul><li>æäº¤ï¼šæ²¡å‡ºç°é—®é¢˜ï¼Œæ•°æ®è¿›è¡Œæ›´æ–°</li><li>å›æ»šï¼šå‡ºç°é—®é¢˜ï¼Œæ•°æ®æ¢å¤åˆ°å¼€å¯äº‹åŠ¡æ—¶çš„çŠ¶æ€</li></ul></li></ol><p>äº‹åŠ¡æ“ä½œï¼š</p><ul><li><p>æ˜¾å¼å¼€å¯äº‹åŠ¡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>START TRANSACTION [READ ONLY|READ WRITE|WITH CONSISTENT SNAPSHOT]; #å¯ä»¥è·Ÿä¸€ä¸ªæˆ–å¤šä¸ªçŠ¶æ€ï¼Œæœ€åçš„æ˜¯ä¸€è‡´æ€§è¯»
BEGIN [WORK];
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯´æ˜ï¼šä¸å¡«çŠ¶æ€é»˜è®¤æ˜¯è¯»å†™äº‹åŠ¡</p></li><li><p>å›æ»šäº‹åŠ¡ï¼Œç”¨æ¥æ‰‹åŠ¨ä¸­æ­¢äº‹åŠ¡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>ROLLBACK;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æäº¤äº‹åŠ¡ï¼Œæ˜¾ç¤ºæ‰§è¡Œæ˜¯æ‰‹åŠ¨æäº¤ï¼ŒMySQL é»˜è®¤ä¸ºè‡ªåŠ¨æäº¤</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>COMMIT;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿å­˜ç‚¹ï¼šåœ¨äº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è®¾ç½®çš„è¿˜åŸç‚¹ï¼Œè°ƒç”¨ ROLLBACK æ—¶å¯ä»¥æŒ‡å®šå›æ»šåˆ°å“ªä¸ªç‚¹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SAVEPOINT point_name;						#è®¾ç½®ä¿å­˜ç‚¹
RELEASE point_name							#åˆ é™¤ä¿å­˜ç‚¹
ROLLBACK [WORK] TO [SAVEPOINT] point_name	#å›æ»šè‡³æŸä¸ªä¿å­˜ç‚¹ï¼Œä¸å¡«é»˜è®¤å›æ»šåˆ°äº‹åŠ¡æ‰§è¡Œä¹‹å‰çš„çŠ¶æ€
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ“ä½œæ¼”ç¤º</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- å¼€å¯äº‹åŠ¡
START TRANSACTION;

-- å¼ ä¸‰ç»™æå››è½¬è´¦500å…ƒ
-- 1.å¼ ä¸‰è´¦æˆ·-500
UPDATE account SET money=money-500 WHERE NAME=&#39;å¼ ä¸‰&#39;;
-- 2.æå››è´¦æˆ·+500
UPDATE account SET money=money+500 WHERE NAME=&#39;æå››&#39;;

-- å›æ»šäº‹åŠ¡(å‡ºç°é—®é¢˜)
ROLLBACK;

-- æäº¤äº‹åŠ¡(æ²¡å‡ºç°é—®é¢˜)
COMMIT;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="æäº¤æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#æäº¤æ–¹å¼" aria-hidden="true">#</a> æäº¤æ–¹å¼</h4><p>æäº¤æ–¹å¼çš„ç›¸å…³è¯­æ³•ï¼š</p><ul><li><p>æŸ¥çœ‹äº‹åŠ¡æäº¤æ–¹å¼</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT @@AUTOCOMMIT;  		-- ä¼šè¯ï¼Œ1 ä»£è¡¨è‡ªåŠ¨æäº¤    0 ä»£è¡¨æ‰‹åŠ¨æäº¤
SELECT @@GLOBAL.AUTOCOMMIT;	-- ç³»ç»Ÿ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹äº‹åŠ¡æäº¤æ–¹å¼</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET @@AUTOCOMMIT=æ•°å­—;	-- ç³»ç»Ÿ
SET AUTOCOMMIT=æ•°å­—;		-- ä¼šè¯
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>ç³»ç»Ÿå˜é‡çš„æ“ä½œ</strong>ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token punctuation">[</span><span class="token keyword">GLOBAL</span><span class="token operator">|</span><span class="token keyword">SESSION</span><span class="token punctuation">]</span> å˜é‡å <span class="token operator">=</span> å€¼<span class="token punctuation">;</span>					<span class="token comment">-- é»˜è®¤æ˜¯ä¼šè¯</span>
<span class="token keyword">SET</span> @@<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">GLOBAL</span><span class="token operator">|</span><span class="token keyword">SESSION</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">]</span>å˜é‡å <span class="token operator">=</span> å€¼<span class="token punctuation">;</span>				<span class="token comment">-- é»˜è®¤æ˜¯ç³»ç»Ÿ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token punctuation">[</span><span class="token keyword">GLOBAL</span><span class="token operator">|</span><span class="token keyword">SESSION</span><span class="token punctuation">]</span> VARIABLES <span class="token punctuation">[</span><span class="token operator">LIKE</span> <span class="token string">&#39;å˜é‡%&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	  <span class="token comment">-- é»˜è®¤æŸ¥çœ‹ä¼šè¯å†…ç³»ç»Ÿå˜é‡å€¼</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>å·¥ä½œåŸç†ï¼š</p><ul><li>è‡ªåŠ¨æäº¤ï¼šå¦‚æœæ²¡æœ‰ START TRANSACTION æ˜¾å¼åœ°å¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œé‚£ä¹ˆ<strong>æ¯æ¡ SQL è¯­å¥éƒ½ä¼šè¢«å½“åšä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œæäº¤æ“ä½œ</strong>ï¼›æ˜¾å¼å¼€å¯äº‹åŠ¡åï¼Œä¼šåœ¨æœ¬æ¬¡äº‹åŠ¡ç»“æŸï¼ˆæäº¤æˆ–å›æ»šï¼‰å‰æš‚æ—¶å…³é—­è‡ªåŠ¨æäº¤</li><li>æ‰‹åŠ¨æäº¤ï¼šä¸éœ€è¦æ˜¾å¼çš„å¼€å¯äº‹åŠ¡ï¼Œæ‰€æœ‰çš„ SQL è¯­å¥éƒ½åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œç›´åˆ°æ‰§è¡Œäº†æäº¤æˆ–å›æ»šï¼Œç„¶åè¿›å…¥ä¸‹ä¸€ä¸ªäº‹åŠ¡</li><li>éšå¼æäº¤ï¼šå­˜åœ¨ä¸€äº›ç‰¹æ®Šçš„å‘½ä»¤ï¼Œåœ¨äº‹åŠ¡ä¸­æ‰§è¡Œäº†è¿™äº›å‘½ä»¤ä¼šé©¬ä¸Š<strong>å¼ºåˆ¶æ‰§è¡Œ COMMIT æäº¤äº‹åŠ¡</strong><ul><li><strong>DDL è¯­å¥</strong> (CREATE/DROP/ALTER)ã€LOCK TABLES è¯­å¥ã€LOAD DATA å¯¼å…¥æ•°æ®è¯­å¥ã€ä¸»ä»å¤åˆ¶è¯­å¥ç­‰</li><li>å½“ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æˆ–å›æ»šï¼Œæ˜¾å¼çš„å¼€å¯ä¸€ä¸ªäº‹åŠ¡ä¼šéšå¼çš„æäº¤ä¸Šä¸€ä¸ªäº‹åŠ¡</li></ul></li></ul><hr><h4 id="äº‹åŠ¡-id" tabindex="-1"><a class="header-anchor" href="#äº‹åŠ¡-id" aria-hidden="true">#</a> äº‹åŠ¡ ID</h4><p>äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯¹æŸä¸ªè¡¨æ‰§è¡Œäº†<strong>å¢åˆ æ”¹æ“ä½œæˆ–è€…åˆ›å»ºè¡¨</strong>ï¼Œå°±ä¼šä¸ºå½“å‰äº‹åŠ¡åˆ†é…ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„äº‹åŠ¡ IDï¼ˆå¯¹ä¸´æ—¶è¡¨å¹¶ä¸ä¼šåˆ†é… IDï¼‰ï¼Œå¦‚æœå½“å‰äº‹åŠ¡æ²¡æœ‰è¢«åˆ†é… IDï¼Œé»˜è®¤æ˜¯ 0</p><p>è¯´æ˜ï¼šåªè¯»äº‹åŠ¡ä¸èƒ½å¯¹æ™®é€šçš„è¡¨è¿›è¡Œå¢åˆ æ”¹æ“ä½œï¼Œä½†æ˜¯å¯ä»¥å¯¹ä¸´æ—¶è¡¨å¢åˆ æ”¹ï¼Œè¯»å†™äº‹åŠ¡å¯ä»¥å¯¹æ•°æ®è¡¨æ‰§è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œ</p><p>äº‹åŠ¡ ID æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒæœåŠ¡å™¨åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€ä¸ªå…¨å±€å˜é‡ï¼š</p><ul><li>æ¯å½“éœ€è¦ä¸ºæŸä¸ªäº‹åŠ¡åˆ†é… IDï¼Œå°±ä¼šæŠŠå…¨å±€å˜é‡çš„å€¼èµ‹å€¼ç»™äº‹åŠ¡ IDï¼Œç„¶åå˜é‡è‡ªå¢ 1</li><li>æ¯å½“å˜é‡å€¼ä¸º 256 çš„å€æ•°æ—¶ï¼Œå°±å°†è¯¥å˜é‡çš„å€¼åˆ·æ–°åˆ°ç³»ç»Ÿè¡¨ç©ºé—´çš„ Max Trx ID å±æ€§ä¸­ï¼Œè¯¥å±æ€§å  8 å­—èŠ‚</li><li>ç³»ç»Ÿå†æ¬¡å¯åŠ¨åï¼Œä¼šè¯»å–è¡¨ç©ºé—´çš„ Max Trx ID å±æ€§åˆ°å†…å­˜ï¼ŒåŠ ä¸Š 256 åèµ‹å€¼ç»™å…¨å±€å˜é‡ï¼Œå› ä¸ºå…³æœºæ—¶çš„äº‹åŠ¡ ID å¯èƒ½å¹¶ä¸æ˜¯ 256 çš„å€æ•°ï¼Œä¼šæ¯” Max Trx ID å¤§ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Š 256 ä¿æŒäº‹åŠ¡ ID æ˜¯ä¸€ä¸ª<strong>é€’å¢çš„æ•°å­—</strong></li></ul><p><strong>èšç°‡ç´¢å¼•</strong>çš„è¡Œè®°å½•é™¤äº†å®Œæ•´çš„æ•°æ®ï¼Œè¿˜ä¼šè‡ªåŠ¨æ·»åŠ  trx_idã€roll_pointer éšè—åˆ—ï¼Œå¦‚æœè¡¨ä¸­æ²¡æœ‰ä¸»é”®å¹¶ä¸”æ²¡æœ‰éç©ºå”¯ä¸€ç´¢å¼•ï¼Œä¹Ÿä¼šæ·»åŠ ä¸€ä¸ª row_id çš„éšè—åˆ—ä½œä¸ºèšç°‡ç´¢å¼•</p><hr><h3 id="éš”ç¦»çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#éš”ç¦»çº§åˆ«" aria-hidden="true">#</a> éš”ç¦»çº§åˆ«</h3><h4 id="å››ç§çº§åˆ«" tabindex="-1"><a class="header-anchor" href="#å››ç§çº§åˆ«" aria-hidden="true">#</a> å››ç§çº§åˆ«</h4><p>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼šå¤šä¸ªå®¢æˆ·ç«¯æ“ä½œæ—¶ï¼Œå„ä¸ªå®¢æˆ·ç«¯çš„äº‹åŠ¡ä¹‹é—´åº”è¯¥æ˜¯éš”ç¦»çš„ï¼Œ<strong>ä¸åŒçš„äº‹åŠ¡ä¹‹é—´ä¸è¯¥äº’ç›¸å½±å“</strong>ï¼Œè€Œå¦‚æœå¤šä¸ªäº‹åŠ¡æ“ä½œåŒä¸€æ‰¹æ•°æ®æ—¶ï¼Œåˆ™éœ€è¦è®¾ç½®ä¸åŒçš„éš”ç¦»çº§åˆ«ï¼Œå¦åˆ™å°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚</p><p>éš”ç¦»çº§åˆ«åˆ†ç±»ï¼š</p><table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>åç§°</th><th>ä¼šå¼•å‘çš„é—®é¢˜</th><th>æ•°æ®åº“é»˜è®¤éš”ç¦»çº§åˆ«</th></tr></thead><tbody><tr><td>Read Uncommitted</td><td>è¯»æœªæäº¤</td><td>è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»</td><td></td></tr><tr><td>Read Committed</td><td>è¯»å·²æäº¤</td><td>ä¸å¯é‡å¤è¯»ã€å¹»è¯»</td><td>Oracle / SQL Server</td></tr><tr><td>Repeatable Read</td><td>å¯é‡å¤è¯»</td><td>å¹»è¯»</td><td>MySQL</td></tr><tr><td>Serializable</td><td>å¯ä¸²è¡ŒåŒ–</td><td>æ— </td><td></td></tr></tbody></table><p>ä¸€èˆ¬æ¥è¯´ï¼Œéš”ç¦»çº§åˆ«è¶Šä½ï¼Œç³»ç»Ÿå¼€é”€è¶Šä½ï¼Œå¯æ”¯æŒçš„å¹¶å‘è¶Šé«˜ï¼Œä½†éš”ç¦»æ€§ä¹Ÿè¶Šå·®</p><ul><li><p>è„å†™ (Dirty Write)ï¼šå½“ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡é€‰æ‹©åŒä¸€è¡Œï¼Œæœ€åˆçš„äº‹åŠ¡ä¿®æ”¹çš„å€¼è¢«åé¢äº‹åŠ¡ä¿®æ”¹çš„å€¼è¦†ç›–ï¼Œæ‰€æœ‰çš„éš”ç¦»çº§åˆ«éƒ½å¯ä»¥é¿å…è„å†™ï¼ˆåˆå«ä¸¢å¤±æ›´æ–°ï¼‰ï¼Œå› ä¸ºæœ‰è¡Œé”</p></li><li><p>è„è¯» (Dirty Reads)ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­è¯»å–äº†å¦ä¸€ä¸ª<strong>æœªæäº¤</strong>çš„äº‹åŠ¡ä¸­ä¿®æ”¹è¿‡çš„æ•°æ®</p></li><li><p>ä¸å¯é‡å¤è¯» (Non-Repeatable Reads)ï¼šåœ¨ä¸€ä¸ªäº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­è¯»å–äº†å¦ä¸€ä¸ªäº‹åŠ¡ä¸­ä¿®æ”¹å¹¶<strong>å·²æäº¤</strong>çš„æ•°æ®</p><blockquote><p>å¯é‡å¤è¯»çš„æ„æ€æ˜¯ä¸ç®¡è¯»å‡ æ¬¡ï¼Œç»“æœéƒ½ä¸€æ ·ï¼Œå¯ä»¥é‡å¤çš„è¯»ï¼Œå¯ä»¥ç†è§£ä¸ºå¿«ç…§è¯»ï¼Œè¦è¯»çš„æ•°æ®é›†ä¸ä¼šå‘ç”Ÿå˜åŒ–</p></blockquote></li><li><p>å¹»è¯» (Phantom Reads)ï¼šåœ¨äº‹åŠ¡ä¸­æŒ‰æŸä¸ªæ¡ä»¶å…ˆåä¸¤æ¬¡æŸ¥è¯¢æ•°æ®åº“ï¼Œåä¸€æ¬¡æŸ¥è¯¢æŸ¥åˆ°äº†å‰ä¸€æ¬¡æŸ¥è¯¢æ²¡æœ‰æŸ¥åˆ°çš„è¡Œï¼Œ<strong>æ•°æ®æ¡ç›®</strong>å‘ç”Ÿäº†å˜åŒ–ã€‚æ¯”å¦‚æŸ¥è¯¢æŸæ•°æ®ä¸å­˜åœ¨ï¼Œå‡†å¤‡æ’å…¥æ­¤è®°å½•ï¼Œä½†æ‰§è¡Œæ’å…¥æ—¶å‘ç°æ­¤è®°å½•å·²å­˜åœ¨ï¼Œæ— æ³•æ’å…¥</p></li></ul><p>éš”ç¦»çº§åˆ«æ“ä½œè¯­æ³•ï¼š</p><ul><li><p>æŸ¥è¯¢æ•°æ®åº“éš”ç¦»çº§åˆ«</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT @@TX_ISOLATION;			-- ä¼šè¯
SELECT @@GLOBAL.TX_ISOLATION;	-- ç³»ç»Ÿ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹æ•°æ®åº“éš”ç¦»çº§åˆ«</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET GLOBAL TRANSACTION ISOLATION LEVEL çº§åˆ«å­—ç¬¦ä¸²;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><hr><h4 id="åŠ é”åˆ†æ" tabindex="-1"><a class="header-anchor" href="#åŠ é”åˆ†æ" aria-hidden="true">#</a> åŠ é”åˆ†æ</h4><p>InnoDB å­˜å‚¨å¼•æ“æ”¯æŒäº‹åŠ¡ï¼Œæ‰€ä»¥åŠ é”åˆ†ææ˜¯åŸºäºè¯¥å­˜å‚¨å¼•æ“</p><ul><li><p>Read Uncommitted çº§åˆ«ï¼Œä»»ä½•æ“ä½œéƒ½ä¸ä¼šåŠ é”</p></li><li><p>Read Committed çº§åˆ«ï¼Œå¢åˆ æ”¹æ“ä½œä¼šåŠ å†™é”ï¼ˆè¡Œé”ï¼‰ï¼Œè¯»æ“ä½œä¸åŠ é”</p><p>åœ¨ Server å±‚è¿‡æ»¤æ¡ä»¶æ—¶å‘ç°ä¸æ»¡è¶³çš„è®°å½•ä¼šè°ƒç”¨ unlock_row æ–¹æ³•é‡Šæ”¾è¯¥è®°å½•çš„è¡Œé”ï¼Œä¿è¯æœ€ååªæœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•åŠ é”ï¼Œä½†æ˜¯æ‰«è¡¨è¿‡ç¨‹ä¸­æ¯æ¡è®°å½•çš„<strong>åŠ é”æ“ä½œä¸èƒ½çœç•¥</strong>ã€‚æ‰€ä»¥å¯¹æ•°æ®é‡å¾ˆå¤§çš„è¡¨åšæ‰¹é‡ä¿®æ”¹æ—¶ï¼Œå¦‚æœæ— æ³•ä½¿ç”¨ç›¸åº”çš„ç´¢å¼•ï¼ˆå…¨è¡¨æ‰«æï¼‰ï¼Œåœ¨ Server è¿‡æ»¤æ•°æ®æ—¶å°±ä¼šç‰¹åˆ«æ…¢ï¼Œå‡ºç°è™½ç„¶æ²¡æœ‰ä¿®æ”¹æŸäº›è¡Œçš„æ•°æ®ï¼Œä½†æ˜¯è¿˜æ˜¯è¢«é”ä½äº†çš„ç°è±¡ï¼ˆé”è¡¨ï¼‰ï¼Œè¿™ç§æƒ…å†µåŒæ ·é€‚ç”¨äº RR</p></li><li><p>Repeatable Read çº§åˆ«ï¼Œå¢åˆ æ”¹æ“ä½œä¼šåŠ å†™é”ï¼Œè¯»æ“ä½œä¸åŠ é”ã€‚å› ä¸ºè¯»å†™é”ä¸å…¼å®¹ï¼Œ<strong>åŠ äº†è¯»é”åå…¶ä»–äº‹åŠ¡å°±æ— æ³•ä¿®æ”¹æ•°æ®</strong>ï¼Œå½±å“äº†å¹¶å‘æ€§èƒ½ï¼Œä¸ºäº†ä¿è¯éš”ç¦»æ€§å’Œå¹¶å‘æ€§ï¼ŒMySQL é€šè¿‡ MVCC è§£å†³äº†è¯»å†™å†²çªã€‚RR çº§åˆ«ä¸‹çš„é”æœ‰å¾ˆå¤šç§ï¼Œé”æœºåˆ¶ç« èŠ‚è¯¦è§£</p></li><li><p>Serializable çº§åˆ«ï¼Œè¯»åŠ å…±äº«é”ï¼Œå†™åŠ æ’ä»–é”ï¼Œè¯»å†™äº’æ–¥ï¼Œä½¿ç”¨çš„æ‚²è§‚é”çš„ç†è®ºï¼Œå®ç°ç®€å•ï¼Œæ•°æ®æ›´åŠ å®‰å…¨ï¼Œä½†æ˜¯å¹¶å‘èƒ½åŠ›éå¸¸å·®</p><ul><li>ä¸²è¡ŒåŒ–ï¼šè®©æ‰€æœ‰äº‹åŠ¡æŒ‰é¡ºåºå•ç‹¬æ‰§è¡Œï¼Œå†™æ“ä½œä¼šåŠ å†™é”ï¼Œè¯»æ“ä½œä¼šåŠ è¯»é”</li><li>å¯ä¸²è¡ŒåŒ–ï¼šè®©æ‰€æœ‰æ“ä½œç›¸åŒæ•°æ®çš„äº‹åŠ¡é¡ºåºæ‰§è¡Œï¼Œé€šè¿‡åŠ é”å®ç°</li></ul></li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://tech.meituan.com/2014/08/20/innodb-lock.html" target="_blank" rel="noopener noreferrer">https://tech.meituan.com/2014/08/20/innodb-lock.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h3 id="åŸå­ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#åŸå­ç‰¹æ€§" aria-hidden="true">#</a> åŸå­ç‰¹æ€§</h3><h4 id="å®ç°æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#å®ç°æ–¹å¼" aria-hidden="true">#</a> å®ç°æ–¹å¼</h4><p>åŸå­æ€§æ˜¯æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•ä½ï¼Œäº‹åŠ¡çš„æ“ä½œå¦‚æœæˆåŠŸå°±å¿…é¡»è¦å®Œå…¨åº”ç”¨åˆ°æ•°æ®åº“ï¼Œå¤±è´¥åˆ™ä¸èƒ½å¯¹æ•°æ®åº“æœ‰ä»»ä½•å½±å“ã€‚æ¯”å¦‚äº‹åŠ¡ä¸­ä¸€ä¸ª SQL è¯­å¥æ‰§è¡Œå¤±è´¥ï¼Œåˆ™å·²æ‰§è¡Œçš„è¯­å¥ä¹Ÿå¿…é¡»å›æ»šï¼Œæ•°æ®åº“é€€å›åˆ°äº‹åŠ¡å‰çš„çŠ¶æ€</p><p>InnoDB å­˜å‚¨å¼•æ“æä¾›äº†ä¸¤ç§äº‹åŠ¡æ—¥å¿—ï¼šredo logï¼ˆé‡åšæ—¥å¿—ï¼‰å’Œ undo logï¼ˆå›æ»šæ—¥å¿—ï¼‰</p><ul><li>redo log ç”¨äºä¿è¯äº‹åŠ¡æŒä¹…æ€§</li><li>undo log ç”¨äºä¿è¯äº‹åŠ¡åŸå­æ€§å’Œéš”ç¦»æ€§</li></ul><p>undo log å±äº<strong>é€»è¾‘æ—¥å¿—</strong>ï¼Œæ ¹æ®æ¯è¡Œæ“ä½œè¿›è¡Œè®°å½•ï¼Œè®°å½•äº† SQL æ‰§è¡Œç›¸å…³çš„ä¿¡æ¯ï¼Œç”¨æ¥å›æ»šè¡Œè®°å½•åˆ°æŸä¸ªç‰ˆæœ¬</p><p>å½“äº‹åŠ¡å¯¹æ•°æ®åº“è¿›è¡Œä¿®æ”¹æ—¶ï¼ŒInnoDB ä¼šå…ˆè®°å½•å¯¹åº”çš„ undo logï¼Œå¦‚æœäº‹åŠ¡æ‰§è¡Œå¤±è´¥æˆ–è°ƒç”¨äº† rollback å¯¼è‡´äº‹åŠ¡å›æ»šï¼ŒInnoDB ä¼šæ ¹æ® undo log çš„å†…å®¹<strong>åšä¸ä¹‹å‰ç›¸åçš„æ“ä½œ</strong>ï¼š</p><ul><li><p>å¯¹äºæ¯ä¸ª insertï¼Œå›æ»šæ—¶ä¼šæ‰§è¡Œ delete</p></li><li><p>å¯¹äºæ¯ä¸ª deleteï¼Œå›æ»šæ—¶ä¼šæ‰§è¡Œ insert</p></li><li><p>å¯¹äºæ¯ä¸ª updateï¼Œå›æ»šæ—¶ä¼šæ‰§è¡Œä¸€ä¸ªç›¸åçš„ updateï¼ŒæŠŠæ•°æ®ä¿®æ”¹å›å»</p></li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.cnblogs.com/kismetv/p/10331633.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/kismetv/p/10331633.html<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="dml-è§£æ" tabindex="-1"><a class="header-anchor" href="#dml-è§£æ" aria-hidden="true">#</a> DML è§£æ</h4><h5 id="insert-1" tabindex="-1"><a class="header-anchor" href="#insert-1" aria-hidden="true">#</a> INSERT</h5><p>ä¹è§‚æ’å…¥ï¼šå½“å‰æ•°æ®é¡µçš„å‰©ä½™ç©ºé—´å……è¶³ï¼Œç›´æ¥å°†æ•°æ®è¿›è¡Œæ’å…¥</p><p>æ‚²è§‚æ’å…¥ï¼šå½“å‰æ•°æ®é¡µçš„å‰©ä½™ç©ºé—´ä¸è¶³ï¼Œéœ€è¦è¿›è¡Œé¡µåˆ†è£‚ï¼Œç”³è¯·ä¸€ä¸ªæ–°çš„é¡µé¢æ¥æ’å…¥æ•°æ®ï¼Œä¼šé€ æˆæ›´å¤šçš„ redo logï¼Œundo log å½±å“ä¸å¤§</p><p>å½“å‘æŸä¸ªè¡¨æ’å…¥ä¸€æ¡è®°å½•ï¼Œå®é™…ä¸Šéœ€è¦å‘èšç°‡ç´¢å¼•å’Œæ‰€æœ‰äºŒçº§ç´¢å¼•éƒ½æ’å…¥ä¸€æ¡è®°å½•ï¼Œä½†æ˜¯ undo log <strong>åªé’ˆå¯¹èšç°‡ç´¢å¼•è®°å½•</strong>ï¼Œåœ¨å›æ»šæ—¶ä¼šæ ¹æ®èšç°‡ç´¢å¼•å»æ‰€æœ‰çš„äºŒçº§ç´¢å¼•è¿›è¡Œå›æ»šæ“ä½œ</p><p>roll_pointer æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œ<strong>æŒ‡å‘è®°å½•å¯¹åº”çš„ undo log æ—¥å¿—</strong>ï¼Œä¸€æ¡è®°å½•å°±æ˜¯ä¸€ä¸ªæ•°æ®è¡Œï¼Œè¡Œæ ¼å¼ä¸­çš„ roll_pointer å°±æŒ‡å‘ undo log</p><hr><h5 id="delete-1" tabindex="-1"><a class="header-anchor" href="#delete-1" aria-hidden="true">#</a> DELETE</h5><p>æ’å…¥åˆ°é¡µé¢ä¸­çš„è®°å½•ä¼šæ ¹æ® next_record å±æ€§ç»„æˆä¸€ä¸ªå•å‘é“¾è¡¨ï¼Œè¿™ä¸ªé“¾è¡¨ç§°ä¸ºæ­£å¸¸é“¾è¡¨ï¼Œè¢«åˆ é™¤çš„è®°å½•ä¹Ÿä¼šé€šè¿‡ next_record ç»„æˆä¸€ä¸ªåƒåœ¾é“¾è¡¨ï¼Œè¯¥é“¾è¡¨ä¸­æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´å¯ä»¥è¢«é‡æ–°åˆ©ç”¨ï¼Œå¹¶ä¸ä¼šç›´æ¥æ¸…é™¤æ•°æ®</p><p>åœ¨é¡µé¢ Page Header ä¸­ï¼ŒPAGE_FREE å±æ€§æŒ‡å‘åƒåœ¾é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œåˆ é™¤çš„å·¥ä½œè¿‡ç¨‹ï¼š</p><ul><li><p>å°†è¦åˆ é™¤çš„è®°å½•çš„ delete_flag ä½ç½®ä¸º 1ï¼Œå…¶ä»–ä¸åšä¿®æ”¹ï¼Œè¿™ä¸ªè¿‡ç¨‹å« <strong>delete mark</strong></p></li><li><p>åœ¨äº‹åŠ¡æäº¤å‰ï¼Œdelete_flag = 1 çš„è®°å½•ä¸€ç›´éƒ½ä¼šå¤„äºä¸­é—´çŠ¶æ€</p></li><li><p>äº‹åŠ¡æäº¤åï¼Œæœ‰ä¸“é—¨çš„çº¿ç¨‹å°† delete_flag = 1 çš„è®°å½•ä»æ­£å¸¸é“¾è¡¨ç§»é™¤å¹¶åŠ å…¥åƒåœ¾é“¾è¡¨ï¼Œè¿™ä¸ªè¿‡ç¨‹å« <strong>purge</strong></p><p>purge çº¿ç¨‹åœ¨æ‰§è¡Œåˆ é™¤æ“ä½œæ—¶ä¼šåˆ›å»ºä¸€ä¸ª ReadViewï¼Œæ ¹æ®äº‹åŠ¡çš„å¯è§æ€§ç§»é™¤æ•°æ®ï¼ˆéš”ç¦»ç‰¹æ€§éƒ¨åˆ†è¯¦è§£ï¼‰</p></li></ul><p>å½“æœ‰æ–°æ’å…¥çš„è®°å½•æ—¶ï¼Œé¦–å…ˆåˆ¤æ–­ PAGE_FREE æŒ‡å‘çš„å¤´èŠ‚ç‚¹æ˜¯å¦è¶³å¤Ÿå®¹çº³æ–°çºªå½•ï¼š</p><ul><li>å¦‚æœå¯ä»¥å®¹çº³æ–°çºªå½•ï¼Œå°±ä¼šç›´æ¥é‡ç”¨å·²åˆ é™¤çš„è®°å½•çš„å­˜å‚¨ç©ºé—´ï¼Œç„¶åè®© PAGE_FREE æŒ‡å‘åƒåœ¾é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</li><li>å¦‚æœä¸èƒ½å®¹çº³æ–°çºªå½•ï¼Œå°±ç›´æ¥å‘é¡µé¢ç”³è¯·æ–°çš„ç©ºé—´å­˜å‚¨ï¼Œå¹¶ä¸ä¼šéå†åƒåœ¾é“¾è¡¨</li></ul><p>é‡ç”¨å·²åˆ é™¤çš„è®°å½•ç©ºé—´ï¼Œå¯èƒ½ä¼šé€ æˆç©ºé—´ç¢ç‰‡ï¼Œå½“æ•°æ®é¡µå®¹çº³ä¸äº†ä¸€æ¡è®°å½•æ—¶ï¼Œä¼šåˆ¤æ–­å°†ç¢ç‰‡ç©ºé—´åŠ èµ·æ¥æ˜¯å¦å¯ä»¥å®¹çº³ï¼Œåˆ¤æ–­ä¸ºçœŸå°±ä¼šé‡æ–°ç»„ç»‡é¡µå†…çš„è®°å½•ï¼š</p><ul><li>å¼€è¾Ÿä¸€ä¸ªä¸´æ—¶é¡µé¢ï¼Œå°†é¡µå†…è®°å½•ä¸€æ¬¡æ’å…¥åˆ°ä¸´æ—¶é¡µé¢ï¼Œæ­¤æ—¶ä¸´æ—¶é¡µé¢æ—¶æ²¡æœ‰ç¢ç‰‡çš„</li><li>æŠŠä¸´æ—¶é¡µé¢çš„å†…å®¹å¤åˆ¶åˆ°æœ¬é¡µï¼Œè¿™æ ·å°±è§£æ”¾å‡ºäº†å†…å­˜ç¢ç‰‡ï¼Œä½†æ˜¯ä¼šè€—è´¹å¾ˆå¤§çš„æ€§èƒ½èµ„æº</li></ul><hr><h5 id="update-1" tabindex="-1"><a class="header-anchor" href="#update-1" aria-hidden="true">#</a> UPDATE</h5><p>æ‰§è¡Œ UPDATE è¯­å¥ï¼Œå¯¹äºæ›´æ–°ä¸»é”®å’Œä¸æ›´æ–°ä¸»é”®æœ‰ä¸¤ç§ä¸åŒçš„å¤„ç†æ–¹å¼</p><p>ä¸æ›´æ–°ä¸»é”®çš„æƒ…å†µï¼š</p><ul><li><p>å°±åœ°æ›´æ–°ï¼ˆin-place updateï¼‰ï¼Œå¦‚æœæ›´æ–°åçš„åˆ—å’Œæ›´æ–°å‰çš„åˆ—å ç”¨çš„å­˜å‚¨ç©ºé—´ä¸€æ ·å¤§ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨åŸè®°å½•ä¸Šä¿®æ”¹</p></li><li><p>å…ˆåˆ é™¤æ—§çºªå½•ï¼Œå†æ’å…¥æ–°çºªå½•ï¼Œè¿™é‡Œçš„åˆ é™¤ä¸æ˜¯ delete markï¼Œè€Œæ˜¯ç›´æ¥å°†è®°å½•åŠ å…¥åƒåœ¾é“¾è¡¨ï¼Œå¹¶ä¸”ä¿®æ”¹é¡µé¢çš„ç›¸åº”çš„æ§åˆ¶ä¿¡æ¯ï¼Œæ‰§è¡Œåˆ é™¤çš„çº¿ç¨‹ä¸æ˜¯ purgeï¼Œæ˜¯æ‰§è¡Œæ›´æ–°çš„ç”¨æˆ·çº¿ç¨‹ï¼Œæ’å…¥æ–°è®°å½•æ—¶å¯èƒ½é€ æˆé¡µç©ºé—´ä¸è¶³ï¼Œä»è€Œå¯¼è‡´é¡µåˆ†è£‚</p></li></ul><p>æ›´æ–°ä¸»é”®çš„æƒ…å†µï¼š</p><ul><li>å°†æ—§çºªå½•è¿›è¡Œ delete markï¼Œåœ¨æ›´æ–°è¯­å¥æäº¤åç”± purge çº¿ç¨‹ç§»å…¥åƒåœ¾é“¾è¡¨</li><li>æ ¹æ®æ›´æ–°çš„å„åˆ—çš„å€¼åˆ›å»ºä¸€æ¡æ–°çºªå½•ï¼Œæ’å…¥åˆ°èšç°‡ç´¢å¼•ä¸­</li></ul><p>åœ¨å¯¹ä¸€æ¡è®°å½•ä¿®æ”¹å‰ä¼š<strong>å°†è®°å½•çš„éšè—åˆ— trx_id å’Œ roll_pointer çš„æ—§å€¼è®°å½•åˆ°å½“å‰ undo log å¯¹åº”çš„å±æ€§ä¸­</strong>ï¼Œè¿™æ ·å½“å‰è®°å½•çš„ roll_pointer æŒ‡å‘å½“å‰ undo log è®°å½•ï¼Œå½“å‰ undo log è®°å½•çš„ roll_pointer æŒ‡å‘æ—§çš„ undo log è®°å½•ï¼Œ<strong>å½¢æˆä¸€ä¸ªç‰ˆæœ¬é“¾</strong></p><p>UPDATEã€DELETE æ“ä½œäº§ç”Ÿçš„ undo æ—¥å¿—ä¼šç”¨äºå…¶ä»–äº‹åŠ¡çš„ MVCC æ“ä½œï¼Œæ‰€ä»¥ä¸èƒ½ç«‹å³åˆ é™¤ï¼ŒINSERT å¯ä»¥åˆ é™¤çš„åŸå› æ˜¯ MVCC æ˜¯å¯¹ç°æœ‰æ•°æ®çš„å¿«ç…§</p><hr><h4 id="å›æ»šæ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#å›æ»šæ—¥å¿—" aria-hidden="true">#</a> å›æ»šæ—¥å¿—</h4><p>undo log æ˜¯é‡‡ç”¨æ®µçš„æ–¹å¼æ¥è®°å½•ï¼ŒRollback Segement ç§°ä¸ºå›æ»šæ®µï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªç±»å‹æ˜¯ Rollback Segement Header çš„é¡µé¢</p><p>æ¯ä¸ªå›æ»šæ®µä¸­æœ‰ 1024 ä¸ª undo slotï¼Œæ¯ä¸ª slot å­˜æ”¾ undo é“¾è¡¨é¡µé¢çš„å¤´èŠ‚ç‚¹é¡µå·ï¼Œæ¯ä¸ªé“¾è¡¨å¯¹åº”ä¸€ä¸ªå« undo log segment çš„æ®µ</p><ul><li>åœ¨ä»¥å‰è€ç‰ˆæœ¬ï¼Œåªæ”¯æŒ 1 ä¸ª Rollback Segementï¼Œåªèƒ½è®°å½• 1024 ä¸ª undo log segment</li><li>MySQL5.5 å¼€å§‹æ”¯æŒ 128 ä¸ª Rollback Segementï¼Œæ”¯æŒ 128*1024 ä¸ª undo æ“ä½œ</li></ul><p>å·¥ä½œæµç¨‹ï¼š</p><ul><li><p>äº‹åŠ¡æ‰§è¡Œå‰éœ€è¦åˆ°ç³»ç»Ÿè¡¨ç©ºé—´ç¬¬ 5 å·é¡µé¢ä¸­åˆ†é…ä¸€ä¸ªå›æ»šæ®µï¼ˆé¡µï¼‰ï¼Œè·å–ä¸€ä¸ª Rollback Segement Header é¡µé¢çš„åœ°å€</p></li><li><p>å›æ»šæ®µé¡µé¢æœ‰ 1024 ä¸ª undo slotï¼Œé¦–å…ˆå»å›æ»šæ®µçš„ä¸¤ä¸ª cached é“¾è¡¨è·å–ç¼“å­˜çš„ slotï¼Œç¼“å­˜ä¸­æ²¡æœ‰å°±åœ¨å›æ»šæ®µé¡µé¢ä¸­æ‰¾ä¸€ä¸ªå¯ç”¨çš„ undo slot åˆ†é…ç»™å½“å‰äº‹åŠ¡</p></li><li><p>å¦‚æœæ˜¯ç¼“å­˜ä¸­è·å–çš„ slotï¼Œåˆ™è¯¥ slot å¯¹åº”çš„ undo log segment å·²ç»åˆ†é…äº†ï¼Œéœ€è¦é‡æ–°åˆ†é…ï¼Œç„¶åä» undo log segment ä¸­ç”³è¯·ä¸€ä¸ªé¡µé¢ä½œä¸ºæ—¥å¿—é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œå¹¶å¡«å…¥å¯¹åº”çš„ slot ä¸­</p></li><li><p>æ¯ä¸ªäº‹åŠ¡ undo æ—¥å¿—åœ¨è®°å½•çš„æ—¶å€™<strong>å ç”¨ä¸¤ä¸ª undo é¡µé¢çš„ç»„æˆé“¾è¡¨</strong>ï¼Œåˆ†åˆ«ä¸º insert undo é“¾è¡¨å’Œ update undo é“¾è¡¨ï¼Œé“¾è¡¨çš„å¤´èŠ‚ç‚¹é¡µé¢ä¸º first undo page ä¼šåŒ…å«ä¸€äº›ç®¡ç†ä¿¡æ¯ï¼Œå…¶ä»–é¡µé¢ä¸º normal undo page</p><p>è¯´æ˜ï¼šäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹çš„ä¸´æ—¶è¡¨ä¹Ÿéœ€è¦ä¸¤ä¸ª undo é“¾è¡¨ï¼Œä¸å’Œæ™®é€šè¡¨å…±ç”¨ï¼Œè¿™äº›é“¾è¡¨å¹¶ä¸æ˜¯äº‹åŠ¡å¼€å§‹å°±åˆ†é…ï¼Œè€Œæ˜¯æŒ‰éœ€åˆ†é…</p></li></ul><hr><h3 id="éš”ç¦»ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#éš”ç¦»ç‰¹æ€§" aria-hidden="true">#</a> éš”ç¦»ç‰¹æ€§</h3><h4 id="å®ç°æ–¹å¼-1" tabindex="-1"><a class="header-anchor" href="#å®ç°æ–¹å¼-1" aria-hidden="true">#</a> å®ç°æ–¹å¼</h4><p>éš”ç¦»æ€§æ˜¯æŒ‡ï¼Œäº‹åŠ¡å†…éƒ¨çš„æ“ä½œä¸å…¶ä»–äº‹åŠ¡æ˜¯éš”ç¦»çš„ï¼Œå¤šä¸ªå¹¶å‘äº‹åŠ¡ä¹‹é—´è¦ç›¸äº’éš”ç¦»ï¼Œä¸èƒ½äº’ç›¸å¹²æ‰°</p><ul><li><p>ä¸¥æ ¼çš„éš”ç¦»æ€§ï¼Œå¯¹åº”äº†äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸­çš„ serializableï¼Œå®é™…åº”ç”¨ä¸­å¯¹æ€§èƒ½è€ƒè™‘å¾ˆå°‘ä½¿ç”¨å¯ä¸²è¡ŒåŒ–</p></li><li><p>ä¸åŸå­æ€§ã€æŒä¹…æ€§ä¾§é‡äºç ”ç©¶äº‹åŠ¡æœ¬èº«ä¸åŒï¼Œéš”ç¦»æ€§ç ”ç©¶çš„æ˜¯<strong>ä¸åŒäº‹åŠ¡</strong>ä¹‹é—´çš„ç›¸äº’å½±å“</p></li></ul><p>éš”ç¦»æ€§è®©å¹¶å‘æƒ…å½¢ä¸‹çš„äº‹åŠ¡ä¹‹é—´äº’ä¸å¹²æ‰°ï¼š</p><ul><li>ä¸€ä¸ªäº‹åŠ¡çš„å†™æ“ä½œå¯¹å¦ä¸€ä¸ªäº‹åŠ¡çš„å†™æ“ä½œï¼ˆå†™å†™ï¼‰ï¼šé”æœºåˆ¶ä¿è¯éš”ç¦»æ€§</li><li>ä¸€ä¸ªäº‹åŠ¡çš„å†™æ“ä½œå¯¹å¦ä¸€ä¸ªäº‹åŠ¡çš„è¯»æ“ä½œï¼ˆè¯»å†™ï¼‰ï¼šMVCC ä¿è¯éš”ç¦»æ€§</li></ul><p>é”æœºåˆ¶ï¼šäº‹åŠ¡åœ¨ä¿®æ”¹æ•°æ®ä¹‹å‰ï¼Œéœ€è¦å…ˆè·å¾—ç›¸åº”çš„é”ï¼Œè·å¾—é”ä¹‹åï¼Œäº‹åŠ¡ä¾¿å¯ä»¥ä¿®æ”¹æ•°æ®ï¼›è¯¥äº‹åŠ¡æ“ä½œæœŸé—´ï¼Œè¿™éƒ¨åˆ†æ•°æ®æ˜¯é”å®šçš„ï¼Œå…¶ä»–äº‹åŠ¡å¦‚æœéœ€è¦ä¿®æ”¹æ•°æ®ï¼Œéœ€è¦ç­‰å¾…å½“å‰äº‹åŠ¡æäº¤æˆ–å›æ»šåé‡Šæ”¾é”ï¼ˆè¯¦è§£è§é”æœºåˆ¶ï¼‰</p><hr><h4 id="å¹¶å‘æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#å¹¶å‘æ§åˆ¶" aria-hidden="true">#</a> å¹¶å‘æ§åˆ¶</h4><p>MVCC å…¨ç§° Multi-Version Concurrency Controlï¼Œå³å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ï¼Œç”¨æ¥<strong>è§£å†³è¯»å†™å†²çªçš„æ— é”å¹¶å‘æ§åˆ¶</strong>ï¼Œå¯ä»¥åœ¨å‘ç”Ÿè¯»å†™è¯·æ±‚å†²çªæ—¶ä¸ç”¨åŠ é”è§£å†³ï¼Œè¿™ä¸ªè¯»æ˜¯æŒ‡çš„å¿«ç…§è¯»ï¼ˆä¹Ÿå«ä¸€è‡´æ€§è¯»æˆ–ä¸€è‡´æ€§æ— é”è¯»ï¼‰ï¼Œè€Œä¸æ˜¯å½“å‰è¯»ï¼š</p><ul><li>å¿«ç…§è¯»ï¼šå®ç°åŸºäº MVCCï¼Œå› ä¸ºæ˜¯å¤šç‰ˆæœ¬å¹¶å‘ï¼Œæ‰€ä»¥å¿«ç…§è¯»è¯»åˆ°çš„æ•°æ®ä¸ä¸€å®šæ˜¯å½“å‰æœ€æ–°çš„æ•°æ®ï¼Œæœ‰å¯èƒ½æ˜¯å†å²ç‰ˆæœ¬çš„æ•°æ®</li><li>å½“å‰è¯»ï¼šåˆå«åŠ é”è¯»ï¼Œè¯»å–æ•°æ®åº“è®°å½•æ˜¯å½“å‰<strong>æœ€æ–°çš„ç‰ˆæœ¬</strong>ï¼ˆäº§ç”Ÿå¹»è¯»ã€ä¸å¯é‡å¤è¯»ï¼‰ï¼Œå¯ä»¥å¯¹è¯»å–çš„æ•°æ®è¿›è¡ŒåŠ é”ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹æ•°æ®ï¼Œæ˜¯æ‚²è§‚é”çš„ä¸€ç§æ“ä½œï¼Œè¯»å†™æ“ä½œåŠ å…±äº«é”æˆ–è€…æ’ä»–é”å’Œä¸²è¡ŒåŒ–äº‹åŠ¡çš„éš”ç¦»çº§åˆ«éƒ½æ˜¯å½“å‰è¯»</li></ul><p>æ•°æ®åº“å¹¶å‘åœºæ™¯ï¼š</p><ul><li><p>è¯»-è¯»ï¼šä¸å­˜åœ¨ä»»ä½•é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦å¹¶å‘æ§åˆ¶</p></li><li><p>è¯»-å†™ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šé€ æˆäº‹åŠ¡éš”ç¦»æ€§é—®é¢˜ï¼Œå¯èƒ½é‡åˆ°è„è¯»ï¼Œå¹»è¯»ï¼Œä¸å¯é‡å¤è¯»</p></li><li><p>å†™-å†™ï¼šæœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯èƒ½ä¼šå­˜åœ¨è„å†™ï¼ˆä¸¢å¤±æ›´æ–°ï¼‰é—®é¢˜</p></li></ul><p>MVCC çš„ä¼˜ç‚¹ï¼š</p><ul><li>åœ¨å¹¶å‘è¯»å†™æ•°æ®åº“æ—¶ï¼Œåšåˆ°åœ¨è¯»æ“ä½œæ—¶ä¸ç”¨é˜»å¡å†™æ“ä½œï¼Œå†™æ“ä½œä¹Ÿä¸ç”¨é˜»å¡è¯»æ“ä½œï¼Œæé«˜äº†å¹¶å‘è¯»å†™çš„æ€§èƒ½</li><li>å¯ä»¥è§£å†³è„è¯»ï¼Œä¸å¯é‡å¤è¯»ç­‰äº‹åŠ¡éš”ç¦»é—®é¢˜ï¼ˆåŠ é”ä¹Ÿèƒ½è§£å†³ï¼‰ï¼Œä½†ä¸èƒ½è§£å†³æ›´æ–°ä¸¢å¤±é—®é¢˜ï¼ˆå†™é”ä¼šè§£å†³ï¼‰</li></ul><p>æé«˜è¯»å†™å’Œå†™å†™çš„å¹¶å‘æ€§èƒ½ï¼š</p><ul><li>MVCC + æ‚²è§‚é”ï¼šMVCC è§£å†³è¯»å†™å†²çªï¼Œæ‚²è§‚é”è§£å†³å†™å†™å†²çª</li><li>MVCC + ä¹è§‚é”ï¼šMVCC è§£å†³è¯»å†™å†²çªï¼Œä¹è§‚é”è§£å†³å†™å†™å†²çª</li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://www.jianshu.com/p/8845ddca3b23" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/8845ddca3b23<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#å®ç°åŸç†" aria-hidden="true">#</a> å®ç°åŸç†</h4><h5 id="éšè—å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#éšè—å­—æ®µ" aria-hidden="true">#</a> éšè—å­—æ®µ</h5><p>å®ç°åŸç†ä¸»è¦æ˜¯éšè—å­—æ®µï¼Œundoæ—¥å¿—ï¼ŒRead View æ¥å®ç°çš„</p><p>InnoDB å­˜å‚¨å¼•æ“ï¼Œæ•°æ®åº“ä¸­çš„<strong>èšç°‡ç´¢å¼•</strong>æ¯è¡Œæ•°æ®ï¼Œé™¤äº†è‡ªå®šä¹‰çš„å­—æ®µï¼Œè¿˜æœ‰æ•°æ®åº“éšå¼å®šä¹‰çš„å­—æ®µï¼š</p><ul><li>DB_TRX_IDï¼šæœ€è¿‘ä¿®æ”¹äº‹åŠ¡ IDï¼Œè®°å½•åˆ›å»ºè¯¥æ•°æ®æˆ–æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥æ•°æ®çš„äº‹åŠ¡ ID</li><li>DB_ROLL_PTRï¼šå›æ»šæŒ‡é’ˆï¼Œ<strong>æŒ‡å‘è®°å½•å¯¹åº”çš„ undo log æ—¥å¿—</strong>ï¼Œundo log ä¸­åˆæŒ‡å‘ä¸Šä¸€ä¸ªæ—§ç‰ˆæœ¬çš„ undo log</li><li>DB_ROW_IDï¼šéšå«çš„è‡ªå¢ IDï¼ˆ<strong>éšè—ä¸»é”®</strong>ï¼‰ï¼Œå¦‚æœæ•°æ®è¡¨æ²¡æœ‰ä¸»é”®ï¼ŒInnoDB ä¼šè‡ªåŠ¨ä»¥ DB_ROW_ID ä½œä¸ºèšç°‡ç´¢å¼•</li></ul><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MVCCç‰ˆæœ¬é“¾éšè—å­—æ®µ.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h5 id="ç‰ˆæœ¬é“¾" tabindex="-1"><a class="header-anchor" href="#ç‰ˆæœ¬é“¾" aria-hidden="true">#</a> ç‰ˆæœ¬é“¾</h5><p>undo log æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯æ¯ä¸ªäº‹åŠ¡å¯¹æ•°æ®æ‰§è¡Œçš„æ“ä½œï¼Œè€Œä¸æ˜¯è®°å½•çš„å…¨éƒ¨æ•°æ®ï¼Œè¦<strong>æ ¹æ® undo log é€†æ¨å‡ºä»¥å¾€äº‹åŠ¡çš„æ•°æ®</strong></p><p>undo log çš„ä½œç”¨ï¼š</p><ul><li>ä¿è¯äº‹åŠ¡è¿›è¡Œ rollback æ—¶çš„åŸå­æ€§å’Œä¸€è‡´æ€§ï¼Œå½“äº‹åŠ¡è¿›è¡Œå›æ»šçš„æ—¶å€™å¯ä»¥ç”¨ undo log çš„æ•°æ®è¿›è¡Œæ¢å¤</li><li>ç”¨äº MVCC å¿«ç…§è¯»ï¼Œé€šè¿‡è¯»å– undo log çš„å†å²ç‰ˆæœ¬æ•°æ®å¯ä»¥å®ç°ä¸åŒäº‹åŠ¡ç‰ˆæœ¬å·éƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹çš„å¿«ç…§æ•°æ®</li></ul><p>undo log ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><p>insert undo logï¼šäº‹åŠ¡åœ¨ insert æ–°è®°å½•æ—¶äº§ç”Ÿçš„ undo logï¼Œåªåœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦ï¼Œå¹¶ä¸”åœ¨äº‹åŠ¡æäº¤åå¯ä»¥è¢«ç«‹å³ä¸¢å¼ƒ</p></li><li><p>update undo logï¼šäº‹åŠ¡åœ¨è¿›è¡Œ update æˆ– delete æ—¶äº§ç”Ÿçš„ undo logï¼Œåœ¨äº‹åŠ¡å›æ»šæ—¶éœ€è¦ï¼Œåœ¨å¿«ç…§è¯»æ—¶ä¹Ÿéœ€è¦ã€‚ä¸èƒ½éšæ„åˆ é™¤ï¼Œåªæœ‰åœ¨å½“å‰è¯»æˆ–äº‹åŠ¡å›æ»šä¸æ¶‰åŠè¯¥æ—¥å¿—æ—¶ï¼Œå¯¹åº”çš„æ—¥å¿—æ‰ä¼šè¢« purge çº¿ç¨‹ç»Ÿä¸€æ¸…é™¤</p></li></ul><p>æ¯æ¬¡å¯¹æ•°æ®åº“è®°å½•è¿›è¡Œæ”¹åŠ¨ï¼Œéƒ½ä¼šäº§ç”Ÿçš„æ–°ç‰ˆæœ¬çš„ undo logï¼Œéšç€æ›´æ–°æ¬¡æ•°çš„å¢å¤šï¼Œæ‰€æœ‰çš„ç‰ˆæœ¬éƒ½ä¼šè¢« roll_pointer å±æ€§è¿æ¥æˆä¸€ä¸ªé“¾è¡¨ï¼ŒæŠŠè¿™ä¸ªé“¾è¡¨ç§°ä¹‹ä¸º<strong>ç‰ˆæœ¬é“¾</strong>ï¼Œç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹å°±æ˜¯å½“å‰çš„æœ€æ–°çš„ undo logï¼Œé“¾å°¾å°±æ˜¯æœ€æ—©çš„æ—§ undo log</p><p>è¯´æ˜ï¼šå› ä¸º DELETE åˆ é™¤è®°å½•ï¼Œéƒ½æ˜¯ç§»åŠ¨åˆ°åƒåœ¾é“¾è¡¨ä¸­ï¼Œä¸æ˜¯çœŸæ­£çš„åˆ é™¤ï¼Œæ‰€ä»¥æ‰å¯ä»¥é€šè¿‡ç‰ˆæœ¬é“¾è®¿é—®åŸå§‹æ•°æ®</p><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MVCCç‰ˆæœ¬é“¾.png" style="zoom:80%;"><p>æ³¨æ„ï¼šundo æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè¿™é‡Œåªæ˜¯ç›´è§‚çš„å±•ç¤ºå‡ºæ¥</p><p>å·¥ä½œæµç¨‹ï¼š</p><ul><li>æœ‰ä¸ªäº‹åŠ¡æ’å…¥ persion è¡¨ä¸€æ¡æ–°è®°å½•ï¼Œname ä¸º Jerryï¼Œage ä¸º 24</li><li>äº‹åŠ¡ 1 ä¿®æ”¹è¯¥è¡Œæ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¼šå…ˆå¯¹è¯¥è¡ŒåŠ æ’ä»–é”ï¼Œç„¶åå…ˆè®°å½• undo logï¼Œç„¶åä¿®æ”¹è¯¥è¡Œ name ä¸º Tomï¼Œå¹¶ä¸”ä¿®æ”¹éšè—å­—æ®µçš„äº‹åŠ¡ ID ä¸ºå½“å‰äº‹åŠ¡ 1 çš„ IDï¼ˆé»˜è®¤ä¸º 1 ä¹‹åé€’å¢ï¼‰ï¼Œå›æ»šæŒ‡é’ˆæŒ‡å‘æ‹·è´åˆ° undo log çš„å‰¯æœ¬è®°å½•ï¼Œäº‹åŠ¡æäº¤åï¼Œé‡Šæ”¾é”</li><li>ä»¥æ­¤ç±»æ¨</li></ul><hr><h5 id="è¯»è§†å›¾" tabindex="-1"><a class="header-anchor" href="#è¯»è§†å›¾" aria-hidden="true">#</a> è¯»è§†å›¾</h5><p>Read View æ˜¯äº‹åŠ¡è¿›è¡Œè¯»æ•°æ®æ“ä½œæ—¶äº§ç”Ÿçš„è¯»è§†å›¾ï¼Œè¯¥äº‹åŠ¡æ‰§è¡Œå¿«ç…§è¯»çš„é‚£ä¸€åˆ»ä¼šç”Ÿæˆæ•°æ®åº“ç³»ç»Ÿå½“å‰çš„ä¸€ä¸ªå¿«ç…§ï¼Œè®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡çš„ IDï¼Œç”¨æ¥åšå¯è§æ€§åˆ¤æ–­ï¼Œæ ¹æ®è§†å›¾åˆ¤æ–­å½“å‰äº‹åŠ¡èƒ½å¤Ÿçœ‹åˆ°å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®</p><p>æ³¨æ„ï¼šè¿™é‡Œçš„å¿«ç…§å¹¶ä¸æ˜¯æŠŠæ‰€æœ‰çš„æ•°æ®æ‹·è´ä¸€ä»½å‰¯æœ¬ï¼Œè€Œæ˜¯ç”± undo log è®°å½•çš„é€»è¾‘æ—¥å¿—ï¼Œæ ¹æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œè®¡ç®—å‡ºå†å²æ•°æ®</p><p>å·¥ä½œæµç¨‹ï¼šå°†ç‰ˆæœ¬é“¾çš„å¤´èŠ‚ç‚¹çš„äº‹åŠ¡ IDï¼ˆæœ€æ–°æ•°æ®äº‹åŠ¡ IDï¼Œå¤§æ¦‚ç‡ä¸æ˜¯å½“å‰çº¿ç¨‹ï¼‰DB_TRX_ID å–å‡ºæ¥ï¼Œä¸ç³»ç»Ÿå½“å‰æ´»è·ƒäº‹åŠ¡çš„ ID å¯¹æ¯”è¿›è¡Œå¯è§æ€§åˆ†æï¼Œä¸å¯è§å°±é€šè¿‡ DB_ROLL_PTR å›æ»šæŒ‡é’ˆå»å–å‡º undo log ä¸­çš„ä¸‹ä¸€ä¸ª DB_TRX_ID æ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°æœ€è¿‘çš„æ»¡è¶³å¯è§æ€§çš„ DB_TRX_IDï¼Œè¯¥äº‹åŠ¡ ID æ‰€åœ¨çš„æ—§è®°å½•å°±æ˜¯å½“å‰äº‹åŠ¡èƒ½çœ‹è§çš„æœ€æ–°çš„è®°å½•</p><p>Read View å‡ ä¸ªå±æ€§ï¼š</p><ul><li>m_idsï¼šç”Ÿæˆ Read View æ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„äº‹åŠ¡ id åˆ—è¡¨ï¼ˆæœªæäº¤çš„äº‹åŠ¡é›†åˆï¼Œå½“å‰äº‹åŠ¡ä¹Ÿåœ¨å…¶ä¸­ï¼‰</li><li>min_trx_idï¼šç”Ÿæˆ Read View æ—¶å½“å‰ç³»ç»Ÿä¸­æ´»è·ƒçš„æœ€å°çš„äº‹åŠ¡ idï¼Œä¹Ÿå°±æ˜¯ m_ids ä¸­çš„æœ€å°å€¼ï¼ˆå·²æäº¤çš„äº‹åŠ¡é›†åˆï¼‰</li><li>max_trx_idï¼šç”Ÿæˆ Read View æ—¶å½“å‰ç³»ç»Ÿåº”è¯¥åˆ†é…ç»™ä¸‹ä¸€ä¸ªäº‹åŠ¡çš„ id å€¼ï¼Œm_ids ä¸­çš„æœ€å¤§å€¼åŠ  1ï¼ˆæœªå¼€å§‹äº‹åŠ¡ï¼‰</li><li>creator_trx_idï¼šç”Ÿæˆè¯¥ Read View çš„äº‹åŠ¡çš„äº‹åŠ¡ idï¼Œå°±æ˜¯åˆ¤æ–­è¯¥ id çš„äº‹åŠ¡èƒ½è¯»åˆ°ä»€ä¹ˆæ•°æ®</li></ul><p>creator åˆ›å»ºä¸€ä¸ª Read Viewï¼Œè¿›è¡Œå¯è§æ€§ç®—æ³•åˆ†æï¼šï¼ˆè§£å†³äº†è¯»æœªæäº¤ï¼‰</p><ul><li><p>db_trx_id == creator_trx_idï¼šè¡¨ç¤ºè¿™ä¸ªæ•°æ®å°±æ˜¯å½“å‰äº‹åŠ¡è‡ªå·±ç”Ÿæˆçš„ï¼Œè‡ªå·±ç”Ÿæˆçš„æ•°æ®è‡ªå·±è‚¯å®šèƒ½çœ‹è§ï¼Œæ‰€ä»¥æ­¤æ•°æ®å¯¹ creator æ˜¯å¯è§çš„</p></li><li><p>db_trx_id &lt; min_trx_idï¼šè¯¥ç‰ˆæœ¬å¯¹åº”çš„äº‹åŠ¡ ID å°äº Read view ä¸­çš„æœ€å°æ´»è·ƒäº‹åŠ¡ IDï¼Œåˆ™è¿™ä¸ªäº‹åŠ¡åœ¨å½“å‰äº‹åŠ¡ä¹‹å‰å°±å·²ç»è¢«æäº¤äº†ï¼Œå¯¹ creator å¯è§ï¼ˆå› ä¸ºæ¯”å·²æäº¤çš„æœ€å¤§äº‹åŠ¡ ID å°çš„å¹¶ä¸ä¸€å®šå·²ç»æäº¤ï¼Œæ‰€ä»¥åº”è¯¥åˆ¤æ–­æ˜¯å¦åœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ï¼‰</p></li><li><p>db_trx_id &gt;= max_trx_idï¼šè¯¥ç‰ˆæœ¬å¯¹åº”çš„äº‹åŠ¡ ID å¤§äº Read view ä¸­å½“å‰ç³»ç»Ÿçš„æœ€å¤§äº‹åŠ¡ IDï¼Œåˆ™è¯´æ˜è¯¥æ•°æ®æ˜¯åœ¨å½“å‰ Read view åˆ›å»ºä¹‹åæ‰äº§ç”Ÿçš„ï¼Œå¯¹ creator ä¸å¯è§</p></li><li><p>min_trx_id&lt;= db_trx_id &lt; max_trx_idï¼šåˆ¤æ–­ db_trx_id æ˜¯å¦åœ¨æ´»è·ƒäº‹åŠ¡åˆ—è¡¨ m_ids ä¸­</p><ul><li>åœ¨åˆ—è¡¨ä¸­ï¼Œè¯´æ˜è¯¥ç‰ˆæœ¬å¯¹åº”çš„äº‹åŠ¡æ­£åœ¨è¿è¡Œï¼Œæ•°æ®ä¸èƒ½æ˜¾ç¤ºï¼ˆ<strong>ä¸èƒ½è¯»åˆ°æœªæäº¤çš„æ•°æ®</strong>ï¼‰</li><li>ä¸åœ¨åˆ—è¡¨ä¸­ï¼Œè¯´æ˜è¯¥ç‰ˆæœ¬å¯¹åº”çš„äº‹åŠ¡å·²ç»è¢«æäº¤ï¼Œæ•°æ®å¯ä»¥æ˜¾ç¤ºï¼ˆ<strong>å¯ä»¥è¯»åˆ°å·²ç»æäº¤çš„æ•°æ®</strong>ï¼‰</li></ul></li></ul><hr><h5 id="å·¥ä½œæµç¨‹-1" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œæµç¨‹-1" aria-hidden="true">#</a> å·¥ä½œæµç¨‹</h5><p>è¡¨ user æ•°æ®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">id</span>		name		age
<span class="token number">1</span>		å¼ ä¸‰		   <span class="token number">18</span>	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Transaction 20ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>START TRANSACTION;	-- å¼€å¯äº‹åŠ¡
UPDATE user SET name = &#39;æå››&#39; WHERE id = 1;
UPDATE user SET name = &#39;ç‹äº”&#39; WHERE id = 1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Transaction 60ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>START TRANSACTION;	-- å¼€å¯äº‹åŠ¡
-- æ“ä½œè¡¨çš„å…¶ä»–æ•°æ®
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MVCCå·¥ä½œæµç¨‹1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ID ä¸º 0 çš„äº‹åŠ¡åˆ›å»º Read Viewï¼š</p><ul><li>m_idsï¼š20ã€60</li><li>min_trx_idï¼š20</li><li>max_trx_idï¼š61</li><li>creator_trx_idï¼š0</li></ul><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MVCCå·¥ä½œæµç¨‹2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>åªæœ‰çº¢æ¡†éƒ¨åˆ†æ‰å¤åˆæ¡ä»¶ï¼Œæ‰€ä»¥åªæœ‰å¼ ä¸‰å¯¹åº”çš„ç‰ˆæœ¬çš„æ•°æ®å¯ä»¥è¢«çœ‹åˆ°</p><p>å‚è€ƒè§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1t5411u7Fg" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1t5411u7Fg<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h5 id="äºŒçº§ç´¢å¼•" tabindex="-1"><a class="header-anchor" href="#äºŒçº§ç´¢å¼•" aria-hidden="true">#</a> äºŒçº§ç´¢å¼•</h5><p>åªæœ‰åœ¨èšç°‡ç´¢å¼•ä¸­æ‰æœ‰ trx_id å’Œ roll_pointer çš„éšè—åˆ—ï¼Œå¯¹äºäºŒçº§ç´¢å¼•åˆ¤æ–­å¯è§æ€§çš„æ–¹å¼ï¼š</p><ul><li>äºŒçº§ç´¢å¼•é¡µé¢çš„ Page Header ä¸­æœ‰ä¸€ä¸ª PAGE_MAX_TRX_ID å±æ€§ï¼Œä»£è¡¨ä¿®æ”¹å½“å‰é¡µé¢çš„æœ€å¤§çš„äº‹åŠ¡ IDï¼ŒSELECT è¯­å¥è®¿é—®æŸä¸ªäºŒçº§ç´¢å¼•æ—¶ä¼šåˆ¤æ–­ ReadView çš„ min_trx_id æ˜¯å¦å¤§äºè¯¥å±æ€§ï¼Œå¤§äºè¯´æ˜è¯¥é¡µé¢çš„æ‰€æœ‰å±æ€§å¯¹ ReadView å¯è§</li><li>å¦‚æœå±æ€§åˆ¤æ–­ä¸å¯è§ï¼Œå°±éœ€è¦åˆ©ç”¨äºŒçº§ç´¢å¼•è·å–ä¸»é”®å€¼è¿›è¡Œ<strong>å›è¡¨æ“ä½œ</strong>ï¼Œå¾—åˆ°èšç°‡ç´¢å¼•åæŒ‰ç…§èšç°‡ç´¢å¼•çš„å¯è§æ€§åˆ¤æ–­çš„æ–¹æ³•æ“ä½œ</li></ul><hr><h4 id="rc-rr" tabindex="-1"><a class="header-anchor" href="#rc-rr" aria-hidden="true">#</a> RC RR</h4><p>Read View ç”¨äºæ”¯æŒ RCï¼ˆRead Committedï¼Œè¯»å·²æäº¤ï¼‰å’Œ RRï¼ˆRepeatable Readï¼Œå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«çš„å®ç°ï¼Œæ‰€ä»¥ <strong>SELECT åœ¨ RC å’Œ RR éš”ç¦»çº§åˆ«ä½¿ç”¨ MVCC è¯»å–è®°å½•</strong></p><p>RRã€RC ç”Ÿæˆæ—¶æœºï¼š</p><ul><li>RC éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ¯æ¬¡è¯»å–æ•°æ®å‰éƒ½ä¼šç”Ÿæˆæœ€æ–°çš„ Read Viewï¼ˆå½“å‰è¯»ï¼‰</li><li>RR éš”ç¦»çº§åˆ«ä¸‹ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ•°æ®è¯»å–æ—¶æ‰ä¼šåˆ›å»º Read Viewï¼ˆå¿«ç…§è¯»ï¼‰</li></ul><p>RCã€RR çº§åˆ«ä¸‹çš„ InnoDB å¿«ç…§è¯»åŒºåˆ«</p><ul><li><p>RC çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡ä¸­æ¯æ¬¡å¿«ç…§è¯»éƒ½ä¼šæ–°ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œè¿™å°±æ˜¯åœ¨ RC çº§åˆ«ä¸‹çš„äº‹åŠ¡ä¸­å¯ä»¥çœ‹åˆ°åˆ«çš„äº‹åŠ¡æäº¤çš„æ›´æ–°çš„åŸå› </p></li><li><p>RR çº§åˆ«ä¸‹ï¼ŒæŸä¸ªäº‹åŠ¡çš„å¯¹æŸæ¡è®°å½•çš„<strong>ç¬¬ä¸€æ¬¡å¿«ç…§è¯»</strong>ä¼šåˆ›å»ºä¸€ä¸ª Read Viewï¼Œ å°†å½“å‰ç³»ç»Ÿæ´»è·ƒçš„å…¶ä»–äº‹åŠ¡è®°å½•èµ·æ¥ï¼Œæ­¤ååœ¨è°ƒç”¨å¿«ç…§è¯»çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ª Read Viewï¼Œæ‰€ä»¥ä¸€ä¸ªäº‹åŠ¡çš„æŸ¥è¯¢ç»“æœæ¯æ¬¡éƒ½æ˜¯ç›¸åŒçš„</p><p>RR çº§åˆ«ä¸‹ï¼Œé€šè¿‡ <code>START TRANSACTION WITH CONSISTENT SNAPSHOT</code> å¼€å¯äº‹åŠ¡ï¼Œä¼šåœ¨æ‰§è¡Œè¯¥è¯­å¥åç«‹åˆ»ç”Ÿæˆä¸€ä¸ª Read Viewï¼Œä¸æ˜¯åœ¨æ‰§è¡Œç¬¬ä¸€æ¡ SELECT è¯­å¥æ—¶ç”Ÿæˆï¼ˆæ‰€ä»¥è¯´ <code>START TRANSACTION</code> å¹¶ä¸æ˜¯äº‹åŠ¡çš„èµ·ç‚¹ï¼Œæ‰§è¡Œç¬¬ä¸€æ¡è¯­å¥æ‰ç®—èµ·ç‚¹ï¼‰</p></li></ul><p>è§£å†³å¹»è¯»é—®é¢˜ï¼š</p><ul><li><p>å¿«ç…§è¯»ï¼šé€šè¿‡ MVCC æ¥è¿›è¡Œæ§åˆ¶çš„ï¼Œåœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ™®é€šæŸ¥è¯¢æ˜¯å¿«ç…§è¯»ï¼Œæ˜¯ä¸ä¼šçœ‹åˆ°åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®çš„ï¼Œä½†æ˜¯<strong>å¹¶ä¸èƒ½å®Œå…¨é¿å…å¹»è¯»</strong></p><p>åœºæ™¯ï¼šRR çº§åˆ«ï¼ŒT1 äº‹åŠ¡å¼€å¯ï¼Œåˆ›å»º Read Viewï¼Œæ­¤æ—¶ T2 å» INSERT æ–°çš„ä¸€è¡Œç„¶åæäº¤ï¼Œç„¶å T1 å» UPDATE è¯¥è¡Œä¼šå‘ç°æ›´æ–°æˆåŠŸï¼Œå¹¶ä¸”æŠŠè¿™æ¡æ–°è®°å½•çš„ trx_id å˜ä¸ºå½“å‰çš„äº‹åŠ¡ idï¼Œæ‰€ä»¥å¯¹å½“å‰äº‹åŠ¡å°±æ˜¯å¯è§çš„ã€‚å› ä¸º <strong>Read View å¹¶ä¸èƒ½é˜»æ­¢äº‹åŠ¡å»æ›´æ–°æ•°æ®ï¼Œæ›´æ–°æ•°æ®éƒ½æ˜¯å…ˆè¯»åå†™å¹¶ä¸”æ˜¯å½“å‰è¯»</strong>ï¼Œè¯»å–åˆ°çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®</p></li><li><p>å½“å‰è¯»ï¼šé€šè¿‡ next-key é”ï¼ˆè¡Œé” + é—´éš™é”ï¼‰æ¥è§£å†³é—®é¢˜</p></li></ul><hr><h3 id="æŒä¹…ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#æŒä¹…ç‰¹æ€§" aria-hidden="true">#</a> æŒä¹…ç‰¹æ€§</h3><h4 id="å®ç°æ–¹å¼-2" tabindex="-1"><a class="header-anchor" href="#å®ç°æ–¹å¼-2" aria-hidden="true">#</a> å®ç°æ–¹å¼</h4><p>æŒä¹…æ€§æ˜¯æŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦è¢«æäº¤äº†ï¼Œé‚£ä¹ˆå¯¹æ•°æ®åº“ä¸­æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ï¼Œæ¥ä¸‹æ¥çš„å…¶ä»–æ“ä½œæˆ–æ•…éšœä¸åº”è¯¥å¯¹å…¶æœ‰ä»»ä½•å½±å“ã€‚</p><p>Buffer Pool çš„ä½¿ç”¨æé«˜äº†è¯»å†™æ•°æ®çš„æ•ˆç‡ï¼Œä½†æ˜¯å¦‚æœ MySQL å®•æœºï¼Œæ­¤æ—¶ Buffer Pool ä¸­ä¿®æ”¹çš„æ•°æ®è¿˜æ²¡æœ‰åˆ·æ–°åˆ°ç£ç›˜ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®çš„ä¸¢å¤±ï¼Œäº‹åŠ¡çš„æŒä¹…æ€§æ— æ³•ä¿è¯ï¼Œæ‰€ä»¥å¼•å…¥äº† redo log æ—¥å¿—ï¼š</p><ul><li>redo log <strong>è®°å½•æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹</strong>ï¼Œè€Œä¸æ˜¯æŸä¸€è¡Œæˆ–æŸå‡ è¡Œçš„ä¿®æ”¹ï¼Œç”¨æ¥æ¢å¤æäº¤åçš„æ•°æ®é¡µï¼Œåªèƒ½<strong>æ¢å¤åˆ°æœ€åä¸€æ¬¡æäº¤</strong>çš„ä½ç½®</li><li>redo log é‡‡ç”¨çš„æ˜¯ WALï¼ˆWrite-ahead loggingï¼Œ<strong>é¢„å†™å¼æ—¥å¿—</strong>ï¼‰ï¼Œæ‰€æœ‰ä¿®æ”¹è¦å…ˆå†™å…¥æ—¥å¿—ï¼Œå†æ›´æ–°åˆ°ç£ç›˜ï¼Œä¿è¯äº†æ•°æ®ä¸ä¼šå›  MySQL å®•æœºè€Œä¸¢å¤±ï¼Œä»è€Œæ»¡è¶³äº†æŒä¹…æ€§è¦æ±‚</li><li>ç®€å•çš„ redo log æ˜¯çº¯ç²¹çš„ç‰©ç†æ—¥å¿—ï¼Œå¤æ‚çš„ redo log ä¼šå­˜åœ¨ç‰©ç†æ—¥å¿—å’Œé€»è¾‘æ—¥å¿—</li></ul><p>å·¥ä½œè¿‡ç¨‹ï¼šMySQL å‘ç”Ÿäº†å®•æœºï¼ŒInnoDB ä¼šåˆ¤æ–­ä¸€ä¸ªæ•°æ®é¡µåœ¨å´©æºƒæ¢å¤æ—¶ä¸¢å¤±äº†æ›´æ–°ï¼Œå°±ä¼šå°†å®ƒè¯»åˆ°å†…å­˜ï¼Œç„¶åæ ¹æ® redo log å†…å®¹æ›´æ–°å†…å­˜ï¼Œæ›´æ–°å®Œæˆåï¼Œå†…å­˜é¡µå˜æˆè„é¡µï¼Œç„¶åè¿›è¡Œåˆ·è„</p><p>ç¼“å†²æ± çš„<strong>åˆ·è„ç­–ç•¥</strong>ï¼š</p><ul><li>redo log æ–‡ä»¶æ˜¯å›ºå®šå¤§å°çš„ï¼Œå¦‚æœå†™æ»¡äº†å°±è¦æ“¦é™¤ä»¥å‰çš„è®°å½•ï¼Œåœ¨æ“¦é™¤ä¹‹å‰éœ€è¦æŠŠå¯¹åº”çš„æ›´æ–°æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­</li><li>Buffer Pool å†…å­˜ä¸è¶³ï¼Œéœ€è¦æ·˜æ±°éƒ¨åˆ†æ•°æ®é¡µï¼ˆLRU é“¾è¡¨å°¾éƒ¨ï¼‰ï¼Œå¦‚æœæ·˜æ±°çš„æ˜¯è„é¡µï¼Œå°±è¦å…ˆå°†è„é¡µå†™åˆ°ç£ç›˜ï¼ˆè¦é¿å…å¤§äº‹åŠ¡ï¼‰</li><li>ç³»ç»Ÿç©ºé—²æ—¶ï¼Œåå°çº¿ç¨‹ä¼šè‡ªåŠ¨è¿›è¡Œåˆ·è„ï¼ˆFlush é“¾è¡¨éƒ¨åˆ†å·²ç»è¯¦è§£ï¼‰</li><li>MySQL æ­£å¸¸å…³é—­æ—¶ï¼Œä¼šæŠŠå†…å­˜çš„è„é¡µéƒ½åˆ·æ–°åˆ°ç£ç›˜ä¸Š</li></ul><hr><h4 id="é‡åšæ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#é‡åšæ—¥å¿—" aria-hidden="true">#</a> é‡åšæ—¥å¿—</h4><h5 id="æ—¥å¿—ç¼“å†²" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—ç¼“å†²" aria-hidden="true">#</a> æ—¥å¿—ç¼“å†²</h5><p>æœåŠ¡å™¨å¯åŠ¨æ—¶ä¼šå‘æ“ä½œç³»ç»Ÿç”³è¯·ä¸€ç‰‡è¿ç»­å†…å­˜ç©ºé—´ä½œä¸º redo log bufferï¼ˆé‡åšæ—¥å¿—ç¼“å†²åŒºï¼‰ï¼Œå¯ä»¥é€šè¿‡ <code>innodb_log_buffer_size</code> ç³»ç»Ÿå˜é‡æŒ‡å®š redo log buffer çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ 16MB</p><p>log buffer è¢«åˆ’åˆ†ä¸ºè‹¥å¹² redo log blockï¼ˆå—ï¼Œç±»ä¼¼æ•°æ®é¡µçš„æ¦‚å¿µï¼‰ï¼Œæ¯ä¸ªé»˜è®¤å¤§å° 512 å­—èŠ‚ï¼Œæ¯ä¸ª block ç”± 12 å­—èŠ‚çš„ log block headã€496 å­—èŠ‚çš„ log block bodyã€4 å­—èŠ‚çš„ log block trailer ç»„æˆ</p><ul><li>å½“æ•°æ®ä¿®æ”¹æ—¶ï¼Œå…ˆä¿®æ”¹ Change Buffer ä¸­çš„æ•°æ®ï¼Œç„¶ååœ¨ redo log buffer è®°å½•è¿™æ¬¡æ“ä½œï¼Œå†™å…¥ log buffer çš„è¿‡ç¨‹æ˜¯<strong>é¡ºåºå†™å…¥</strong>çš„ï¼ˆå…ˆå†™å…¥å‰é¢çš„ blockï¼Œå†™æ»¡åç»§ç»­å†™ä¸‹ä¸€ä¸ªï¼‰</li><li>log buffer ä¸­æœ‰ä¸€ä¸ªæŒ‡é’ˆ buf_freeï¼Œæ¥æ ‡è¯†è¯¥ä½ç½®ä¹‹å‰éƒ½æ˜¯å¡«æ»¡çš„ blockï¼Œè¯¥ä½ç½®ä¹‹åéƒ½æ˜¯ç©ºé—²åŒºåŸŸ</li></ul><p>MySQL è§„å®šå¯¹åº•å±‚é¡µé¢çš„ä¸€æ¬¡åŸå­è®¿é—®ç§°ä¸ºä¸€ä¸ª Mini-Transactionï¼ˆMTRï¼‰ï¼Œæ¯”å¦‚åœ¨ B+ æ ‘ä¸Šæ’å…¥ä¸€æ¡æ•°æ®å°±ç®—ä¸€ä¸ª MTR</p><ul><li><p>ä¸€ä¸ªäº‹åŠ¡åŒ…å«è‹¥å¹²ä¸ª MTRï¼Œä¸€ä¸ª MTR å¯¹åº”ä¸€ç»„è‹¥å¹²æ¡ redo logï¼Œä¸€ç»„ redo log æ˜¯ä¸å¯åˆ†å‰²çš„ï¼Œåœ¨è¿›è¡Œæ•°æ®æ¢å¤æ—¶ä¹ŸæŠŠä¸€ç»„ redo log å½“ä½œä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ•´ä½“å¤„ç†</p></li><li><p>ä¸æ˜¯æ¯ç”Ÿæˆä¸€æ¡ redo æ—¥å¿—å°±å°†å…¶æ’å…¥åˆ° log buffer ä¸­ï¼Œè€Œæ˜¯ä¸€ä¸ª MTR ç»“æŸå<strong>å°†ä¸€ç»„ redo æ—¥å¿—å†™å…¥</strong></p></li></ul><p>InnoDB çš„ redo log æ˜¯<strong>å›ºå®šå¤§å°</strong>çš„ï¼Œredo æ—¥å¿—åœ¨ç£ç›˜ä¸­ä»¥æ–‡ä»¶ç»„çš„å½¢å¼å­˜å‚¨ï¼ŒåŒä¸€ç»„ä¸­çš„æ¯ä¸ªæ–‡ä»¶å¤§å°ä¸€æ ·æ ¼å¼ä¸€æ ·</p><ul><li><code>innodb_log_group_home_dir</code> ä»£è¡¨ç£ç›˜å­˜å‚¨ redo log çš„æ–‡ä»¶ç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰æ•°æ®ç›®å½•</li><li><code>innodb_log_file_size</code> ä»£è¡¨æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ 48Mï¼Œ<code>innodb_log_files_in_group</code> ä»£è¡¨æ–‡ä»¶ä¸ªæ•°ï¼Œé»˜è®¤ 2 æœ€å¤§ 100ï¼Œæ‰€ä»¥æ—¥å¿—çš„æ–‡ä»¶å¤§å°ä¸º <code>innodb_log_file_size * innodb_log_files_in_group</code></li></ul><p>redo æ—¥å¿—æ–‡ä»¶ä¹Ÿæ˜¯ç”±è‹¥å¹²ä¸ª 512 å­—èŠ‚çš„ block ç»„æˆï¼Œæ—¥å¿—æ–‡ä»¶çš„å‰ 2048 ä¸ªå­—èŠ‚ï¼ˆå‰ 4 ä¸ª blockï¼‰ç”¨æ¥å­˜å‚¨ä¸€äº›ç®¡ç†ä¿¡æ¯ï¼Œä»¥åçš„ç”¨æ¥å­˜å‚¨ log buffer ä¸­çš„ block é•œåƒ</p><p>æ³¨æ„ï¼šblock å¹¶ä¸ä»£è¡¨ä¸€ç»„ redo logï¼Œä¸€ç»„æ—¥å¿—å¯èƒ½å ç”¨ä¸åˆ°ä¸€ä¸ª block æˆ–è€…å‡ ä¸ª blockï¼Œä¾èµ–äº MTR çš„å¤§å°</p><hr><h5 id="æ—¥å¿—åˆ·ç›˜" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—åˆ·ç›˜" aria-hidden="true">#</a> æ—¥å¿—åˆ·ç›˜</h5><p>redo log éœ€è¦åœ¨äº‹åŠ¡æäº¤æ—¶å°†æ—¥å¿—å†™å…¥ç£ç›˜ï¼Œä½†æ˜¯æ¯” Buffer Pool ä¿®æ”¹çš„æ•°æ®å†™å…¥ç£ç›˜çš„é€Ÿåº¦å¿«ï¼ŒåŸå› ï¼š</p><ul><li>åˆ·è„æ˜¯éšæœº IOï¼Œå› ä¸ºæ¯æ¬¡ä¿®æ”¹çš„æ•°æ®ä½ç½®éšæœºï¼›redo log å’Œ binlog éƒ½æ˜¯<strong>é¡ºåºå†™</strong>ï¼Œç£ç›˜çš„é¡ºåº IO æ¯”éšæœº IO é€Ÿåº¦è¦å¿«</li><li>åˆ·è„æ˜¯ä»¥æ•°æ®é¡µï¼ˆPageï¼‰ä¸ºå•ä½çš„ï¼Œä¸€ä¸ªé¡µä¸Šçš„ä¸€ä¸ªå°ä¿®æ”¹éƒ½è¦æ•´é¡µå†™å…¥ï¼›redo log ä¸­åªåŒ…å«çœŸæ­£éœ€è¦å†™å…¥çš„éƒ¨åˆ†ï¼Œå¥½å‡ é¡µçš„æ•°æ®ä¿®æ”¹å¯èƒ½åªè®°å½•åœ¨ä¸€ä¸ª redo log é¡µä¸­ï¼Œå‡å°‘æ— æ•ˆ IO</li><li><strong>ç»„æäº¤æœºåˆ¶</strong>ï¼Œå¯ä»¥å¤§å¹…åº¦é™ä½ç£ç›˜çš„ IO æ¶ˆè€—</li></ul><p>InnoDB å¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™ï¼ŒæŠŠå†…å­˜ä¸­ redo log buffer æŒä¹…åŒ–ï¼ˆfsyncï¼‰åˆ°ç£ç›˜ï¼Œå…·ä½“çš„<strong>åˆ·ç›˜ç­–ç•¥</strong>ï¼š</p><ul><li>åœ¨äº‹åŠ¡æäº¤æ—¶éœ€è¦è¿›è¡Œåˆ·ç›˜ï¼Œé€šè¿‡ä¿®æ”¹å‚æ•° <code>innodb_flush_log_at_trx_commit</code> è®¾ç½®ï¼š <ul><li>0ï¼šè¡¨ç¤ºå½“æäº¤äº‹åŠ¡æ—¶ï¼Œå¹¶ä¸å°†ç¼“å†²åŒºçš„ redo æ—¥å¿—å†™å…¥ç£ç›˜ï¼Œè€Œæ˜¯ç­‰å¾…<strong>åå°çº¿ç¨‹æ¯ç§’åˆ·æ–°ä¸€æ¬¡</strong></li><li>1ï¼šåœ¨äº‹åŠ¡æäº¤æ—¶å°†ç¼“å†²åŒºçš„ redo æ—¥å¿—<strong>åŒæ­¥å†™å…¥</strong>åˆ°ç£ç›˜ï¼Œä¿è¯ä¸€å®šä¼šå†™å…¥æˆåŠŸï¼ˆé»˜è®¤å€¼ï¼‰</li><li>2ï¼šåœ¨äº‹åŠ¡æäº¤æ—¶å°†ç¼“å†²åŒºçš„ redo æ—¥å¿—å¼‚æ­¥å†™å…¥åˆ°ç£ç›˜ï¼Œä¸èƒ½ä¿è¯æäº¤æ—¶è‚¯å®šä¼šå†™å…¥ï¼Œåªæ˜¯æœ‰è¿™ä¸ªåŠ¨ä½œã€‚æ—¥å¿—å·²ç»åœ¨æ“ä½œç³»ç»Ÿçš„ç¼“å­˜ï¼Œå¦‚æœæ“ä½œç³»ç»Ÿæ²¡æœ‰å®•æœºè€Œ MySQL å®•æœºï¼Œä¹Ÿæ˜¯å¯ä»¥æ¢å¤æ•°æ®çš„</li></ul></li><li>å†™å…¥ redo log buffer çš„æ—¥å¿—è¶…è¿‡äº†æ€»å®¹é‡çš„ä¸€åŠï¼Œå°±ä¼šå°†æ—¥å¿—åˆ·å…¥åˆ°ç£ç›˜æ–‡ä»¶ï¼Œè¿™ä¼šå½±å“æ‰§è¡Œæ•ˆç‡ï¼Œæ‰€ä»¥å¼€å‘ä¸­åº”<strong>é¿å…å¤§äº‹åŠ¡</strong></li><li>æœåŠ¡å™¨å…³é—­æ—¶</li><li>å¹¶è¡Œçš„äº‹åŠ¡æäº¤ï¼ˆç»„æäº¤ï¼‰æ—¶ï¼Œä¼šå°†å°†å…¶ä»–äº‹åŠ¡çš„ redo log æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚å‡è®¾äº‹åŠ¡ A å·²ç»å†™å…¥ redo log buffer ä¸­ï¼Œè¿™æ—¶å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„äº‹åŠ¡ B æäº¤ï¼Œå¦‚æœ innodb_flush_log_at_trx_commit è®¾ç½®çš„æ˜¯ 1ï¼Œé‚£ä¹ˆäº‹åŠ¡ B è¦æŠŠ redo log buffer é‡Œçš„æ—¥å¿—å…¨éƒ¨æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œ<strong>å› ä¸ºå¤šä¸ªäº‹åŠ¡å…±ç”¨ä¸€ä¸ª redo log buffer</strong>ï¼Œæ‰€ä»¥ä¸€æ¬¡ fsync å¯ä»¥åˆ·ç›˜å¤šä¸ªäº‹åŠ¡çš„ redo logï¼Œæå‡äº†å¹¶å‘é‡</li></ul><p>æœåŠ¡å™¨å¯åŠ¨å redo ç£ç›˜ç©ºé—´ä¸å˜ï¼Œæ‰€ä»¥ redo ç£ç›˜ä¸­çš„æ—¥å¿—æ–‡ä»¶æ˜¯è¢«<strong>å¾ªç¯ä½¿ç”¨</strong>çš„ï¼Œé‡‡ç”¨å¾ªç¯å†™æ•°æ®çš„æ–¹å¼ï¼Œå†™å®Œå°¾éƒ¨é‡æ–°å†™å¤´éƒ¨ï¼Œæ‰€ä»¥è¦ç¡®ä¿å¤´éƒ¨ log å¯¹åº”çš„ä¿®æ”¹å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜</p><hr><h5 id="æ—¥å¿—åºå·" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—åºå·" aria-hidden="true">#</a> æ—¥å¿—åºå·</h5><p>lsn (log sequence number) ä»£è¡¨å·²ç»å†™å…¥çš„ redo æ—¥å¿—é‡ã€flushed_to_disk_lsn æŒ‡åˆ·æ–°åˆ°ç£ç›˜ä¸­çš„ redo æ—¥å¿—é‡ï¼Œä¸¤è€…éƒ½æ˜¯<strong>å…¨å±€å˜é‡</strong>ï¼Œå¦‚æœä¸¤è€…çš„å€¼ç›¸åŒï¼Œè¯´æ˜ log buffer ä¸­æ‰€æœ‰çš„ redo æ—¥å¿—éƒ½å·²ç»æŒä¹…åŒ–åˆ°ç£ç›˜</p><p>å·¥ä½œè¿‡ç¨‹ï¼šå†™å…¥ log buffer æ•°æ®æ—¶ï¼Œbuf_free ä¼šè¿›è¡Œåç§»ï¼Œåç§»é‡å°±ä¼šåŠ åˆ° lsn ä¸Š</p><p>MTR çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿®æ”¹è¿‡çš„é¡µå¯¹åº”çš„æ§åˆ¶å—ä¼šåŠ åˆ° Buffer Pool çš„ flush é“¾è¡¨ä¸­ï¼Œé“¾è¡¨ä¸­è„é¡µæ˜¯æŒ‰ç…§ç¬¬ä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´è¿›è¡Œæ’åºçš„ï¼ˆå¤´æ’ï¼‰ï¼Œæ§åˆ¶å—ä¸­æœ‰ä¸¤ä¸ªæŒ‡é’ˆç”¨æ¥è®°å½•è„é¡µè¢«ä¿®æ”¹çš„æ—¶é—´ï¼š</p><ul><li>oldest_modificationï¼šç¬¬ä¸€æ¬¡ä¿®æ”¹ Buffer Pool ä¸­æŸä¸ªç¼“å†²é¡µæ—¶ï¼Œå°†ä¿®æ”¹è¯¥é¡µçš„ MTR <strong>å¼€å§‹æ—¶</strong>å¯¹åº”çš„ lsn å€¼å†™å…¥è¿™ä¸ªå±æ€§</li><li>newest_modificationï¼šæ¯æ¬¡ä¿®æ”¹é¡µé¢ï¼Œéƒ½å°† MTR ç»“æŸæ—¶å…¨å±€çš„ lsn å€¼å†™å…¥è¿™ä¸ªå±æ€§ï¼Œæ‰€ä»¥è¯¥å€¼æ˜¯è¯¥é¡µé¢æœ€åä¸€æ¬¡ä¿®æ”¹åçš„ lsn å€¼</li></ul><p>å…¨å±€å˜é‡ checkpoint_lsn è¡¨ç¤º<strong>å½“å‰ç³»ç»Ÿå¯ä»¥è¢«è¦†ç›–çš„ redo æ—¥å¿—æ€»é‡</strong>ï¼Œå½“ redo æ—¥å¿—å¯¹åº”çš„è„é¡µå·²ç»è¢«åˆ·æ–°åˆ°ç£ç›˜åï¼Œè¯¥æ–‡ä»¶ç©ºé—´å°±å¯ä»¥è¢«è¦†ç›–é‡ç”¨ï¼Œæ­¤æ—¶æ‰§è¡Œä¸€æ¬¡ checkpoint æ¥æ›´æ–° checkpoint_lsn çš„å€¼å­˜å…¥ç®¡ç†ä¿¡æ¯ï¼ˆåˆ·è„å’Œæ‰§è¡Œä¸€æ¬¡ checkpoint å¹¶ä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼‰ï¼Œè¯¥å€¼çš„å¢é‡å°±ä»£è¡¨ç£ç›˜æ–‡ä»¶ä¸­å½“å‰ä½ç½®å‘åå¯ä»¥è¢«è¦†ç›–çš„æ–‡ä»¶çš„é‡ï¼Œæ‰€ä»¥è¯¥å€¼æ˜¯ä¸€ç›´å¢å¤§çš„</p><p><strong>checkpoint</strong>ï¼šä» flush é“¾è¡¨å°¾éƒ¨ä¸­æ‰¾å‡ºè¿˜æœªåˆ·è„çš„é¡µé¢ï¼Œè¯¥é¡µé¢æ˜¯å½“å‰ç³»ç»Ÿä¸­æœ€æ—©è¢«ä¿®æ”¹çš„è„é¡µï¼Œè¯¥é¡µé¢ä¹‹å‰äº§ç”Ÿçš„è„é¡µéƒ½å·²ç»åˆ·è„ï¼Œç„¶åå°†è¯¥é¡µ oldest_modification å€¼èµ‹å€¼ç»™ checkpoint_lsnï¼Œå› ä¸º lsn å°äºè¯¥å€¼æ—¶äº§ç”Ÿçš„ redo æ—¥å¿—éƒ½å¯ä»¥è¢«è¦†ç›–äº†</p><p>ä½†æ˜¯åœ¨ç³»ç»Ÿå¿™ç¢Œæ—¶ï¼Œåå°çº¿ç¨‹çš„åˆ·è„æ“ä½œä¸èƒ½å°†è„é¡µå¿«é€Ÿåˆ·å‡ºï¼Œå¯¼è‡´ç³»ç»Ÿæ— æ³•åŠæ—¶æ‰§è¡Œ checkpoint ï¼Œè¿™æ—¶éœ€è¦ç”¨æˆ·çº¿ç¨‹ä» flush é“¾è¡¨ä¸­æŠŠæœ€æ—©ä¿®æ”¹çš„è„é¡µåˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œç„¶åæ‰§è¡Œ checkpoint</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>write pos <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> checkpoint_lsn <span class="token comment">// ä¸¤å€¼ä¹‹é—´çš„éƒ¨åˆ†è¡¨ç¤ºå¯ä»¥å†™å…¥çš„æ—¥å¿—é‡ï¼Œå½“ pos è¿½èµ¶ä¸Š lsn æ—¶å¿…é¡»æ‰§è¡Œ checkpoint</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½¿ç”¨å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ InnoDB å­˜å‚¨å¼•æ“å„ç§ lsn çš„å€¼ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW ENGINE INNODB STATUS\G
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h5 id="å´©æºƒæ¢å¤" tabindex="-1"><a class="header-anchor" href="#å´©æºƒæ¢å¤" aria-hidden="true">#</a> å´©æºƒæ¢å¤</h5><p>æ¢å¤çš„èµ·ç‚¹ï¼šåœ¨ä» redo æ—¥å¿—æ–‡ä»¶ç»„çš„ç®¡ç†ä¿¡æ¯ä¸­è·å–æœ€è¿‘å‘ç”Ÿ checkpoint çš„ä¿¡æ¯ï¼Œ<strong>ä» checkpoint_lsn å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶å¼€å§‹æ¢å¤</strong></p><p>æ¢å¤çš„ç»ˆç‚¹ï¼šæ‰«ææ—¥å¿—æ–‡ä»¶çš„ blockï¼Œblock çš„å¤´éƒ¨è®°å½•ç€å½“å‰ block ä½¿ç”¨äº†å¤šå°‘å­—èŠ‚ï¼Œå¡«æ»¡çš„ block æ€»æ˜¯ 512 å­—èŠ‚ï¼Œ å¦‚æœæŸä¸ª block ä¸æ˜¯ 512 å­—èŠ‚ï¼Œè¯´æ˜è¯¥ block å°±æ˜¯éœ€è¦æ¢å¤çš„æœ€åä¸€ä¸ª block</p><p>æ¢å¤çš„è¿‡ç¨‹ï¼šæŒ‰ç…§ redo log ä¾æ¬¡æ‰§è¡Œæ¢å¤æ•°æ®ï¼Œä¼˜åŒ–æ–¹å¼</p><ul><li>ä½¿ç”¨å“ˆå¸Œè¡¨ï¼šæ ¹æ® redo log çš„ space id å’Œ page number å±æ€§è®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œå°†å¯¹åŒä¸€é¡µé¢çš„ä¿®æ”¹æ”¾å…¥åŒä¸€ä¸ªæ§½é‡Œï¼Œå¯ä»¥ä¸€æ¬¡æ€§å®Œæˆå¯¹æŸé¡µçš„æ¢å¤ï¼Œ<strong>é¿å…äº†éšæœº IO</strong></li><li>è·³è¿‡å·²ç»åˆ·æ–°åˆ°ç£ç›˜ä¸­çš„é¡µé¢ï¼šæ•°æ®é¡µçš„ File Header ä¸­çš„ FILE_PAGE_LSN å±æ€§ï¼ˆç±»ä¼¼ newest_modificationï¼‰è¡¨ç¤ºæœ€è¿‘ä¸€æ¬¡ä¿®æ”¹é¡µé¢æ—¶çš„ lsn å€¼ï¼Œæ•°æ®é¡µè¢«åˆ·æ–°åˆ°ç£ç›˜ä¸­ï¼Œé‚£ä¹ˆè¯¥é¡µ lsn å±æ€§è‚¯å®šå¤§äº checkpoint_lsn</li></ul><p>å‚è€ƒä¹¦ç±ï¼š<a href="https://book.douban.com/subject/35231266/" target="_blank" rel="noopener noreferrer">https://book.douban.com/subject/35231266/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="å·¥ä½œæµç¨‹-2" tabindex="-1"><a class="header-anchor" href="#å·¥ä½œæµç¨‹-2" aria-hidden="true">#</a> å·¥ä½œæµç¨‹</h4><h5 id="æ—¥å¿—å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—å¯¹æ¯”" aria-hidden="true">#</a> æ—¥å¿—å¯¹æ¯”</h5><p>MySQL ä¸­è¿˜å­˜åœ¨ binlogï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰ä¹Ÿå¯ä»¥è®°å½•å†™æ“ä½œå¹¶ç”¨äºæ•°æ®çš„æ¢å¤ï¼Œ<strong>ä¿è¯æ•°æ®ä¸ä¸¢å¤±</strong>ï¼ŒäºŒè€…çš„åŒºåˆ«æ˜¯ï¼š</p><ul><li>ä½œç”¨ä¸åŒï¼šredo log æ˜¯ç”¨äº crash recovery ï¼ˆæ•…éšœæ¢å¤ï¼‰ï¼Œä¿è¯ MySQL å®•æœºä¹Ÿä¸ä¼šå½±å“æŒä¹…æ€§ï¼›binlog æ˜¯ç”¨äº point-in-time recovery çš„ï¼Œä¿è¯æœåŠ¡å™¨å¯ä»¥åŸºäºæ—¶é—´ç‚¹æ¢å¤æ•°æ®ï¼Œæ­¤å¤– binlog è¿˜ç”¨äºä¸»ä»å¤åˆ¶</li><li>å±‚æ¬¡ä¸åŒï¼šredo log æ˜¯ InnoDB å­˜å‚¨å¼•æ“å®ç°çš„ï¼Œè€Œ binlog æ˜¯MySQLçš„ Server å±‚å®ç°çš„ï¼ŒåŒæ—¶æ”¯æŒ InnoDB å’Œå…¶ä»–å­˜å‚¨å¼•æ“</li><li>å†…å®¹ä¸åŒï¼šredo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œå†…å®¹åŸºäºç£ç›˜çš„ Pageï¼›binlog çš„å†…å®¹æ˜¯äºŒè¿›åˆ¶çš„ï¼Œæ ¹æ® binlog_format å‚æ•°çš„ä¸åŒï¼Œå¯èƒ½åŸºäºSQL è¯­å¥ã€åŸºäºæ•°æ®æœ¬èº«æˆ–è€…äºŒè€…çš„æ··åˆï¼ˆæ—¥å¿—éƒ¨åˆ†è¯¦è§£ï¼‰</li><li>å†™å…¥æ—¶æœºä¸åŒï¼šbinlog åœ¨äº‹åŠ¡æäº¤æ—¶ä¸€æ¬¡å†™å…¥ï¼›redo log çš„å†™å…¥æ—¶æœºç›¸å¯¹å¤šå…ƒ</li></ul><p>binlog ä¸ºä»€ä¹ˆä¸æ”¯æŒå´©æºƒæ¢å¤ï¼Ÿ</p><ul><li>binlog è®°å½•çš„æ˜¯è¯­å¥ï¼Œå¹¶ä¸è®°å½•æ•°æ®é¡µçº§çš„æ•°æ®ï¼ˆå“ªä¸ªé¡µæ”¹äº†å“ªäº›åœ°æ–¹ï¼‰ï¼Œæ‰€ä»¥æ²¡æœ‰èƒ½åŠ›æ¢å¤æ•°æ®é¡µ</li><li>binlog æ˜¯è¿½åŠ å†™ï¼Œä¿å­˜å…¨é‡çš„æ—¥å¿—ï¼Œæ²¡æœ‰æ ‡å¿—ç¡®å®šä»å“ªä¸ªç‚¹å¼€å§‹çš„æ•°æ®æ˜¯å·²ç»åˆ·ç›˜äº†ï¼Œè€Œ redo log åªè¦åœ¨ checkpoint_lsn åé¢çš„å°±æ˜¯æ²¡æœ‰åˆ·ç›˜çš„</li></ul><hr><h5 id="æ›´æ–°è®°å½•" tabindex="-1"><a class="header-anchor" href="#æ›´æ–°è®°å½•" aria-hidden="true">#</a> æ›´æ–°è®°å½•</h5><p>æ›´æ–°ä¸€æ¡è®°å½•çš„è¿‡ç¨‹ï¼šå†™ä¹‹å‰ä¸€å®šå…ˆè¯»</p><ul><li><p>åœ¨ B+ æ ‘ä¸­å®šä½åˆ°è¯¥è®°å½•ï¼Œå¦‚æœè¯¥è®°å½•æ‰€åœ¨çš„é¡µé¢ä¸åœ¨ Buffer Pool é‡Œï¼Œå…ˆå°†å…¶åŠ è½½è¿›å†…å­˜</p></li><li><p>é¦–å…ˆæ›´æ–°è¯¥è®°å½•å¯¹åº”çš„èšç°‡ç´¢å¼•ï¼Œæ›´æ–°èšç°‡ç´¢å¼•è®°å½•æ—¶ï¼š</p><ul><li><p>æ›´æ–°è®°å½•å‰å‘ undo é¡µé¢å†™ undo æ—¥å¿—ï¼Œç”±äºè¿™æ˜¯æ›´æ”¹é¡µé¢ï¼Œæ‰€ä»¥éœ€è¦è®°å½•ä¸€ä¸‹ç›¸åº”çš„ redo æ—¥å¿—</p><p>æ³¨æ„ï¼šä¿®æ”¹ undo é¡µé¢ä¹Ÿæ˜¯åœ¨<strong>ä¿®æ”¹é¡µé¢</strong>ï¼Œäº‹åŠ¡åªè¦ä¿®æ”¹é¡µé¢å°±éœ€è¦å…ˆè®°å½•ç›¸åº”çš„ redo æ—¥å¿—</p></li><li><p>ç„¶å<strong>è®°å½•å¯¹åº”çš„ redo æ—¥å¿—</strong>ï¼ˆç­‰å¾… MTR æäº¤åå†™å…¥ redo log bufferï¼‰ï¼Œ<strong>æœ€åè¿›è¡ŒçœŸæ­£çš„æ›´æ–°è®°å½•</strong></p></li></ul></li><li><p>æ›´æ–°å…¶ä»–çš„äºŒçº§ç´¢å¼•è®°å½•ï¼Œä¸ä¼šå†è®°å½• undo logï¼Œåªè®°å½• redo log åˆ° buffer ä¸­</p></li><li><p>åœ¨ä¸€æ¡æ›´æ–°è¯­å¥æ‰§è¡Œå®Œæˆåï¼ˆä¹Ÿå°±æ˜¯å°†æ‰€æœ‰å¾…æ›´æ–°è®°å½•éƒ½æ›´æ–°å®Œäº†ï¼‰ï¼Œå°±ä¼šå¼€å§‹è®°å½•è¯¥è¯­å¥å¯¹åº”çš„ binlog æ—¥å¿—ï¼Œæ­¤æ—¶è®°å½•çš„ binlog å¹¶æ²¡æœ‰åˆ·æ–°åˆ°ç¡¬ç›˜ä¸Šï¼Œè¿˜åœ¨å†…å­˜ä¸­ï¼Œåœ¨äº‹åŠ¡æäº¤æ—¶æ‰ä¼šç»Ÿä¸€å°†è¯¥äº‹åŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰ binlog æ—¥å¿—åˆ·æ–°åˆ°ç¡¬ç›˜</p></li></ul><p>å‡è®¾è¡¨ä¸­æœ‰å­—æ®µ id å’Œ aï¼Œå­˜åœ¨ä¸€æ¡ <code>id = 1, a = 2</code> çš„è®°å½•ï¼Œæ­¤æ—¶æ‰§è¡Œæ›´æ–°è¯­å¥ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">update</span> <span class="token keyword">table</span> <span class="token keyword">set</span> a<span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>InnoDB ä¼šçœŸæ­£çš„å»æ‰§è¡ŒæŠŠå€¼ä¿®æ”¹æˆ (1,2) è¿™ä¸ªæ“ä½œï¼Œå…ˆåŠ è¡Œé”ï¼Œåœ¨å»æ›´æ–°ï¼Œå¹¶ä¸ä¼šæå‰åˆ¤æ–­ç›¸åŒå°±ä¸ä¿®æ”¹äº†</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://mp.weixin.qq.com/s/wcJ2KisSaMnfP4nH5NYaQA" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/wcJ2KisSaMnfP4nH5NYaQA<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h5 id="ä¸¤æ®µæäº¤" tabindex="-1"><a class="header-anchor" href="#ä¸¤æ®µæäº¤" aria-hidden="true">#</a> ä¸¤æ®µæäº¤</h5><p>å½“å®¢æˆ·ç«¯æ‰§è¡Œ COMMIT è¯­å¥æˆ–è€…åœ¨è‡ªåŠ¨æäº¤çš„æƒ…å†µä¸‹ï¼ŒMySQL å†…éƒ¨å¼€å¯ä¸€ä¸ª XA äº‹åŠ¡ï¼Œåˆ†ä¸¤é˜¶æ®µæ¥å®Œæˆ XA äº‹åŠ¡çš„æäº¤ï¼š</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">update</span> T <span class="token keyword">set</span> c<span class="token operator">=</span>c<span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">where</span> ID<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-updateçš„æ‰§è¡Œæµç¨‹.png" style="zoom:33%;"><p>æµç¨‹è¯´æ˜ï¼šæ‰§è¡Œå¼•æ“å°†è¿™è¡Œæ–°æ•°æ®è¯»å…¥åˆ°å†…å­˜ä¸­ï¼ˆBuffer Poolï¼‰åï¼Œå…ˆå°†æ­¤æ¬¡æ›´æ–°æ“ä½œè®°å½•åˆ° redo log buffer é‡Œï¼Œç„¶åæ›´æ–°è®°å½•ã€‚æœ€åå°† redo log åˆ·ç›˜åäº‹åŠ¡å¤„äº prepare çŠ¶æ€ï¼Œæ‰§è¡Œå™¨ä¼šç”Ÿæˆè¿™ä¸ªæ“ä½œçš„ binlogï¼Œå¹¶<strong>æŠŠ binlog å†™å…¥ç£ç›˜</strong>ï¼Œå®Œæˆæäº¤</p><p>ä¸¤é˜¶æ®µï¼š</p><ul><li>Prepare é˜¶æ®µï¼šå­˜å‚¨å¼•æ“å°†è¯¥äº‹åŠ¡çš„ <strong>redo æ—¥å¿—åˆ·ç›˜</strong>ï¼Œå¹¶ä¸”å°†æœ¬äº‹åŠ¡çš„çŠ¶æ€è®¾ç½®ä¸º PREPAREï¼Œä»£è¡¨æ‰§è¡Œå®Œæˆéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡</li><li>Commit é˜¶æ®µï¼šå…ˆå°†äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ binlog åˆ·æ–°åˆ°ç¡¬ç›˜ï¼Œå†æ‰§è¡Œå­˜å‚¨å¼•æ“çš„æäº¤å·¥ä½œï¼Œå¼•æ“æŠŠ redo log æ”¹æˆæäº¤çŠ¶æ€</li></ul><p>å­˜å‚¨å¼•æ“å±‚çš„ redo log å’Œ server å±‚çš„ binlog å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œ éƒ½å¯ä»¥ç”¨äºè¡¨ç¤ºäº‹åŠ¡çš„æäº¤çŠ¶æ€ï¼Œè€Œ<strong>ä¸¤é˜¶æ®µæäº¤å°±æ˜¯è®©è¿™ä¸¤ä¸ªçŠ¶æ€ä¿æŒé€»è¾‘ä¸Šçš„ä¸€è‡´</strong>ï¼Œä¹Ÿæœ‰åˆ©äºä¸»ä»å¤åˆ¶ï¼Œæ›´å¥½çš„ä¿æŒä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§</p><hr><h5 id="æ•°æ®æ¢å¤" tabindex="-1"><a class="header-anchor" href="#æ•°æ®æ¢å¤" aria-hidden="true">#</a> æ•°æ®æ¢å¤</h5><p>ç³»ç»Ÿå´©æºƒå‰æ²¡æœ‰æäº¤çš„äº‹åŠ¡çš„ redo log å¯èƒ½å·²ç»åˆ·ç›˜ï¼ˆå®šæ—¶çº¿ç¨‹æˆ–è€… checkpointï¼‰ï¼Œæ€ä¹ˆå¤„ç†å´©æºƒæ¢å¤ï¼Ÿ</p><p>å·¥ä½œæµç¨‹ï¼šè·å– undo é“¾è¡¨é¦–èŠ‚ç‚¹é¡µé¢çš„ undo segement header ä¸­çš„ TRX_UNDO_STATE å±æ€§ï¼Œè¡¨ç¤ºå½“å‰é“¾è¡¨çš„äº‹åŠ¡å±æ€§ï¼Œ<strong>äº‹åŠ¡çŠ¶æ€æ˜¯æ´»è·ƒï¼ˆæœªæäº¤ï¼‰çš„å°±å…¨éƒ¨å›æ»š</strong>ï¼Œå¦‚æœæ˜¯ PREPARE çŠ¶æ€ï¼Œå°±éœ€è¦æ ¹æ® binlog çš„çŠ¶æ€è¿›è¡Œåˆ¤æ–­ï¼š</p><ul><li>å¦‚æœåœ¨æ—¶åˆ» A å‘ç”Ÿäº†å´©æºƒï¼ˆcrashï¼‰ï¼Œç”±äºæ­¤æ—¶ binlog è¿˜æ²¡å®Œæˆï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œå›æ»š</li><li>å¦‚æœåœ¨æ—¶åˆ» B å‘ç”Ÿäº†å´©æºƒï¼Œredo log å’Œ binlog æœ‰ä¸€ä¸ªå…±<strong>åŒçš„æ•°æ®å­—æ®µå« XID</strong>ï¼Œå´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œä¼šæŒ‰é¡ºåºæ‰«æ redo logï¼š <ul><li>å¦‚æœ redo log é‡Œé¢çš„äº‹åŠ¡æ˜¯å®Œæ•´çš„ï¼Œä¹Ÿå°±æ˜¯å·²ç»æœ‰äº† commit æ ‡è¯†ï¼Œè¯´æ˜ binlog ä¹Ÿå·²ç»è®°å½•å®Œæ•´ï¼Œç›´æ¥ä» redo log æ¢å¤æ•°æ®</li><li>å¦‚æœ redo log é‡Œé¢çš„äº‹åŠ¡åªæœ‰ prepareï¼Œå°±æ ¹æ® XID å» binlog ä¸­åˆ¤æ–­å¯¹åº”çš„äº‹åŠ¡æ˜¯å¦å­˜åœ¨å¹¶å®Œæ•´ï¼Œå¦‚æœå®Œæ•´å¯ä»¥æ¢å¤æ•°æ®</li></ul></li></ul><p>åˆ¤æ–­ä¸€ä¸ªäº‹åŠ¡çš„ binlog æ˜¯å¦å®Œæ•´çš„æ–¹æ³•ï¼š</p><ul><li>statement æ ¼å¼çš„ binlogï¼Œæœ€åä¼šæœ‰ COMMIT</li><li>row æ ¼å¼çš„ binlogï¼Œæœ€åä¼šæœ‰ä¸€ä¸ª XID event</li><li>MySQL 5.6.2 ç‰ˆæœ¬ä»¥åï¼Œå¼•å…¥äº† binlog-checksum å‚æ•°ç”¨æ¥éªŒè¯ binlog å†…å®¹çš„æ­£ç¡®æ€§ï¼ˆå¯èƒ½æ—¥å¿—ä¸­é—´å‡ºé”™ï¼‰</li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://time.geekbang.org/column/article/73161" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/73161<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="åˆ·è„ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#åˆ·è„ä¼˜åŒ–" aria-hidden="true">#</a> åˆ·è„ä¼˜åŒ–</h4><p>ç³»ç»Ÿåœ¨è¿›è¡Œåˆ·è„æ—¶ä¼šå ç”¨ä¸€éƒ¨åˆ†ç³»ç»Ÿèµ„æºï¼Œä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½ï¼Œ<strong>äº§ç”Ÿç³»ç»ŸæŠ–åŠ¨</strong></p><ul><li>ä¸€ä¸ªæŸ¥è¯¢è¦æ·˜æ±°çš„è„é¡µä¸ªæ•°å¤ªå¤šï¼Œä¼šå¯¼è‡´æŸ¥è¯¢çš„å“åº”æ—¶é—´æ˜æ˜¾å˜é•¿</li><li>æ—¥å¿—å†™æ»¡ï¼Œæ›´æ–°å…¨éƒ¨å µä½ï¼Œå†™æ€§èƒ½è·Œä¸º 0ï¼Œè¿™ç§æƒ…å†µå¯¹æ•æ„Ÿä¸šåŠ¡æ¥è¯´ï¼Œæ˜¯ä¸èƒ½æ¥å—çš„</li></ul><p>InnoDB åˆ·è„é¡µçš„æ§åˆ¶ç­–ç•¥ï¼š</p><ul><li><code>innodb_io_capacity</code> å‚æ•°ä»£è¡¨ç£ç›˜çš„è¯»å†™èƒ½åŠ›ï¼Œå»ºè®®è®¾ç½®æˆç£ç›˜çš„ IOPSï¼ˆæ¯ç§’çš„ IO æ¬¡æ•°ï¼‰</li><li>åˆ·è„é€Ÿåº¦å‚è€ƒä¸¤ä¸ªå› ç´ ï¼šè„é¡µæ¯”ä¾‹å’Œ redo log å†™ç›˜é€Ÿåº¦ <ul><li>å‚æ•° <code>innodb_max_dirty_pages_pct</code> æ˜¯è„é¡µæ¯”ä¾‹ä¸Šé™ï¼Œé»˜è®¤å€¼æ˜¯ 75%ï¼ŒInnoDB ä¼šæ ¹æ®å½“å‰çš„è„é¡µæ¯”ä¾‹ï¼Œç®—å‡ºä¸€ä¸ªèŒƒå›´åœ¨ 0 åˆ° 100 ä¹‹é—´çš„æ•°å­—</li><li>InnoDB æ¯æ¬¡å†™å…¥çš„æ—¥å¿—éƒ½æœ‰ä¸€ä¸ªåºå·ï¼Œå½“å‰å†™å…¥çš„åºå·è·Ÿ checkpoint å¯¹åº”çš„åºå·ä¹‹é—´çš„å·®å€¼ï¼ŒInnoDB æ ¹æ®å·®å€¼ç®—å‡ºä¸€ä¸ªèŒƒå›´åœ¨ 0 åˆ° 100 ä¹‹é—´çš„æ•°å­—</li><li>ä¸¤è€…è¾ƒå¤§çš„å€¼è®°ä¸º Rï¼Œæ‰§è¡Œå¼•æ“æŒ‰ç…§ innodb_io_capacity å®šä¹‰çš„èƒ½åŠ›ä¹˜ä»¥ R% æ¥æ§åˆ¶åˆ·è„é¡µçš„é€Ÿåº¦</li></ul></li><li><code>innodb_flush_neighbors</code> å‚æ•°ç½®ä¸º 1 ä»£è¡¨æ§åˆ¶åˆ·è„æ—¶æ£€æŸ¥ç›¸é‚»çš„æ•°æ®é¡µï¼Œå¦‚æœä¹Ÿæ˜¯è„é¡µå°±ä¸€èµ·åˆ·è„ï¼Œå¹¶æ£€æŸ¥é‚»å±…çš„é‚»å±…ï¼Œè¿™ä¸ªè¡Œä¸ºä¼šä¸€ç›´è”“å»¶ç›´åˆ°ä¸æ˜¯è„é¡µï¼Œåœ¨ MySQL 8.0 ä¸­è¯¥å€¼çš„é»˜è®¤å€¼æ˜¯ 0ï¼Œä¸å»ºè®®å¼€å¯æ­¤åŠŸèƒ½</li></ul><hr><h3 id="ä¸€è‡´ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#ä¸€è‡´ç‰¹æ€§" aria-hidden="true">#</a> ä¸€è‡´ç‰¹æ€§</h3><p>ä¸€è‡´æ€§æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸæ²¡æœ‰è¢«ç ´åï¼Œäº‹åŠ¡æ‰§è¡Œçš„å‰åéƒ½æ˜¯åˆæ³•çš„æ•°æ®çŠ¶æ€ã€‚</p><p>æ•°æ®åº“çš„å®Œæ•´æ€§çº¦æŸåŒ…æ‹¬ä½†ä¸é™äºï¼šå®ä½“å®Œæ•´æ€§ï¼ˆå¦‚è¡Œçš„ä¸»é”®å­˜åœ¨ä¸”å”¯ä¸€ï¼‰ã€åˆ—å®Œæ•´æ€§ï¼ˆå¦‚å­—æ®µçš„ç±»å‹ã€å¤§å°ã€é•¿åº¦è¦ç¬¦åˆè¦æ±‚ï¼‰ã€å¤–é”®çº¦æŸã€ç”¨æˆ·è‡ªå®šä¹‰å®Œæ•´æ€§ï¼ˆå¦‚è½¬è´¦å‰åï¼Œä¸¤ä¸ªè´¦æˆ·ä½™é¢çš„å’Œåº”è¯¥ä¸å˜ï¼‰</p><p>å®ç°ä¸€è‡´æ€§çš„æªæ–½ï¼š</p><ul><li>ä¿è¯åŸå­æ€§ã€æŒä¹…æ€§å’Œéš”ç¦»æ€§ï¼Œå¦‚æœè¿™äº›ç‰¹æ€§æ— æ³•ä¿è¯ï¼Œäº‹åŠ¡çš„ä¸€è‡´æ€§ä¹Ÿæ— æ³•ä¿è¯</li><li>æ•°æ®åº“æœ¬èº«æä¾›ä¿éšœï¼Œä¾‹å¦‚ä¸å…è®¸å‘æ•´å½¢åˆ—æ’å…¥å­—ç¬¦ä¸²å€¼ã€å­—ç¬¦ä¸²é•¿åº¦ä¸èƒ½è¶…è¿‡åˆ—çš„é™åˆ¶ç­‰</li><li>åº”ç”¨å±‚é¢è¿›è¡Œä¿éšœï¼Œä¾‹å¦‚å¦‚æœè½¬è´¦æ“ä½œåªæ‰£é™¤è½¬è´¦è€…çš„ä½™é¢ï¼Œè€Œæ²¡æœ‰å¢åŠ æ¥æ”¶è€…çš„ä½™é¢ï¼Œæ— è®ºæ•°æ®åº“å®ç°çš„å¤šä¹ˆå®Œç¾ï¼Œä¹Ÿæ— æ³•ä¿è¯çŠ¶æ€çš„ä¸€è‡´</li></ul><hr><h2 id="é”æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#é”æœºåˆ¶" aria-hidden="true">#</a> é”æœºåˆ¶</h2><h3 id="åŸºæœ¬ä»‹ç»-8" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-8" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>é”æœºåˆ¶ï¼šæ•°æ®åº“ä¸ºäº†ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œåœ¨å…±äº«çš„èµ„æºè¢«å¹¶å‘è®¿é—®æ—¶å˜å¾—å®‰å…¨æœ‰åºæ‰€è®¾è®¡çš„ä¸€ç§è§„åˆ™</p><p>åˆ©ç”¨ MVCC æ€§è´¨è¿›è¡Œè¯»å–çš„æ“ä½œå«<strong>ä¸€è‡´æ€§è¯»</strong>ï¼Œè¯»å–æ•°æ®å‰åŠ é”çš„æ“ä½œå«<strong>é”å®šè¯»</strong></p><p>é”çš„åˆ†ç±»ï¼š</p><ul><li>æŒ‰æ“ä½œåˆ†ç±»ï¼š <ul><li>å…±äº«é”ï¼šä¹Ÿå«è¯»é”ã€‚å¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªäº‹åŠ¡è¯»æ“ä½œå¯ä»¥åŒæ—¶åŠ é”è€Œä¸äº’ç›¸å½±å“ ï¼Œä½†ä¸èƒ½ä¿®æ”¹æ•°æ®</li><li>æ’ä»–é”ï¼šä¹Ÿå«å†™é”ã€‚å½“å‰çš„æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œä¼šé˜»æ–­å…¶ä»–æ“ä½œçš„è¯»å–å’Œå†™å…¥</li></ul></li><li>æŒ‰ç²’åº¦åˆ†ç±»ï¼š <ul><li>è¡¨çº§é”ï¼šä¼šé”å®šæ•´ä¸ªè¡¨ï¼Œå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šåŠ›åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªæ¦‚ç‡é«˜ï¼Œå¹¶å‘åº¦æœ€ä½ï¼Œåå‘ MyISAM</li><li>è¡Œçº§é”ï¼šä¼šé”å®šå½“å‰æ“ä½œè¡Œï¼Œå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šåŠ›åº¦å°ï¼Œå‘ç”Ÿé”å†²çªæ¦‚ç‡ä½ï¼Œå¹¶å‘åº¦é«˜ï¼Œåå‘ InnoDB</li><li>é¡µçº§é”ï¼šé”çš„åŠ›åº¦ã€å‘ç”Ÿå†²çªçš„æ¦‚ç‡å’ŒåŠ é”å¼€é”€ä»‹äºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œä¼šå‡ºç°æ­»é”ï¼Œå¹¶å‘æ€§èƒ½ä¸€èˆ¬</li></ul></li><li>æŒ‰ä½¿ç”¨æ–¹å¼åˆ†ç±»ï¼š <ul><li>æ‚²è§‚é”ï¼šæ¯æ¬¡æŸ¥è¯¢æ•°æ®æ—¶éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œå¾ˆæ‚²è§‚ï¼Œæ‰€ä»¥æŸ¥è¯¢æ—¶åŠ é”</li><li>ä¹è§‚é”ï¼šæ¯æ¬¡æŸ¥è¯¢æ•°æ®æ—¶éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œå¾ˆä¹è§‚ï¼Œä½†æ˜¯æ›´æ–°æ—¶ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®</li></ul></li></ul><ul><li><p>ä¸åŒå­˜å‚¨å¼•æ“æ”¯æŒçš„é”</p><table><thead><tr><th>å­˜å‚¨å¼•æ“</th><th>è¡¨çº§é”</th><th>è¡Œçº§é”</th><th>é¡µçº§é”</th></tr></thead><tbody><tr><td>MyISAM</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>InnoDB</td><td><strong>æ”¯æŒ</strong></td><td><strong>æ”¯æŒ</strong></td><td>ä¸æ”¯æŒ</td></tr><tr><td>MEMORY</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>ä¸æ”¯æŒ</td></tr><tr><td>BDB</td><td>æ”¯æŒ</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr></tbody></table></li></ul><p>ä»é”çš„è§’åº¦æ¥è¯´ï¼šè¡¨çº§é”æ›´é€‚åˆäºä»¥æŸ¥è¯¢ä¸ºä¸»ï¼Œåªæœ‰å°‘é‡æŒ‰ç´¢å¼•æ¡ä»¶æ›´æ–°æ•°æ®çš„åº”ç”¨ï¼Œå¦‚ Web åº”ç”¨ï¼›è€Œè¡Œçº§é”åˆ™æ›´é€‚åˆäºæœ‰å¤§é‡æŒ‰ç´¢å¼•æ¡ä»¶å¹¶å‘æ›´æ–°å°‘é‡ä¸åŒæ•°æ®ï¼ŒåŒæ—¶åˆæœ‰å¹¶æŸ¥è¯¢çš„åº”ç”¨ï¼Œå¦‚ä¸€äº›åœ¨çº¿äº‹åŠ¡å¤„ç†ç³»ç»Ÿ</p><hr><h3 id="å†…å­˜ç»“æ„" tabindex="-1"><a class="header-anchor" href="#å†…å­˜ç»“æ„" aria-hidden="true">#</a> å†…å­˜ç»“æ„</h3><p>å¯¹ä¸€æ¡è®°å½•åŠ é”çš„æœ¬è´¨å°±æ˜¯<strong>åœ¨å†…å­˜ä¸­</strong>åˆ›å»ºä¸€ä¸ªé”ç»“æ„ä¸ä¹‹å…³è”ï¼Œç»“æ„åŒ…æ‹¬</p><ul><li>äº‹åŠ¡ä¿¡æ¯ï¼šé”å¯¹åº”çš„äº‹åŠ¡ä¿¡æ¯ï¼Œä¸€ä¸ªé”å±äºä¸€ä¸ªäº‹åŠ¡</li><li>ç´¢å¼•ä¿¡æ¯ï¼šå¯¹äºè¡Œçº§é”ï¼Œéœ€è¦è®°å½•åŠ é”çš„è®°å½•å±äºå“ªä¸ªç´¢å¼•</li><li>è¡¨é”å’Œè¡Œé”ä¿¡æ¯ï¼šè¡¨é”è®°å½•ç€é”å®šçš„è¡¨ï¼Œè¡Œé”è®°å½•äº† Space ID æ‰€åœ¨è¡¨ç©ºé—´ã€Page Number æ‰€åœ¨çš„é¡µå·ã€n_bits ä½¿ç”¨äº†å¤šå°‘æ¯”ç‰¹</li><li>type_modeï¼šä¸€ä¸ª 32 æ¯”ç‰¹çš„æ•°ï¼Œè¢«åˆ†æˆ lock_modeã€lock_typeã€rec_lock_type ä¸‰ä¸ªéƒ¨åˆ† <ul><li>lock_modeï¼šé”æ¨¡å¼ï¼Œè®°å½•æ˜¯å…±äº«é”ã€æ’ä»–é”ã€æ„å‘é”ä¹‹ç±»</li><li>lock_typeï¼šä»£è¡¨è¡¨çº§é”è¿˜æ˜¯è¡Œçº§é”</li><li>rec_lock_typeï¼šä»£è¡¨è¡Œé”çš„å…·ä½“ç±»å‹å’Œ is_waiting å±æ€§ï¼Œis_waiting = true æ—¶è¡¨ç¤ºå½“å‰äº‹åŠ¡å°šæœªè·å–åˆ°é”ï¼Œå¤„äºç­‰å¾…çŠ¶æ€ã€‚äº‹åŠ¡è·å–é”åçš„é”ç»“æ„æ˜¯ is_waiting ä¸º falseï¼Œé‡Šæ”¾é”æ—¶ä¼šæ£€æŸ¥æ˜¯å¦ä¸å½“å‰è®°å½•å…³è”çš„é”ç»“æ„ï¼Œå¦‚æœæœ‰å°±å”¤é†’å¯¹åº”äº‹åŠ¡çš„çº¿ç¨‹</li></ul></li></ul><p>ä¸€ä¸ªäº‹åŠ¡å¯èƒ½æ“ä½œå¤šæ¡è®°å½•ï¼Œä¸ºäº†èŠ‚çœå†…å­˜ï¼Œæ»¡è¶³ä¸‹é¢æ¡ä»¶çš„é”ä½¿ç”¨åŒä¸€ä¸ªé”ç»“æ„ï¼š</p><ul><li>åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„åŠ é”æ“ä½œ</li><li>è¢«åŠ é”çš„è®°å½•åœ¨åŒä¸€ä¸ªé¡µé¢ä¸­</li><li>åŠ é”çš„ç±»å‹æ˜¯ä¸€æ ·çš„</li><li>åŠ é”çš„çŠ¶æ€æ˜¯ä¸€æ ·çš„</li></ul><hr><h3 id="server" tabindex="-1"><a class="header-anchor" href="#server" aria-hidden="true">#</a> Server</h3><p>MySQL é‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDL)</p><p>MDL å«å…ƒæ•°æ®é”ï¼Œä¸»è¦ç”¨æ¥ä¿æŠ¤ MySQL å†…éƒ¨å¯¹è±¡çš„å…ƒæ•°æ®ï¼Œä¿è¯æ•°æ®è¯»å†™çš„æ­£ç¡®æ€§ï¼Œ<strong>å½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥çš„æ—¶å€™ï¼ŒåŠ  MDL è¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œ DDL çš„æ—¶å€™ï¼ŒåŠ  MDL å†™é”</strong>ï¼Œä¸¤ç§é”ä¸ç›¸äº’å…¼å®¹ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯ DDLã€DMLã€DQL æ“ä½œçš„å®‰å…¨</p><p>è¯´æ˜ï¼šDDL æ“ä½œæ‰§è¡Œå‰ä¼šéšå¼æäº¤å½“å‰ä¼šè¯çš„äº‹åŠ¡ï¼Œå› ä¸º DDL ä¸€èˆ¬ä¼šåœ¨è‹¥å¹²ä¸ªç‰¹æ®Šäº‹åŠ¡ä¸­å®Œæˆï¼Œå¼€å¯ç‰¹æ®Šäº‹åŠ¡å‰éœ€è¦æäº¤åˆ°å…¶ä»–äº‹åŠ¡</p><p>MDL é”çš„ç‰¹æ€§ï¼š</p><ul><li><p>MDL é”ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šï¼Œåœ¨äº‹åŠ¡å¼€å§‹æ—¶ç”³è¯·ï¼Œæ•´ä¸ªäº‹åŠ¡æäº¤åé‡Šæ”¾ï¼ˆæ‰§è¡Œå®Œå•æ¡è¯­å¥ä¸é‡Šæ”¾ï¼‰</p></li><li><p>MDL é”æ˜¯åœ¨ Server ä¸­å®ç°ï¼Œä¸æ˜¯ InnoDB å­˜å‚¨å¼•æ“å±‚èƒ½ç›´æ¥å®ç°çš„é”</p></li><li><p>MDL é”è¿˜èƒ½å®ç°å…¶ä»–ç²’åº¦çº§åˆ«çš„é”ï¼Œæ¯”å¦‚å…¨å±€é”ã€åº“çº§åˆ«çš„é”ã€è¡¨ç©ºé—´çº§åˆ«çš„é”</p></li></ul><p>FLUSH TABLES WITH READ LOCK ç®€ç§°ï¼ˆFTWRLï¼‰ï¼Œå…¨å±€è¯»é”ï¼Œè®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ï¼ŒDDL DML éƒ½è¢«é˜»å¡ï¼Œå·¥ä½œæµç¨‹ï¼š</p><ol><li>ä¸Šå…¨å±€è¯»é”ï¼ˆlock_global_read_lockï¼‰</li><li>æ¸…ç†è¡¨ç¼“å­˜ï¼ˆclose_cached_tablesï¼‰</li><li>ä¸Šå…¨å±€ COMMIT é”ï¼ˆmake_global_read_lock_block_commitï¼‰</li></ol><p>è¯¥å‘½ä»¤ä¸»è¦ç”¨äºå¤‡ä»½å·¥å…·åš<strong>ä¸€è‡´æ€§å¤‡ä»½</strong>ï¼Œç”±äº FTWRL éœ€è¦æŒæœ‰ä¸¤æŠŠå…¨å±€çš„ MDL é”ï¼Œå¹¶ä¸”è¿˜è¦å…³é—­æ‰€æœ‰è¡¨å¯¹è±¡ï¼Œå› æ­¤æ€ä¼¤æ€§å¾ˆå¤§</p><hr><h3 id="myisam-1" tabindex="-1"><a class="header-anchor" href="#myisam-1" aria-hidden="true">#</a> MyISAM</h3><h4 id="è¡¨çº§é”" tabindex="-1"><a class="header-anchor" href="#è¡¨çº§é”" aria-hidden="true">#</a> è¡¨çº§é”</h4><p>MyISAM å­˜å‚¨å¼•æ“åªæ”¯æŒè¡¨é”ï¼Œè¿™ä¹Ÿæ˜¯ MySQL å¼€å§‹å‡ ä¸ªç‰ˆæœ¬ä¸­å”¯ä¸€æ”¯æŒçš„é”ç±»å‹</p><p>MyISAM å¼•æ“åœ¨æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ä¹‹å‰ï¼Œä¼š<strong>è‡ªåŠ¨</strong>ç»™æ¶‰åŠåˆ°çš„æ‰€æœ‰è¡¨åŠ è¯»é”ï¼Œåœ¨æ‰§è¡Œå¢åˆ æ”¹ä¹‹å‰ï¼Œä¼š<strong>è‡ªåŠ¨</strong>ç»™æ¶‰åŠçš„è¡¨åŠ å†™é”ï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶ä¸éœ€è¦ç”¨æˆ·å¹²é¢„ï¼Œæ‰€ä»¥ç”¨æˆ·ä¸€èˆ¬ä¸éœ€è¦ç›´æ¥ç”¨ LOCK TABLE å‘½ä»¤ç»™ MyISAM è¡¨æ˜¾å¼åŠ é”</p><ul><li><p>åŠ é”å‘½ä»¤ï¼šï¼ˆå¯¹ InnoDB å­˜å‚¨å¼•æ“ä¹Ÿé€‚ç”¨ï¼‰</p><p>è¯»é”ï¼šæ‰€æœ‰è¿æ¥åªèƒ½è¯»å–æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹</p><p>å†™é”ï¼šå…¶ä»–è¿æ¥ä¸èƒ½æŸ¥è¯¢å’Œä¿®æ”¹æ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- è¯»é”
LOCK TABLE table_name READ;

-- å†™é”
LOCK TABLE table_name WRITE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è§£é”å‘½ä»¤ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- å°†å½“å‰ä¼šè¯æ‰€æœ‰çš„è¡¨è¿›è¡Œè§£é”
UNLOCK TABLES;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>é”çš„å…¼å®¹æ€§ï¼š</p><ul><li>å¯¹ MyISAM è¡¨çš„è¯»æ“ä½œï¼Œä¸ä¼šé˜»å¡å…¶ä»–ç”¨æˆ·å¯¹åŒä¸€è¡¨çš„è¯»è¯·æ±‚ï¼Œä½†ä¼šé˜»å¡å¯¹åŒä¸€è¡¨çš„å†™è¯·æ±‚</li><li>å¯¹ MyISAM è¡¨çš„å†™æ“ä½œï¼Œåˆ™ä¼šé˜»å¡å…¶ä»–ç”¨æˆ·å¯¹åŒä¸€è¡¨çš„è¯»å’Œå†™æ“ä½œ</li></ul><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é”çš„å…¼å®¹æ€§.png)</p><p>é”è°ƒåº¦ï¼š<strong>MyISAM çš„è¯»å†™é”è°ƒåº¦æ˜¯å†™ä¼˜å…ˆ</strong>ï¼Œå› ä¸ºå†™é”åå…¶ä»–çº¿ç¨‹ä¸èƒ½åšä»»ä½•æ“ä½œï¼Œå¤§é‡çš„æ›´æ–°ä¼šä½¿æŸ¥è¯¢å¾ˆéš¾å¾—åˆ°é”ï¼Œä»è€Œé€ æˆæ°¸è¿œé˜»å¡ï¼Œæ‰€ä»¥ MyISAM ä¸é€‚åˆåšå†™ä¸ºä¸»çš„è¡¨çš„å­˜å‚¨å¼•æ“</p><hr><h4 id="é”æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#é”æ“ä½œ" aria-hidden="true">#</a> é”æ“ä½œ</h4><h5 id="è¯»é”" tabindex="-1"><a class="header-anchor" href="#è¯»é”" aria-hidden="true">#</a> è¯»é”</h5><p>ä¸¤ä¸ªå®¢æˆ·ç«¯æ“ä½œ Client 1å’Œ Client 2ï¼Œç®€åŒ–ä¸º C1ã€C2</p><ul><li><p>æ•°æ®å‡†å¤‡ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE `tb_book` (
  `id` INT(11) AUTO_INCREMENT,
  `name` VARCHAR(50) DEFAULT NULL,
  `publish_time` DATE DEFAULT NULL,
  `status` CHAR(1) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=MYISAM DEFAULT CHARSET=utf8 ;

INSERT INTO tb_book (id, NAME, publish_time, STATUS) VALUES(NULL,&#39;javaç¼–ç¨‹æ€æƒ³&#39;,&#39;2088-08-01&#39;,&#39;1&#39;);
INSERT INTO tb_book (id, NAME, publish_time, STATUS) VALUES(NULL,&#39;mysqlç¼–ç¨‹æ€æƒ³&#39;,&#39;2088-08-08&#39;,&#39;0&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>C1ã€C2 åŠ è¯»é”ï¼ŒåŒæ—¶æŸ¥è¯¢å¯ä»¥æ­£å¸¸æŸ¥è¯¢å‡ºæ•°æ®</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>LOCK TABLE tb_book READ;	-- C1ã€C2
SELECT * FROM tb_book;		-- C1ã€C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> è¯»é”1.png)</p></li><li><p>C1 åŠ è¯»é”ï¼ŒC1ã€C2 æŸ¥è¯¢æœªé”å®šçš„è¡¨ï¼ŒC1 æŠ¥é”™ï¼ŒC2 æ­£å¸¸æŸ¥è¯¢</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>LOCK TABLE tb_book READ;	-- C1
SELECT * FROM tb_user;		-- C1ã€C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> è¯»é”2.png)</p><p>C1ã€C2 æ‰§è¡Œæ’å…¥æ“ä½œï¼ŒC1 æŠ¥é”™ï¼ŒC2 ç­‰å¾…è·å–</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>INSERT INTO tb_book VALUES(NULL,&#39;Springé«˜çº§&#39;,&#39;2088-01-01&#39;,&#39;1&#39;);	-- C1ã€C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> è¯»é”3.png)</p><p>å½“åœ¨ C1 ä¸­é‡Šæ”¾é”æŒ‡ä»¤ UNLOCK TABLESï¼ŒC2 ä¸­çš„ INSERT è¯­å¥ç«‹å³æ‰§è¡Œ</p></li></ul><hr><h5 id="å†™é”" tabindex="-1"><a class="header-anchor" href="#å†™é”" aria-hidden="true">#</a> å†™é”</h5><p>ä¸¤ä¸ªå®¢æˆ·ç«¯æ“ä½œ Client 1å’Œ Client 2ï¼Œç®€åŒ–ä¸º C1ã€C2</p><ul><li><p>C1 åŠ å†™é”ï¼ŒC1ã€C2æŸ¥è¯¢è¡¨ï¼ŒC1 æ­£å¸¸æŸ¥è¯¢ï¼ŒC2 éœ€è¦ç­‰å¾…</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>LOCK TABLE tb_book WRITE;	-- C1
SELECT * FROM tb_book;		-- C1ã€C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å†™é”1.png)</p><p>å½“åœ¨ C1 ä¸­é‡Šæ”¾é”æŒ‡ä»¤ UNLOCK TABLESï¼ŒC2 ä¸­çš„ SELECT è¯­å¥ç«‹å³æ‰§è¡Œ</p></li><li><p>C1ã€C2 åŒæ—¶åŠ å†™é”</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>LOCK TABLE tb_book WRITE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å†™é”2.png)</p></li><li><p>C1 åŠ å†™é”ï¼ŒC1ã€C2æŸ¥è¯¢æœªé”å®šçš„è¡¨ï¼ŒC1 æŠ¥é”™ï¼ŒC2 æ­£å¸¸æŸ¥è¯¢</p></li></ul><hr><h4 id="é”çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#é”çŠ¶æ€" aria-hidden="true">#</a> é”çŠ¶æ€</h4><ul><li><p>æŸ¥çœ‹é”ç«äº‰ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW OPEN TABLES;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-é”äº‰ç”¨æƒ…å†µæŸ¥çœ‹1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>In_userï¼šè¡¨å½“å‰è¢«æŸ¥è¯¢ä½¿ç”¨çš„æ¬¡æ•°ï¼Œå¦‚æœè¯¥æ•°ä¸ºé›¶ï¼Œåˆ™è¡¨æ˜¯æ‰“å¼€çš„ï¼Œä½†æ˜¯å½“å‰æ²¡æœ‰è¢«ä½¿ç”¨</p><p>Name_lockedï¼šè¡¨åç§°æ˜¯å¦è¢«é”å®šï¼Œåç§°é”å®šç”¨äºå–æ¶ˆè¡¨æˆ–å¯¹è¡¨è¿›è¡Œé‡å‘½åç­‰æ“ä½œ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>LOCK TABLE tb_book READ;	-- æ‰§è¡Œå‘½ä»¤
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-é”äº‰ç”¨æƒ…å†µæŸ¥çœ‹2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>æŸ¥çœ‹é”çŠ¶æ€ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW STATUS LIKE &#39;Table_locks%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-MyISAM<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é”çŠ¶æ€.png)</p><p>Table_locks_immediateï¼šæŒ‡çš„æ˜¯èƒ½ç«‹å³è·å¾—è¡¨çº§é”çš„æ¬¡æ•°ï¼Œæ¯ç«‹å³è·å–é”ï¼Œå€¼åŠ  1</p><p>Table_locks_waitedï¼šæŒ‡çš„æ˜¯ä¸èƒ½ç«‹å³è·å–è¡¨çº§é”è€Œéœ€è¦ç­‰å¾…çš„æ¬¡æ•°ï¼Œæ¯ç­‰å¾…ä¸€æ¬¡ï¼Œè¯¥å€¼åŠ  1ï¼Œæ­¤å€¼é«˜è¯´æ˜å­˜åœ¨ç€è¾ƒä¸ºä¸¥é‡çš„è¡¨çº§é”äº‰ç”¨æƒ…å†µ</p></li></ul><hr><h3 id="innodb-1" tabindex="-1"><a class="header-anchor" href="#innodb-1" aria-hidden="true">#</a> InnoDB</h3><h4 id="è¡Œçº§é”" tabindex="-1"><a class="header-anchor" href="#è¡Œçº§é”" aria-hidden="true">#</a> è¡Œçº§é”</h4><h5 id="è®°å½•é”" tabindex="-1"><a class="header-anchor" href="#è®°å½•é”" aria-hidden="true">#</a> è®°å½•é”</h5><p>InnoDB ä¸ MyISAM çš„æœ€å¤§ä¸åŒæœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯æ”¯æŒäº‹åŠ¡ï¼›äºŒæ˜¯é‡‡ç”¨äº†è¡Œçº§é”ï¼Œ<strong>InnoDB åŒæ—¶æ”¯æŒè¡¨é”å’Œè¡Œé”</strong></p><p>è¡Œçº§é”ï¼Œä¹Ÿç§°ä¸ºè®°å½•é”ï¼ˆRecord Lockï¼‰ï¼ŒInnoDB å®ç°äº†ä»¥ä¸‹ä¸¤ç§ç±»å‹çš„è¡Œé”ï¼š</p><ul><li>å…±äº«é” (S)ï¼šåˆç§°ä¸ºè¯»é”ï¼Œç®€ç§° S é”ï¼Œå¤šä¸ªäº‹åŠ¡å¯¹äºåŒä¸€æ•°æ®å¯ä»¥å…±äº«ä¸€æŠŠé”ï¼Œéƒ½èƒ½è®¿é—®åˆ°æ•°æ®ï¼Œä½†æ˜¯åªèƒ½è¯»ä¸èƒ½ä¿®æ”¹</li><li>æ’ä»–é” (X)ï¼šåˆç§°ä¸ºå†™é”ï¼Œç®€ç§° X é”ï¼Œä¸èƒ½ä¸å…¶ä»–é”å¹¶å­˜ï¼Œè·å–æ’ä»–é”çš„äº‹åŠ¡æ˜¯å¯ä»¥å¯¹æ•°æ®è¯»å–å’Œä¿®æ”¹</li></ul><p>RR éš”ç¦»ç•Œåˆ«ä¸‹ï¼Œå¯¹äº UPDATEã€DELETE å’Œ INSERT è¯­å¥ï¼ŒInnoDB ä¼š<strong>è‡ªåŠ¨ç»™æ¶‰åŠæ•°æ®é›†åŠ æ’ä»–é”</strong>ï¼ˆè¡Œé”ï¼‰ï¼Œåœ¨ commit æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼›å¯¹äºæ™®é€š SELECT è¯­å¥ï¼Œä¸ä¼šåŠ ä»»ä½•é”ï¼ˆåªæ˜¯é’ˆå¯¹ InnoDB å±‚æ¥è¯´çš„ï¼Œå› ä¸ºåœ¨ Server å±‚ä¼š<strong>åŠ  MDL è¯»é”</strong>ï¼‰ï¼Œé€šè¿‡ MVCC é˜²æ­¢å¹¶å‘å†²çª</p><p>åœ¨äº‹åŠ¡ä¸­åŠ çš„é”ï¼Œå¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±é‡Šæ”¾ï¼Œè€Œæ˜¯åœ¨äº‹åŠ¡ä¸­æ­¢æˆ–æäº¤æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œè¿™ä¸ªå°±æ˜¯<strong>ä¸¤é˜¶æ®µé”åè®®</strong>ã€‚æ‰€ä»¥ä¸€èˆ¬å°†æ›´æ–°å…±äº«èµ„æºï¼ˆå¹¶å‘é«˜ï¼‰çš„ SQL æ”¾åˆ°äº‹åŠ¡çš„æœ€åæ‰§è¡Œï¼Œå¯ä»¥è®©å…¶ä»–çº¿ç¨‹å°½é‡çš„å‡å°‘ç­‰å¾…æ—¶é—´</p><p>é”çš„å…¼å®¹æ€§ï¼š</p><ul><li>å…±äº«é”å’Œå…±äº«é” å…¼å®¹</li><li>å…±äº«é”å’Œæ’ä»–é” å†²çª</li><li>æ’ä»–é”å’Œæ’ä»–é” å†²çª</li><li>æ’ä»–é”å’Œå…±äº«é” å†²çª</li></ul><p>æ˜¾å¼ç»™æ•°æ®é›†åŠ å…±äº«é”æˆ–æ’ä»–é”ï¼š<strong>åŠ é”è¯»å°±æ˜¯å½“å‰è¯»ï¼Œè¯»å–çš„æ˜¯æœ€æ–°æ•°æ®</strong></p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM table_name WHERE ... LOCK IN SHARE MODE	-- å…±äº«é”
SELECT * FROM table_name WHERE ... FOR UPDATE			-- æ’ä»–é”
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼š<strong>é”é»˜è®¤ä¼šé”èšç°‡ç´¢å¼•ï¼ˆé”å°±æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šï¼‰</strong>ï¼Œä½†æ˜¯å½“ä½¿ç”¨è¦†ç›–ç´¢å¼•æ—¶ï¼ŒåŠ å…±äº«é”åªé”äºŒçº§ç´¢å¼•ï¼Œä¸é”èšç°‡ç´¢å¼•</p><hr><h5 id="é”æ“ä½œ-1" tabindex="-1"><a class="header-anchor" href="#é”æ“ä½œ-1" aria-hidden="true">#</a> é”æ“ä½œ</h5><p>ä¸¤ä¸ªå®¢æˆ·ç«¯æ“ä½œ Client 1å’Œ Client 2ï¼Œç®€åŒ–ä¸º C1ã€C2</p><ul><li><p>ç¯å¢ƒå‡†å¤‡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE TABLE test_innodb_lock(
	id INT(11),
	name VARCHAR(16),
	sex VARCHAR(1)
)ENGINE = INNODB DEFAULT CHARSET=utf8;

INSERT INTO test_innodb_lock VALUES(1,&#39;100&#39;,&#39;1&#39;);
-- ..........

CREATE INDEX idx_test_innodb_lock_id ON test_innodb_lock(id);
CREATE INDEX idx_test_innodb_lock_name ON test_innodb_lock(name);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å…³é—­è‡ªåŠ¨æäº¤åŠŸèƒ½ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET AUTOCOMMIT=0;	-- C1ã€C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ­£å¸¸æŸ¥è¯¢æ•°æ®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM test_innodb_lock;	-- C1ã€C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢ id ä¸º 3 çš„æ•°æ®ï¼Œæ­£å¸¸æŸ¥è¯¢ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM test_innodb_lock WHERE id=3;	-- C1ã€C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é”æ“ä½œ1.png)</p></li><li><p>C1 æ›´æ–° id ä¸º 3 çš„æ•°æ®ï¼Œä½†ä¸æäº¤ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>UPDATE test_innodb_lock SET name=&#39;300&#39; WHERE id=3;	-- C1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é”æ“ä½œ2.png)</p><p>C2 æŸ¥è¯¢ä¸åˆ° C1 ä¿®æ”¹çš„æ•°æ®ï¼Œå› ä¸ºéš”ç¦»ç•Œåˆ«ä¸º REPEATABLE READï¼ŒC1 æäº¤äº‹åŠ¡ï¼ŒC2 æŸ¥è¯¢ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>COMMIT;	-- C1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é”æ“ä½œ3.png)</p><p>æäº¤åä»ç„¶æŸ¥è¯¢ä¸åˆ° C1 ä¿®æ”¹çš„æ•°æ®ï¼Œå› ä¸ºéš”ç¦»çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼Œæ‰€ä»¥ C2 éœ€è¦æäº¤æ‰å¯ä»¥æŸ¥è¯¢åˆ°å…¶ä»–äº‹åŠ¡å¯¹æ•°æ®çš„ä¿®æ”¹ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>COMMIT;	-- C2
SELECT * FROM test_innodb_lock WHERE id=3;	-- C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é”æ“ä½œ4.png)</p></li><li><p>C1 æ›´æ–° id ä¸º 3 çš„æ•°æ®ï¼Œä½†ä¸æäº¤ï¼ŒC2 ä¹Ÿæ›´æ–° id ä¸º 3 çš„æ•°æ®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>UPDATE test_innodb_lock SET name=&#39;3&#39; WHERE id=3;	-- C1
UPDATE test_innodb_lock SET name=&#39;30&#39; WHERE id=3;	-- C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é”æ“ä½œ5.png)</p><p>å½“ C1 æäº¤ï¼ŒC2 ç›´æ¥è§£é™¤é˜»å¡ï¼Œç›´æ¥æ›´æ–°</p></li><li><p>æ“ä½œä¸åŒè¡Œçš„æ•°æ®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>UPDATE test_innodb_lock SET name=&#39;10&#39; WHERE id=1;	-- C1
UPDATE test_innodb_lock SET name=&#39;30&#39; WHERE id=3;	-- C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é”æ“ä½œ6.png)</p><p>ç”±äº C1ã€C2 æ“ä½œçš„ä¸åŒè¡Œï¼Œè·å–ä¸åŒçš„è¡Œé”ï¼Œæ‰€ä»¥éƒ½å¯ä»¥æ­£å¸¸è·å–è¡Œé”</p></li></ul><hr><h4 id="é”åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#é”åˆ†ç±»" aria-hidden="true">#</a> é”åˆ†ç±»</h4><h5 id="é—´éš™é”" tabindex="-1"><a class="header-anchor" href="#é—´éš™é”" aria-hidden="true">#</a> é—´éš™é”</h5><p>InnoDB ä¼šå¯¹é—´éš™ï¼ˆGAPï¼‰è¿›è¡ŒåŠ é”ï¼Œå°±æ˜¯é—´éš™é” ï¼ˆRR éš”ç¦»çº§åˆ«ä¸‹æ‰æœ‰è¯¥é”ï¼‰ã€‚é—´éš™é”ä¹‹é—´ä¸å­˜åœ¨å†²çªå…³ç³»ï¼Œ<strong>å¤šä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶å¯¹ä¸€ä¸ªé—´éš™åŠ é”</strong>ï¼Œä½†æ˜¯é—´éš™é”ä¼šé˜»æ­¢å¾€è¿™ä¸ªé—´éš™ä¸­æ’å…¥ä¸€ä¸ªè®°å½•çš„æ“ä½œ</p><p>InnoDB åŠ é”çš„åŸºæœ¬å•ä½æ˜¯ next-key lockï¼Œè¯¥é”æ˜¯è¡Œé”å’Œ gap lock çš„ç»„åˆï¼ˆX or S é”ï¼‰ï¼Œä½†æ˜¯åŠ é”è¿‡ç¨‹æ˜¯åˆ†ä¸ºé—´éš™é”å’Œè¡Œé”ä¸¤æ®µæ‰§è¡Œ</p><ul><li>å¯ä»¥<strong>ä¿æŠ¤å½“å‰è®°å½•å’Œå‰é¢çš„é—´éš™</strong>ï¼Œéµå¾ªå·¦å¼€å³é—­åŸåˆ™ï¼Œå•çº¯çš„é—´éš™é”æ˜¯å·¦å¼€å³å¼€</li><li>å‡è®¾æœ‰ 10ã€11ã€13ï¼Œé‚£ä¹ˆå¯èƒ½çš„é—´éš™é”åŒ…æ‹¬ï¼š(è´Ÿæ— ç©·,10]ã€(10,11]ã€(11,13]ã€(13,æ­£æ— ç©·)</li></ul><p>å‡ ç§ç´¢å¼•çš„åŠ é”æƒ…å†µï¼š</p><ul><li>å”¯ä¸€ç´¢å¼•åŠ é”åœ¨å€¼å­˜åœ¨æ—¶æ˜¯è¡Œé”ï¼Œnext-key lock ä¼šé€€åŒ–ä¸ºè¡Œé”ï¼Œå€¼ä¸å­˜åœ¨ä¼šå˜æˆé—´éš™é”</li><li>æ™®é€šç´¢å¼•åŠ é”ä¼šç»§ç»­å‘å³éå†åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„å€¼ä¸ºæ­¢ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”</li><li>èŒƒå›´æŸ¥è¯¢æ— è®ºæ˜¯å¦æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œéƒ½éœ€è¦è®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢</li><li>å¯¹äºè”åˆç´¢å¼•ä¸”æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœ where æ¡ä»¶åªåŒ…æ‹¬è”åˆç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆä¼šåŠ é—´éš™é”</li></ul><p>é—´éš™é”ä¼˜ç‚¹ï¼šRR çº§åˆ«ä¸‹é—´éš™é”å¯ä»¥<strong>è§£å†³äº‹åŠ¡çš„ä¸€éƒ¨åˆ†çš„å¹»è¯»é—®é¢˜</strong>ï¼Œé€šè¿‡å¯¹é—´éš™åŠ é”ï¼Œå¯ä»¥é˜²æ­¢è¯»å–è¿‡ç¨‹ä¸­æ•°æ®æ¡ç›®å‘ç”Ÿå˜åŒ–ã€‚ä¸€éƒ¨åˆ†çš„æ„æ€æ˜¯ä¸ä¼šå¯¹å…¨éƒ¨é—´éš™åŠ é”ï¼Œåªèƒ½åŠ é”ä¸€éƒ¨åˆ†çš„é—´éš™</p><p>é—´éš™é”å±å®³ï¼š</p><ul><li>å½“é”å®šä¸€ä¸ªèŒƒå›´çš„é”®å€¼åï¼Œå³ä½¿æŸäº›ä¸å­˜åœ¨çš„é”®å€¼ä¹Ÿä¼šè¢«æ— è¾œçš„é”å®šï¼Œé€ æˆåœ¨é”å®šçš„æ—¶å€™æ— æ³•æ’å…¥é”å®šé”®å€¼èŒƒå›´å†…çš„ä»»ä½•æ•°æ®ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹è¿™å¯èƒ½ä¼šå¯¹æ€§èƒ½é€ æˆå¾ˆå¤§çš„å±å®³ï¼Œå½±å“å¹¶å‘åº¦</li><li>äº‹åŠ¡ A B åŒæ—¶é”ä½ä¸€ä¸ªé—´éš™åï¼ŒA å¾€å½“å‰é—´éš™æ’å…¥æ•°æ®æ—¶ä¼šè¢« B çš„é—´éš™é”é˜»å¡ï¼ŒB ä¹Ÿæ‰§è¡Œæ’å…¥é—´éš™æ•°æ®çš„æ“ä½œæ—¶å°±ä¼š<strong>äº§ç”Ÿæ­»é”</strong></li></ul><p>ç°åœºæ¼”ç¤ºï¼š</p><ul><li><p>å…³é—­è‡ªåŠ¨æäº¤åŠŸèƒ½ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET AUTOCOMMIT=0;	-- C1ã€C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢æ•°æ®è¡¨ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM test_innodb_lock;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é—´éš™é”1.png)</p></li><li><p>C1 æ ¹æ® id èŒƒå›´æ›´æ–°æ•°æ®ï¼ŒC2 æ’å…¥æ•°æ®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>UPDATE test_innodb_lock SET name=&#39;8888&#39; WHERE id &lt; 4;	-- C1
INSERT INTO test_innodb_lock VALUES(2,&#39;200&#39;,&#39;2&#39;);		-- C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é—´éš™é”2.png)</p><p>å‡ºç°é—´éš™é”ï¼ŒC2 è¢«é˜»å¡ï¼Œç­‰å¾… C1 æäº¤äº‹åŠ¡åæ‰èƒ½æ›´æ–°</p></li></ul><hr><h5 id="æ„å‘é”" tabindex="-1"><a class="header-anchor" href="#æ„å‘é”" aria-hidden="true">#</a> æ„å‘é”</h5><p>InnoDB ä¸ºäº†æ”¯æŒå¤šç²’åº¦çš„åŠ é”ï¼Œå…è®¸è¡Œé”å’Œè¡¨é”åŒæ—¶å­˜åœ¨ï¼Œæ”¯æŒåœ¨ä¸åŒç²’åº¦ä¸Šçš„åŠ é”æ“ä½œï¼ŒInnoDB å¢åŠ äº†æ„å‘é”ï¼ˆIntention Lockï¼‰</p><p>æ„å‘é”æ˜¯å°†é”å®šçš„å¯¹è±¡åˆ†ä¸ºå¤šä¸ªå±‚æ¬¡ï¼Œæ„å‘é”æ„å‘³ç€äº‹åŠ¡å¸Œæœ›åœ¨æ›´ç»†ç²’åº¦ä¸Šè¿›è¡ŒåŠ é”ï¼Œæ„å‘é”åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>æ„å‘å…±äº«é”ï¼ˆISï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨åŠ å…±äº«é”</li><li>æ„å‘æ’ä»–é”ï¼ˆIXï¼‰ï¼šäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨åŠ æ’ä»–é”</li></ul><p><strong>IXï¼ŒIS æ˜¯è¡¨çº§é”</strong>ï¼Œä¸ä¼šå’Œè¡Œçº§çš„ Xï¼ŒS é”å‘ç”Ÿå†²çªï¼Œæ„å‘é”æ˜¯åœ¨åŠ è¡¨çº§é”ä¹‹å‰æ·»åŠ ï¼Œä¸ºäº†åœ¨åŠ è¡¨çº§é”æ—¶å¯ä»¥å¿«é€Ÿåˆ¤æ–­è¡¨ä¸­æ˜¯å¦æœ‰è®°å½•è¢«ä¸Šé”ï¼Œæ¯”å¦‚å‘ä¸€ä¸ªè¡¨æ·»åŠ è¡¨çº§ X é”çš„æ—¶ï¼š</p><ul><li>æ²¡æœ‰æ„å‘é”ï¼Œåˆ™éœ€è¦éå†æ•´ä¸ªè¡¨åˆ¤æ–­æ˜¯å¦æœ‰é”å®šçš„è®°å½•</li><li>æœ‰äº†æ„å‘é”ï¼Œé¦–å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ„å‘é”ï¼Œç„¶ååˆ¤æ–­è¯¥æ„å‘é”ä¸å³å°†æ·»åŠ çš„è¡¨çº§é”æ˜¯å¦å…¼å®¹å³å¯ï¼Œå› ä¸ºæ„å‘é”çš„å­˜åœ¨ä»£è¡¨æœ‰è¡¨çº§é”çš„å­˜åœ¨æˆ–è€…å³å°†æœ‰è¡¨çº§é”çš„å­˜åœ¨</li></ul><p>å…¼å®¹æ€§å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æ„å‘é”å…¼å®¹æ€§.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>æ’å…¥æ„å‘é”</strong> Insert Intention Lock æ˜¯åœ¨æ’å…¥ä¸€è¡Œè®°å½•æ“ä½œä¹‹å‰è®¾ç½®çš„ä¸€ç§é—´éš™é”ï¼Œæ˜¯è¡Œçº§é”</p><p>æ’å…¥æ„å‘é”é‡Šæ”¾äº†ä¸€ç§æ’å…¥ä¿¡å·ï¼Œå³å¤šä¸ªäº‹åŠ¡åœ¨ç›¸åŒçš„ç´¢å¼•é—´éš™æ’å…¥æ—¶å¦‚æœä¸æ˜¯æ’å…¥ç›¸åŒçš„é—´éš™ä½ç½®å°±ä¸éœ€è¦äº’ç›¸ç­‰å¾…ã€‚å‡è®¾æŸåˆ—æœ‰ç´¢å¼•ï¼Œåªè¦ä¸¤ä¸ªäº‹åŠ¡æ’å…¥ä½ç½®ä¸åŒï¼Œå¦‚äº‹åŠ¡ A æ’å…¥ 3ï¼Œäº‹åŠ¡ B æ’å…¥ 4ï¼Œé‚£ä¹ˆå°±å¯ä»¥åŒæ—¶æ’å…¥</p><hr><h5 id="è‡ªå¢é”" tabindex="-1"><a class="header-anchor" href="#è‡ªå¢é”" aria-hidden="true">#</a> è‡ªå¢é”</h5><p>ç³»ç»Ÿä¼šè‡ªåŠ¨ç»™ AUTO_INCREMENT ä¿®é¥°çš„åˆ—è¿›è¡Œé€’å¢èµ‹å€¼ï¼Œå®ç°æ–¹å¼ï¼š</p><ul><li>AUTO_INC é”ï¼šè¡¨çº§é”ï¼Œæ‰§è¡Œæ’å…¥è¯­å¥æ—¶ä¼šè‡ªåŠ¨æ·»åŠ ï¼Œåœ¨è¯¥è¯­å¥æ‰§è¡Œå®Œæˆåé‡Šæ”¾ï¼Œå¹¶ä¸æ˜¯äº‹åŠ¡ç»“æŸ</li><li>è½»é‡çº§é”ï¼šä¸ºæ’å…¥è¯­å¥ç”Ÿæˆ AUTO_INCREMENT ä¿®é¥°çš„åˆ—æ—¶è·å–è¯¥é”ï¼Œç”Ÿæˆä»¥åé‡Šæ”¾æ‰ï¼Œä¸éœ€è¦ç­‰åˆ°æ’å…¥è¯­å¥æ‰§è¡Œå®Œåé‡Šæ”¾</li></ul><p>ç³»ç»Ÿå˜é‡ <code>innodb_autoinc_lock_mode</code> æ§åˆ¶é‡‡å–å“ªç§æ–¹å¼ï¼š</p><ul><li>0ï¼šå…¨éƒ¨é‡‡ç”¨ AUTO_INC é”</li><li>1ï¼šå…¨éƒ¨é‡‡ç”¨è½»é‡çº§é”</li><li>2ï¼šæ··åˆä½¿ç”¨ï¼Œåœ¨æ’å…¥è®°å½•çš„æ•°é‡ç¡®å®šæ—¶é‡‡ç”¨è½»é‡çº§é”ï¼Œä¸ç¡®å®šæ—¶é‡‡ç”¨ AUTO_INC é”</li></ul><hr><h5 id="éšå¼é”" tabindex="-1"><a class="header-anchor" href="#éšå¼é”" aria-hidden="true">#</a> éšå¼é”</h5><p>ä¸€èˆ¬æƒ…å†µä¸‹ INSERT è¯­å¥æ˜¯ä¸éœ€è¦åœ¨å†…å­˜ä¸­ç”Ÿæˆé”ç»“æ„çš„ï¼Œä¼šè¿›è¡Œéšå¼çš„åŠ é”ï¼Œä¿æŠ¤çš„æ˜¯æ’å…¥åçš„å®‰å…¨</p><p>æ³¨æ„ï¼šå¦‚æœæ’å…¥çš„é—´éš™è¢«å…¶ä»–äº‹åŠ¡åŠ äº†é—´éš™é”ï¼Œæ­¤æ¬¡æ’å…¥ä¼šè¢«é˜»å¡ï¼Œå¹¶åœ¨è¯¥é—´éš™æ’å…¥ä¸€ä¸ªæ’å…¥æ„å‘é”</p><ul><li>èšç°‡ç´¢å¼•ï¼šç´¢å¼•è®°å½•æœ‰ trx_id éšè—åˆ—ï¼Œè¡¨ç¤ºæœ€åæ”¹åŠ¨è¯¥è®°å½•çš„äº‹åŠ¡ idï¼Œæ’å…¥æ•°æ®åäº‹åŠ¡ id å°±æ˜¯å½“å‰äº‹åŠ¡ã€‚å…¶ä»–äº‹åŠ¡æƒ³è·å–è¯¥è®°å½•çš„é”æ—¶ä¼šåˆ¤æ–­å½“å‰è®°å½•çš„äº‹åŠ¡ id æ˜¯å¦æ˜¯æ´»è·ƒçš„ï¼Œå¦‚æœä¸æ˜¯å°±å¯ä»¥æ­£å¸¸åŠ é”ï¼›å¦‚æœæ˜¯å°±åˆ›å»ºä¸€ä¸ª X çš„é”ç»“æ„ï¼Œè¯¥é”çš„ is_waiting æ˜¯ falseï¼Œä¸ºè‡ªå·±çš„äº‹åŠ¡åˆ›å»ºä¸€ä¸ªé”ç»“æ„ï¼Œis_waiting æ˜¯ trueï¼ˆç±»ä¼¼ Java ä¸­çš„é”å‡çº§ï¼‰</li><li>äºŒçº§ç´¢å¼•ï¼šè·å–æ•°æ®é¡µ Page Header ä¸­çš„ PAGE_MAX_TRX_ID å±æ€§ï¼Œä»£è¡¨ä¿®æ”¹å½“å‰é¡µé¢çš„æœ€å¤§çš„äº‹åŠ¡ IDï¼Œå¦‚æœå°äºå½“å‰æ´»è·ƒçš„æœ€å°äº‹åŠ¡ idï¼Œå°±è¯æ˜æ’å…¥è¯¥æ•°æ®çš„äº‹åŠ¡å·²ç»æäº¤ï¼Œå¦åˆ™å°±éœ€è¦è·å–åˆ°ä¸»é”®å€¼è¿›è¡Œå›è¡¨æ“ä½œ</li></ul><p>éšå¼é”èµ·åˆ°äº†å»¶è¿Ÿç”Ÿæˆé”çš„æ•ˆæœï¼Œå¦‚æœå…¶ä»–äº‹åŠ¡ä¸éšå¼é”æ²¡æœ‰å†²çªï¼Œå°±å¯ä»¥é¿å…é”ç»“æ„çš„ç”Ÿæˆï¼ŒèŠ‚çœäº†å†…å­˜èµ„æº</p><p>INSERT åœ¨ä¸¤ç§æƒ…å†µä¸‹ä¼šç”Ÿæˆé”ç»“æ„ï¼š</p><ul><li><p>é‡å¤é”®ï¼šåœ¨æ’å…¥ä¸»é”®æˆ–å”¯ä¸€äºŒçº§ç´¢å¼•æ—¶é‡åˆ°é‡å¤çš„é”®å€¼ä¼šæŠ¥é”™ï¼Œåœ¨æŠ¥é”™å‰éœ€è¦å¯¹å¯¹åº”çš„èšç°‡ç´¢å¼•è¿›è¡ŒåŠ é”</p><ul><li>éš”ç¦»çº§åˆ« &lt;= Read Uncommittedï¼ŒåŠ  S å‹ Record Lock</li><li>éš”ç¦»çº§åˆ« &gt;= Repeatable Readï¼ŒåŠ  S å‹ next_key é”</li></ul></li><li><p>å¤–é”®æ£€æŸ¥ï¼šå¦‚æœå¾…æ’å…¥çš„è®°å½•åœ¨çˆ¶è¡¨ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œä¼šå¯¹çˆ¶è¡¨çš„è®°å½•åŠ  S å‹ Record Lockã€‚å¦‚æœå¾…æ’å…¥çš„è®°å½•åœ¨çˆ¶è¡¨ä¸­æ‰¾ä¸åˆ°</p><ul><li>éš”ç¦»çº§åˆ« &lt;= Read Committedï¼Œä¸åŠ é”</li><li>éš”ç¦»çº§åˆ« &gt;= Repeatable Readï¼ŒåŠ é—´éš™é”</li></ul></li></ul><hr><h4 id="é”ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#é”ä¼˜åŒ–" aria-hidden="true">#</a> é”ä¼˜åŒ–</h4><h5 id="ä¼˜åŒ–é”" tabindex="-1"><a class="header-anchor" href="#ä¼˜åŒ–é”" aria-hidden="true">#</a> ä¼˜åŒ–é”</h5><p>InnoDB å­˜å‚¨å¼•æ“å®ç°äº†è¡Œçº§é”å®šï¼Œè™½ç„¶åœ¨é”å®šæœºåˆ¶çš„å®ç°æ–¹é¢å¸¦æ¥äº†æ€§èƒ½æŸè€—å¯èƒ½æ¯”è¡¨é”ä¼šæ›´é«˜ï¼Œä½†æ˜¯åœ¨æ•´ä½“å¹¶å‘å¤„ç†èƒ½åŠ›æ–¹é¢è¦è¿œè¿œä¼˜äº MyISAM çš„è¡¨é”ï¼Œå½“ç³»ç»Ÿå¹¶å‘é‡è¾ƒé«˜çš„æ—¶å€™ï¼ŒInnoDB çš„æ•´ä½“æ€§èƒ½è¿œè¿œå¥½äº MyISAM</p><p>ä½†æ˜¯ä½¿ç”¨ä¸å½“å¯èƒ½ä¼šè®© InnoDB çš„æ•´ä½“æ€§èƒ½è¡¨ç°ä¸ä»…ä¸èƒ½æ¯” MyISAM é«˜ï¼Œç”šè‡³å¯èƒ½ä¼šæ›´å·®</p><p>ä¼˜åŒ–å»ºè®®ï¼š</p><ul><li>å°½å¯èƒ½è®©æ‰€æœ‰æ•°æ®æ£€ç´¢éƒ½èƒ½é€šè¿‡ç´¢å¼•æ¥å®Œæˆï¼Œé¿å…æ— ç´¢å¼•è¡Œé”å‡çº§ä¸ºè¡¨é”</li><li>åˆç†è®¾è®¡ç´¢å¼•ï¼Œå°½é‡ç¼©å°é”çš„èŒƒå›´</li><li>å°½å¯èƒ½å‡å°‘ç´¢å¼•æ¡ä»¶åŠç´¢å¼•èŒƒå›´ï¼Œé¿å…é—´éš™é”</li><li>å°½é‡æ§åˆ¶äº‹åŠ¡å¤§å°ï¼Œå‡å°‘é”å®šèµ„æºé‡å’Œæ—¶é—´é•¿åº¦</li><li>å°½å¯ä½¿ç”¨ä½çº§åˆ«äº‹åŠ¡éš”ç¦»ï¼ˆéœ€è¦ä¸šåŠ¡å±‚é¢æ»¡è¶³éœ€æ±‚ï¼‰</li></ul><hr><h5 id="é”å‡çº§" tabindex="-1"><a class="header-anchor" href="#é”å‡çº§" aria-hidden="true">#</a> é”å‡çº§</h5><p>ç´¢å¼•å¤±æ•ˆé€ æˆ<strong>è¡Œé”å‡çº§ä¸ºè¡¨é”</strong>ï¼Œä¸é€šè¿‡ç´¢å¼•æ£€ç´¢æ•°æ®ï¼Œå…¨å±€æ‰«æçš„è¿‡ç¨‹ä¸­ InnoDB ä¼šå°†å¯¹è¡¨ä¸­çš„æ‰€æœ‰è®°å½•åŠ é”ï¼Œå®é™…æ•ˆæœå’Œ<strong>è¡¨é”</strong>ä¸€æ ·ï¼Œå®é™…å¼€å‘è¿‡ç¨‹åº”é¿å…å‡ºç°ç´¢å¼•å¤±æ•ˆçš„çŠ¶å†µ</p><ul><li><p>æŸ¥çœ‹å½“å‰è¡¨çš„ç´¢å¼•ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW INDEX FROM test_innodb_lock;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å…³é—­è‡ªåŠ¨æäº¤åŠŸèƒ½ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET AUTOCOMMIT=0;	-- C1ã€C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ‰§è¡Œæ›´æ–°è¯­å¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>UPDATE test_innodb_lock SET sex=&#39;2&#39; WHERE name=10;	-- C1
UPDATE test_innodb_lock SET sex=&#39;2&#39; WHERE id=3;		-- C2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>![](<a href="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB" target="_blank" rel="noopener noreferrer">https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> é”å‡çº§.png)</p><p>ç´¢å¼•å¤±æ•ˆï¼šæ‰§è¡Œæ›´æ–°æ—¶ name å­—æ®µä¸º varchar ç±»å‹ï¼Œé€ æˆç´¢å¼•å¤±æ•ˆï¼Œæœ€ç»ˆè¡Œé”å˜ä¸ºè¡¨é”</p></li></ul><hr><h5 id="æ­»é”" tabindex="-1"><a class="header-anchor" href="#æ­»é”" aria-hidden="true">#</a> æ­»é”</h5><p>ä¸åŒäº‹åŠ¡ç”±äºäº’ç›¸æŒæœ‰å¯¹æ–¹éœ€è¦çš„é”è€Œå¯¼è‡´äº‹åŠ¡éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œçš„æƒ…å†µç§°ä¸ºæ­»é”</p><p>æ­»é”æƒ…å†µï¼šçº¿ç¨‹ A ä¿®æ”¹äº† id = 1 çš„æ•°æ®ï¼Œè¯·æ±‚ä¿®æ”¹ id = 2 çš„æ•°æ®ï¼Œçº¿ç¨‹ B ä¿®æ”¹äº† id = 2 çš„æ•°æ®ï¼Œè¯·æ±‚ä¿®æ”¹ id = 1 çš„æ•°æ®ï¼Œäº§ç”Ÿæ­»é”</p><p>è§£å†³ç­–ç•¥ï¼š</p><ul><li><p>ç›´æ¥è¿›å…¥ç­‰å¾…ç›´åˆ°è¶…æ—¶ï¼Œè¶…æ—¶æ—¶é—´å¯ä»¥é€šè¿‡å‚æ•° innodb_lock_wait_timeout æ¥è®¾ç½®ï¼Œé»˜è®¤ 50 ç§’ï¼Œä½†æ˜¯æ—¶é—´çš„è®¾ç½®ä¸å¥½æ§åˆ¶ï¼Œè¶…æ—¶å¯èƒ½ä¸æ˜¯å› ä¸ºæ­»é”ï¼Œè€Œæ˜¯å› ä¸ºäº‹åŠ¡å¤„ç†æ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸é‡‡å–è¯¥æ–¹å¼</p></li><li><p>ä¸»åŠ¨æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”å<strong>ä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­è¾ƒå°çš„ä¸€ä¸ªäº‹åŠ¡</strong>ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œï¼Œå°†å‚æ•° <code>innodb_deadlock_detect</code> è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºå¼€å¯è¯¥åŠŸèƒ½ï¼ˆäº‹åŠ¡è¾ƒå°çš„æ„æ€å°±æ˜¯äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ’å…¥ã€åˆ é™¤ã€æ›´æ–°çš„è®°å½•æ¡æ•°ï¼‰</p><p>æ­»é”æ£€æµ‹å¹¶ä¸æ˜¯æ¯ä¸ªè¯­å¥éƒ½è¦æ£€æµ‹ï¼Œåªæœ‰åœ¨åŠ é”è®¿é—®çš„è¡Œä¸Šå·²ç»æœ‰é”æ—¶ï¼Œå½“å‰äº‹åŠ¡è¢«é˜»å¡äº†æ‰ä¼šæ£€æµ‹ï¼Œä¹Ÿæ˜¯ä»å½“å‰äº‹åŠ¡å¼€å§‹è¿›è¡Œæ£€æµ‹</p></li></ul><p>é€šè¿‡æ‰§è¡Œ <code>SHOW ENGINE INNODB STATUS</code> å¯ä»¥æŸ¥çœ‹æœ€è¿‘å‘ç”Ÿçš„ä¸€æ¬¡æ­»å¾ªç¯ï¼Œå…¨å±€ç³»ç»Ÿå˜é‡ <code>innodb_print_all_deadlocks</code> è®¾ç½®ä¸º onï¼Œå°±å¯ä»¥å°†æ¯ä¸ªæ­»é”ä¿¡æ¯éƒ½è®°å½•åœ¨ MySQL é”™è¯¯æ—¥å¿—ä¸­</p><p>æ­»é”ä¸€èˆ¬æ˜¯è¡Œçº§é”ï¼Œå½“è¡¨é”å‘ç”Ÿæ­»é”æ—¶ï¼Œä¼šåœ¨äº‹åŠ¡ä¸­è®¿é—®å…¶ä»–è¡¨æ—¶<strong>ç›´æ¥æŠ¥é”™</strong>ï¼Œç ´åäº†æŒæœ‰å¹¶ç­‰å¾…çš„æ­»é”æ¡ä»¶</p><hr><h4 id="é”çŠ¶æ€-1" tabindex="-1"><a class="header-anchor" href="#é”çŠ¶æ€-1" aria-hidden="true">#</a> é”çŠ¶æ€</h4><p>æŸ¥çœ‹é”ä¿¡æ¯</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW STATUS LIKE &#39;innodb_row_lock%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDB é”äº‰ç”¨.png" style="zoom:80%;"><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><p>Innodb_row_lock_current_waitsï¼šå½“å‰æ­£åœ¨ç­‰å¾…é”å®šçš„æ•°é‡</p></li><li><p>Innodb_row_lock_timeï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨é”å®šæ€»æ—¶é—´é•¿åº¦</p></li><li><p>Innodb_row_lock_time_avgï¼šæ¯æ¬¡ç­‰å¾…æ‰€èŠ±å¹³å‡æ—¶é•¿</p></li><li><p>Innodb_row_lock_time_maxï¼šä»ç³»ç»Ÿå¯åŠ¨åˆ°ç°åœ¨ç­‰å¾…æœ€é•¿çš„ä¸€æ¬¡æ‰€èŠ±çš„æ—¶é—´</p></li><li><p>Innodb_row_lock_waitsï¼šç³»ç»Ÿå¯åŠ¨ååˆ°ç°åœ¨æ€»å…±ç­‰å¾…çš„æ¬¡æ•°</p></li></ul><p>å½“ç­‰å¾…çš„æ¬¡æ•°å¾ˆé«˜ï¼Œè€Œä¸”æ¯æ¬¡ç­‰å¾…çš„æ—¶é•¿ä¹Ÿä¸çŸ­çš„æ—¶å€™ï¼Œå°±éœ€è¦åˆ†æç³»ç»Ÿä¸­ä¸ºä»€ä¹ˆä¼šæœ‰å¦‚æ­¤å¤šçš„ç­‰å¾…ï¼Œç„¶åæ ¹æ®åˆ†æç»“æœåˆ¶å®šä¼˜åŒ–è®¡åˆ’</p><p>æŸ¥çœ‹é”çŠ¶æ€ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM information_schema.innodb_locks;	#é”çš„æ¦‚å†µ
SHOW ENGINE INNODB STATUS\G; #InnoDBæ•´ä½“çŠ¶æ€ï¼Œå…¶ä¸­åŒ…æ‹¬é”çš„æƒ…å†µ
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-InnoDBæŸ¥çœ‹é”çŠ¶æ€.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>lock_id æ˜¯é” idï¼›lock_trx_id ä¸ºäº‹åŠ¡ idï¼›lock_mode ä¸º X ä»£è¡¨æ’å®ƒé”ï¼ˆå†™é”ï¼‰ï¼›lock_type ä¸º RECORD ä»£è¡¨é”ä¸ºè¡Œé”ï¼ˆè®°å½•é”ï¼‰</p><hr><h3 id="ä¹è§‚é”" tabindex="-1"><a class="header-anchor" href="#ä¹è§‚é”" aria-hidden="true">#</a> ä¹è§‚é”</h3><p>æ‚²è§‚é”ï¼šåœ¨æ•´ä¸ªæ•°æ®å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå°†æ•°æ®å¤„äºé”å®šçŠ¶æ€ï¼Œä¸ºäº†ä¿è¯äº‹åŠ¡çš„éš”ç¦»æ€§ï¼Œå°±éœ€è¦ä¸€è‡´æ€§é”å®šè¯»ã€‚è¯»å–æ•°æ®æ—¶ç»™åŠ é”ï¼Œå…¶å®ƒäº‹åŠ¡æ— æ³•ä¿®æ”¹è¿™äº›æ•°æ®ï¼Œä¿®æ”¹åˆ é™¤æ•°æ®æ—¶ä¹ŸåŠ é”ï¼Œå…¶å®ƒäº‹åŠ¡åŒæ ·æ— æ³•è¯»å–è¿™äº›æ•°æ®</p><p>æ‚²è§‚é”å’Œä¹è§‚é”ä½¿ç”¨å‰æï¼š</p><ul><li>å¯¹äºè¯»çš„æ“ä½œè¿œå¤šäºå†™çš„æ“ä½œçš„æ—¶å€™ï¼Œä¸€ä¸ªæ›´æ–°æ“ä½œåŠ é”ä¼šé˜»å¡æ‰€æœ‰çš„è¯»å–æ“ä½œï¼Œé™ä½äº†ååé‡ï¼Œæœ€åéœ€è¦é‡Šæ”¾é”ï¼Œé”æ˜¯éœ€è¦ä¸€äº›å¼€é”€çš„ï¼Œè¿™æ—¶å€™å¯ä»¥é€‰æ‹©ä¹è§‚é”</li><li>å¦‚æœæ˜¯è¯»å†™æ¯”ä¾‹å·®è·ä¸æ˜¯éå¸¸å¤§æˆ–è€…ç³»ç»Ÿæ²¡æœ‰å“åº”ä¸åŠæ—¶ï¼Œååé‡ç“¶é¢ˆçš„é—®é¢˜ï¼Œé‚£å°±ä¸è¦å»ä½¿ç”¨ä¹è§‚é”ï¼Œå®ƒå¢åŠ äº†å¤æ‚åº¦ï¼Œä¹Ÿå¸¦æ¥äº†ä¸šåŠ¡é¢å¤–çš„é£é™©ï¼Œè¿™æ—¶å€™å¯ä»¥é€‰æ‹©æ‚²è§‚é”</li></ul><p>ä¹è§‚é”çš„å®ç°æ–¹å¼ï¼šå°±æ˜¯ CASï¼Œæ¯”è¾ƒå¹¶äº¤æ¢</p><ul><li><p>ç‰ˆæœ¬å·</p><ol><li><p>ç»™æ•°æ®è¡¨ä¸­æ·»åŠ ä¸€ä¸ª version åˆ—ï¼Œæ¯æ¬¡æ›´æ–°åéƒ½å°†è¿™ä¸ªåˆ—çš„å€¼åŠ  1</p></li><li><p>è¯»å–æ•°æ®æ—¶ï¼Œå°†ç‰ˆæœ¬å·è¯»å–å‡ºæ¥ï¼Œåœ¨æ‰§è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œæ¯”è¾ƒç‰ˆæœ¬å·</p></li><li><p>å¦‚æœç›¸åŒåˆ™æ‰§è¡Œæ›´æ–°ï¼Œå¦‚æœä¸ç›¸åŒï¼Œè¯´æ˜æ­¤æ¡æ•°æ®å·²ç»å‘ç”Ÿäº†å˜åŒ–</p></li><li><p>ç”¨æˆ·è‡ªè¡Œæ ¹æ®è¿™ä¸ªé€šçŸ¥æ¥å†³å®šæ€ä¹ˆå¤„ç†ï¼Œæ¯”å¦‚é‡æ–°å¼€å§‹ä¸€éï¼Œæˆ–è€…æ”¾å¼ƒæœ¬æ¬¡æ›´æ–°</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>-- åˆ›å»ºcityè¡¨
CREATE TABLE city(
	id INT PRIMARY KEY AUTO_INCREMENT,  -- åŸå¸‚id
	NAME VARCHAR(20),                   -- åŸå¸‚åç§°
	VERSION INT                         -- ç‰ˆæœ¬å·
);

-- æ·»åŠ æ•°æ®
INSERT INTO city VALUES (NULL,&#39;åŒ—äº¬&#39;,1),(NULL,&#39;ä¸Šæµ·&#39;,1),(NULL,&#39;å¹¿å·&#39;,1),(NULL,&#39;æ·±åœ³&#39;,1);

-- ä¿®æ”¹åŒ—äº¬ä¸ºåŒ—äº¬å¸‚
-- 1.æŸ¥è¯¢åŒ—äº¬çš„version
SELECT VERSION FROM city WHERE NAME=&#39;åŒ—äº¬&#39;;
-- 2.ä¿®æ”¹åŒ—äº¬ä¸ºåŒ—äº¬å¸‚ï¼Œç‰ˆæœ¬å·+1ã€‚å¹¶å¯¹æ¯”ç‰ˆæœ¬å·
UPDATE city SET NAME=&#39;åŒ—äº¬å¸‚&#39;,VERSION=VERSION+1 WHERE NAME=&#39;åŒ—äº¬&#39; AND VERSION=1;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>æ—¶é—´æˆ³</p><ul><li>å’Œç‰ˆæœ¬å·æ–¹å¼åŸºæœ¬ä¸€æ ·ï¼Œç»™æ•°æ®è¡¨ä¸­æ·»åŠ ä¸€ä¸ªåˆ—ï¼Œåç§°æ— æ‰€è°“ï¼Œæ•°æ®ç±»å‹éœ€è¦æ˜¯ <strong>timestamp</strong></li><li>æ¯æ¬¡æ›´æ–°åéƒ½å°†æœ€æ–°æ—¶é—´æ’å…¥åˆ°æ­¤åˆ—</li><li>è¯»å–æ•°æ®æ—¶ï¼Œå°†æ—¶é—´è¯»å–å‡ºæ¥ï¼Œåœ¨æ‰§è¡Œæ›´æ–°çš„æ—¶å€™ï¼Œæ¯”è¾ƒæ—¶é—´</li><li>å¦‚æœç›¸åŒåˆ™æ‰§è¡Œæ›´æ–°ï¼Œå¦‚æœä¸ç›¸åŒï¼Œè¯´æ˜æ­¤æ¡æ•°æ®å·²ç»å‘ç”Ÿäº†å˜åŒ–</li></ul></li></ul><p>ä¹è§‚é”çš„å¼‚å¸¸æƒ…å†µï¼šå¦‚æœ version è¢«å…¶ä»–äº‹åŠ¡æŠ¢å…ˆæ›´æ–°ï¼Œåˆ™åœ¨å½“å‰äº‹åŠ¡ä¸­æ›´æ–°å¤±è´¥ï¼Œtrx_id æ²¡æœ‰å˜æˆå½“å‰äº‹åŠ¡çš„ IDï¼Œå½“å‰äº‹åŠ¡å†æ¬¡æŸ¥è¯¢è¿˜æ˜¯æ—§å€¼ï¼Œå°±ä¼šå‡ºç°<strong>å€¼æ²¡å˜ä½†æ˜¯æ›´æ–°ä¸äº†</strong>çš„ç°è±¡ï¼ˆanomalyï¼‰</p><p>è§£å†³æ–¹æ¡ˆï¼šæ¯æ¬¡ CAS æ›´æ–°ä¸ç®¡æˆåŠŸå¤±è´¥ï¼Œå°±ç»“æŸå½“å‰äº‹åŠ¡ï¼›å¦‚æœå¤±è´¥åˆ™é‡æ–°èµ·ä¸€ä¸ªäº‹åŠ¡è¿›è¡ŒæŸ¥è¯¢æ›´æ–°</p><hr><h2 id="ä¸»ä»" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»" aria-hidden="true">#</a> ä¸»ä»</h2><h3 id="åŸºæœ¬ä»‹ç»-9" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-9" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h3><p>ä¸»ä»å¤åˆ¶æ˜¯æŒ‡å°†ä¸»æ•°æ®åº“çš„ DDL å’Œ DML æ“ä½œé€šè¿‡äºŒè¿›åˆ¶æ—¥å¿—ä¼ åˆ°ä»åº“æœåŠ¡å™¨ä¸­ï¼Œç„¶ååœ¨ä»åº“ä¸Šå¯¹è¿™äº›æ—¥å¿—é‡æ–°æ‰§è¡Œï¼ˆä¹Ÿå«é‡åšï¼‰ï¼Œä»è€Œä½¿å¾—ä»åº“å’Œä¸»åº“çš„æ•°æ®ä¿æŒåŒæ­¥</p><p>MySQL æ”¯æŒä¸€å°ä¸»åº“åŒæ—¶å‘å¤šå°ä»åº“è¿›è¡Œå¤åˆ¶ï¼Œä»åº“åŒæ—¶ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–ä»æœåŠ¡å™¨çš„ä¸»åº“ï¼Œå®ç°é“¾çŠ¶å¤åˆ¶</p><p>MySQL å¤åˆ¶çš„ä¼˜ç‚¹ä¸»è¦åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p><ul><li><p>ä¸»åº“å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢åˆ°ä»åº“æä¾›æœåŠ¡</p></li><li><p>å¯ä»¥åœ¨ä»åº“ä¸Šæ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œä»ä¸»åº“ä¸­æ›´æ–°ï¼Œå®ç°è¯»å†™åˆ†ç¦»</p></li><li><p>å¯ä»¥åœ¨ä»åº“ä¸­æ‰§è¡Œå¤‡ä»½ï¼Œä»¥é¿å…å¤‡ä»½æœŸé—´å½±å“ä¸»åº“çš„æœåŠ¡ï¼ˆå¤‡ä»½æ—¶ä¼šåŠ å…¨å±€è¯»é”ï¼‰</p></li></ul><hr><h3 id="ä¸»ä»å¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»å¤åˆ¶" aria-hidden="true">#</a> ä¸»ä»å¤åˆ¶</h3><h4 id="ä¸»ä»ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»ç»“æ„" aria-hidden="true">#</a> ä¸»ä»ç»“æ„</h4><p>MySQL çš„ä¸»ä»ä¹‹é—´ç»´æŒäº†ä¸€ä¸ª<strong>é•¿è¿æ¥</strong>ã€‚ä¸»åº“å†…éƒ¨æœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸“é—¨ç”¨äºæœåŠ¡ä»åº“çš„é•¿è¿æ¥ï¼Œè¿æ¥è¿‡ç¨‹ï¼š</p><ul><li>ä»åº“æ‰§è¡Œ change master å‘½ä»¤ï¼Œè®¾ç½®ä¸»åº“çš„ IPã€ç«¯å£ã€ç”¨æˆ·åã€å¯†ç ä»¥åŠè¦ä»å“ªä¸ªä½ç½®å¼€å§‹è¯·æ±‚ binlogï¼Œè¿™ä¸ªä½ç½®åŒ…å«æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡</li><li>ä»åº“æ‰§è¡Œ start slave å‘½ä»¤ï¼Œè¿™æ—¶ä»åº“ä¼šå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œå°±æ˜¯å›¾ä¸­çš„ io_thread å’Œ sql_threadï¼Œå…¶ä¸­ io_thread è´Ÿè´£ä¸ä¸»åº“å»ºç«‹è¿æ¥</li><li>ä¸»åº“æ ¡éªŒå®Œç”¨æˆ·åã€å¯†ç åï¼Œå¼€å§‹æŒ‰ç…§ä»ä¼ è¿‡æ¥çš„ä½ç½®ï¼Œä»æœ¬åœ°è¯»å– binlog å‘ç»™ä»åº“ï¼Œå¼€å§‹ä¸»ä»å¤åˆ¶</li></ul><p>ä¸»ä»å¤åˆ¶åŸç†å›¾ï¼š</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¸»ä»å¤åˆ¶åŸç†å›¾.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä¸»ä»å¤åˆ¶ä¸»è¦ä¾èµ–çš„æ˜¯ binlogï¼ŒMySQL é»˜è®¤æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Œéœ€è¦ä¸‰ä¸ªçº¿ç¨‹ï¼š</p><ul><li>binlog threadï¼šåœ¨ä¸»åº“äº‹åŠ¡æäº¤æ—¶ï¼ŒæŠŠæ•°æ®å˜æ›´è®°å½•åœ¨æ—¥å¿—æ–‡ä»¶ binlog ä¸­ï¼Œå¹¶é€šçŸ¥ slave æœ‰æ•°æ®æ›´æ–°</li><li>I/O threadï¼šè´Ÿè´£ä»ä¸»æœåŠ¡å™¨ä¸Š<strong>æ‹‰å–äºŒè¿›åˆ¶æ—¥å¿—</strong>ï¼Œå¹¶å°† binlog æ—¥å¿—å†…å®¹ä¾æ¬¡å†™åˆ° relay log ä¸­è½¬æ—¥å¿—çš„æœ€æœ«ç«¯ï¼Œå¹¶å°†æ–°çš„ binlog æ–‡ä»¶åå’Œ offset è®°å½•åˆ° master-info æ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿ä¸‹ä¸€æ¬¡è¯»å–æ—¥å¿—æ—¶ä»æŒ‡å®š binlog æ—¥å¿—æ–‡ä»¶åŠä½ç½®å¼€å§‹è¯»å–æ–°çš„ binlog æ—¥å¿—å†…å®¹</li><li>SQL threadï¼šç›‘æµ‹æœ¬åœ° relay log ä¸­æ–°å¢äº†æ—¥å¿—å†…å®¹ï¼Œè¯»å–ä¸­ç»§æ—¥å¿—å¹¶é‡åšå…¶ä¸­çš„ SQL è¯­å¥ï¼Œä»åº“åœ¨ <a href="http://relay-log.info" target="_blank" rel="noopener noreferrer">relay-log.info<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¸­è®°å½•å½“å‰åº”ç”¨ä¸­ç»§æ—¥å¿—çš„æ–‡ä»¶åå’Œä½ç‚¹ä»¥ä¾¿ä¸‹ä¸€æ¬¡æ‰§è¡Œ</li></ul><p>åŒæ­¥ä¸å¼‚æ­¥ï¼š</p><ul><li>å¼‚æ­¥å¤åˆ¶æœ‰æ•°æ®ä¸¢å¤±é£é™©ï¼Œä¾‹å¦‚æ•°æ®è¿˜æœªåŒæ­¥åˆ°ä»åº“ï¼Œä¸»åº“å°±ç»™å®¢æˆ·ç«¯å“åº”ï¼Œç„¶åä¸»åº“æŒ‚äº†ï¼Œæ­¤æ—¶ä»åº“æ™‹å‡ä¸ºä¸»åº“çš„è¯æ•°æ®æ˜¯ç¼ºå¤±çš„</li><li>åŒæ­¥å¤åˆ¶ï¼Œä¸»åº“éœ€è¦å°† binlog å¤åˆ¶åˆ°æ‰€æœ‰ä»åº“ï¼Œç­‰æ‰€æœ‰ä»åº“å“åº”äº†ä¹‹åä¸»åº“æ‰è¿›è¡Œå…¶ä»–é€»è¾‘ï¼Œè¿™æ ·çš„è¯æ€§èƒ½å¾ˆå·®ï¼Œä¸€èˆ¬ä¸ä¼šé€‰æ‹©</li><li>MySQL 5.7 ä¹‹åå‡ºç°äº†åŠåŒæ­¥å¤åˆ¶ï¼Œæœ‰å‚æ•°å¯ä»¥é€‰æ‹©æˆåŠŸåŒæ­¥å‡ ä¸ªä»åº“å°±è¿”å›å“åº”</li></ul><hr><h4 id="ä¸»ä¸»ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ä¸»ä¸»ç»“æ„" aria-hidden="true">#</a> ä¸»ä¸»ç»“æ„</h4><p>ä¸»ä¸»ç»“æ„å°±æ˜¯ä¸¤ä¸ªæ•°æ®åº“ä¹‹é—´æ€»æ˜¯äº’ä¸ºä¸»ä»å…³ç³»ï¼Œè¿™æ ·åœ¨åˆ‡æ¢çš„æ—¶å€™å°±ä¸ç”¨å†ä¿®æ”¹ä¸»ä»å…³ç³»</p><p>å¾ªç¯å¤åˆ¶ï¼šåœ¨åº“ A ä¸Šæ›´æ–°äº†ä¸€æ¡è¯­å¥ï¼Œç„¶åæŠŠç”Ÿæˆçš„ binlog å‘ç»™åº“ Bï¼Œåº“ B æ‰§è¡Œå®Œè¿™æ¡æ›´æ–°è¯­å¥åä¹Ÿä¼šç”Ÿæˆ binlogï¼Œä¼šå†å‘ç»™ A</p><p>è§£å†³æ–¹æ³•ï¼š</p><ul><li>ä¸¤ä¸ªåº“çš„ server id å¿…é¡»ä¸åŒï¼Œå¦‚æœç›¸åŒåˆ™å®ƒä»¬ä¹‹é—´ä¸èƒ½è®¾å®šä¸ºä¸»ä¸»å…³ç³»</li><li>ä¸€ä¸ªåº“æ¥åˆ° binlog å¹¶åœ¨é‡æ”¾çš„è¿‡ç¨‹ä¸­ï¼Œç”Ÿæˆä¸åŸ binlog çš„ server id ç›¸åŒçš„æ–°çš„ binlog</li><li>æ¯ä¸ªåº“åœ¨æ”¶åˆ°ä»ä¸»åº“å‘è¿‡æ¥çš„æ—¥å¿—åï¼Œå…ˆåˆ¤æ–­ server idï¼Œå¦‚æœè·Ÿè‡ªå·±çš„ç›¸åŒï¼Œè¡¨ç¤ºè¿™ä¸ªæ—¥å¿—æ˜¯è‡ªå·±ç”Ÿæˆçš„ï¼Œå°±ç›´æ¥ä¸¢å¼ƒè¿™ä¸ªæ—¥å¿—</li></ul><hr><h3 id="ä¸»ä»å»¶è¿Ÿ" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»å»¶è¿Ÿ" aria-hidden="true">#</a> ä¸»ä»å»¶è¿Ÿ</h3><h4 id="å»¶è¿ŸåŸå› " tabindex="-1"><a class="header-anchor" href="#å»¶è¿ŸåŸå› " aria-hidden="true">#</a> å»¶è¿ŸåŸå› </h4><p>æ­£å¸¸æƒ…å†µä¸»åº“æ‰§è¡Œæ›´æ–°ç”Ÿæˆçš„æ‰€æœ‰ binlogï¼Œéƒ½å¯ä»¥ä¼ åˆ°ä»åº“å¹¶è¢«æ­£ç¡®åœ°æ‰§è¡Œï¼Œä»åº“å°±èƒ½è¾¾åˆ°è·Ÿä¸»åº“ä¸€è‡´çš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯æœ€ç»ˆä¸€è‡´æ€§</p><p>ä¸»ä»å»¶è¿Ÿæ˜¯ä¸»ä»ä¹‹é—´æ˜¯å­˜åœ¨ä¸€å®šæ—¶é—´çš„æ•°æ®ä¸ä¸€è‡´ï¼Œå°±æ˜¯åŒä¸€ä¸ªäº‹åŠ¡åœ¨ä»åº“æ‰§è¡Œå®Œæˆçš„æ—¶é—´å’Œä¸»åº“æ‰§è¡Œå®Œæˆçš„æ—¶é—´çš„å·®å€¼ï¼Œå³ T2-T1</p><ul><li>ä¸»åº“ A æ‰§è¡Œå®Œæˆä¸€ä¸ªäº‹åŠ¡ï¼Œå†™å…¥ binlogï¼Œè¯¥æ—¶åˆ»è®°ä¸º T1</li><li>æ—¥å¿—ä¼ ç»™ä»åº“ Bï¼Œä»åº“ B æ‰§è¡Œå®Œè¿™ä¸ªäº‹åŠ¡ï¼Œè¯¥æ—¶åˆ»è®°ä¸º T2</li></ul><p>é€šè¿‡åœ¨ä»åº“æ‰§è¡Œ <code>show slave status</code> å‘½ä»¤ï¼Œè¿”å›ç»“æœä¼šæ˜¾ç¤º seconds_behind_master è¡¨ç¤ºå½“å‰ä»åº“å»¶è¿Ÿäº†å¤šå°‘ç§’</p><ul><li>æ¯ä¸€ä¸ªäº‹åŠ¡çš„ binlog éƒ½æœ‰ä¸€ä¸ªæ—¶é—´å­—æ®µï¼Œç”¨äºè®°å½•ä¸»åº“ä¸Šå†™å…¥çš„æ—¶é—´</li><li>ä»åº“å–å‡ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„äº‹åŠ¡çš„æ—¶é—´å­—æ®µï¼Œè·Ÿç³»ç»Ÿçš„æ—¶é—´è¿›è¡Œç›¸å‡ï¼Œå¾—åˆ°çš„å°±æ˜¯ seconds_behind_master</li></ul><p>ä¸»ä»å»¶è¿Ÿçš„åŸå› ï¼š</p><ul><li>ä»åº“çš„æœºå™¨æ€§èƒ½æ¯”ä¸»åº“çš„å·®ï¼Œå¯¼è‡´ä»åº“çš„å¤åˆ¶èƒ½åŠ›å¼±</li><li>ä»åº“çš„æŸ¥è¯¢å‹åŠ›å¤§ï¼Œå»ºç«‹ä¸€ä¸»å¤šä»çš„ç»“æ„</li><li>å¤§äº‹åŠ¡çš„æ‰§è¡Œï¼Œä¸»åº“å¿…é¡»è¦ç­‰åˆ°äº‹åŠ¡å®Œæˆä¹‹åæ‰ä¼šå†™å…¥ binlogï¼Œå¯¼è‡´ä»èŠ‚ç‚¹å‡ºç°åº”ç”¨ binlog å»¶è¿Ÿ</li><li>ä¸»åº“çš„ DDLï¼Œä»åº“ä¸ä¸»åº“çš„ DDL åŒæ­¥æ˜¯ä¸²è¡Œè¿›è¡Œï¼ŒDDL åœ¨ä¸»åº“æ‰§è¡Œæ—¶é—´å¾ˆé•¿ï¼Œé‚£ä¹ˆä»åº“ä¹Ÿä¼šæ¶ˆè€—åŒæ ·çš„æ—¶é—´</li><li>é”å†²çªé—®é¢˜ä¹Ÿå¯èƒ½å¯¼è‡´ä»èŠ‚ç‚¹çš„ SQL çº¿ç¨‹æ‰§è¡Œæ…¢</li></ul><p>ä¸»ä»åŒæ­¥é—®é¢˜æ°¸è¿œéƒ½æ˜¯<strong>ä¸€è‡´æ€§å’Œæ€§èƒ½çš„æƒè¡¡</strong>ï¼Œéœ€è¦æ ¹æ®å®é™…çš„åº”ç”¨åœºæ™¯ï¼Œå¯ä»¥é‡‡å–ä¸‹é¢çš„åŠæ³•ï¼š</p><ul><li><p>ä¼˜åŒ– SQLï¼Œé¿å…æ…¢ SQLï¼Œå‡å°‘æ‰¹é‡æ“ä½œ</p></li><li><p>é™ä½å¤šçº¿ç¨‹å¤§äº‹åŠ¡å¹¶å‘çš„æ¦‚ç‡ï¼Œä¼˜åŒ–ä¸šåŠ¡é€»è¾‘</p></li><li><p>ä¸šåŠ¡ä¸­å¤§å¤šæ•°æƒ…å†µæŸ¥è¯¢æ“ä½œè¦æ¯”æ›´æ–°æ“ä½œæ›´å¤šï¼Œæ­å»º<strong>ä¸€ä¸»å¤šä»</strong>ç»“æ„ï¼Œè®©è¿™äº›ä»åº“æ¥åˆ†æ‹…è¯»çš„å‹åŠ›</p></li><li><p>å°½é‡é‡‡ç”¨çŸ­çš„é“¾è·¯ï¼Œä¸»åº“å’Œä»åº“æœåŠ¡å™¨çš„è·ç¦»å°½é‡è¦çŸ­ï¼Œæå‡ç«¯å£å¸¦å®½ï¼Œå‡å°‘ binlog ä¼ è¾“çš„ç½‘ç»œå»¶æ—¶</p></li><li><p>å®æ—¶æ€§è¦æ±‚é«˜çš„ä¸šåŠ¡è¯»å¼ºåˆ¶èµ°ä¸»åº“ï¼Œä»åº“åªåšå¤‡ä»½</p></li></ul><hr><h4 id="å¹¶è¡Œå¤åˆ¶" tabindex="-1"><a class="header-anchor" href="#å¹¶è¡Œå¤åˆ¶" aria-hidden="true">#</a> å¹¶è¡Œå¤åˆ¶</h4><h5 id="mysql5-6" tabindex="-1"><a class="header-anchor" href="#mysql5-6" aria-hidden="true">#</a> MySQL5.6</h5><p>é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œä¸»åº“çš„ä¼šäº§ç”Ÿå¤§é‡çš„ binlogï¼Œåœ¨ä»åº“ä¸­æœ‰ä¸¤ä¸ªçº¿ç¨‹ IO Thread å’Œ SQL Thread å•çº¿ç¨‹æ‰§è¡Œï¼Œä¼šå¯¼è‡´ä¸»åº“å»¶è¿Ÿå˜å¤§ã€‚ä¸ºäº†æ”¹å–„å¤åˆ¶å»¶è¿Ÿé—®é¢˜ï¼ŒMySQL 5.6 ç‰ˆæœ¬å¢åŠ äº†å¹¶è¡Œå¤åˆ¶åŠŸèƒ½ï¼Œä»¥é‡‡ç”¨å¤šçº¿ç¨‹æœºåˆ¶æ¥ä¿ƒè¿›æ‰§è¡Œ</p><p>coordinator å°±æ˜¯åŸæ¥çš„ SQL Threadï¼Œå¹¶è¡Œå¤åˆ¶ä¸­å®ƒä¸å†ç›´æ¥æ›´æ–°æ•°æ®ï¼Œ<strong>åªè´Ÿè´£è¯»å–ä¸­è½¬æ—¥å¿—å’Œåˆ†å‘äº‹åŠ¡</strong>ï¼š</p><ul><li>çº¿ç¨‹åˆ†é…å®Œæˆå¹¶ä¸æ˜¯ç«‹å³æ‰§è¡Œï¼Œä¸ºäº†é˜²æ­¢é€ æˆæ›´æ–°è¦†ç›–ï¼Œæ›´æ–°åŒä¸€ DB çš„ä¸¤ä¸ªäº‹åŠ¡å¿…é¡»è¢«åˆ†å‘åˆ°åŒä¸€ä¸ªå·¥ä½œçº¿ç¨‹</li><li>åŒä¸€ä¸ªäº‹åŠ¡ä¸èƒ½è¢«æ‹†å¼€ï¼Œå¿…é¡»æ”¾åˆ°åŒä¸€ä¸ªå·¥ä½œçº¿ç¨‹</li></ul><p>MySQL 5.6 ç‰ˆæœ¬çš„ç­–ç•¥ï¼šæ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ª hash è¡¨ï¼Œç”¨äºä¿å­˜å½“å‰è¿™ä¸ªçº¿ç¨‹çš„æ‰§è¡Œé˜Ÿåˆ—é‡Œçš„äº‹åŠ¡æ‰€æ¶‰åŠçš„è¡¨ï¼Œhash è¡¨çš„ key æ˜¯æ•°æ®åº“åï¼Œvalue æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºé˜Ÿåˆ—ä¸­æœ‰å¤šå°‘ä¸ªäº‹åŠ¡ä¿®æ”¹è¿™ä¸ªåº“ï¼Œé€‚ç”¨äºä¸»åº“ä¸Šæœ‰å¤šä¸ª DB çš„æƒ…å†µ</p><p>æ¯ä¸ªäº‹åŠ¡åœ¨åˆ†å‘çš„æ—¶å€™ï¼Œè·Ÿçº¿ç¨‹çš„<strong>å†²çª</strong>ï¼ˆäº‹åŠ¡æ“ä½œçš„æ˜¯åŒä¸€ä¸ªåº“ï¼‰å…³ç³»åŒ…æ‹¬ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœè·Ÿæ‰€æœ‰çº¿ç¨‹éƒ½ä¸å†²çªï¼Œcoordinator çº¿ç¨‹å°±ä¼šæŠŠè¿™ä¸ªäº‹åŠ¡åˆ†é…ç»™æœ€ç©ºé—²çš„çº¿ç¨‹</li><li>å¦‚æœåªè·Ÿä¸€ä¸ªçº¿ç¨‹å†²çªï¼Œcoordinator çº¿ç¨‹å°±ä¼šæŠŠè¿™ä¸ªäº‹åŠ¡åˆ†é…ç»™è¿™ä¸ªå­˜åœ¨å†²çªå…³ç³»çš„çº¿ç¨‹</li><li>å¦‚æœè·Ÿå¤šäºä¸€ä¸ªçº¿ç¨‹å†²çªï¼Œcoordinator çº¿ç¨‹å°±è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å’Œè¿™ä¸ªäº‹åŠ¡å­˜åœ¨å†²çªå…³ç³»çš„çº¿ç¨‹åªå‰©ä¸‹ 1 ä¸ª</li></ul><p>ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>æ„é€  hash å€¼çš„æ—¶å€™å¾ˆå¿«ï¼Œåªéœ€è¦åº“åï¼Œè€Œä¸”ä¸€ä¸ªå®ä¾‹ä¸Š DB æ•°ä¹Ÿä¸ä¼šå¾ˆå¤šï¼Œä¸ä¼šå‡ºç°éœ€è¦æ„é€ å¾ˆå¤šé¡¹çš„æƒ…å†µ</li><li>ä¸è¦æ±‚ binlog çš„æ ¼å¼ï¼Œstatement æ ¼å¼çš„ binlog ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“æ‹¿åˆ°åº“åï¼ˆæ—¥å¿—ç« èŠ‚è¯¦è§£äº† binlogï¼‰</li><li>ä¸»åº“ä¸Šçš„è¡¨éƒ½æ”¾åœ¨åŒä¸€ä¸ª DB é‡Œé¢ï¼Œè¿™ä¸ªç­–ç•¥å°±æ²¡æœ‰æ•ˆæœäº†ï¼›æˆ–è€…ä¸åŒ DB çš„çƒ­ç‚¹ä¸åŒï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯ä¸šåŠ¡é€»è¾‘åº“ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿé…ç½®åº“ï¼Œé‚£ä¹Ÿèµ·ä¸åˆ°å¹¶è¡Œçš„æ•ˆæœï¼Œéœ€è¦<strong>æŠŠç›¸åŒçƒ­åº¦çš„è¡¨å‡åŒ€åˆ†åˆ°è¿™äº›ä¸åŒçš„ DB ä¸­</strong>ï¼Œæ‰å¯ä»¥ä½¿ç”¨è¿™ä¸ªç­–ç•¥</li></ul><hr><h5 id="mysql5-7" tabindex="-1"><a class="header-anchor" href="#mysql5-7" aria-hidden="true">#</a> MySQL5.7</h5><p>MySQL 5.7 ç”±å‚æ•° slave-parallel-type æ¥æ§åˆ¶å¹¶è¡Œå¤åˆ¶ç­–ç•¥ï¼š</p><ul><li>é…ç½®ä¸º DATABASEï¼Œè¡¨ç¤ºä½¿ç”¨ MySQL 5.6 ç‰ˆæœ¬çš„<strong>æŒ‰åº“ï¼ˆDBï¼‰å¹¶è¡Œç­–ç•¥</strong></li><li>é…ç½®ä¸º LOGICAL_CLOCKï¼Œè¡¨ç¤ºçš„<strong>æŒ‰æäº¤çŠ¶æ€å¹¶è¡Œ</strong>æ‰§è¡Œ</li></ul><p>æŒ‰æäº¤çŠ¶æ€å¹¶è¡Œå¤åˆ¶ç­–ç•¥çš„æ€æƒ³æ˜¯ï¼š</p><ul><li>æ‰€æœ‰å¤„äº commit çŠ¶æ€çš„äº‹åŠ¡å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼›åŒæ—¶å¤„äº prepare çŠ¶æ€çš„äº‹åŠ¡ï¼Œåœ¨ä»åº“æ‰§è¡Œæ—¶æ˜¯å¯ä»¥å¹¶è¡Œçš„</li><li>å¤„äº prepare çŠ¶æ€çš„äº‹åŠ¡ï¼Œä¸å¤„äº commit çŠ¶æ€çš„äº‹åŠ¡ä¹‹é—´ï¼Œåœ¨ä»åº“æ‰§è¡Œæ—¶ä¹Ÿæ˜¯å¯ä»¥å¹¶è¡Œçš„</li></ul><p>MySQL 5.7.22 ç‰ˆæœ¬é‡Œï¼ŒMySQL å¢åŠ äº†ä¸€ä¸ªæ–°çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ï¼ŒåŸºäº WRITESET çš„å¹¶è¡Œå¤åˆ¶ï¼Œæ–°å¢äº†ä¸€ä¸ªå‚æ•° binlog-transaction-dependency-trackingï¼Œç”¨æ¥æ§åˆ¶æ˜¯å¦å¯ç”¨è¿™ä¸ªæ–°ç­–ç•¥ï¼š</p><ul><li><p>COMMIT_ORDERï¼šè¡¨ç¤ºæ ¹æ®åŒæ—¶è¿›å…¥ prepare å’Œ commit æ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥å¹¶è¡Œçš„ç­–ç•¥</p></li><li><p>WRITESETï¼šè¡¨ç¤ºçš„æ˜¯å¯¹äºæ¯ä¸ªäº‹åŠ¡æ¶‰åŠæ›´æ–°çš„æ¯ä¸€è¡Œï¼Œè®¡ç®—å‡ºè¿™ä¸€è¡Œçš„ hash å€¼ï¼Œç»„æˆè¯¥äº‹åŠ¡çš„ writeset é›†åˆï¼Œå¦‚æœä¸¤ä¸ªäº‹åŠ¡æ²¡æœ‰æ“ä½œç›¸åŒçš„è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬çš„ writeset æ²¡æœ‰äº¤é›†ï¼Œå°±å¯ä»¥å¹¶è¡Œï¼ˆ<strong>æŒ‰è¡Œå¹¶è¡Œ</strong>ï¼‰</p><p>ä¸ºäº†å”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ª hash è¡¨çš„å€¼æ˜¯é€šè¿‡ <code>åº“å + è¡¨å + ç´¢å¼•å + å€¼</code>ï¼ˆè¡¨ç¤ºçš„æ˜¯æŸä¸€è¡Œï¼‰è®¡ç®—å‡ºæ¥çš„</p></li><li><p>WRITESET_SESSIONï¼šæ˜¯åœ¨ WRITESET çš„åŸºç¡€ä¸Šå¤šäº†ä¸€ä¸ªçº¦æŸï¼Œå³åœ¨ä¸»åº“ä¸ŠåŒä¸€ä¸ªçº¿ç¨‹å…ˆåæ‰§è¡Œçš„ä¸¤ä¸ªäº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦ä¿è¯ç›¸åŒçš„å…ˆåé¡ºåº</p></li></ul><p>MySQL 5.7.22 æŒ‰è¡Œå¹¶å‘çš„ä¼˜åŠ¿ï¼š</p><ul><li>writeset æ˜¯åœ¨ä¸»åº“ç”Ÿæˆåç›´æ¥å†™å…¥åˆ° binlog é‡Œé¢çš„ï¼Œè¿™æ ·åœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸éœ€è¦è§£æ binlog å†…å®¹ï¼ŒèŠ‚çœäº†è®¡ç®—é‡</li><li>ä¸éœ€è¦æŠŠæ•´ä¸ªäº‹åŠ¡çš„ binlog éƒ½æ‰«ä¸€éæ‰èƒ½å†³å®šåˆ†å‘åˆ°å“ªä¸ªçº¿ç¨‹ï¼Œæ›´çœå†…å­˜</li><li>ä»åº“çš„åˆ†å‘ç­–ç•¥ä¸ä¾èµ–äº binlog å†…å®¹ï¼Œæ‰€ä»¥ binlog æ˜¯ statement æ ¼å¼ä¹Ÿå¯ä»¥ï¼Œæ›´èŠ‚çº¦å†…å­˜ï¼ˆå› ä¸º row æ‰è®°å½•æ›´æ”¹çš„è¡Œï¼‰</li></ul><p>MySQL 5.7.22 çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥åœ¨é€šç”¨æ€§ä¸Šæ˜¯æœ‰ä¿è¯çš„ï¼Œä½†æ˜¯å¯¹äºè¡¨ä¸Šæ²¡ä¸»é”®ã€å”¯ä¸€å’Œå¤–é”®çº¦æŸçš„åœºæ™¯ï¼ŒWRITESET ç­–ç•¥ä¹Ÿæ˜¯æ²¡æ³•å¹¶è¡Œçš„ï¼Œä¹Ÿä¼šæš‚æ—¶é€€åŒ–ä¸ºå•çº¿ç¨‹æ¨¡å‹</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://time.geekbang.org/column/article/77083" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/77083<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h3 id="è¯»å†™åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#è¯»å†™åˆ†ç¦»" aria-hidden="true">#</a> è¯»å†™åˆ†ç¦»</h3><h4 id="è¯»å†™å»¶è¿Ÿ" tabindex="-1"><a class="header-anchor" href="#è¯»å†™å»¶è¿Ÿ" aria-hidden="true">#</a> è¯»å†™å»¶è¿Ÿ</h4><p>è¯»å†™åˆ†ç¦»ï¼šå¯ä»¥é™ä½ä¸»åº“çš„è®¿é—®å‹åŠ›ï¼Œæé«˜ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›</p><ul><li>ä¸»åº“ä¸å»ºæŸ¥è¯¢çš„ç´¢å¼•ï¼Œä»åº“å»ºæŸ¥è¯¢çš„ç´¢å¼•ã€‚å› ä¸ºç´¢å¼•éœ€è¦ç»´æŠ¤çš„ï¼Œæ¯”å¦‚æ’å…¥ä¸€æ¡æ•°æ®ï¼Œä¸ä»…è¦åœ¨èšç°‡ç´¢å¼•ä¸Šé¢æ’å…¥ï¼Œå¯¹åº”çš„äºŒçº§ç´¢å¼•ä¹Ÿå¾—æ’å…¥</li><li>å°†è¯»æ“ä½œåˆ†åˆ°ä»åº“äº†ä¹‹åï¼Œå¯ä»¥åœ¨ä¸»åº“æŠŠæŸ¥è¯¢è¦ç”¨çš„ç´¢å¼•åˆ äº†ï¼Œå‡å°‘å†™æ“ä½œå¯¹ä¸»åº“çš„å½±å“</li></ul><p>è¯»å†™åˆ†ç¦»äº§ç”Ÿäº†è¯»å†™å»¶è¿Ÿï¼Œé€ æˆæ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚å‡å¦‚å®¢æˆ·ç«¯æ‰§è¡Œå®Œä¸€ä¸ªæ›´æ–°äº‹åŠ¡åé©¬ä¸Šå‘èµ·æŸ¥è¯¢ï¼Œå¦‚æœæŸ¥è¯¢é€‰æ‹©çš„æ˜¯ä»åº“çš„è¯ï¼Œå¯èƒ½è¯»åˆ°çš„è¿˜æ˜¯ä»¥å‰çš„æ•°æ®ï¼Œå«è¿‡æœŸè¯»</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>å¼ºåˆ¶å°†å†™ä¹‹å<strong>ç«‹åˆ»è¯»çš„æ“ä½œè½¬ç§»åˆ°ä¸»åº“</strong>ï¼Œæ¯”å¦‚åˆšæ³¨å†Œçš„ç”¨æˆ·ï¼Œç›´æ¥ç™»å½•ä»åº“æŸ¥è¯¢å¯èƒ½æŸ¥è¯¢ä¸åˆ°ï¼Œå…ˆèµ°ä¸»åº“ç™»å½•</li><li><strong>äºŒæ¬¡æŸ¥è¯¢</strong>ï¼Œå¦‚æœä»åº“æŸ¥ä¸åˆ°æ•°æ®ï¼Œåˆ™å†å»ä¸»åº“æŸ¥ä¸€éï¼Œç”± API å°è£…ï¼Œæ¯”è¾ƒç®€å•ï¼Œä½†å¯¼è‡´ä¸»åº“å‹åŠ›å¤§</li><li>æ›´æ–°ä¸»åº“åï¼Œè¯»ä»åº“ä¹‹å‰å…ˆ sleep ä¸€ä¸‹ï¼Œç±»ä¼¼äºæ‰§è¡Œä¸€æ¡ <code>select sleep(1)</code> å‘½ä»¤ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¸»å¤‡å»¶è¿Ÿåœ¨ 1 ç§’ä¹‹å†…</li></ul><hr><h4 id="ç¡®ä¿æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#ç¡®ä¿æœºåˆ¶" aria-hidden="true">#</a> ç¡®ä¿æœºåˆ¶</h4><h5 id="æ— å»¶è¿Ÿ" tabindex="-1"><a class="header-anchor" href="#æ— å»¶è¿Ÿ" aria-hidden="true">#</a> æ— å»¶è¿Ÿ</h5><p>ç¡®ä¿ä¸»å¤‡æ— å»¶è¿Ÿçš„æ–¹æ³•ï¼š</p><ul><li>æ¯æ¬¡ä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚å‰ï¼Œå…ˆåˆ¤æ–­ seconds_behind_master æ˜¯å¦å·²ç»ç­‰äº 0ï¼Œå¦‚æœä¸ç­‰äºé‚£å°±ç­‰åˆ°å‚æ•°å˜ä¸º 0 æ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚</li><li>å¯¹æ¯”ä½ç‚¹ï¼ŒMaster_Log_File å’Œ Read_Master_Log_Pos è¡¨ç¤ºçš„æ˜¯è¯»åˆ°çš„ä¸»åº“çš„æœ€æ–°ä½ç‚¹ï¼ŒRelay_Master_Log_File å’Œ Exec_Master_Log_Pos è¡¨ç¤ºçš„æ˜¯å¤‡åº“æ‰§è¡Œçš„æœ€æ–°ä½ç‚¹ï¼Œè¿™ä¸¤ç»„å€¼å®Œå…¨ç›¸åŒå°±è¯´æ˜æ¥æ”¶åˆ°çš„æ—¥å¿—å·²ç»åŒæ­¥å®Œæˆ</li><li>å¯¹æ¯” GTID é›†åˆï¼ŒRetrieved_Gtid_Set æ˜¯å¤‡åº“æ”¶åˆ°çš„æ‰€æœ‰æ—¥å¿—çš„ GTID é›†åˆï¼ŒExecuted_Gtid_Set æ˜¯å¤‡åº“æ‰€æœ‰å·²ç»æ‰§è¡Œå®Œæˆçš„ GTID é›†åˆï¼Œå¦‚æœè¿™ä¸¤ä¸ªé›†åˆç›¸åŒä¹Ÿè¡¨ç¤ºå¤‡åº“æ¥æ”¶åˆ°çš„æ—¥å¿—éƒ½å·²ç»åŒæ­¥å®Œæˆ</li></ul><hr><h5 id="åŠåŒæ­¥" tabindex="-1"><a class="header-anchor" href="#åŠåŒæ­¥" aria-hidden="true">#</a> åŠåŒæ­¥</h5><p>åŠåŒæ­¥å¤åˆ¶å°±æ˜¯ semi-sync replicationï¼Œé€‚ç”¨äºä¸€ä¸»ä¸€å¤‡çš„åœºæ™¯ï¼Œå·¥ä½œæµç¨‹ï¼š</p><ul><li>äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œä¸»åº“æŠŠ binlog å‘ç»™ä»åº“</li><li>ä»åº“æ”¶åˆ° binlog ä»¥åï¼Œå‘å›ç»™ä¸»åº“ä¸€ä¸ª ackï¼Œè¡¨ç¤ºæ”¶åˆ°äº†</li><li>ä¸»åº“æ”¶åˆ°è¿™ä¸ª ack ä»¥åï¼Œæ‰èƒ½ç»™å®¢æˆ·ç«¯è¿”å›äº‹åŠ¡å®Œæˆçš„ç¡®è®¤</li></ul><p>åœ¨ä¸€ä¸»å¤šä»åœºæ™¯ä¸­ï¼Œä¸»åº“åªè¦ç­‰åˆ°ä¸€ä¸ªä»åº“çš„ ackï¼Œå°±å¼€å§‹ç»™å®¢æˆ·ç«¯è¿”å›ç¡®è®¤ï¼Œè¿™æ—¶åœ¨ä»åº“ä¸Šæ‰§è¡ŒæŸ¥è¯¢è¯·æ±‚ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœæŸ¥è¯¢æ˜¯è½åœ¨è¿™ä¸ªå“åº”äº† ack çš„ä»åº“ä¸Šï¼Œæ˜¯èƒ½å¤Ÿç¡®ä¿è¯»åˆ°æœ€æ–°æ•°æ®</li><li>å¦‚æœæŸ¥è¯¢è½åˆ°å…¶ä»–ä»åº“ä¸Šï¼Œå®ƒä»¬å¯èƒ½è¿˜æ²¡æœ‰æ”¶åˆ°æœ€æ–°çš„æ—¥å¿—ï¼Œå°±ä¼šäº§ç”Ÿè¿‡æœŸè¯»çš„é—®é¢˜</li></ul><p>åœ¨ä¸šåŠ¡æ›´æ–°çš„é«˜å³°æœŸï¼Œä¸»åº“çš„ä½ç‚¹æˆ–è€… GTID é›†åˆæ›´æ–°å¾ˆå¿«ï¼Œå¯¼è‡´ä»åº“æ¥ä¸åŠå¤„ç†ï¼Œé‚£ä¹ˆä¸¤ä¸ªä½ç‚¹ç­‰å€¼åˆ¤æ–­å°±ä¼šä¸€ç›´ä¸æˆç«‹ï¼Œå¾ˆå¯èƒ½å‡ºç°ä»åº“ä¸Šè¿Ÿè¿Ÿæ— æ³•å“åº”æŸ¥è¯¢è¯·æ±‚çš„æƒ…å†µ</p><hr><h5 id="ç­‰ä½ç‚¹" tabindex="-1"><a class="header-anchor" href="#ç­‰ä½ç‚¹" aria-hidden="true">#</a> ç­‰ä½ç‚¹</h5><p>åœ¨<strong>ä»åº“æ‰§è¡Œåˆ¤æ–­ä½ç‚¹</strong>çš„å‘½ä»¤ï¼Œå‚æ•° file å’Œ pos æŒ‡çš„æ˜¯ä¸»åº“ä¸Šçš„æ–‡ä»¶åå’Œä½ç½®ï¼Œtimeout å¯é€‰ï¼Œè®¾ç½®ä¸ºæ­£æ•´æ•° N è¡¨ç¤ºæœ€å¤šç­‰å¾… N ç§’</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT master_pos_wait(file, pos[, timeout]);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‘½ä»¤æ­£å¸¸è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªæ­£æ•´æ•° Mï¼Œè¡¨ç¤ºä»å‘½ä»¤å¼€å§‹æ‰§è¡Œï¼Œåˆ°åº”ç”¨å®Œ file å’Œ pos è¡¨ç¤ºçš„ binlog ä½ç½®ï¼Œæ‰§è¡Œäº†å¤šå°‘äº‹åŠ¡</p><ul><li>å¦‚æœæ‰§è¡ŒæœŸé—´ï¼Œå¤‡åº“åŒæ­¥çº¿ç¨‹å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™è¿”å› NULL</li><li>å¦‚æœç­‰å¾…è¶…è¿‡ N ç§’ï¼Œå°±è¿”å› -1</li><li>å¦‚æœåˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±å‘ç°å·²ç»æ‰§è¡Œè¿‡è¿™ä¸ªä½ç½®äº†ï¼Œåˆ™è¿”å› 0</li></ul><p>å·¥ä½œæµç¨‹ï¼šå…ˆæ‰§è¡Œ trx1ï¼Œå†æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚çš„é€»è¾‘ï¼Œè¦<strong>ä¿è¯èƒ½å¤ŸæŸ¥åˆ°æ­£ç¡®çš„æ•°æ®</strong></p><ul><li>trx1 äº‹åŠ¡æ›´æ–°å®Œæˆåï¼Œé©¬ä¸Šæ‰§è¡Œ <code>show master status</code> å¾—åˆ°å½“å‰ä¸»åº“æ‰§è¡Œåˆ°çš„ File å’Œ Position</li><li>é€‰å®šä¸€ä¸ªä»åº“æ‰§è¡Œåˆ¤æ–­ä½ç‚¹è¯­å¥ï¼Œå¦‚æœè¿”å›å€¼æ˜¯ &gt;=0 çš„æ­£æ•´æ•°ï¼Œè¯´æ˜ä»åº“å·²ç»åŒæ­¥å®Œäº‹åŠ¡ï¼Œå¯ä»¥åœ¨è¿™ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥</li><li>å¦‚æœå‡ºç°å…¶ä»–æƒ…å†µï¼Œéœ€è¦åˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥</li></ul><p>æ³¨æ„ï¼šå¦‚æœæ‰€æœ‰çš„ä»åº“éƒ½å»¶è¿Ÿè¶…è¿‡ timeout ç§’ï¼ŒæŸ¥è¯¢å‹åŠ›å°±éƒ½è·‘åˆ°ä¸»åº“ä¸Šï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œæƒè¡¡</p><hr><h5 id="ç­‰gtid" tabindex="-1"><a class="header-anchor" href="#ç­‰gtid" aria-hidden="true">#</a> ç­‰GTID</h5><p>æ•°æ®åº“å¼€å¯äº† GTID æ¨¡å¼ï¼ŒMySQL æä¾›äº†åˆ¤æ–­ GTID çš„å‘½ä»¤</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT wait_for_executed_gtid_set(gtid_set [, timeout])
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>ç­‰å¾…ç›´åˆ°è¿™ä¸ªåº“æ‰§è¡Œçš„äº‹åŠ¡ä¸­åŒ…å«ä¼ å…¥çš„ gtid_setï¼Œè¿”å› 0</li><li>è¶…æ—¶è¿”å› 1</li></ul><p>å·¥ä½œæµç¨‹ï¼šå…ˆæ‰§è¡Œ trx1ï¼Œå†æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚çš„é€»è¾‘ï¼Œè¦ä¿è¯èƒ½å¤ŸæŸ¥åˆ°æ­£ç¡®çš„æ•°æ®</p><ul><li>trx1 äº‹åŠ¡æ›´æ–°å®Œæˆåï¼Œä»è¿”å›åŒ…ç›´æ¥è·å–è¿™ä¸ªäº‹åŠ¡çš„ GTIDï¼Œè®°ä¸º gtid</li><li>é€‰å®šä¸€ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œå¦‚æœè¿”å›å€¼æ˜¯ 0ï¼Œåˆ™åœ¨è¿™ä¸ªä»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œå¦åˆ™åˆ°ä¸»åº“æ‰§è¡ŒæŸ¥è¯¢è¯­å¥</li></ul><p>å¯¹æ¯”ç­‰å¾…ä½ç‚¹æ–¹æ³•ï¼Œå‡å°‘äº†ä¸€æ¬¡ <code>show master status</code> çš„æ–¹æ³•ï¼Œå°†å‚æ•° session_track_gtids è®¾ç½®ä¸º OWN_GTIDï¼Œç„¶åé€šè¿‡ API æ¥å£ mysql_session_track_get_first ä»è¿”å›åŒ…è§£æå‡º GTID çš„å€¼å³å¯</p><p>æ€»ç»“ï¼šæ‰€æœ‰çš„ç­‰å¾…æ— å»¶è¿Ÿçš„æ–¹æ³•ï¼Œéƒ½éœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯å»åˆ¤æ–­å®æ–½</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://time.geekbang.org/column/article/77636" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/77636<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="è´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#è´Ÿè½½å‡è¡¡" aria-hidden="true">#</a> è´Ÿè½½å‡è¡¡</h4><p>è´Ÿè½½å‡è¡¡æ˜¯åº”ç”¨ä¸­ä½¿ç”¨éå¸¸æ™®éçš„ä¸€ç§ä¼˜åŒ–æ–¹æ³•ï¼Œæœºåˆ¶å°±æ˜¯åˆ©ç”¨æŸç§å‡è¡¡ç®—æ³•ï¼Œå°†å›ºå®šçš„è´Ÿè½½é‡åˆ†å¸ƒåˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä»¥æ­¤æ¥é™ä½å•å°æœåŠ¡å™¨çš„è´Ÿè½½ï¼Œè¾¾åˆ°ä¼˜åŒ–çš„æ•ˆæœ</p><ul><li><p>åˆ†æµæŸ¥è¯¢ï¼šé€šè¿‡ MySQL çš„ä¸»ä»å¤åˆ¶ï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼Œä½¿å¢åˆ æ”¹æ“ä½œèµ°ä¸»èŠ‚ç‚¹ï¼ŒæŸ¥è¯¢æ“ä½œèµ°ä»èŠ‚ç‚¹ï¼Œä»è€Œå¯ä»¥é™ä½å•å°æœåŠ¡å™¨çš„è¯»å†™å‹åŠ›</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-è´Ÿè½½å‡è¡¡ä¸»ä»å¤åˆ¶.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>åˆ†å¸ƒå¼æ•°æ®åº“æ¶æ„ï¼šé€‚åˆå¤§æ•°æ®é‡ã€è´Ÿè½½é«˜çš„æƒ…å†µï¼Œå…·æœ‰è‰¯å¥½çš„æ‹“å±•æ€§å’Œé«˜å¯ç”¨æ€§ã€‚é€šè¿‡åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´åˆ†å¸ƒæ•°æ®ï¼Œå¯ä»¥å®ç°åœ¨å¤šå°æœåŠ¡å™¨ä¹‹é—´çš„è´Ÿè½½å‡è¡¡ï¼Œæé«˜è®¿é—®æ•ˆç‡</p></li></ul><hr><h3 id="ä¸»ä»æ­å»º" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»æ­å»º" aria-hidden="true">#</a> ä¸»ä»æ­å»º</h3><h4 id="master" tabindex="-1"><a class="header-anchor" href="#master" aria-hidden="true">#</a> master</h4><ol><li><p>åœ¨master çš„é…ç½®æ–‡ä»¶ï¼ˆ/etc/mysql/my.cnfï¼‰ä¸­ï¼Œé…ç½®å¦‚ä¸‹å†…å®¹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#mysql æœåŠ¡ID,ä¿è¯æ•´ä¸ªé›†ç¾¤ç¯å¢ƒä¸­å”¯ä¸€</span>
server-id<span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">#mysql binlog æ—¥å¿—çš„å­˜å‚¨è·¯å¾„å’Œæ–‡ä»¶å</span>
log-bin<span class="token operator">=</span>/var/lib/mysql/mysqlbin

<span class="token comment">#é”™è¯¯æ—¥å¿—,é»˜è®¤å·²ç»å¼€å¯</span>
<span class="token comment">#log-err</span>

<span class="token comment">#mysqlçš„å®‰è£…ç›®å½•</span>
<span class="token comment">#basedir</span>

<span class="token comment">#mysqlçš„ä¸´æ—¶ç›®å½•</span>
<span class="token comment">#tmpdir</span>

<span class="token comment">#mysqlçš„æ•°æ®å­˜æ”¾ç›®å½•</span>
<span class="token comment">#datadir</span>

<span class="token comment">#æ˜¯å¦åªè¯»,1 ä»£è¡¨åªè¯», 0 ä»£è¡¨è¯»å†™</span>
read-only<span class="token operator">=</span><span class="token number">0</span>

<span class="token comment">#å¿½ç•¥çš„æ•°æ®, æŒ‡ä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“</span>
binlog-ignore-db<span class="token operator">=</span>mysql

<span class="token comment">#æŒ‡å®šåŒæ­¥çš„æ•°æ®åº“</span>
<span class="token comment">#binlog-do-db=db01</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œéœ€è¦é‡å¯ MySQL</p></li><li><p>åˆ›å»ºåŒæ­¥æ•°æ®çš„è´¦æˆ·ï¼Œå¹¶ä¸”è¿›è¡Œæˆæƒæ“ä½œï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>GRANT REPLICATION SLAVE ON *.* TO &#39;seazean&#39;@&#39;192.168.0.137&#39; IDENTIFIED BY &#39;123456&#39;;
FLUSH PRIVILEGES;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹ master çŠ¶æ€ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW MASTER STATUS;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æŸ¥çœ‹masterçŠ¶æ€.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>Fileï¼šä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¼€å§‹æ¨é€æ—¥å¿—æ–‡ä»¶</li><li>Positionï¼šä»å“ªä¸ªä½ç½®å¼€å§‹æ¨é€æ—¥å¿—</li><li>Binlog_Ignore_DBï¼šæŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“</li></ul></li></ol><hr><h4 id="slave" tabindex="-1"><a class="header-anchor" href="#slave" aria-hidden="true">#</a> slave</h4><ol><li><p>åœ¨ slave ç«¯é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®å¦‚ä¸‹å†…å®¹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#mysqlæœåŠ¡ç«¯ID,å”¯ä¸€</span>
server-id<span class="token operator">=</span><span class="token number">2</span>

<span class="token comment">#æŒ‡å®šbinlogæ—¥å¿—</span>
log-bin<span class="token operator">=</span>/var/lib/mysql/mysqlbin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œéœ€è¦é‡å¯ MySQL</p></li><li><p>æŒ‡å®šå½“å‰ä»åº“å¯¹åº”çš„ä¸»åº“çš„IPåœ°å€ã€ç”¨æˆ·åã€å¯†ç ï¼Œä»å“ªä¸ªæ—¥å¿—æ–‡ä»¶å¼€å§‹çš„é‚£ä¸ªä½ç½®å¼€å§‹åŒæ­¥æ¨é€æ—¥å¿—</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CHANGE MASTER TO MASTER_HOST= &#39;192.168.0.138&#39;, MASTER_USER=&#39;seazean&#39;, MASTER_PASSWORD=&#39;seazean&#39;, MASTER_LOG_FILE=&#39;mysqlbin.000001&#39;, MASTER_LOG_POS=413;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å¼€å¯åŒæ­¥æ“ä½œï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>START SLAVE;
SHOW SLAVE STATUS;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åœæ­¢åŒæ­¥æ“ä½œï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>STOP SLAVE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><hr><h4 id="éªŒè¯" tabindex="-1"><a class="header-anchor" href="#éªŒè¯" aria-hidden="true">#</a> éªŒè¯</h4><ol><li><p>åœ¨ä¸»åº“ä¸­åˆ›å»ºæ•°æ®åº“ï¼Œåˆ›å»ºè¡¨å¹¶æ’å…¥æ•°æ®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>CREATE DATABASE db01;
USE db01;
CREATE TABLE user(
	id INT(11) NOT NULL AUTO_INCREMENT,
	name VARCHAR(50) NOT NULL,
	sex VARCHAR(1),
	PRIMARY KEY (id)
)ENGINE=INNODB DEFAULT CHARSET=utf8;

INSERT INTO user(id,NAME,sex) VALUES(NULL,&#39;Tom&#39;,&#39;1&#39;);
INSERT INTO user(id,NAME,sex) VALUES(NULL,&#39;Trigger&#39;,&#39;0&#39;);
INSERT INTO user(id,NAME,sex) VALUES(NULL,&#39;Dawn&#39;,&#39;1&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åœ¨ä»åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼Œè¿›è¡ŒéªŒè¯ï¼š</p><p>åœ¨ä»åº“ä¸­ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°åˆšæ‰åˆ›å»ºçš„æ•°æ®åº“ï¼š</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¸»ä»å¤åˆ¶éªŒè¯1.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>åœ¨è¯¥æ•°æ®åº“ä¸­ï¼ŒæŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼š</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-ä¸»ä»å¤åˆ¶éªŒè¯2.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ol><hr><h3 id="ä¸»ä»åˆ‡æ¢" tabindex="-1"><a class="header-anchor" href="#ä¸»ä»åˆ‡æ¢" aria-hidden="true">#</a> ä¸»ä»åˆ‡æ¢</h3><h4 id="æ­£å¸¸åˆ‡æ¢" tabindex="-1"><a class="header-anchor" href="#æ­£å¸¸åˆ‡æ¢" aria-hidden="true">#</a> æ­£å¸¸åˆ‡æ¢</h4><p>æ­£å¸¸åˆ‡æ¢æ­¥éª¤ï¼š</p><ul><li><p>åœ¨å¼€å§‹åˆ‡æ¢ä¹‹å‰å…ˆå¯¹ä¸»åº“è¿›è¡Œé”è¡¨ <code>flush tables with read lock</code>ï¼Œç„¶åç­‰å¾…æ‰€æœ‰è¯­å¥æ‰§è¡Œå®Œæˆï¼Œåˆ‡æ¢å®Œæˆåå¯ä»¥é‡Šæ”¾é”</p></li><li><p>æ£€æŸ¥ slave åŒæ­¥çŠ¶æ€ï¼Œåœ¨ slave æ‰§è¡Œ <code>show processlist</code></p></li><li><p>åœæ­¢ slave io çº¿ç¨‹ï¼Œæ‰§è¡Œå‘½ä»¤ <code>STOP SLAVE IO_THREAD</code></p></li><li><p>æå‡ slave ä¸º master</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>Stop slave<span class="token punctuation">;</span>
Reset master<span class="token punctuation">;</span>
Reset slave <span class="token keyword">all</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token keyword">global</span> read_only<span class="token operator">=</span><span class="token keyword">off</span><span class="token punctuation">;</span>	<span class="token comment">-- è®¾ç½®ä¸ºå¯æ›´æ–°çŠ¶æ€</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å°†åŸæ¥ master å˜ä¸º slaveï¼ˆå‚è€ƒæ­å»ºæµç¨‹ä¸­çš„ slave æ–¹æ³•ï¼‰</p></li></ul><p><strong>å¯é æ€§ä¼˜å…ˆç­–ç•¥</strong>ï¼š</p><ul><li>åˆ¤æ–­å¤‡åº“ B ç°åœ¨çš„ seconds_behind_masterï¼Œå¦‚æœå°äºæŸä¸ªå€¼ï¼ˆæ¯”å¦‚ 5 ç§’ï¼‰ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™æŒç»­é‡è¯•è¿™ä¸€æ­¥</li><li>æŠŠä¸»åº“ A æ”¹æˆåªè¯»çŠ¶æ€ï¼Œå³æŠŠ readonly è®¾ç½®ä¸º true</li><li>åˆ¤æ–­å¤‡åº“ B çš„ seconds_behind_master çš„å€¼ï¼Œç›´åˆ°è¿™ä¸ªå€¼å˜æˆ 0 ä¸ºæ­¢ï¼ˆè¯¥æ­¥éª¤æ¯”è¾ƒè€—æ—¶ï¼Œæ‰€ä»¥æ­¥éª¤ 1 ä¸­è¦å°½é‡ç­‰å¾…è¯¥å€¼å˜å°ï¼‰</li><li>æŠŠå¤‡åº“ B æ”¹æˆå¯è¯»å†™çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æŠŠ readonly è®¾ç½®ä¸º false</li><li>æŠŠä¸šåŠ¡è¯·æ±‚åˆ‡åˆ°å¤‡åº“ B</li></ul><p>å¯ç”¨æ€§ä¼˜å…ˆç­–ç•¥ï¼šå…ˆåšæœ€åä¸¤æ­¥ï¼Œä¼šé€ æˆä¸»å¤‡æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜</p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://time.geekbang.org/column/article/76795" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/76795<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h4 id="å¥åº·æ£€æµ‹" tabindex="-1"><a class="header-anchor" href="#å¥åº·æ£€æµ‹" aria-hidden="true">#</a> å¥åº·æ£€æµ‹</h4><p>ä¸»åº“å‘ç”Ÿæ•…éšœåä»åº“ä¼šä¸Šä½ï¼Œ<strong>å…¶ä»–ä»åº“æŒ‡å‘æ–°çš„ä¸»åº“</strong>ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªå¥åº·æ£€æµ‹çš„æœºåˆ¶æ¥åˆ¤æ–­ä¸»åº“æ˜¯å¦å®•æœº</p><ul><li><p>select 1 åˆ¤æ–­ï¼Œä½†æ˜¯é«˜å¹¶å‘ä¸‹æ£€æµ‹ä¸å‡ºçº¿ç¨‹çš„é”ç­‰å¾…çš„é˜»å¡é—®é¢˜</p></li><li><p>æŸ¥è¡¨åˆ¤æ–­ï¼Œåœ¨ç³»ç»Ÿåº“ï¼ˆmysql åº“ï¼‰é‡Œåˆ›å»ºä¸€ä¸ªè¡¨ï¼Œæ¯”å¦‚å‘½åä¸º health_checkï¼Œé‡Œé¢åªæ”¾ä¸€è¡Œæ•°æ®ï¼Œç„¶åå®šæœŸæ‰§è¡Œã€‚ä½†æ˜¯å½“ binlog æ‰€åœ¨ç£ç›˜çš„ç©ºé—´å ç”¨ç‡è¾¾åˆ° 100%ï¼Œæ‰€æœ‰çš„æ›´æ–°å’Œäº‹åŠ¡æäº¤è¯­å¥éƒ½è¢«é˜»å¡ï¼ŒæŸ¥è¯¢è¯­å¥å¯ä»¥ç»§ç»­è¿è¡Œ</p></li><li><p>æ›´æ–°åˆ¤æ–­ï¼Œåœ¨å¥åº·æ£€æµ‹è¡¨ä¸­æ”¾ä¸€ä¸ª timestamp å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºæœ€åä¸€æ¬¡æ‰§è¡Œæ£€æµ‹çš„æ—¶é—´</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>UPDATE mysql.health_check SET t_modified=now();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>èŠ‚ç‚¹å¯ç”¨æ€§çš„æ£€æµ‹éƒ½åº”è¯¥åŒ…å«ä¸»åº“å’Œå¤‡åº“ï¼Œä¸ºäº†è®©ä¸»å¤‡ä¹‹é—´çš„æ›´æ–°ä¸äº§ç”Ÿå†²çªï¼Œå¯ä»¥åœ¨ mysql.health_check è¡¨ä¸Šå­˜å…¥å¤šè¡Œæ•°æ®ï¼Œå¹¶ç”¨ä¸»å¤‡çš„ server_id åšä¸»é”®ï¼Œä¿è¯ä¸»ã€å¤‡åº“å„è‡ªçš„æ£€æµ‹å‘½ä»¤ä¸ä¼šå‘ç”Ÿå†²çª</p></li></ul><hr><h4 id="åŸºäºä½ç‚¹" tabindex="-1"><a class="header-anchor" href="#åŸºäºä½ç‚¹" aria-hidden="true">#</a> åŸºäºä½ç‚¹</h4><p>ä¸»åº“ä¸Šä½åï¼Œä»åº“ B æ‰§è¡Œ CHANGE MASTER TO å‘½ä»¤ï¼ŒæŒ‡å®š MASTER_LOG_FILEã€MASTER_LOG_POS è¡¨ç¤ºä»æ–°ä¸»åº“ A çš„å“ªä¸ªæ–‡ä»¶çš„å“ªä¸ªä½ç‚¹å¼€å§‹åŒæ­¥ï¼Œè¿™ä¸ªä½ç½®å°±æ˜¯<strong>åŒæ­¥ä½ç‚¹</strong>ï¼Œå¯¹åº”ä¸»åº“çš„æ–‡ä»¶åå’Œæ—¥å¿—åç§»é‡</p><p>å¯»æ‰¾ä½ç‚¹éœ€è¦æ‰¾ä¸€ä¸ªç¨å¾®å¾€å‰çš„ï¼Œç„¶åå†é€šè¿‡åˆ¤æ–­è·³è¿‡é‚£äº›åœ¨ä»åº“ B ä¸Šå·²ç»æ‰§è¡Œè¿‡çš„äº‹åŠ¡ï¼Œè·å–ä½ç‚¹æ–¹æ³•ï¼š</p><ul><li>ç­‰å¾…æ–°ä¸»åº“ A æŠŠä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰å…¨éƒ¨åŒæ­¥å®Œæˆ</li><li>åœ¨ A ä¸Šæ‰§è¡Œ show master status å‘½ä»¤ï¼Œå¾—åˆ°å½“å‰ A ä¸Šæœ€æ–°çš„ File å’Œ Position</li><li>å–åŸä¸»åº“æ•…éšœçš„æ—¶åˆ» Tï¼Œç”¨ mysqlbinlog å·¥å…·è§£ææ–°ä¸»åº“ A çš„ Fileï¼Œå¾—åˆ° T æ—¶åˆ»çš„ä½ç‚¹</li></ul><p>é€šå¸¸æƒ…å†µä¸‹è¯¥å€¼å¹¶ä¸å‡†ç¡®ï¼Œåœ¨åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥è¦å…ˆä¸»åŠ¨è·³è¿‡è¿™äº›é”™è¯¯ï¼š</p><ul><li><p>åˆ‡æ¢è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡å¤æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ï¼Œæ‰€ä»¥éœ€è¦ä¸»åŠ¨è·³è¿‡æ‰€æœ‰é‡å¤çš„äº‹åŠ¡</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET GLOBAL sql_slave_skip_counter=1;
START SLAVE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è®¾ç½® slave_skip_errors å‚æ•°ï¼Œç›´æ¥è®¾ç½®è·³è¿‡æŒ‡å®šçš„é”™è¯¯ï¼Œä¿è¯ä¸»ä»åˆ‡æ¢çš„æ­£å¸¸è¿›è¡Œ</p><ul><li>1062 é”™è¯¯æ˜¯æ’å…¥æ•°æ®æ—¶å”¯ä¸€é”®å†²çª</li><li>1032 é”™è¯¯æ˜¯åˆ é™¤æ•°æ®æ—¶æ‰¾ä¸åˆ°è¡Œ</li></ul><p>è¯¥æ–¹æ³•é’ˆå¯¹çš„æ˜¯ä¸»å¤‡åˆ‡æ¢æ—¶ï¼Œç”±äºæ‰¾ä¸åˆ°ç²¾ç¡®çš„åŒæ­¥ä½ç‚¹ï¼Œåªèƒ½é‡‡ç”¨è¿™ç§æ–¹æ³•æ¥åˆ›å»ºä»åº“å’Œæ–°ä¸»åº“çš„ä¸»å¤‡å…³ç³»ã€‚ç­‰åˆ°ä¸»å¤‡é—´çš„åŒæ­¥å…³ç³»å»ºç«‹å®Œæˆå¹¶ç¨³å®šæ‰§è¡Œä¸€æ®µæ—¶é—´åï¼Œè¿˜éœ€è¦æŠŠè¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºç©ºï¼Œä»¥å…çœŸçš„å‡ºç°äº†ä¸»ä»æ•°æ®ä¸ä¸€è‡´ä¹Ÿè·³è¿‡äº†</p></li></ul><hr><h4 id="åŸºäºgtid" tabindex="-1"><a class="header-anchor" href="#åŸºäºgtid" aria-hidden="true">#</a> åŸºäºGTID</h4><h5 id="gtid" tabindex="-1"><a class="header-anchor" href="#gtid" aria-hidden="true">#</a> GTID</h5><p>GTID çš„å…¨ç§°æ˜¯ Global Transaction Identifierï¼Œå…¨å±€äº‹åŠ¡ IDï¼Œæ˜¯ä¸€ä¸ªäº‹åŠ¡<strong>åœ¨æäº¤æ—¶ç”Ÿæˆ</strong>çš„ï¼Œæ˜¯è¿™ä¸ªäº‹åŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œç»„æˆï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>GTID=source_id:transaction_id
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>source_idï¼šæ˜¯ä¸€ä¸ªå®ä¾‹ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„å€¼</li><li>transaction_idï¼šåˆå§‹å€¼æ˜¯ 1ï¼Œæ¯æ¬¡æäº¤äº‹åŠ¡çš„æ—¶å€™åˆ†é…ç»™è¿™ä¸ªäº‹åŠ¡ï¼Œå¹¶åŠ  1ï¼Œæ˜¯è¿ç»­çš„ï¼ˆåŒºåˆ†äº‹åŠ¡ IDï¼Œäº‹åŠ¡ ID æ˜¯åœ¨æ‰§è¡Œæ—¶ç”Ÿæˆï¼‰</li></ul><p>å¯åŠ¨ MySQL å®ä¾‹æ—¶ï¼ŒåŠ ä¸Šå‚æ•° <code>gtid_mode=on</code> å’Œ <code>enforce_gtid_consistency=on</code> å°±å¯ä»¥å¯åŠ¨ GTID æ¨¡å¼ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½ä¼šå’Œä¸€ä¸ª GTID ä¸€ä¸€å¯¹åº”ï¼Œæ¯ä¸ª MySQL å®ä¾‹éƒ½ç»´æŠ¤äº†ä¸€ä¸ª GTID é›†åˆï¼Œç”¨æ¥å­˜å‚¨å½“å‰å®ä¾‹<strong>æ‰§è¡Œè¿‡çš„æ‰€æœ‰äº‹åŠ¡</strong></p><p>GTID æœ‰ä¸¤ç§ç”Ÿæˆæ–¹å¼ï¼Œä½¿ç”¨å“ªç§æ–¹å¼å–å†³äº session å˜é‡ gtid_nextï¼š</p><ul><li><p><code>gtid_next=automatic</code>ï¼šä½¿ç”¨é»˜è®¤å€¼ï¼ŒæŠŠ source_id:transaction_id ï¼ˆé€’å¢ï¼‰åˆ†é…ç»™è¿™ä¸ªäº‹åŠ¡ï¼Œç„¶ååŠ å…¥æœ¬å®ä¾‹çš„ GTID é›†åˆ</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>@@SESSION.GTID_NEXT = &#39;source_id:transaction_id&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p><code>gtid_next=GTID</code>ï¼šæŒ‡å®šçš„ GTID çš„å€¼ï¼Œå¦‚æœè¯¥å€¼å·²ç»å­˜åœ¨äºå®ä¾‹çš„ GTID é›†åˆä¸­ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œçš„äº‹åŠ¡ä¼šç›´æ¥è¢«ç³»ç»Ÿå¿½ç•¥ï¼›åä¹‹å°±å°†è¯¥å€¼åˆ†é…ç»™æ¥ä¸‹æ¥è¦æ‰§è¡Œçš„äº‹åŠ¡ï¼Œç³»ç»Ÿä¸éœ€è¦ç»™è¿™ä¸ªäº‹åŠ¡ç”Ÿæˆæ–°çš„ GTIDï¼Œä¹Ÿä¸ç”¨åŠ  1</p><p>æ³¨æ„ï¼šä¸€ä¸ª GTID åªèƒ½ç»™ä¸€ä¸ªäº‹åŠ¡ä½¿ç”¨ï¼Œæ‰€ä»¥æ‰§è¡Œä¸‹ä¸€ä¸ªäº‹åŠ¡ï¼Œè¦æŠŠ gtid_next è®¾ç½®æˆå¦å¤–ä¸€ä¸ª GTID æˆ–è€… automatic</p></li></ul><p>ä¸šåŠ¡åœºæ™¯ï¼š</p><ul><li><p>ä¸»åº“ X å’Œä»åº“ Y æ‰§è¡Œä¸€æ¡ç›¸åŒçš„æŒ‡ä»¤åè¿›è¡Œäº‹åŠ¡åŒæ­¥</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>INSERT INTO t VALUES(1,1);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å½“ Y åŒæ­¥ X æ—¶ï¼Œä¼šå‡ºç°ä¸»é”®å†²çªï¼Œå¯¼è‡´å®ä¾‹ X çš„åŒæ­¥çº¿ç¨‹åœæ­¢ï¼Œè§£å†³æ–¹æ³•ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SET gtid_next=&#39;(è¿™é‡Œæ˜¯ä¸»åº“ X çš„ GTID å€¼)&#39;;
BEGIN;
COMMIT;
SET gtid_next=automatic;
START SLAVE;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‰ä¸‰æ¡è¯­å¥é€šè¿‡<strong>æäº¤ä¸€ä¸ªç©ºäº‹åŠ¡</strong>ï¼ŒæŠŠ X çš„ GTID åŠ åˆ°å®ä¾‹ Y çš„ GTID é›†åˆä¸­ï¼Œå®ä¾‹ Y å°±ä¼šç›´æ¥è·³è¿‡è¿™ä¸ªäº‹åŠ¡</p></li></ul><hr><h5 id="åˆ‡æ¢" tabindex="-1"><a class="header-anchor" href="#åˆ‡æ¢" aria-hidden="true">#</a> åˆ‡æ¢</h5><p>åœ¨ GTID æ¨¡å¼ä¸‹ï¼ŒCHANGE MASTER TO ä¸éœ€è¦æŒ‡å®šæ—¥å¿—åå’Œæ—¥å¿—åç§»é‡ï¼ŒæŒ‡å®š <code>master_auto_position=1</code> ä»£è¡¨ä½¿ç”¨ GTID æ¨¡å¼</p><p>æ–°ä¸»åº“å®ä¾‹ A çš„ GTID é›†åˆè®°ä¸º set_aï¼Œä»åº“å®ä¾‹ B çš„ GTID é›†åˆè®°ä¸º set_bï¼Œä¸»å¤‡åˆ‡æ¢é€»è¾‘ï¼š</p><ul><li>å®ä¾‹ B æŒ‡å®šä¸»åº“ Aï¼ŒåŸºäºä¸»å¤‡åè®®å»ºç«‹è¿æ¥ï¼Œå®ä¾‹ B å¹¶æŠŠ set_b å‘ç»™ä¸»åº“ A</li><li>å®ä¾‹ A ç®—å‡º set_a ä¸ set_b çš„å·®é›†ï¼Œå°±æ˜¯æ‰€æœ‰å­˜åœ¨äº set_a ä½†ä¸å­˜åœ¨äº set_b çš„ GTID çš„é›†åˆï¼Œåˆ¤æ–­ A æœ¬åœ°æ˜¯å¦åŒ…å«äº†è¿™ä¸ª<strong>å·®é›†</strong>éœ€è¦çš„æ‰€æœ‰ binlog äº‹åŠ¡ <ul><li>å¦‚æœä¸åŒ…å«ï¼Œè¡¨ç¤º A å·²ç»æŠŠå®ä¾‹ B éœ€è¦çš„ binlog ç»™åˆ æ‰äº†ï¼Œç›´æ¥è¿”å›é”™è¯¯</li><li>å¦‚æœç¡®è®¤å…¨éƒ¨åŒ…å«ï¼ŒA ä»è‡ªå·±çš„ binlog æ–‡ä»¶é‡Œé¢ï¼Œæ‰¾å‡ºç¬¬ä¸€ä¸ªä¸åœ¨ set_b çš„äº‹åŠ¡ï¼Œå‘ç»™ B</li></ul></li><li>å®ä¾‹ A ä¹‹åå°±ä»è¿™ä¸ªäº‹åŠ¡å¼€å§‹ï¼Œå¾€åè¯»æ–‡ä»¶ï¼ŒæŒ‰é¡ºåºå– binlog å‘ç»™ B å»æ‰§è¡Œ</li></ul><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://time.geekbang.org/column/article/77427" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/77427<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><h2 id="æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—" aria-hidden="true">#</a> æ—¥å¿—</h2><h3 id="æ—¥å¿—åˆ†ç±»" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—åˆ†ç±»" aria-hidden="true">#</a> æ—¥å¿—åˆ†ç±»</h3><p>åœ¨ä»»ä½•ä¸€ç§æ•°æ®åº“ä¸­ï¼Œéƒ½ä¼šæœ‰å„ç§å„æ ·çš„æ—¥å¿—ï¼Œè®°å½•ç€æ•°æ®åº“å·¥ä½œçš„è¿‡ç¨‹ï¼Œå¯ä»¥å¸®åŠ©æ•°æ®åº“ç®¡ç†å‘˜è¿½è¸ªæ•°æ®åº“æ›¾ç»å‘ç”Ÿè¿‡çš„å„ç§äº‹ä»¶</p><p>MySQLæ—¥å¿—ä¸»è¦åŒ…æ‹¬å…­ç§ï¼š</p><ol><li>é‡åšæ—¥å¿—ï¼ˆredo logï¼‰</li><li>å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰</li><li>å½’æ¡£æ—¥å¿—ï¼ˆbinlogï¼‰ï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰</li><li>é”™è¯¯æ—¥å¿—ï¼ˆerrorlogï¼‰</li><li>æ…¢æŸ¥è¯¢æ—¥å¿—ï¼ˆslow query logï¼‰</li><li>ä¸€èˆ¬æŸ¥è¯¢æ—¥å¿—ï¼ˆgeneral logï¼‰</li><li>ä¸­ç»§æ—¥å¿—ï¼ˆrelay logï¼‰</li></ol><hr><h3 id="é”™è¯¯æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯æ—¥å¿—" aria-hidden="true">#</a> é”™è¯¯æ—¥å¿—</h3><p>é”™è¯¯æ—¥å¿—æ˜¯ MySQL ä¸­æœ€é‡è¦çš„æ—¥å¿—ä¹‹ä¸€ï¼Œè®°å½•äº†å½“ mysqld å¯åŠ¨å’Œåœæ­¢æ—¶ï¼Œä»¥åŠæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿä»»ä½•ä¸¥é‡é”™è¯¯æ—¶çš„ç›¸å…³ä¿¡æ¯ã€‚å½“æ•°æ®åº“å‡ºç°ä»»ä½•æ•…éšœå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨æ—¶ï¼Œå¯ä»¥é¦–å…ˆæŸ¥çœ‹æ­¤æ—¥å¿—</p><p>è¯¥æ—¥å¿—æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œé»˜è®¤ä½ç½®æ˜¯ï¼š<code>/var/log/mysql/error.log</code></p><p>æŸ¥çœ‹æŒ‡ä»¤ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SHOW VARIABLES LIKE &#39;log_error%&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŸ¥çœ‹æ—¥å¿—å†…å®¹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tail</span> <span class="token parameter variable">-f</span> /var/log/mysql/error.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><hr><h3 id="å½’æ¡£æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#å½’æ¡£æ—¥å¿—" aria-hidden="true">#</a> å½’æ¡£æ—¥å¿—</h3><h4 id="åŸºæœ¬ä»‹ç»-10" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬ä»‹ç»-10" aria-hidden="true">#</a> åŸºæœ¬ä»‹ç»</h4><p>å½’æ¡£æ—¥å¿—ï¼ˆBINLOGï¼‰ä¹Ÿå«äºŒè¿›åˆ¶æ—¥å¿—ï¼Œæ˜¯å› ä¸ºé‡‡ç”¨äºŒè¿›åˆ¶è¿›è¡Œå­˜å‚¨ï¼Œè®°å½•äº†æ‰€æœ‰çš„ DDLï¼ˆæ•°æ®å®šä¹‰è¯­è¨€ï¼‰è¯­å¥å’Œ DMLï¼ˆæ•°æ®æ“ä½œè¯­è¨€ï¼‰è¯­å¥ï¼Œä½†<strong>ä¸åŒ…æ‹¬æ•°æ®æŸ¥è¯¢è¯­å¥ï¼Œåœ¨äº‹åŠ¡æäº¤å‰çš„æœ€åé˜¶æ®µå†™å…¥</strong></p><p>ä½œç”¨ï¼š<strong>ç¾éš¾æ—¶çš„æ•°æ®æ¢å¤å’Œ MySQL çš„ä¸»ä»å¤åˆ¶</strong></p><p>å½’æ¡£æ—¥å¿—é»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œéœ€è¦åœ¨ MySQL é…ç½®æ–‡ä»¶ä¸­å¼€å¯ï¼Œå¹¶é…ç½® MySQL æ—¥å¿—çš„æ ¼å¼ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /etc/mysql
<span class="token function">vim</span> my.cnf

<span class="token comment"># é…ç½®å¼€å¯binlogæ—¥å¿—ï¼Œ æ—¥å¿—çš„æ–‡ä»¶å‰ç¼€ä¸º mysqlbin -----&gt; ç”Ÿæˆçš„æ–‡ä»¶åå¦‚: mysqlbin.000001</span>
<span class="token assign-left variable">log_bin</span><span class="token operator">=</span>mysqlbin
<span class="token comment"># é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼</span>
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>STATEMENT
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ—¥å¿—å­˜æ”¾ä½ç½®ï¼šé…ç½®æ—¶ç»™å®šäº†æ–‡ä»¶åä½†æ˜¯æ²¡æœ‰æŒ‡å®šè·¯å¾„ï¼Œæ—¥å¿—é»˜è®¤å†™å…¥MySQL çš„æ•°æ®ç›®å½•</p><p>æ—¥å¿—æ ¼å¼ï¼š</p><ul><li><p>STATEMENTï¼šè¯¥æ—¥å¿—æ ¼å¼åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•çš„éƒ½æ˜¯ <strong>SQL è¯­å¥</strong>ï¼Œæ¯ä¸€æ¡å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹çš„ SQL éƒ½ä¼šè®°å½•åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ mysqlbinlog å·¥å…·ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°æ¯æ¡è¯­å¥çš„æ–‡æœ¬ã€‚ä¸»ä»å¤åˆ¶æ—¶ï¼Œä»åº“ä¼šå°†æ—¥å¿—è§£æä¸ºåŸè¯­å¥ï¼Œå¹¶åœ¨ä»åº“é‡æ–°æ‰§è¡Œä¸€é</p><p>ç¼ºç‚¹ï¼šå¯èƒ½ä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´ï¼Œå› ä¸ºè®°å½•çš„ SQL åœ¨ä¸åŒçš„ç¯å¢ƒä¸­å¯èƒ½é€‰æ‹©çš„ç´¢å¼•ä¸åŒï¼Œå¯¼è‡´ç»“æœä¸åŒ</p></li><li><p>ROWï¼šè¯¥æ—¥å¿—æ ¼å¼åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è®°å½•çš„æ˜¯æ¯ä¸€è¡Œçš„<strong>æ•°æ®å˜æ›´</strong>ï¼Œè€Œä¸æ˜¯è®°å½• SQL è¯­å¥ã€‚æ¯”å¦‚æ‰§è¡Œ SQL è¯­å¥ <code>update tb_book set status=&#39;1&#39;</code>ï¼Œå¦‚æœæ˜¯ STATEMENTï¼Œåœ¨æ—¥å¿—ä¸­ä¼šè®°å½•ä¸€è¡Œ SQL è¯­å¥ï¼› å¦‚æœæ˜¯ ROWï¼Œç”±äºæ˜¯å¯¹å…¨è¡¨è¿›è¡Œæ›´æ–°ï¼Œå°±æ˜¯æ¯ä¸€è¡Œè®°å½•éƒ½ä¼šå‘ç”Ÿå˜æ›´ï¼ŒROW æ ¼å¼çš„æ—¥å¿—ä¸­ä¼šè®°å½•æ¯ä¸€è¡Œçš„æ•°æ®å˜æ›´</p><p>ç¼ºç‚¹ï¼šè®°å½•çš„æ•°æ®æ¯”è¾ƒå¤šï¼Œå ç”¨å¾ˆå¤šçš„å­˜å‚¨ç©ºé—´</p></li><li><p>MIXEDï¼šè¿™æ˜¯ MySQL é»˜è®¤çš„æ—¥å¿—æ ¼å¼ï¼Œæ··åˆäº†STATEMENT å’Œ ROW ä¸¤ç§æ ¼å¼ï¼ŒMIXED æ ¼å¼èƒ½å°½é‡åˆ©ç”¨ä¸¤ç§æ¨¡å¼çš„ä¼˜ç‚¹ï¼Œè€Œé¿å¼€å®ƒä»¬çš„ç¼ºç‚¹</p></li></ul><hr><h4 id="æ—¥å¿—åˆ·ç›˜-1" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—åˆ·ç›˜-1" aria-hidden="true">#</a> æ—¥å¿—åˆ·ç›˜</h4><p>äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…ˆå°†æ—¥å¿—å†™ï¼ˆwriteï¼‰åˆ° binlog cacheï¼Œäº‹åŠ¡æäº¤æ—¶å†æŠŠ binlog cache å†™ï¼ˆfsyncï¼‰åˆ° binlog æ–‡ä»¶ä¸­ï¼Œä¸€ä¸ªäº‹åŠ¡çš„ binlog æ˜¯ä¸èƒ½è¢«æ‹†å¼€çš„ï¼Œæ‰€ä»¥ä¸è®ºè¿™ä¸ªäº‹åŠ¡å¤šå¤§ä¹Ÿè¦ç¡®ä¿ä¸€æ¬¡æ€§å†™å…¥</p><p>äº‹åŠ¡æäº¤æ—¶æ‰§è¡Œå™¨æŠŠ binlog cache é‡Œçš„å®Œæ•´äº‹åŠ¡å†™å…¥åˆ° binlog ä¸­ï¼Œå¹¶æ¸…ç©º binlog cache</p><p>write å’Œ fsync çš„æ—¶æœºç”±å‚æ•° sync_binlog æ§åˆ¶çš„ï¼š</p><ul><li>sync_binlog=0ï¼šè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½åª writeï¼Œä¸ fsync</li><li>sync_binlog=1ï¼šè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ä¼šæ‰§è¡Œ fsync</li><li>sync_binlog=N(N&gt;1)ï¼šè¡¨ç¤ºæ¯æ¬¡æäº¤äº‹åŠ¡éƒ½ writeï¼Œä½†ç´¯ç§¯ N ä¸ªäº‹åŠ¡åæ‰ fsyncï¼Œä½†æ˜¯å¦‚æœä¸»æœºå‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¼šä¸¢å¤±æœ€è¿‘ N ä¸ªäº‹åŠ¡çš„ binlog æ—¥å¿—</li></ul><hr><h4 id="æ—¥å¿—è¯»å–" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—è¯»å–" aria-hidden="true">#</a> æ—¥å¿—è¯»å–</h4><p>æ—¥å¿—æ–‡ä»¶å­˜å‚¨ä½ç½®ï¼š/var/lib/mysql</p><p>ç”±äºæ—¥å¿—ä»¥äºŒè¿›åˆ¶æ–¹å¼å­˜å‚¨ï¼Œä¸èƒ½ç›´æ¥è¯»å–ï¼Œéœ€è¦ç”¨ mysqlbinlog å·¥å…·æ¥æŸ¥çœ‹ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlbinlog log-file<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æŸ¥çœ‹ STATEMENT æ ¼å¼æ—¥å¿—ï¼š</p><ul><li><p>æ‰§è¡Œæ’å…¥è¯­å¥ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>INSERT INTO tb_book VALUES(NULL,&#39;Lucene&#39;,&#39;2088-05-01&#39;,&#39;0&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p><code>cd /var/lib/mysql</code>ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>-rw-r-----  <span class="token number">1</span> mysql mysql      <span class="token number">177</span> <span class="token number">5</span>æœˆ  <span class="token number">23</span> <span class="token number">21</span>:08 mysqlbin.000001
-rw-r-----  <span class="token number">1</span> mysql mysql       <span class="token number">18</span> <span class="token number">5</span>æœˆ  <span class="token number">23</span> <span class="token number">21</span>:04 mysqlbin.index
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>mysqlbin.indexï¼šè¯¥æ–‡ä»¶æ˜¯æ—¥å¿—ç´¢å¼•æ–‡ä»¶ ï¼Œ è®°å½•æ—¥å¿—çš„æ–‡ä»¶åï¼›</p><p>mysqlbing.000001ï¼šæ—¥å¿—æ–‡ä»¶</p></li><li><p>æŸ¥çœ‹æ—¥å¿—å†…å®¹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqlbinlog mysqlbing.000001<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æ—¥å¿—è¯»å–1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>æ—¥å¿—ç»“å°¾æœ‰ COMMIT</p></li></ul><p>æŸ¥çœ‹ ROW æ ¼å¼æ—¥å¿—ï¼š</p><ul><li><p>ä¿®æ”¹é…ç½®ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># é…ç½®äºŒè¿›åˆ¶æ—¥å¿—çš„æ ¼å¼</span>
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>ROW
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ’å…¥æ•°æ®ï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>INSERT INTO tb_book VALUES(NULL,&#39;SpringCloudå®æˆ˜&#39;,&#39;2088-05-05&#39;,&#39;0&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹æ—¥å¿—å†…å®¹ï¼šæ—¥å¿—æ ¼å¼ ROWï¼Œç›´æ¥æŸ¥çœ‹æ•°æ®æ˜¯ä¹±ç ï¼Œå¯ä»¥åœ¨ mysqlbinlog åé¢åŠ ä¸Šå‚æ•° -vv</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>mysqlbinlog -vv mysqlbin.000002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æ—¥å¿—è¯»å–2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul><hr><h4 id="æ—¥å¿—åˆ é™¤" tabindex="-1"><a class="header-anchor" href="#æ—¥å¿—åˆ é™¤" aria-hidden="true">#</a> æ—¥å¿—åˆ é™¤</h4><p>å¯¹äºæ¯”è¾ƒç¹å¿™çš„ç³»ç»Ÿï¼Œç”Ÿæˆæ—¥å¿—é‡å¤§ï¼Œè¿™äº›æ—¥å¿—å¦‚æœé•¿æ—¶é—´ä¸æ¸…é™¤ï¼Œå°†ä¼šå ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ï¼Œéœ€è¦åˆ é™¤æ—¥å¿—</p><ul><li><p>Reset Master æŒ‡ä»¤åˆ é™¤å…¨éƒ¨ binlog æ—¥å¿—ï¼Œåˆ é™¤ä¹‹åï¼Œæ—¥å¿—ç¼–å·å°†ä» xxxx.000001é‡æ–°å¼€å§‹</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>Reset Master	-- MySQLæŒ‡ä»¤
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æ‰§è¡ŒæŒ‡ä»¤ <code>PURGE MASTER LOGS TO &#39;mysqlbin.***</code>ï¼Œè¯¥å‘½ä»¤å°†åˆ é™¤ <code> ***</code> ç¼–å·ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—</p></li><li><p>æ‰§è¡ŒæŒ‡ä»¤ <code>PURGE MASTER LOGS BEFORE &#39;yyyy-mm-dd hh:mm:ss&#39;</code> ï¼Œè¯¥å‘½ä»¤å°†åˆ é™¤æ—¥å¿—ä¸º <code>yyyy-mm-dd hh:mm:ss</code> ä¹‹å‰äº§ç”Ÿçš„æ—¥å¿—</p></li><li><p>è®¾ç½®å‚æ•° <code>--expire_logs_days=#</code>ï¼Œæ­¤å‚æ•°çš„å«ä¹‰æ˜¯è®¾ç½®æ—¥å¿—çš„è¿‡æœŸå¤©æ•°ï¼Œè¿‡äº†æŒ‡å®šçš„å¤©æ•°åæ—¥å¿—å°†ä¼šè¢«è‡ªåŠ¨åˆ é™¤ï¼Œè¿™æ ·åšæœ‰åˆ©äºå‡å°‘ç®¡ç†æ—¥å¿—çš„å·¥ä½œé‡ï¼Œé…ç½® my.cnf æ–‡ä»¶ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">log_bin</span><span class="token operator">=</span>mysqlbin
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>ROW
<span class="token parameter variable">--expire_logs_days</span><span class="token operator">=</span><span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h4 id="æ•°æ®æ¢å¤-1" tabindex="-1"><a class="header-anchor" href="#æ•°æ®æ¢å¤-1" aria-hidden="true">#</a> æ•°æ®æ¢å¤</h4><p>è¯¯åˆ åº“æˆ–è€…è¡¨æ—¶ï¼Œéœ€è¦æ ¹æ® binlog è¿›è¡Œæ•°æ®æ¢å¤</p><p>ä¸€èˆ¬æƒ…å†µä¸‹æ•°æ®åº“æœ‰å®šæ—¶çš„å…¨é‡å¤‡ä»½ï¼Œå‡å¦‚æ¯å¤© 0 ç‚¹å®šæ—¶å¤‡ä»½ï¼Œ12 ç‚¹è¯¯åˆ äº†åº“ï¼Œæ¢å¤æµç¨‹ï¼š</p><ul><li>å–æœ€è¿‘ä¸€æ¬¡å…¨é‡å¤‡ä»½ï¼Œç”¨å¤‡ä»½æ¢å¤å‡ºä¸€ä¸ªä¸´æ—¶åº“</li><li>ä»æ—¥å¿—æ–‡ä»¶ä¸­å–å‡ºå‡Œæ™¨ 0 ç‚¹ä¹‹åçš„æ—¥å¿—</li><li>æŠŠé™¤äº†è¯¯åˆ é™¤æ•°æ®çš„è¯­å¥å¤–æ—¥å¿—ï¼Œå…¨éƒ¨åº”ç”¨åˆ°ä¸´æ—¶åº“</li></ul><p>è·³è¿‡è¯¯åˆ é™¤è¯­å¥æ—¥å¿—çš„æ–¹æ³•ï¼š</p><ul><li>å¦‚æœåŸå®ä¾‹æ²¡æœ‰ä½¿ç”¨ GTID æ¨¡å¼ï¼Œåªèƒ½åœ¨åº”ç”¨åˆ°åŒ…å« 12 ç‚¹çš„ binlog æ–‡ä»¶çš„æ—¶å€™ï¼Œå…ˆç”¨ â€“stop-position å‚æ•°æ‰§è¡Œåˆ°è¯¯æ“ä½œä¹‹å‰çš„æ—¥å¿—ï¼Œç„¶åå†ç”¨ â€“start-position ä»è¯¯æ“ä½œä¹‹åçš„æ—¥å¿—ç»§ç»­æ‰§è¡Œ</li><li>å¦‚æœå®ä¾‹ä½¿ç”¨äº† GTID æ¨¡å¼ï¼Œå‡è®¾è¯¯æ“ä½œå‘½ä»¤çš„ GTID æ˜¯ gtid1ï¼Œé‚£ä¹ˆåªéœ€è¦æäº¤ä¸€ä¸ªç©ºäº‹åŠ¡å…ˆå°†è¿™ä¸ª GTID åŠ åˆ°ä¸´æ—¶å®ä¾‹çš„ GTID é›†åˆï¼Œä¹‹åæŒ‰é¡ºåºæ‰§è¡Œ binlog çš„æ—¶å°±ä¼šè‡ªåŠ¨è·³è¿‡è¯¯æ“ä½œçš„è¯­å¥</li></ul><hr><h3 id="æŸ¥è¯¢æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#æŸ¥è¯¢æ—¥å¿—" aria-hidden="true">#</a> æŸ¥è¯¢æ—¥å¿—</h3><p>æŸ¥è¯¢æ—¥å¿—ä¸­è®°å½•äº†å®¢æˆ·ç«¯çš„æ‰€æœ‰æ“ä½œè¯­å¥ï¼Œè€ŒäºŒè¿›åˆ¶æ—¥å¿—ä¸åŒ…å«æŸ¥è¯¢æ•°æ®çš„ SQL è¯­å¥</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæŸ¥è¯¢æ—¥å¿—æ˜¯æœªå¼€å¯çš„ã€‚å¦‚æœéœ€è¦å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼Œé…ç½® my.cnfï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¯¥é€‰é¡¹ç”¨æ¥å¼€å¯æŸ¥è¯¢æ—¥å¿—ï¼Œå¯é€‰å€¼0æˆ–è€…1ï¼Œ0ä»£è¡¨å…³é—­ï¼Œ1ä»£è¡¨å¼€å¯ </span>
<span class="token assign-left variable">general_log</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># è®¾ç½®æ—¥å¿—çš„æ–‡ä»¶åï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤çš„æ–‡ä»¶åä¸ºhost_name.logï¼Œå­˜æ”¾åœ¨/var/lib/mysql</span>
<span class="token assign-left variable">general_log_file</span><span class="token operator">=</span>mysql_query.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é…ç½®å®Œæ¯•ä¹‹åï¼Œåœ¨æ•°æ®åº“æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><div class="language-mysql line-numbers-mode" data-ext="mysql"><pre class="language-mysql"><code>SELECT * FROM tb_book;
SELECT * FROM tb_book WHERE id = 1;
UPDATE tb_book SET name = &#39;luceneå…¥é—¨æŒ‡å—&#39; WHERE id = 5;
SELECT * FROM tb_book WHERE id &lt; 8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œ å†æ¬¡æ¥æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ï¼š</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æŸ¥è¯¢æ—¥å¿—.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h3 id="æ…¢æ—¥å¿—" tabindex="-1"><a class="header-anchor" href="#æ…¢æ—¥å¿—" aria-hidden="true">#</a> æ…¢æ—¥å¿—</h3><p>æ…¢æŸ¥è¯¢æ—¥å¿—è®°å½•æ‰€æœ‰æ‰§è¡Œæ—¶é—´è¶…è¿‡ long_query_time å¹¶ä¸”æ‰«æè®°å½•æ•°ä¸å°äº min_examined_row_limit çš„æ‰€æœ‰çš„ SQL è¯­å¥çš„æ—¥å¿—long_query_time é»˜è®¤ä¸º 10 ç§’ï¼Œæœ€å°ä¸º 0ï¼Œ ç²¾åº¦åˆ°å¾®ç§’</p><p>æ…¢æŸ¥è¯¢æ—¥å¿—é»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¯ä»¥é€šè¿‡ä¸¤ä¸ªå‚æ•°æ¥æ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œé…ç½®æ–‡ä»¶ <code>/etc/mysql/my.cnf</code>ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># è¯¥å‚æ•°ç”¨æ¥æ§åˆ¶æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯å¦å¼€å¯ï¼Œå¯é€‰å€¼0æˆ–è€…1ï¼Œ0ä»£è¡¨å…³é—­ï¼Œ1ä»£è¡¨å¼€å¯ </span>
<span class="token assign-left variable">slow_query_log</span><span class="token operator">=</span><span class="token number">1</span> 

<span class="token comment"># è¯¥å‚æ•°ç”¨æ¥æŒ‡å®šæ…¢æŸ¥è¯¢æ—¥å¿—çš„æ–‡ä»¶åï¼Œå­˜æ”¾åœ¨ /var/lib/mysql</span>
<span class="token assign-left variable">slow_query_log_file</span><span class="token operator">=</span>slow_query.log

<span class="token comment"># è¯¥é€‰é¡¹ç”¨æ¥é…ç½®æŸ¥è¯¢çš„æ—¶é—´é™åˆ¶ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°†è®¤ä¸ºå€¼æ…¢æŸ¥è¯¢ï¼Œå°†éœ€è¦è¿›è¡Œæ—¥å¿—è®°å½•ï¼Œé»˜è®¤10s</span>
<span class="token assign-left variable">long_query_time</span><span class="token operator">=</span><span class="token number">10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ—¥å¿—è¯»å–ï¼š</p><ul><li><p>ç›´æ¥é€šè¿‡ cat æŒ‡ä»¤æŸ¥è¯¢è¯¥æ—¥å¿—æ–‡ä»¶ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> slow_query.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æ…¢æ—¥å¿—è¯»å–1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li><li><p>å¦‚æœæ…¢æŸ¥è¯¢æ—¥å¿—å†…å®¹å¾ˆå¤šï¼Œç›´æ¥æŸ¥çœ‹æ–‡ä»¶æ¯”è¾ƒç¹çï¼Œå¯ä»¥å€ŸåŠ© mysql è‡ªå¸¦çš„ mysqldumpslow å·¥å…·å¯¹æ…¢æŸ¥è¯¢æ—¥å¿—è¿›è¡Œåˆ†ç±»æ±‡æ€»ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldumpslow slow_query.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/MySQL-æ…¢æ—¥å¿—è¯»å–2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></li></ul><hr><h2 id="èŒƒå¼" tabindex="-1"><a class="header-anchor" href="#èŒƒå¼" aria-hidden="true">#</a> èŒƒå¼</h2><h3 id="ç¬¬ä¸€èŒƒå¼" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€èŒƒå¼" aria-hidden="true">#</a> ç¬¬ä¸€èŒƒå¼</h3><p>å»ºç«‹ç§‘å­¦çš„ï¼Œ<strong>è§„èŒƒçš„æ•°æ®è¡¨</strong>å°±éœ€è¦æ»¡è¶³ä¸€äº›è§„åˆ™æ¥ä¼˜åŒ–æ•°æ®çš„è®¾è®¡å’Œå­˜å‚¨ï¼Œè¿™äº›è§„åˆ™å°±ç§°ä¸ºèŒƒå¼</p><p>**1NFï¼š**æ•°æ®åº“è¡¨çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ï¼Œä¸èƒ½æ˜¯é›†åˆã€æ•°ç»„ç­‰éåŸå­æ•°æ®é¡¹ã€‚å³è¡¨ä¸­çš„æŸä¸ªåˆ—æœ‰å¤šä¸ªå€¼æ—¶ï¼Œå¿…é¡»æ‹†åˆ†ä¸ºä¸åŒçš„åˆ—ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<strong>ç¬¬ä¸€èŒƒå¼æ¯ä¸€åˆ—ä¸å¯å†æ‹†åˆ†ï¼Œç§°ä¸ºåŸå­æ€§</strong></p><p>åŸºæœ¬è¡¨ï¼š</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/æ™®é€šè¡¨.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ç¬¬ä¸€èŒƒå¼è¡¨ï¼š</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/ç¬¬ä¸€èŒƒå¼.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h3 id="ç¬¬äºŒèŒƒå¼" tabindex="-1"><a class="header-anchor" href="#ç¬¬äºŒèŒƒå¼" aria-hidden="true">#</a> ç¬¬äºŒèŒƒå¼</h3><p>**2NFï¼š**åœ¨æ»¡è¶³ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéä¸»å±æ€§å®Œå…¨ä¾èµ–äºä¸»ç ï¼ˆä¸»å…³é”®å­—ã€ä¸»é”®ï¼‰ï¼Œæ¶ˆé™¤éä¸»å±æ€§å¯¹ä¸»ç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<strong>è¡¨ä¸­çš„æ¯ä¸€ä¸ªå­—æ®µ ï¼ˆæ‰€æœ‰åˆ—ï¼‰éƒ½å®Œå…¨ä¾èµ–äºä¸»é”®ï¼Œè®°å½•çš„å”¯ä¸€æ€§</strong></p><p>ä½œç”¨ï¼šéµå®ˆç¬¬äºŒèŒƒå¼å‡å°‘æ•°æ®å†—ä½™ï¼Œé€šè¿‡ä¸»é”®åŒºåˆ†ç›¸åŒæ•°æ®ã€‚</p><ol><li>å‡½æ•°ä¾èµ–ï¼šA â†’ Bï¼Œå¦‚æœé€šè¿‡ A å±æ€§(å±æ€§ç»„)çš„å€¼ï¼Œå¯ä»¥ç¡®å®šå”¯ä¸€ B å±æ€§çš„å€¼ï¼Œåˆ™ç§° B ä¾èµ–äº A <ul><li>å­¦å· â†’ å§“åï¼›(å­¦å·ï¼Œè¯¾ç¨‹åç§°) â†’ åˆ†æ•°</li></ul></li><li>å®Œå…¨å‡½æ•°ä¾èµ–ï¼šA â†’ Bï¼Œå¦‚æœAæ˜¯ä¸€ä¸ªå±æ€§ç»„ï¼Œåˆ™ B å±æ€§å€¼çš„ç¡®å®šéœ€è¦ä¾èµ–äº A å±æ€§ç»„çš„æ‰€æœ‰å±æ€§å€¼ <ul><li>(å­¦å·ï¼Œè¯¾ç¨‹åç§°) â†’ åˆ†æ•°</li></ul></li><li>éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼šA â†’ Bï¼Œå¦‚æœ A æ˜¯ä¸€ä¸ªå±æ€§ç»„ï¼Œåˆ™ B å±æ€§å€¼çš„ç¡®å®šåªéœ€è¦ä¾èµ–äº A å±æ€§ç»„çš„æŸäº›å±æ€§å€¼ <ul><li>(å­¦å·ï¼Œè¯¾ç¨‹åç§°) â†’ å§“å</li></ul></li><li>ä¼ é€’å‡½æ•°ä¾èµ–ï¼šA â†’ Bï¼ŒB â†’ Cï¼Œå¦‚æœé€šè¿‡Aå±æ€§(å±æ€§ç»„)çš„å€¼ï¼Œå¯ä»¥ç¡®å®šå”¯ä¸€ B å±æ€§çš„å€¼ï¼Œåœ¨é€šè¿‡ B å±æ€§(å±æ€§ç»„)çš„å€¼ï¼Œå¯ä»¥ç¡®å®šå”¯ä¸€ C å±æ€§çš„å€¼ï¼Œåˆ™ç§° C ä¼ é€’å‡½æ•°ä¾èµ–äº A <ul><li>å­¦å· â†’ ç³»åï¼Œç³»å â†’ ç³»ä¸»ä»»</li></ul></li><li>ç ï¼šå¦‚æœåœ¨ä¸€å¼ è¡¨ä¸­ï¼Œä¸€ä¸ªå±æ€§æˆ–å±æ€§ç»„ï¼Œè¢«å…¶ä»–æ‰€æœ‰å±æ€§æ‰€å®Œå…¨ä¾èµ–ï¼Œåˆ™ç§°è¿™ä¸ªå±æ€§(å±æ€§ç»„)ä¸ºè¯¥è¡¨çš„ç  <ul><li>è¯¥è¡¨ä¸­çš„ç ï¼š(å­¦å·ï¼Œè¯¾ç¨‹åç§°)</li><li>ä¸»å±æ€§ï¼šç å±æ€§ç»„ä¸­çš„æ‰€æœ‰å±æ€§</li><li>éä¸»å±æ€§ï¼šé™¤ç å±æ€§ç»„ä»¥å¤–çš„å±æ€§</li></ul></li></ol><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/ç¬¬äºŒèŒƒå¼.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h3 id="ç¬¬ä¸‰èŒƒå¼" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰èŒƒå¼" aria-hidden="true">#</a> ç¬¬ä¸‰èŒƒå¼</h3><p>**3NFï¼š**åœ¨æ»¡è¶³ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œè¡¨ä¸­çš„ä»»ä½•å±æ€§ä¸ä¾èµ–äºå…¶å®ƒéä¸»å±æ€§ï¼Œæ¶ˆé™¤ä¼ é€’ä¾èµ–ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ<strong>éä¸»é”®éƒ½ç›´æ¥ä¾èµ–äºä¸»é”®ï¼Œè€Œä¸æ˜¯é€šè¿‡å…¶å®ƒçš„é”®æ¥é—´æ¥ä¾èµ–äºä¸»é”®</strong>ã€‚</p><p>ä½œç”¨ï¼šå¯ä»¥é€šè¿‡ä¸»é”® id åŒºåˆ†ç›¸åŒæ•°æ®ï¼Œä¿®æ”¹æ•°æ®çš„æ—¶å€™åªéœ€è¦ä¿®æ”¹ä¸€å¼ è¡¨ï¼ˆæ–¹ä¾¿ä¿®æ”¹ï¼‰ï¼Œåä¹‹éœ€è¦ä¿®æ”¹å¤šè¡¨ã€‚</p><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/ç¬¬ä¸‰èŒƒå¼.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h3><figure><img src="https://seazean.oss-cn-beijing.aliyuncs.com/img/DB/ä¸‰å¤§èŒƒå¼.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><hr></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/rockbenben/LearnData/edit/main/docs/æ•°æ®åº“/MySQL.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><!----></div></footer><nav class="vp-page-nav"><a class="vp-link nav-link prev" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/Java%E6%95%B0%E6%8D%AE%E5%BA%93API.html"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Javaæ•°æ®åº“API</div></a><a class="vp-link nav-link next" href="/%E6%95%B0%E6%8D%AE%E5%BA%93/Redis.html"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Redis<!----></div></a></nav><div id="comment" class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><div class="wl-reaction"><div class="wl-reaction-title">å·²åˆ°è¾¾æ–‡ç« åº•éƒ¨ï¼Œæ¬¢è¿ç•™è¨€ã€è¡¨æƒ…äº’åŠ¨~</div><ul class="wl-reaction-list"><!--[--><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-y/twemoji/13.1.0/72x72/1f44d.png" alt="èµä¸€ä¸ª"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text">èµä¸€ä¸ª</div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-y/twemoji/13.1.0/72x72/1f44f.png" alt="æ”¯æŒä¸‹"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text">æ”¯æŒä¸‹</div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-y/twemoji/13.1.0/72x72/1f60e.png" alt="æœ‰ç‚¹é…·"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text">æœ‰ç‚¹é…·</div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-y/twemoji/13.1.0/72x72/1f602.png" alt="å•¥ç©æ„"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text">å•¥ç©æ„</div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-y/twemoji/13.1.0/72x72/1f635-200d-1f4ab.png" alt="çœ‹ä¸æ‡‚"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text">çœ‹ä¸æ‡‚</div></li><!--]--></ul></div><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">ç½‘å€</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="é¢„è§ˆ"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <!--v-if--> Â å­—</div><button type="button" class="wl-btn">ç™»å½•</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> è¯„è®º</div><ul class="wl-sort"><!--[--><li class="active">æŒ‰æ­£åº</li><li class="">æŒ‰å€’åº</li><li class="">æŒ‰çƒ­åº¦</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v2.15.5</div></div></div><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-3aac6385.js" defer></script>
    <!-- çœ‹æ¿å¨˜åŒºå— -->
    <script src="/live2d-widget/autoload.js"></script>
    <!-- End çœ‹æ¿å¨˜åŒºå— -->
    <script src="https://oss.newzone.top/instantpage.min.js" type="module"></script>
  </body>
</html>
